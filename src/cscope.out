cscope 15 $HOME/scott/branch/twemproxy-zk/src               0000814107
	@event/nc_epoll.c

18 
	~<nc_cÜe.h
>

20 #ifdeà
NC_HAVE_EPOLL


22 
	~<sys/•Şl.h
>

24 
ev’t_ba£
 *

25 
	$ev’t_ba£_ü—‹
(
Ãv’t
, 
ev’t_cb_t
 
cb
)

27 
ev’t_ba£
 *
evb
;

28 
¡©us
, 
•
;

29 
•Şl_ev’t
 *
ev’t
;

31 
	`ASSERT
(
Ãv’t
 > 0);

33 
•
 = 
	`•Şl_ü—‹
(
Ãv’t
);

34 ià(
•
 < 0) {

35 
	`log_”rÜ
("•ŞÈü—‹ oàsiz%d faed: %s", 
Ãv’t
, 
	`¡»¼Ü
(
”ºo
));

36  
NULL
;

39 
ev’t
 = 
	`nc_ÿÎoc
(
Ãv’t
, (*event));

40 ià(
ev’t
 =ğ
NULL
) {

41 
¡©us
 = 
	`şo£
(
•
);

42 ià(
¡©us
 < 0) {

43 
	`log_”rÜ
("şo£ƒ %d faed, ignÜed: %s", 
•
, 
	`¡»¼Ü
(
”ºo
));

45  
NULL
;

48 
evb
 = 
	`nc_®loc
((*evb));

49 ià(
evb
 =ğ
NULL
) {

50 
	`nc_ä“
(
ev’t
);

51 
¡©us
 = 
	`şo£
(
•
);

52 ià(
¡©us
 < 0) {

53 
	`log_”rÜ
("şo£ƒ %d faed, ignÜed: %s", 
•
, 
	`¡»¼Ü
(
”ºo
));

55  
NULL
;

58 
evb
->
•
 =ƒp;

59 
evb
->
ev’t
 =ƒvent;

60 
evb
->
Ãv’t
 =‚event;

61 
evb
->
cb
 = cb;

63 
	`log_debug
(
LOG_INFO
, "%d w™h‚ev’ˆ%d", 
evb
->
•
,ƒvb->
Ãv’t
);

65  
evb
;

66 
	}
}

69 
	$ev’t_ba£_de¡roy
(
ev’t_ba£
 *
evb
)

71 
¡©us
;

73 ià(
evb
 =ğ
NULL
) {

77 
	`ASSERT
(
evb
->
•
 > 0);

79 
	`nc_ä“
(
evb
->
ev’t
);

81 
¡©us
 = 
	`şo£
(
evb
->
•
);

82 ià(
¡©us
 < 0) {

83 
	`log_”rÜ
("şo£ƒ %d faed, ignÜed: %s", 
evb
->
•
, 
	`¡»¼Ü
(
”ºo
));

85 
evb
->
•
 = -1;

87 
	`nc_ä“
(
evb
);

88 
	}
}

91 
	$ev’t_add_š
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

93 
¡©us
;

94 
•Şl_ev’t
 
ev’t
;

95 
•
 = 
evb
->ep;

97 
	`ASSERT
(
•
 > 0);

98 
	`ASSERT
(
c
 !ğ
NULL
);

99 
	`ASSERT
(
c
->
sd
 > 0);

101 ià(
c
->
»cv_aùive
) {

105 
ev’t
.
ev’ts
 = (
ušt32_t
)(
EPOLLIN
 | 
EPOLLET
);

106 
ev’t
.
d©a
.
±r
 = 
c
;

108 
¡©us
 = 
	`•Şl_ùl
(
•
, 
EPOLL_CTL_MOD
, 
c
->
sd
, &
ev’t
);

109 ià(
¡©us
 < 0) {

110 
	`log_”rÜ
("•ŞÈùÈÚƒ %d sd %d faed: %s", 
•
, 
c
->
sd
,

111 
	`¡»¼Ü
(
”ºo
));

113 
c
->
»cv_aùive
 = 1;

116  
¡©us
;

117 
	}
}

120 
	$ev’t_d–_š
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

123 
	}
}

126 
	$ev’t_add_out
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

128 
¡©us
;

129 
•Şl_ev’t
 
ev’t
;

130 
•
 = 
evb
->ep;

132 
	`ASSERT
(
•
 > 0);

133 
	`ASSERT
(
c
 !ğ
NULL
);

134 
	`ASSERT
(
c
->
sd
 > 0);

135 
	`ASSERT
(
c
->
»cv_aùive
);

137 ià(
c
->
£nd_aùive
) {

141 
ev’t
.
ev’ts
 = (
ušt32_t
)(
EPOLLIN
 | 
EPOLLOUT
 | 
EPOLLET
);

142 
ev’t
.
d©a
.
±r
 = 
c
;

144 
¡©us
 = 
	`•Şl_ùl
(
•
, 
EPOLL_CTL_MOD
, 
c
->
sd
, &
ev’t
);

145 ià(
¡©us
 < 0) {

146 
	`log_”rÜ
("•ŞÈùÈÚƒ %d sd %d faed: %s", 
•
, 
c
->
sd
,

147 
	`¡»¼Ü
(
”ºo
));

149 
c
->
£nd_aùive
 = 1;

152  
¡©us
;

153 
	}
}

156 
	$ev’t_d–_out
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

158 
¡©us
;

159 
•Şl_ev’t
 
ev’t
;

160 
•
 = 
evb
->ep;

162 
	`ASSERT
(
•
 > 0);

163 
	`ASSERT
(
c
 !ğ
NULL
);

164 
	`ASSERT
(
c
->
sd
 > 0);

165 
	`ASSERT
(
c
->
»cv_aùive
);

167 ià(!
c
->
£nd_aùive
) {

171 
ev’t
.
ev’ts
 = (
ušt32_t
)(
EPOLLIN
 | 
EPOLLET
);

172 
ev’t
.
d©a
.
±r
 = 
c
;

174 
¡©us
 = 
	`•Şl_ùl
(
•
, 
EPOLL_CTL_MOD
, 
c
->
sd
, &
ev’t
);

175 ià(
¡©us
 < 0) {

176 
	`log_”rÜ
("•ŞÈùÈÚƒ %d sd %d faed: %s", 
•
, 
c
->
sd
,

177 
	`¡»¼Ü
(
”ºo
));

179 
c
->
£nd_aùive
 = 0;

182  
¡©us
;

183 
	}
}

186 
	$ev’t_add_cÚn
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

188 
¡©us
;

189 
•Şl_ev’t
 
ev’t
;

190 
•
 = 
evb
->ep;

192 
	`ASSERT
(
•
 > 0);

193 
	`ASSERT
(
c
 !ğ
NULL
);

194 
	`ASSERT
(
c
->
sd
 > 0);

196 
ev’t
.
ev’ts
 = (
ušt32_t
)(
EPOLLIN
 | 
EPOLLOUT
 | 
EPOLLET
);

197 
ev’t
.
d©a
.
±r
 = 
c
;

199 
¡©us
 = 
	`•Şl_ùl
(
•
, 
EPOLL_CTL_ADD
, 
c
->
sd
, &
ev’t
);

200 ià(
¡©us
 < 0) {

201 
	`log_”rÜ
("•ŞÈùÈÚƒ %d sd %d faed: %s", 
•
, 
c
->
sd
,

202 
	`¡»¼Ü
(
”ºo
));

204 
c
->
£nd_aùive
 = 1;

205 
c
->
»cv_aùive
 = 1;

208  
¡©us
;

209 
	}
}

212 
	$ev’t_d–_cÚn
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

214 
¡©us
;

215 
•
 = 
evb
->ep;

217 
	`ASSERT
(
•
 > 0);

218 
	`ASSERT
(
c
 !ğ
NULL
);

219 
	`ASSERT
(
c
->
sd
 > 0);

221 
¡©us
 = 
	`•Şl_ùl
(
•
, 
EPOLL_CTL_DEL
, 
c
->
sd
, 
NULL
);

222 ià(
¡©us
 < 0) {

223 
	`log_”rÜ
("•ŞÈùÈÚƒ %d sd %d faed: %s", 
•
, 
c
->
sd
,

224 
	`¡»¼Ü
(
”ºo
));

226 
c
->
»cv_aùive
 = 0;

227 
c
->
£nd_aùive
 = 0;

230  
¡©us
;

231 
	}
}

234 
	$ev’t_wa™
(
ev’t_ba£
 *
evb
, 
timeout
)

236 
•
 = 
evb
->ep;

237 
•Şl_ev’t
 *
ev’t
 = 
evb
->event;

238 
Ãv’t
 = 
evb
->nevent;

240 
	`ASSERT
(
•
 > 0);

241 
	`ASSERT
(
ev’t
 !ğ
NULL
);

242 
	`ASSERT
(
Ãv’t
 > 0);

245 
i
, 
nsd
;

247 
nsd
 = 
	`•Şl_wa™
(
•
, 
ev’t
, 
Ãv’t
, 
timeout
);

248 ià(
nsd
 > 0) {

249 
i
 = 0; i < 
nsd
; i++) {

250 
•Şl_ev’t
 *
ev
 = &
evb
->
ev’t
[
i
];

251 
ušt32_t
 
ev’ts
 = 0;

253 
	`log_debug
(
LOG_VVERB
, "•ŞÈ%04"
PRIX32
"riggered on conn %p",

254 
ev
->
ev’ts
,ƒv->
d©a
.
±r
);

256 ià(
ev
->
ev’ts
 & 
EPOLLERR
) {

257 
ev’ts
 |ğ
EVENT_ERR
;

260 ià(
ev
->
ev’ts
 & (
EPOLLIN
 | 
EPOLLHUP
)) {

261 
ev’ts
 |ğ
EVENT_READ
;

264 ià(
ev
->
ev’ts
 & 
EPOLLOUT
) {

265 
ev’ts
 |ğ
EVENT_WRITE
;

268 ià(
evb
->
cb
 !ğ
NULL
) {

269 
evb
->
	`cb
(
ev
->
d©a
.
±r
, 
ev’ts
);

272  
nsd
;

275 ià(
nsd
 == 0) {

276 ià(
timeout
 == -1) {

277 
	`log_”rÜ
("epoll wait onƒ %d with %dƒvents‡nd %dimeout "

278 "»tuºed‚Øev’ts", 
•
, 
Ãv’t
, 
timeout
);

285 ià(
”ºo
 =ğ
EINTR
) {

289 
	`log_”rÜ
("•ŞÈwa™ oÀ%d w™h %dƒv’t çed: %s", 
•
, 
Ãv’t
,

290 
	`¡»¼Ü
(
”ºo
));

294 
	`NOT_REACHED
();

295 
	}
}

298 
	$ev’t_loİ_¡©s
(
ev’t_¡©s_cb_t
 
cb
, *
¬g
)

300 
¡©s
 *
¡
 = 
¬g
;

301 
¡©us
, 
•
;

302 
•Şl_ev’t
 
ev
;

304 
•
 = 
	`•Şl_ü—‹
(1);

305 ià(
•
 < 0) {

306 
	`log_”rÜ
("•ŞÈü—‹ faed: %s", 
	`¡»¼Ü
(
”ºo
));

310 
ev
.
d©a
.
fd
 = 
¡
->
sd
;

311 
ev
.
ev’ts
 = 
EPOLLIN
;

313 
¡©us
 = 
	`•Şl_ùl
(
•
, 
EPOLL_CTL_ADD
, 
¡
->
sd
, &
ev
);

314 ià(
¡©us
 < 0) {

315 
	`log_”rÜ
("•ŞÈùÈÚƒ %d sd %d faed: %s", 
•
, 
¡
->
sd
,

316 
	`¡»¼Ü
(
”ºo
));

317 
”rÜ
;

321 
n
;

323 
n
 = 
	`•Şl_wa™
(
•
, &
ev
, 1, 
¡
->
š‹rv®
);

324 ià(
n
 < 0) {

325 ià(
”ºo
 =ğ
EINTR
) {

328 
	`log_”rÜ
("•ŞÈwa™ oÀ%d w™h m %d faed: %s", 
•
,

329 
¡
->
sd
, 
	`¡»¼Ü
(
”ºo
));

333 
	`cb
(
¡
, &
n
);

336 
”rÜ
:

337 
¡©us
 = 
	`şo£
(
•
);

338 ià(
¡©us
 < 0) {

339 
	`log_”rÜ
("şo£ƒ %d faed, ignÜed: %s", 
•
, 
	`¡»¼Ü
(
”ºo
));

341 
•
 = -1;

342 
	}
}

	@event/nc_event.h

18 #iâdeà
_NC_EVENT_H_


19 
	#_NC_EVENT_H_


	)

21 
	~<nc_cÜe.h
>

23 
	#EVENT_SIZE
 1024

	)

25 
	#EVENT_READ
 0x0000ff

	)

26 
	#EVENT_WRITE
 0x00ff00

	)

27 
	#EVENT_ERR
 0xff0000

	)

29 (*
	tev’t_cb_t
)(*, 
	tušt32_t
);

30 (*
	tev’t_¡©s_cb_t
)(*, *);

32 #ifdeà
NC_HAVE_KQUEUE


34 
	sev’t_ba£
 {

35 
kq
;

37 
kev’t
 *
chªge
;

38 
nchªge
;

40 
kev’t
 *
ev’t
;

41 
Ãv’t
;

42 
Ä‘uºed
;

43 
Åroûs£d
;

45 
ev’t_cb_t
 
cb
;

48 #–ià
NC_HAVE_EPOLL


50 
	sev’t_ba£
 {

51 
•
;

53 
•Şl_ev’t
 *
ev’t
;

54 
Ãv’t
;

56 
ev’t_cb_t
 
cb
;

59 #–ià
NC_HAVE_EVENT_PORTS


61 
	~<pÜt.h
>

63 
	sev’t_ba£
 {

64 
evp
;

66 
pÜt_ev’t_t
 *
ev’t
;

67 
Ãv’t
;

69 
ev’t_cb_t
 
cb
;

73 #”rÜ 
missšg
 
sÿÏbË
 
I
/
O
 
ev’t
 
nÙifiÿtiÚ
 
mechªism


76 
ev’t_ba£
 *
	`ev’t_ba£_ü—‹
(
size
, 
ev’t_cb_t
 
cb
);

77 
	`ev’t_ba£_de¡roy
(
ev’t_ba£
 *
evb
);

79 
	`ev’t_add_š
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
);

80 
	`ev’t_d–_š
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
);

81 
	`ev’t_add_out
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
);

82 
	`ev’t_d–_out
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
);

83 
	`ev’t_add_cÚn
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
);

84 
	`ev’t_d–_cÚn
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
);

85 
	`ev’t_wa™
(
ev’t_ba£
 *
evb
, 
timeout
);

86 
	`ev’t_loİ_¡©s
(
ev’t_¡©s_cb_t
 
cb
, *
¬g
);

	@event/nc_evport.c

18 
	~<nc_cÜe.h
>

20 #ifdeà
NC_HAVE_EVENT_PORTS


22 
	~<pÜt.h
>

23 
	~<pŞl.h
>

25 
ev’t_ba£
 *

26 
	$ev’t_ba£_ü—‹
(
Ãv’t
, 
ev’t_cb_t
 
cb
)

28 
ev’t_ba£
 *
evb
;

29 
¡©us
, 
evp
;

30 
pÜt_ev’t_t
 *
ev’t
;

32 
	`ASSERT
(
Ãv’t
 > 0);

34 
evp
 = 
	`pÜt_ü—‹
();

35 ià(
evp
 < 0) {

36 
	`log_”rÜ
("pÜˆü—‹ faed: %s", 
	`¡»¼Ü
(
”ºo
));

37  
NULL
;

40 
ev’t
 = 
	`nc_ÿÎoc
(
Ãv’t
, (*event));

41 ià(
ev’t
 =ğ
NULL
) {

42 
¡©us
 = 
	`şo£
(
evp
);

43 ià(
¡©us
 < 0) {

44 
	`log_”rÜ
("şo£ƒv°%d faed, ignÜed: %s", 
evp
, 
	`¡»¼Ü
(
”ºo
));

46  
NULL
;

49 
evb
 = 
	`nc_®loc
((*evb));

50 ià(
evb
 =ğ
NULL
) {

51 
	`nc_ä“
(
ev’t
);

52 
¡©us
 = 
	`şo£
(
evp
);

53 ià(
¡©us
 < 0) {

54 
	`log_”rÜ
("şo£ƒv°%d faed, ignÜed: %s", 
evp
, 
	`¡»¼Ü
(
”ºo
));

56  
NULL
;

59 
evb
->
evp
 =ƒvp;

60 
evb
->
ev’t
 =ƒvent;

61 
evb
->
Ãv’t
 =‚event;

62 
evb
->
cb
 = cb;

64 
	`log_debug
(
LOG_INFO
, "ev°%d w™h‚ev’ˆ%d", 
evb
->
evp
,ƒvb->
Ãv’t
);

66  
evb
;

67 
	}
}

70 
	$ev’t_ba£_de¡roy
(
ev’t_ba£
 *
evb
)

72 
¡©us
;

74 ià(
evb
 =ğ
NULL
) {

78 
	`ASSERT
(
evb
->
evp
 >= 0);

80 
	`nc_ä“
(
evb
->
ev’t
);

82 
¡©us
 = 
	`şo£
(
evb
->
evp
);

83 ià(
¡©us
 < 0) {

84 
	`log_”rÜ
("şo£ƒv°%d faed, ignÜed: %s", 
evb
->
evp
, 
	`¡»¼Ü
(
”ºo
));

86 
evb
->
evp
 = -1;

88 
	`nc_ä“
(
evb
);

89 
	}
}

92 
	$ev’t_add_š
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

95 
	}
}

98 
	$ev’t_d–_š
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

101 
	}
}

104 
	$ev’t_add_out
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

106 
¡©us
;

107 
evp
 = 
evb
->evp;

109 
	`ASSERT
(
evp
 > 0);

110 
	`ASSERT
(
c
 !ğ
NULL
);

111 
	`ASSERT
(
c
->
sd
 > 0);

112 
	`ASSERT
(
c
->
»cv_aùive
);

114 ià(
c
->
£nd_aùive
) {

118 
¡©us
 = 
	`pÜt_assocŸ‹
(
evp
, 
PORT_SOURCE_FD
, 
c
->
sd
, 
POLLIN
 | 
POLLOUT
, c);

119 ià(
¡©us
 < 0) {

120 
	`log_”rÜ
("pÜˆassocŸ‹ oÀev°%d sd %d faed: %s", 
evp
, 
c
->
sd
,

121 
	`¡»¼Ü
(
”ºo
));

123 
c
->
£nd_aùive
 = 1;

126  
¡©us
;

127 
	}
}

130 
	$ev’t_d–_out
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

132 
¡©us
;

133 
evp
 = 
evb
->evp;

135 
	`ASSERT
(
evp
 > 0);

136 
	`ASSERT
(
c
 !ğ
NULL
);

137 
	`ASSERT
(
c
->
sd
 > 0);

138 
	`ASSERT
(
c
->
»cv_aùive
);

140 ià(!
c
->
£nd_aùive
) {

144 
¡©us
 = 
	`pÜt_assocŸ‹
(
evp
, 
PORT_SOURCE_FD
, 
c
->
sd
, 
POLLIN
, c);

145 ià(
¡©us
 < 0) {

146 
	`log_”rÜ
("pÜˆassocŸ‹ oÀev°%d sd %d faed: %s", 
evp
, 
c
->
sd
,

147 
	`¡»¼Ü
(
”ºo
));

149 
c
->
£nd_aùive
 = 0;

152  
¡©us
;

153 
	}
}

156 
	$ev’t_add_cÚn
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

158 
¡©us
;

159 
evp
 = 
evb
->evp;

161 
	`ASSERT
(
evp
 > 0);

162 
	`ASSERT
(
c
 !ğ
NULL
);

163 
	`ASSERT
(
c
->
sd
 > 0);

164 
	`ASSERT
(!
c
->
»cv_aùive
);

165 
	`ASSERT
(!
c
->
£nd_aùive
);

167 
¡©us
 = 
	`pÜt_assocŸ‹
(
evp
, 
PORT_SOURCE_FD
, 
c
->
sd
, 
POLLIN
 | 
POLLOUT
, c);

168 ià(
¡©us
 < 0) {

169 
	`log_”rÜ
("pÜˆassocŸ‹ oÀev°%d sd %d faed: %s", 
evp
, 
c
->
sd
,

170 
	`¡»¼Ü
(
”ºo
));

172 
c
->
£nd_aùive
 = 1;

173 
c
->
»cv_aùive
 = 1;

176  
¡©us
;

177 
	}
}

180 
	$ev’t_d–_cÚn
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

182 
¡©us
;

183 
evp
 = 
evb
->evp;

185 
	`ASSERT
(
evp
 > 0);

186 
	`ASSERT
(
c
 !ğ
NULL
);

187 
	`ASSERT
(
c
->
sd
 > 0);

189 ià(!
c
->
£nd_aùive
 && !c->
»cv_aùive
) {

202 
¡©us
 = 
	`pÜt_dissocŸ‹
(
evp
, 
PORT_SOURCE_FD
, 
c
->
sd
);

203 ià(
¡©us
 < 0 && 
”ºo
 !ğ
ENOENT
) {

204 
	`log_”rÜ
("pÜˆdissocŸ‹ƒv°%d sd %d faed: %s", 
evp
, 
c
->
sd
,

205 
	`¡»¼Ü
(
”ºo
));

206  
¡©us
;

209 
c
->
»cv_aùive
 = 0;

210 
c
->
£nd_aùive
 = 0;

213 
	}
}

216 
	$ev’t_»assocŸ‹
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

218 
¡©us
, 
ev’ts
;

219 
evp
 = 
evb
->evp;

221 
	`ASSERT
(
evp
 > 0);

222 
	`ASSERT
(
c
 !ğ
NULL
);

223 
	`ASSERT
(
c
->
sd
 > 0);

224 
	`ASSERT
(
c
->
»cv_aùive
);

226 ià(
c
->
£nd_aùive
) {

227 
ev’ts
 = 
POLLIN
 | 
POLLOUT
;

229 
ev’ts
 = 
POLLIN
;

232 
¡©us
 = 
	`pÜt_assocŸ‹
(
evp
, 
PORT_SOURCE_FD
, 
c
->
sd
, 
ev’ts
 , c);

233 ià(
¡©us
 < 0) {

234 
	`log_”rÜ
("pÜˆassocŸ‹ oÀev°%d sd %d faed: %s", 
evp
, 
c
->
sd
,

235 
	`¡»¼Ü
(
”ºo
));

238  
¡©us
;

239 
	}
}

242 
	$ev’t_wa™
(
ev’t_ba£
 *
evb
, 
timeout
)

244 
evp
 = 
evb
->evp;

245 
pÜt_ev’t_t
 *
ev’t
 = 
evb
->event;

246 
Ãv’t
 = 
evb
->nevent;

247 
time¥ec
 
ts
, *
t¥
;

249 
	`ASSERT
(
evp
 > 0);

250 
	`ASSERT
(
ev’t
 !ğ
NULL
);

251 
	`ASSERT
(
Ãv’t
 > 0);

254 ià(
timeout
 < 0) {

255 
t¥
 = 
NULL
;

257 
t¥
 = &
ts
;

258 
t¥
->
tv_£c
 = 
timeout
 / 1000LL;

259 
t¥
->
tv_n£c
 = (
timeout
 % 1000LL) * 1000000LL;

263 
i
, 
¡©us
;

264 
Ä‘uºed
 = 1;

274 
¡©us
 = 
	`pÜt_g‘n
(
evp
, 
ev’t
, 
Ãv’t
, &
Ä‘uºed
, 
t¥
);

275 ià(
¡©us
 < 0) {

276 ià(
”ºo
 =ğ
EINTR
 ||ƒ¼nØ=ğ
EAGAIN
) {

285 ià(
”ºo
 !ğ
ETIME
) {

286 
	`log_”rÜ
("pÜˆg‘ÀÚƒv°%d w™h %dƒv’t çed: %s", 
evp
,

287 
Ãv’t
, 
	`¡»¼Ü
(
”ºo
));

292 ià(
Ä‘uºed
 > 0) {

293 
i
 = 0; i < 
Ä‘uºed
; i++) {

294 
pÜt_ev’t_t
 *
ev
 = &
evb
->
ev’t
[
i
];

295 
ušt32_t
 
ev’ts
 = 0;

297 
	`log_debug
(
LOG_VVERB
, "pÜˆ%04"
PRIX32
" from source %d "

298 "Œigg”ed oÀcÚÀ%p", 
ev
->
pÜ‹v_ev’ts
,

299 
ev
->
pÜ‹v_sourû
,ƒv->
pÜ‹v_u£r
);

301 ià(
ev
->
pÜ‹v_ev’ts
 & 
POLLERR
) {

302 
ev’ts
 |ğ
EVENT_ERR
;

305 ià(
ev
->
pÜ‹v_ev’ts
 & 
POLLIN
) {

306 
ev’ts
 |ğ
EVENT_READ
;

309 ià(
ev
->
pÜ‹v_ev’ts
 & 
POLLOUT
) {

310 
ev’ts
 |ğ
EVENT_WRITE
;

313 ià(
evb
->
cb
 !ğ
NULL
 && 
ev’ts
 != 0) {

314 
¡©us
 = 
evb
->
	`cb
(
ev
->
pÜ‹v_u£r
, 
ev’ts
);

315 ià(
¡©us
 < 0) {

332 
	`ev’t_»assocŸ‹
(
evb
, 
ev
->
pÜ‹v_u£r
);

336  
Ä‘uºed
;

339 ià(
timeout
 == -1) {

340 
	`log_”rÜ
("port getn onƒvp %d with %dƒvents‡nd %dimeout "

341 "»tuºed‚Øev’ts", 
evp
, 
Ãv’t
, 
timeout
);

348 
	`NOT_REACHED
();

349 
	}
}

352 
	$ev’t_loİ_¡©s
(
ev’t_¡©s_cb_t
 
cb
, *
¬g
)

354 
¡©s
 *
¡
 = 
¬g
;

355 
¡©us
, 
evp
;

356 
pÜt_ev’t_t
 
ev’t
;

357 
time¥ec
 
ts
, *
t¥
;

359 
evp
 = 
	`pÜt_ü—‹
();

360 ià(
evp
 < 0) {

361 
	`log_”rÜ
("pÜˆü—‹ faed: %s", 
	`¡»¼Ü
(
”ºo
));

365 
¡©us
 = 
	`pÜt_assocŸ‹
(
evp
, 
PORT_SOURCE_FD
, 
¡
->
sd
, 
POLLIN
, 
NULL
);

366 ià(
¡©us
 < 0) {

367 
	`log_”rÜ
("pÜˆassocŸ‹ oÀev°%d sd %d faed: %s", 
evp
, 
¡
->
sd
,

368 
	`¡»¼Ü
(
”ºo
));

369 
”rÜ
;

373 ià(
¡
->
š‹rv®
 < 0) {

374 
t¥
 = 
NULL
;

376 
t¥
 = &
ts
;

377 
t¥
->
tv_£c
 = 
¡
->
š‹rv®
 / 1000LL;

378 
t¥
->
tv_n£c
 = (
¡
->
š‹rv®
 % 1000LL) * 1000000LL;

383 
Ä‘uºed
 = 1;

385 
¡©us
 = 
	`pÜt_g‘n
(
evp
, &
ev’t
, 1, &
Ä‘uºed
, 
t¥
);

386 ià(
¡©us
 !ğ
NC_OK
) {

387 ià(
”ºo
 =ğ
EINTR
 ||ƒ¼nØ=ğ
EAGAIN
) {

391 ià(
”ºo
 !ğ
ETIME
) {

392 
	`log_”rÜ
("pÜˆg‘ÀÚƒv°%d w™h m %d faed: %s", 
evp
,

393 
¡
->
sd
, 
	`¡»¼Ü
(
”ºo
));

394 
”rÜ
;

398 
	`ASSERT
(
Ä‘uºed
 <= 1);

400 ià(
Ä‘uºed
 == 1) {

402 
¡©us
 = 
	`pÜt_assocŸ‹
(
evp
, 
PORT_SOURCE_FD
, 
¡
->
sd
, 
POLLIN
, 
NULL
);

403 ià(
¡©us
 < 0) {

404 
	`log_”rÜ
("pÜˆassocŸ‹ oÀev°%d sd %d faed: %s", 
evp
, 
¡
->
sd
,

405 
	`¡»¼Ü
(
”ºo
));

409 
	`cb
(
¡
, &
Ä‘uºed
);

412 
”rÜ
:

413 
¡©us
 = 
	`şo£
(
evp
);

414 ià(
¡©us
 < 0) {

415 
	`log_”rÜ
("şo£ƒv°%d faed, ignÜed: %s", 
evp
, 
	`¡»¼Ü
(
”ºo
));

417 
evp
 = -1;

418 
	}
}

	@event/nc_kqueue.c

18 
	~<nc_cÜe.h
>

20 #ifdeà
NC_HAVE_KQUEUE


22 
	~<sys/ev’t.h
>

24 
ev’t_ba£
 *

25 
	$ev’t_ba£_ü—‹
(
Ãv’t
, 
ev’t_cb_t
 
cb
)

27 
ev’t_ba£
 *
evb
;

28 
¡©us
, 
kq
;

29 
kev’t
 *
chªge
, *
ev’t
;

31 
	`ASSERT
(
Ãv’t
 > 0);

33 
kq
 = 
	`kqueue
();

34 ià(
kq
 < 0) {

35 
	`log_”rÜ
("kqueuçed: %s", 
	`¡»¼Ü
(
”ºo
));

36  
NULL
;

39 
chªge
 = 
	`nc_ÿÎoc
(
Ãv’t
, (*change));

40 ià(
chªge
 =ğ
NULL
) {

41 
¡©us
 = 
	`şo£
(
kq
);

42 ià(
¡©us
 < 0) {

43 
	`log_”rÜ
("şo£ kq %d faed, ignÜed: %s", 
kq
, 
	`¡»¼Ü
(
”ºo
));

45  
NULL
;

48 
ev’t
 = 
	`nc_ÿÎoc
(
Ãv’t
, (*event));

49 ià(
ev’t
 =ğ
NULL
) {

50 
	`nc_ä“
(
chªge
);

51 
¡©us
 = 
	`şo£
(
kq
);

52 ià(
¡©us
 < 0) {

53 
	`log_”rÜ
("şo£ kq %d faed, ignÜed: %s", 
kq
, 
	`¡»¼Ü
(
”ºo
));

55  
NULL
;

58 
evb
 = 
	`nc_®loc
((*evb));

59 ià(
evb
 =ğ
NULL
) {

60 
	`nc_ä“
(
chªge
);

61 
	`nc_ä“
(
ev’t
);

62 
¡©us
 = 
	`şo£
(
kq
);

63 ià(
¡©us
 < 0) {

64 
	`log_”rÜ
("şo£ kq %d faed, ignÜed: %s", 
kq
, 
	`¡»¼Ü
(
”ºo
));

66  
NULL
;

69 
evb
->
kq
 = kq;

70 
evb
->
chªge
 = change;

71 
evb
->
nchªge
 = 0;

72 
evb
->
ev’t
 =ƒvent;

73 
evb
->
Ãv’t
 =‚event;

74 
evb
->
Ä‘uºed
 = 0;

75 
evb
->
Åroûs£d
 = 0;

76 
evb
->
cb
 = cb;

78 
	`log_debug
(
LOG_INFO
, "kq %d w™h‚ev’ˆ%d", 
evb
->
kq
,ƒvb->
Ãv’t
);

80  
evb
;

81 
	}
}

84 
	$ev’t_ba£_de¡roy
(
ev’t_ba£
 *
evb
)

86 
¡©us
;

88 ià(
evb
 =ğ
NULL
) {

92 
	`ASSERT
(
evb
->
kq
 > 0);

94 
	`nc_ä“
(
evb
->
chªge
);

95 
	`nc_ä“
(
evb
->
ev’t
);

97 
¡©us
 = 
	`şo£
(
evb
->
kq
);

98 ià(
¡©us
 < 0) {

99 
	`log_”rÜ
("şo£ kq %d faed, ignÜed: %s", 
evb
->
kq
, 
	`¡»¼Ü
(
”ºo
));

101 
evb
->
kq
 = -1;

103 
	`nc_ä“
(
evb
);

104 
	}
}

107 
	$ev’t_add_š
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

109 
kev’t
 *
ev’t
;

111 
	`ASSERT
(
evb
->
kq
 > 0);

112 
	`ASSERT
(
c
 !ğ
NULL
);

113 
	`ASSERT
(
c
->
sd
 > 0);

114 
	`ASSERT
(
evb
->
nchªge
 <ƒvb->
Ãv’t
);

116 ià(
c
->
»cv_aùive
) {

120 
ev’t
 = &
evb
->
chªge
[evb->
nchªge
++];

121 
	`EV_SET
(
ev’t
, 
c
->
sd
, 
EVFILT_READ
, 
EV_ADD
 | 
EV_CLEAR
, 0, 0, c);

123 
c
->
»cv_aùive
 = 1;

126 
	}
}

129 
	$ev’t_d–_š
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

131 
kev’t
 *
ev’t
;

133 
	`ASSERT
(
evb
->
kq
 > 0);

134 
	`ASSERT
(
c
 !ğ
NULL
);

135 
	`ASSERT
(
c
->
sd
 > 0);

136 
	`ASSERT
(
evb
->
nchªge
 <ƒvb->
Ãv’t
);

138 ià(!
c
->
»cv_aùive
) {

142 
ev’t
 = &
evb
->
chªge
[evb->
nchªge
++];

143 
	`EV_SET
(
ev’t
, 
c
->
sd
, 
EVFILT_READ
, 
EV_DELETE
, 0, 0, c);

145 
c
->
»cv_aùive
 = 0;

148 
	}
}

151 
	$ev’t_add_out
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

153 
kev’t
 *
ev’t
;

155 
	`ASSERT
(
evb
->
kq
 > 0);

156 
	`ASSERT
(
c
 !ğ
NULL
);

157 
	`ASSERT
(
c
->
sd
 > 0);

158 
	`ASSERT
(
c
->
»cv_aùive
);

159 
	`ASSERT
(
evb
->
nchªge
 <ƒvb->
Ãv’t
);

161 ià(
c
->
£nd_aùive
) {

165 
ev’t
 = &
evb
->
chªge
[evb->
nchªge
++];

166 
	`EV_SET
(
ev’t
, 
c
->
sd
, 
EVFILT_WRITE
, 
EV_ADD
 | 
EV_CLEAR
, 0, 0, c);

168 
c
->
£nd_aùive
 = 1;

171 
	}
}

174 
	$ev’t_d–_out
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

176 
kev’t
 *
ev’t
;

178 
	`ASSERT
(
evb
->
kq
 > 0);

179 
	`ASSERT
(
c
 !ğ
NULL
);

180 
	`ASSERT
(
c
->
sd
 > 0);

181 
	`ASSERT
(
c
->
»cv_aùive
);

182 
	`ASSERT
(
evb
->
nchªge
 <ƒvb->
Ãv’t
);

184 ià(!
c
->
£nd_aùive
) {

188 
ev’t
 = &
evb
->
chªge
[evb->
nchªge
++];

189 
	`EV_SET
(
ev’t
, 
c
->
sd
, 
EVFILT_WRITE
, 
EV_DELETE
, 0, 0, c);

191 
c
->
£nd_aùive
 = 0;

194 
	}
}

197 
	$ev’t_add_cÚn
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

199 
	`ASSERT
(
evb
->
kq
 > 0);

200 
	`ASSERT
(
c
 !ğ
NULL
);

201 
	`ASSERT
(
c
->
sd
 > 0);

202 
	`ASSERT
(!
c
->
»cv_aùive
);

203 
	`ASSERT
(!
c
->
£nd_aùive
);

204 
	`ASSERT
(
evb
->
nchªge
 <ƒvb->
Ãv’t
);

206 
	`ev’t_add_š
(
evb
, 
c
);

207 
	`ev’t_add_out
(
evb
, 
c
);

210 
	}
}

213 
	$ev’t_d–_cÚn
(
ev’t_ba£
 *
evb
, 
cÚn
 *
c
)

215 
i
;

217 
	`ASSERT
(
evb
->
kq
 > 0);

218 
	`ASSERT
(
c
 !ğ
NULL
);

219 
	`ASSERT
(
c
->
sd
 > 0);

220 
	`ASSERT
(
evb
->
nchªge
 <ƒvb->
Ãv’t
);

222 
	`ev’t_d–_out
(
evb
, 
c
);

223 
	`ev’t_d–_š
(
evb
, 
c
);

230 
i
 = 
evb
->
Åroûs£d
 + 1; i <ƒvb->
Ä‘uºed
; i++) {

231 
kev’t
 *
ev
 = &
evb
->
ev’t
[
i
];

232 ià(
ev
->
id’t
 =ğ(
ušŒ_t
)
c
->
sd
) {

233 
ev
->
æags
 = 0;

234 
ev
->
f‹r
 = 0;

240 
	}
}

243 
	$ev’t_wa™
(
ev’t_ba£
 *
evb
, 
timeout
)

245 
kq
 = 
evb
->kq;

246 
time¥ec
 
ts
, *
t¥
;

248 
	`ASSERT
(
kq
 > 0);

251 ià(
timeout
 < 0) {

252 
t¥
 = 
NULL
;

254 
t¥
 = &
ts
;

255 
t¥
->
tv_£c
 = 
timeout
 / 1000LL;

256 
t¥
->
tv_n£c
 = (
timeout
 % 1000LL) * 1000000LL;

273 
evb
->
Ä‘uºed
 = 
	`kev’t
(
kq
,ƒvb->
chªge
,ƒvb->
nchªge
,ƒvb->
ev’t
,

274 
evb
->
Ãv’t
, 
t¥
);

275 
evb
->
nchªge
 = 0;

276 ià(
evb
->
Ä‘uºed
 > 0) {

277 
evb
->
Åroûs£d
 = 0;ƒvb->Åroûs£d <ƒvb->
Ä‘uºed
;

278 
evb
->
Åroûs£d
++) {

279 
kev’t
 *
ev
 = &
evb
->
ev’t
[evb->
Åroûs£d
];

280 
ušt32_t
 
ev’ts
 = 0;

282 
	`log_debug
(
LOG_VVERB
, "kev’ˆ%04"
PRIX32
" with filter %d "

283 "Œigg”ed oÀsd %d", 
ev
->
æags
,ƒv->
f‹r
,

284 
ev
->
id’t
);

292 ià(
ev
->
æags
 & 
EV_ERROR
) {

304 ià(
ev
->
d©a
 =ğ
EBADF
 ||ƒv->d©¨=ğ
EINVAL
 ||

305 
ev
->
d©a
 =ğ
ENOENT
 ||ƒv->d©¨=ğ
EINTR
) {

308 
ev’ts
 |ğ
EVENT_ERR
;

311 ià(
ev
->
f‹r
 =ğ
EVFILT_READ
) {

312 
ev’ts
 |ğ
EVENT_READ
;

315 ià(
ev
->
f‹r
 =ğ
EVFILT_WRITE
) {

316 
ev’ts
 |ğ
EVENT_WRITE
;

319 ià(
evb
->
cb
 !ğ
NULL
 && 
ev’ts
 != 0) {

320 
evb
->
	`cb
(
ev
->
ud©a
, 
ev’ts
);

323  
evb
->
Ä‘uºed
;

326 ià(
evb
->
Ä‘uºed
 == 0) {

327 ià(
timeout
 == -1) {

328 
	`log_”rÜ
("kevent on kq %d with %dƒvents‡nd %dimeout "

329 "»tuºed‚Øev’ts", 
kq
, 
evb
->
Ãv’t
, 
timeout
);

336 ià(
”ºo
 =ğ
EINTR
) {

340 
	`log_”rÜ
("kev’ˆÚ kq %d w™h %dƒv’t çed: %s", 
kq
, 
evb
->
Ãv’t
,

341 
	`¡»¼Ü
(
”ºo
));

345 
	`NOT_REACHED
();

346 
	}
}

349 
	$ev’t_loİ_¡©s
(
ev’t_¡©s_cb_t
 
cb
, *
¬g
)

351 
¡©s
 *
¡
 = 
¬g
;

352 
¡©us
, 
kq
;

353 
kev’t
 
chªge
, 
ev’t
;

354 
time¥ec
 
ts
, *
t¥
;

356 
kq
 = 
	`kqueue
();

357 ià(
kq
 < 0) {

358 
	`log_”rÜ
("kqueuçed: %s", 
	`¡»¼Ü
(
”ºo
));

362 
	`EV_SET
(&
chªge
, 
¡
->
sd
, 
EVFILT_READ
, 
EV_ADD
 | 
EV_CLEAR
, 0, 0, 
NULL
);

365 ià(
¡
->
š‹rv®
 < 0) {

366 
t¥
 = 
NULL
;

368 
t¥
 = &
ts
;

369 
t¥
->
tv_£c
 = 
¡
->
š‹rv®
 / 1000LL;

370 
t¥
->
tv_n£c
 = (
¡
->
š‹rv®
 % 1000LL) * 1000000LL;

374 
Ä‘uºed
;

376 
Ä‘uºed
 = 
	`kev’t
(
kq
, &
chªge
, 1, &
ev’t
, 1, 
t¥
);

377 ià(
Ä‘uºed
 < 0) {

378 ià(
”ºo
 =ğ
EINTR
) {

381 
	`log_”rÜ
("kev’ˆÚ kq %d w™h m %d faed: %s", 
kq
, 
¡
->
sd
,

382 
	`¡»¼Ü
(
”ºo
));

383 
”rÜ
;

386 
	`ASSERT
(
Ä‘uºed
 <= 1);

388 ià(
Ä‘uºed
 == 1) {

389 
kev’t
 *
ev
 = &
ev’t
;

391 ià(
ev
->
æags
 & 
EV_ERROR
) {

392 ià(
ev
->
d©a
 =ğ
EINTR
) {

395 
	`log_”rÜ
("kev’ˆÚ kq %d w™h m %d faed: %s", 
kq
, 
¡
->
sd
,

396 
	`¡»¼Ü
(
ev
->
d©a
));

397 
”rÜ
;

401 
	`cb
(
¡
, &
Ä‘uºed
);

404 
”rÜ
:

405 
¡©us
 = 
	`şo£
(
kq
);

406 ià(
¡©us
 < 0) {

407 
	`log_”rÜ
("şo£ kq %d faed, ignÜed: %s", 
kq
, 
	`¡»¼Ü
(
”ºo
));

409 
kq
 = -1;

410 
	}
}

	@hashkit/nc_crc16.c

18 
	~<nc_cÜe.h
>

20 cÚ¡ 
ušt16_t
 
	güc16b
[256] = {

55 
ušt32_t


56 
	$hash_üc16
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
)

58 
ušt64_t
 
x
;

59 
ušt32_t
 
üc
 = 0;

61 
x
=0; x < 
key_Ëngth
; x++) {

62 
üc
 = (üø<< 8è^ 
üc16b
[((üø>> 8è^ *
key
++) & 0x00ff];

65  
üc
;

66 
	}
}

	@hashkit/nc_crc32.c

25 
	~<nc_cÜe.h
>

27 cÚ¡ 
ušt32_t
 
	güc32b
[256] = {

98 
ušt32_t


99 
	$hash_üc32
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
)

101 
ušt64_t
 
x
;

102 
ušt32_t
 
üc
 = 
UINT32_MAX
;

104 
x
 = 0; x < 
key_Ëngth
; x++) {

105 
üc
 = (üø>> 8è^ 
üc32b
[(üø^ (
ušt64_t
)
key
[
x
]) & 0xff];

108  ((~
üc
) >> 16) & 0x7fff;

109 
	}
}

111 
ušt32_t


112 
	$hash_üc32a
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
)

114 cÚ¡ 
ušt8_t
 *
p
 = 
key
;

115 
ušt32_t
 
üc
;

117 
üc
 = ~0U;

118 
key_Ëngth
--) {

119 
üc
 = 
üc32b
[(üø^ *
p
++) & 0xFF] ^ (crc >> 8);

122  
üc
 ^ ~0U;

123 
	}
}

	@hashkit/nc_fnv.c

18 
	~<nc_cÜe.h
>

20 
ušt64_t
 
	gFNV_64_INIT
 = 
UINT64_C
(0xcbf29ce484222325);

21 
ušt64_t
 
	gFNV_64_PRIME
 = 
UINT64_C
(0x100000001b3);

22 
ušt32_t
 
	gFNV_32_INIT
 = 2166136261UL;

23 
ušt32_t
 
	gFNV_32_PRIME
 = 16777619;

25 
ušt32_t


26 
	$hash_âv1_64
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
)

28 
ušt64_t
 
hash
 = 
FNV_64_INIT
;

29 
size_t
 
x
;

31 
x
 = 0; x < 
key_Ëngth
; x++) {

32 
hash
 *ğ
FNV_64_PRIME
;

33 
hash
 ^ğ(
ušt64_t
)
key
[
x
];

36  (
ušt32_t
)
hash
;

37 
	}
}

39 
ušt32_t


40 
	$hash_âv1a_64
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
)

42 
ušt32_t
 
hash
 = (ušt32_tè
FNV_64_INIT
;

43 
size_t
 
x
;

45 
x
 = 0; x < 
key_Ëngth
; x++) {

46 
ušt32_t
 
v®
 = (ušt32_t)
key
[
x
];

47 
hash
 ^ğ
v®
;

48 
hash
 *ğ(
ušt32_t
è
FNV_64_PRIME
;

51  
hash
;

52 
	}
}

54 
ušt32_t


55 
	$hash_âv1_32
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
)

57 
ušt32_t
 
hash
 = 
FNV_32_INIT
;

58 
size_t
 
x
;

60 
x
 = 0; x < 
key_Ëngth
; x++) {

61 
ušt32_t
 
v®
 = (ušt32_t)
key
[
x
];

62 
hash
 *ğ
FNV_32_PRIME
;

63 
hash
 ^ğ
v®
;

66  
hash
;

67 
	}
}

69 
ušt32_t


70 
	$hash_âv1a_32
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
)

72 
ušt32_t
 
hash
 = 
FNV_32_INIT
;

73 
size_t
 
x
;

75 
x
ğ0; x < 
key_Ëngth
; x++) {

76 
ušt32_t
 
v®
 = (ušt32_t)
key
[
x
];

77 
hash
 ^ğ
v®
;

78 
hash
 *ğ
FNV_32_PRIME
;

81  
hash
;

82 
	}
}

	@hashkit/nc_hashkit.h

18 #iâdeà
_NC_HASHKIT_H_


19 
	#_NC_HASHKIT_H_


	)

21 
	~<nc_cÜe.h
>

22 
	~<nc_£rv”.h
>

24 
	#HASH_CODEC
(
ACTION
) \

25 
	`ACTION
Ğ
HASH_ONE_AT_A_TIME
, 
Úe_©_a_time
 ) \

26 
	`ACTION
Ğ
HASH_MD5
, 
md5
 ) \

27 
	`ACTION
Ğ
HASH_CRC16
, 
üc16
 ) \

28 
	`ACTION
Ğ
HASH_CRC32
, 
üc32
 ) \

29 
	`ACTION
Ğ
HASH_CRC32A
, 
üc32a
 ) \

30 
	`ACTION
Ğ
HASH_FNV1_64
, 
âv1_64
 ) \

31 
	`ACTION
Ğ
HASH_FNV1A_64
, 
âv1a_64
 ) \

32 
	`ACTION
Ğ
HASH_FNV1_32
, 
âv1_32
 ) \

33 
	`ACTION
Ğ
HASH_FNV1A_32
, 
âv1a_32
 ) \

34 
	`ACTION
Ğ
HASH_HSIEH
, 
hs›h
 ) \

35 
	`ACTION
Ğ
HASH_MURMUR
, 
murmur
 ) \

36 
	`ACTION
Ğ
HASH_JENKINS
, 
j’kšs
 ) \

37 

	)

38 
	#DIST_CODEC
(
ACTION
) \

39 
	`ACTION
Ğ
DIST_KETAMA
, 
k‘ama
 ) \

40 
	`ACTION
Ğ
DIST_MODULA
, 
moduÏ
 ) \

41 
	`ACTION
Ğ
DIST_RANDOM
, 
¿ndom
 ) \

42 

	)

43 
	#DEFINE_ACTION
(
_hash
, 
_Çme
è_hash,

	)

44 
	ehash_ty³
 {

45 
HASH_CODEC
Ğ
DEFINE_ACTION
 )

46 
	mHASH_SENTINEL


47 } 
	thash_ty³_t
;

48 #undeà
DEFINE_ACTION


50 
	#DEFINE_ACTION
(
_di¡
, 
_Çme
è_di¡,

	)

51 
	edi¡_ty³
 {

52 
DIST_CODEC
Ğ
DEFINE_ACTION
 )

53 
	mDIST_SENTINEL


54 } 
	tdi¡_ty³_t
;

55 #undeà
DEFINE_ACTION


57 
ušt32_t
 
hash_Úe_©_a_time
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
);

58 
md5_sigÇtu»
(cÚ¡ *
key
, 
Ëngth
, *
»suÉ
);

59 
ušt32_t
 
hash_md5
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
);

60 
ušt32_t
 
hash_üc16
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
);

61 
ušt32_t
 
hash_üc32
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
);

62 
ušt32_t
 
hash_üc32a
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
);

63 
ušt32_t
 
hash_âv1_64
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
);

64 
ušt32_t
 
hash_âv1a_64
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
);

65 
ušt32_t
 
hash_âv1_32
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
);

66 
ušt32_t
 
hash_âv1a_32
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
);

67 
ušt32_t
 
hash_hs›h
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
);

68 
ušt32_t
 
hash_j’kšs
(cÚ¡ *
key
, 
size_t
 
Ëngth
);

69 
ušt32_t
 
hash_murmur
(cÚ¡ *
key
, 
size_t
 
Ëngth
);

71 
r¡©us_t
 
k‘ama_upd©e
(
£rv”_poŞ
 *
poŞ
);

72 
ušt32_t
 
k‘ama_di¥©ch
(
cÚtšuum
 *cÚtšuum, ušt32_ˆ
ncÚtšuum
, ušt32_ˆ
hash
);

73 
r¡©us_t
 
moduÏ_upd©e
(
£rv”_poŞ
 *
poŞ
);

74 
ušt32_t
 
moduÏ_di¥©ch
(
cÚtšuum
 *cÚtšuum, ušt32_ˆ
ncÚtšuum
, ušt32_ˆ
hash
);

75 
r¡©us_t
 
¿ndom_upd©e
(
£rv”_poŞ
 *
poŞ
);

76 
ušt32_t
 
¿ndom_di¥©ch
(
cÚtšuum
 *cÚtšuum, ušt32_ˆ
ncÚtšuum
, ušt32_ˆ
hash
);

	@hashkit/nc_hsieh.c

26 
	~<nc_cÜe.h
>

28 #undeà
g‘16b™s


29 #ià(
defšed
(
__GNUC__
è&& defšed(
__i386__
))

30 
	#g‘16b™s
(
d
è(*((cÚ¡ 
ušt16_t
 *è(d)))

	)

33 #ià!
defšed
 (
g‘16b™s
)

34 
	#g‘16b™s
(
d
è((((
ušt32_t
)(((cÚ¡ 
ušt8_t
 *)(d))[1])) << 8)\

35 +(
ušt32_t
)(((cÚ¡ 
ušt8_t
 *)(
d
))[0]è)

	)

38 
ušt32_t


39 
	$hash_hs›h
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
)

41 
ušt32_t
 
hash
 = 0, 
tmp
;

42 
»m
;

44 ià(
key_Ëngth
 <ğ0 || 
key
 =ğ
NULL
) {

48 
»m
 = 
key_Ëngth
 & 3;

49 
key_Ëngth
 >>= 2;

52 ;
key_Ëngth
 > 0; key_length--) {

53 
hash
 +ğ
	`g‘16b™s
 (
key
);

54 
tmp
 = (
	`g‘16b™s
 (
key
+2è<< 11è^ 
hash
;

55 
hash
 = (hash << 16è^ 
tmp
;

56 
key
 +ğ2* (
ušt16_t
);

57 
hash
 += hash >> 11;

61 
»m
) {

63 
hash
 +ğ
	`g‘16b™s
 (
key
);

64 
hash
 ^= hash << 16;

65 
hash
 ^ğ(
ušt32_t
)
key
[ (
ušt16_t
)] << 18;

66 
hash
 += hash >> 11;

70 
hash
 +ğ
	`g‘16b™s
 (
key
);

71 
hash
 ^= hash << 11;

72 
hash
 += hash >> 17;

76 
hash
 +ğ()(*
key
);

77 
hash
 ^= hash << 10;

78 
hash
 += hash >> 1;

85 
hash
 ^= hash << 3;

86 
hash
 += hash >> 5;

87 
hash
 ^= hash << 4;

88 
hash
 += hash >> 17;

89 
hash
 ^= hash << 25;

90 
hash
 += hash >> 6;

92  
hash
;

93 
	}
}

	@hashkit/nc_jenkins.c

30 
	~<nc_cÜe.h
>

32 
	#hashsize
(
n
è((
ušt32_t
)1<<Ò))

	)

33 
	#hashmask
(
n
è(
	`hashsize
Ò)-1)

	)

34 
	#rÙ
(
x
,
k
è(((x)<<(k)è| ((x)>>(32-(k))))

	)

36 
	#mix
(
a
,
b
,
c
) \

38 
a
 -ğ
c
;‡ ^ğ
	`rÙ
(c, 4); c +ğ
b
; \

39 
b
 -ğ
a
; b ^ğ
	`rÙ
×, 6);‡ +ğ
c
; \

40 
c
 -ğ
b
; c ^ğ
	`rÙ
(b, 8); b +ğ
a
; \

41 
a
 -ğ
c
;‡ ^ğ
	`rÙ
(c,16); c +ğ
b
; \

42 
b
 -ğ
a
; b ^ğ
	`rÙ
×,19);‡ +ğ
c
; \

43 
c
 -ğ
b
; c ^ğ
	`rÙ
(b, 4); b +ğ
a
; \

44 }

	)

46 
	#fš®
(
a
,
b
,
c
) \

48 
c
 ^ğ
b
; c -ğ
	`rÙ
(b,14); \

49 
a
 ^ğ
c
;‡ -ğ
	`rÙ
(c,11); \

50 
b
 ^ğ
a
; b -ğ
	`rÙ
(a,25); \

51 
c
 ^ğ
b
; c -ğ
	`rÙ
(b,16); \

52 
a
 ^ğ
c
;‡ -ğ
	`rÙ
(c,4); \

53 
b
 ^ğ
a
; b -ğ
	`rÙ
(a,14); \

54 
c
 ^ğ
b
; c -ğ
	`rÙ
(b,24); \

55 }

	)

57 
	#JENKINS_INITVAL
 13

	)

75 
ušt32_t


76 
	$hash_j’kšs
(cÚ¡ *
key
, 
size_t
 
Ëngth
)

78 
ušt32_t
 
a
,
b
,
c
;

79 uniÚ { cÚ¡ *
±r
; 
size_t
 
i
; } 
u
;

82 
a
 = 
b
 = 
c
 = 0xd—db“à+ ((
ušt32_t
)
Ëngth
è+ 
JENKINS_INITVAL
;

84 
u
.
±r
 = 
key
;

85 #iâdeà
WORDS_BIGENDIAN


86 ià((
u
.
i
 & 0x3) == 0)

88 cÚ¡ 
ušt32_t
 *
k
 = (cÚ¡ ušt32_ˆ*)
key
;

91 
Ëngth
 > 12)

93 
a
 +ğ
k
[0];

94 
b
 +ğ
k
[1];

95 
c
 +ğ
k
[2];

96 
	`mix
(
a
,
b
,
c
);

97 
Ëngth
 -= 12;

98 
k
 += 3;

111 
Ëngth
)

113 12: 
c
+=
k
[2]; 
b
+=k[1]; 
a
+=k[0]; ;

114 11: 
c
+=
k
[2]&0xffffff; 
b
+=k[1]; 
a
+=k[0]; ;

115 10: 
c
+=
k
[2]&0xffff; 
b
+=k[1]; 
a
+=k[0]; ;

116 9 : 
c
+=
k
[2]&0xff; 
b
+=k[1]; 
a
+=k[0]; ;

117 8 : 
b
+=
k
[1]; 
a
+=k[0]; ;

118 7 : 
b
+=
k
[1]&0xffffff; 
a
+=k[0]; ;

119 6 : 
b
+=
k
[1]&0xffff; 
a
+=k[0]; ;

120 5 : 
b
+=
k
[1]&0xff; 
a
+=k[0]; ;

121 4 : 
a
+=
k
[0]; ;

122 3 : 
a
+=
k
[0]&0xffffff; ;

123 2 : 
a
+=
k
[0]&0xffff; ;

124 1 : 
a
+=
k
[0]&0xff; ;

125 0 :  
c
;

126 :  
c
;

130 ià((
u
.
i
 & 0x1) == 0)

132 cÚ¡ 
ušt16_t
 *
k
 = (cÚ¡ ušt16_ˆ*)
key
;

133 cÚ¡ 
ušt8_t
 *
k8
;

136 
Ëngth
 > 12)

138 
a
 +ğ
k
[0] + (((
ušt32_t
)k[1])<<16);

139 
b
 +ğ
k
[2] + (((
ušt32_t
)k[3])<<16);

140 
c
 +ğ
k
[4] + (((
ušt32_t
)k[5])<<16);

141 
	`mix
(
a
,
b
,
c
);

142 
Ëngth
 -= 12;

143 
k
 += 6;

147 
k8
 = (cÚ¡ 
ušt8_t
 *)
k
;

148 
Ëngth
)

150 12: 
c
+=
k
[4]+(((
ušt32_t
)k[5])<<16);

151 
b
+=
k
[2]+(((
ušt32_t
)k[3])<<16);

152 
a
+=
k
[0]+(((
ušt32_t
)k[1])<<16);

154 11: 
c
+=((
ušt32_t
)
k8
[10])<<16;

155 10: 
c
+=
k
[4];

156 
b
+=
k
[2]+(((
ušt32_t
)k[3])<<16);

157 
a
+=
k
[0]+(((
ušt32_t
)k[1])<<16);

159 9 : 
c
+=
k8
[8];

160 8 : 
b
+=
k
[2]+(((
ušt32_t
)k[3])<<16);

161 
a
+=
k
[0]+(((
ušt32_t
)k[1])<<16);

163 7 : 
b
+=((
ušt32_t
)
k8
[6])<<16;

164 6 : 
b
+=
k
[2];

165 
a
+=
k
[0]+(((
ušt32_t
)k[1])<<16);

167 5 : 
b
+=
k8
[4];

168 4 : 
a
+=
k
[0]+(((
ušt32_t
)k[1])<<16);

170 3 : 
a
+=((
ušt32_t
)
k8
[2])<<16;

171 2 : 
a
+=
k
[0];

173 1 : 
a
+=
k8
[0];

175 0 :  
c
;

176 :  
c
;

183 cÚ¡ 
ušt8_t
 *
k
 = (cÚ¡ ušt8_ˆ*)
key
;

186 
Ëngth
 > 12)

188 
a
 +ğ
k
[0];

189 
a
 +ğ((
ušt32_t
)
k
[1])<<8;

190 
a
 +ğ((
ušt32_t
)
k
[2])<<16;

191 
a
 +ğ((
ušt32_t
)
k
[3])<<24;

192 
b
 +ğ
k
[4];

193 
b
 +ğ((
ušt32_t
)
k
[5])<<8;

194 
b
 +ğ((
ušt32_t
)
k
[6])<<16;

195 
b
 +ğ((
ušt32_t
)
k
[7])<<24;

196 
c
 +ğ
k
[8];

197 
c
 +ğ((
ušt32_t
)
k
[9])<<8;

198 
c
 +ğ((
ušt32_t
)
k
[10])<<16;

199 
c
 +ğ((
ušt32_t
)
k
[11])<<24;

200 
	`mix
(
a
,
b
,
c
);

201 
Ëngth
 -= 12;

202 
k
 += 12;

206 
Ëngth
)

208 12: 
c
+=((
ušt32_t
)
k
[11])<<24;

209 11: 
c
+=((
ušt32_t
)
k
[10])<<16;

210 10: 
c
+=((
ušt32_t
)
k
[9])<<8;

211 9 : 
c
+=
k
[8];

212 8 : 
b
+=((
ušt32_t
)
k
[7])<<24;

213 7 : 
b
+=((
ušt32_t
)
k
[6])<<16;

214 6 : 
b
+=((
ušt32_t
)
k
[5])<<8;

215 5 : 
b
+=
k
[4];

216 4 : 
a
+=((
ušt32_t
)
k
[3])<<24;

217 3 : 
a
+=((
ušt32_t
)
k
[2])<<16;

218 2 : 
a
+=((
ušt32_t
)
k
[1])<<8;

219 1 : 
a
+=
k
[0];

221 0 :  
c
;

222  :  
c
;

224 #iâdeà
WORDS_BIGENDIAN


228 
	`fš®
(
a
,
b
,
c
);

229  
c
;

230 
	}
}

	@hashkit/nc_ketama.c

18 
	~<¡dio.h
>

19 
	~<¡dlib.h
>

20 
	~<m©h.h
>

22 
	~<nc_cÜe.h
>

23 
	~<nc_£rv”.h
>

24 
	~<nc_hashk™.h
>

26 
	#KETAMA_CONTINUUM_ADDITION
 10

	)

27 
	#KETAMA_POINTS_PER_SERVER
 160

	)

28 
	#KETAMA_MAX_HOSTLEN
 86

	)

30 
ušt32_t


31 
	$k‘ama_hash
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
, 
ušt32_t
 
®ignm’t
)

33 
»suÉs
[16];

35 
	`md5_sigÇtu»
((*)
key
, 
key_Ëngth
, 
»suÉs
);

37  ((
ušt32_t
è(
»suÉs
[3 + 
®ignm’t
 * 4] & 0xFF) << 24)

38 | ((
ušt32_t
è(
»suÉs
[2 + 
®ignm’t
 * 4] & 0xFF) << 16)

39 | ((
ušt32_t
è(
»suÉs
[1 + 
®ignm’t
 * 4] & 0xFF) << 8)

40 | (
»suÉs
[0 + 
®ignm’t
 * 4] & 0xFF);

41 
	}
}

44 
	$k‘ama_™em_cmp
(cÚ¡ *
t1
, cÚ¡ *
t2
)

46 cÚ¡ 
cÚtšuum
 *
ù1
 = 
t1
, *
ù2
 = 
t2
;

48 ià(
ù1
->
v®ue
 =ğ
ù2
->value) {

50 } ià(
ù1
->
v®ue
 > 
ù2
->value) {

55 
	}
}

57 
r¡©us_t


58 
	$k‘ama_upd©e
(
£rv”_poŞ
 *
poŞ
)

60 
ušt32_t
 
n£rv”
;

61 
ušt32_t
 
Æive_£rv”
;

62 
ušt32_t
 
poš‹r_³r_£rv”
;

63 
ušt32_t
 
poš‹r_³r_hash
;

64 
ušt32_t
 
poš‹r_couÁ”
;

65 
ušt32_t
 
poš‹r_šdex
;

66 
ušt32_t
 
pošts_³r_£rv”
;

67 
ušt32_t
 
cÚtšuum_šdex
;

68 
ušt32_t
 
cÚtšuum_add™iÚ
;

69 
ušt32_t
 
£rv”_šdex
;

70 
ušt32_t
 
v®ue
;

71 
ušt32_t
 
tÙ®_weight
;

72 
št64_t
 
now
;

74 
	`ASSERT
(
	`¬¿y_n
(&
poŞ
->
£rv”
) > 0);

76 
now
 = 
	`nc_u£c_now
();

77 ià(
now
 < 0) {

78  
NC_ERROR
;

85 
n£rv”
 = 
	`¬¿y_n
(&
poŞ
->
£rv”
);

86 
Æive_£rv”
 = 0;

87 
tÙ®_weight
 = 0;

88 
poŞ
->
Ãxt_»bud
 = 0LL;

89 
£rv”_šdex
 = 0; s”v”_šdex < 
n£rv”
; server_index++) {

90 
£rv”
 *£rv” = 
	`¬¿y_g‘
(&
poŞ
->£rv”, 
£rv”_šdex
);

92 ià(
poŞ
->
auto_ejeù_ho¡s
) {

93 ià(
£rv”
->
Ãxt_»Œy
 <ğ
now
) {

94 
£rv”
->
Ãxt_»Œy
 = 0LL;

95 
Æive_£rv”
++;

96 } ià(
poŞ
->
Ãxt_»bud
 == 0LL ||

97 
£rv”
->
Ãxt_»Œy
 < 
poŞ
->
Ãxt_»bud
) {

98 
poŞ
->
Ãxt_»bud
 = 
£rv”
->
Ãxt_»Œy
;

101 
Æive_£rv”
++;

104 
	`ASSERT
(
£rv”
->
weight
 > 0);

107 ià(!
poŞ
->
auto_ejeù_ho¡s
 || 
£rv”
->
Ãxt_»Œy
 <ğ
now
) {

108 
tÙ®_weight
 +ğ
£rv”
->
weight
;

112 
poŞ
->
Æive_£rv”
 =‚live_server;

114 ià(
Æive_£rv”
 == 0) {

115 
	`log_debug
(
LOG_DEBUG
, "nØliv£rv” fÜ…oŞ %"
PRIu32
" '%.*s'",

116 
poŞ
->
idx
,…oŞ->
Çme
.
Ën
,…oŞ->Çme.
d©a
);

118  
NC_OK
;

120 
	`log_debug
(
LOG_DEBUG
, "%"
PRIu32
" of %"PRIu32" servers‡re†ive for…ool "

121 "%"
PRIu32
" '%.*s'", 
Æive_£rv”
, 
n£rv”
, 
poŞ
->
idx
,

122 
poŞ
->
Çme
.
Ën
,…oŞ->Çme.
d©a
);

124 
cÚtšuum_add™iÚ
 = 
KETAMA_CONTINUUM_ADDITION
;

125 
pošts_³r_£rv”
 = 
KETAMA_POINTS_PER_SERVER
;

130 ià(
Æive_£rv”
 > 
poŞ
->
n£rv”_cÚtšuum
) {

131 
cÚtšuum
 *continuum;

132 
ušt32_t
 
n£rv”_cÚtšuum
 = 
Æive_£rv”
 + 
cÚtšuum_add™iÚ
;

133 
ušt32_t
 
ncÚtšuum
 = 
n£rv”_cÚtšuum
 * 
pošts_³r_£rv”
;

135 
cÚtšuum
 = 
	`nc_»®loc
(
poŞ
->cÚtšuum, (*cÚtšuumè* 
ncÚtšuum
);

136 ià(
cÚtšuum
 =ğ
NULL
) {

137  
NC_ENOMEM
;

140 
poŞ
->
cÚtšuum
 = continuum;

141 
poŞ
->
n£rv”_cÚtšuum
 =‚server_continuum;

149 
cÚtšuum_šdex
 = 0;

150 
poš‹r_couÁ”
 = 0;

151 
£rv”_šdex
 = 0; s”v”_šdex < 
n£rv”
; server_index++) {

152 
£rv”
 *server;

153 
pù
;

155 
£rv”
 = 
	`¬¿y_g‘
(&
poŞ
->£rv”, 
£rv”_šdex
);

157 ià(
poŞ
->
auto_ejeù_ho¡s
 && 
£rv”
->
Ãxt_»Œy
 > 
now
) {

161 
pù
 = ()
£rv”
->
weight
 / ()
tÙ®_weight
;

162 
poš‹r_³r_£rv”
 = (
ušt32_t
è((
	`æoÜf
((è(
pù
 * 
KETAMA_POINTS_PER_SERVER
 / 4 * ()
Æive_£rv”
 + 0.0000000001))) * 4);

163 
poš‹r_³r_hash
 = 4;

165 
	`log_debug
(
LOG_VERB
, "%.* weighˆ%"
PRIu32
" of %"PRIu32" "

166 "pù %0.5àpošt ³¸£rv” %"
PRIu32
"",

167 
£rv”
->
Çme
.
Ën
, s”v”->Çme.
d©a
, s”v”->
weight
,

168 
tÙ®_weight
, 
pù
, 
poš‹r_³r_£rv”
);

170 
poš‹r_šdex
 = 1;

171 
poš‹r_šdex
 <ğ
poš‹r_³r_£rv”
 / 
poš‹r_³r_hash
;

172 
poš‹r_šdex
++) {

174 
ho¡
[
KETAMA_MAX_HOSTLEN
]= "";

175 
size_t
 
ho¡Ën
;

176 
ušt32_t
 
x
;

178 
ho¡Ën
 = 
	`¢´štf
(
ho¡
, 
KETAMA_MAX_HOSTLEN
, "%.*s-%u",

179 
£rv”
->
Çme
.
Ën
, s”v”->Çme.
d©a
,

180 
poš‹r_šdex
 - 1);

182 
x
 = 0; x < 
poš‹r_³r_hash
; x++) {

183 
v®ue
 = 
	`k‘ama_hash
(
ho¡
, 
ho¡Ën
, 
x
);

184 
poŞ
->
cÚtšuum
[
cÚtšuum_šdex
].
šdex
 = 
£rv”_šdex
;

185 
poŞ
->
cÚtšuum
[
cÚtšuum_šdex
++].
v®ue
 = value;

188 
poš‹r_couÁ”
 +ğ
poš‹r_³r_£rv”
;

191 
poŞ
->
ncÚtšuum
 = 
poš‹r_couÁ”
;

192 
	`qsÜt
(
poŞ
->
cÚtšuum
,…oŞ->
ncÚtšuum
, (*pool->continuum),

193 
k‘ama_™em_cmp
);

195 
poš‹r_šdex
 = 0;

196 
poš‹r_šdex
 < ((
Æive_£rv”
 * 
KETAMA_POINTS_PER_SERVER
) - 1);

197 
poš‹r_šdex
++) {

198 ià(
poš‹r_šdex
 + 1 >ğ
poš‹r_couÁ”
) {

201 
	`ASSERT
(
poŞ
->
cÚtšuum
[
poš‹r_šdex
].
v®ue
 <=

202 
poŞ
->
cÚtšuum
[
poš‹r_šdex
 + 1].
v®ue
);

205 
	`log_debug
(
LOG_VERB
, "upd©ed…oŞ %"
PRIu32
" '%.*s' with %"PRIu32" of "

206 "%"
PRIu32
" servers†ive in %"PRIu32" slots‡nd %"PRIu32" "

207 "aùivpošt š %"
PRIu32
" slÙs", 
poŞ
->
idx
,

208 
poŞ
->
Çme
.
Ën
,…oŞ->Çme.
d©a
, 
Æive_£rv”
, 
n£rv”
,

209 
poŞ
->
n£rv”_cÚtšuum
,…oŞ->
ncÚtšuum
,

210 (
poŞ
->
n£rv”_cÚtšuum
 + 
cÚtšuum_add™iÚ
è* 
pošts_³r_£rv”
);

212  
NC_OK
;

213 
	}
}

215 
ušt32_t


216 
	$k‘ama_di¥©ch
(
cÚtšuum
 *cÚtšuum, 
ušt32_t
 
ncÚtšuum
, ušt32_ˆ
hash
)

218 
cÚtšuum
 *
begš
, *
’d
, *
Ëá
, *
right
, *
middË
;

220 
	`ASSERT
(
cÚtšuum
 !ğ
NULL
);

221 
	`ASSERT
(
ncÚtšuum
 != 0);

223 
begš
 = 
Ëá
 = 
cÚtšuum
;

224 
’d
 = 
right
 = 
cÚtšuum
 + 
ncÚtšuum
;

226 
Ëá
 < 
right
) {

227 
middË
 = 
Ëá
 + (
right
 -†eft) / 2;

228 ià(
middË
->
v®ue
 < 
hash
) {

229 
Ëá
 = 
middË
 + 1;

231 
right
 = 
middË
;

235 ià(
right
 =ğ
’d
) {

236 
right
 = 
begš
;

239  
right
->
šdex
;

240 
	}
}

	@hashkit/nc_md5.c

18 
	~<nc_cÜe.h
>

29 
	~<¡ršg.h
>

31 
	tMD5_u32¶us
;

34 
MD5_u32¶us
 
	mlo
, 
	mhi
;

35 
MD5_u32¶us
 
	ma
, 
	mb
, 
	mc
, 
	md
;

36 
	mbufãr
[64];

37 
MD5_u32¶us
 
	mblock
[16];

38 } 
	tMD5_CTX
;

47 
	#F
(
x
, 
y
, 
z
è((zè^ ((xè& ((yè^ (z))))

	)

48 
	#G
(
x
, 
y
, 
z
è((yè^ ((zè& ((xè^ (y))))

	)

49 
	#H
(
x
, 
y
, 
z
è((xè^ (yè^ (z))

	)

50 
	#I
(
x
, 
y
, 
z
è((yè^ ((xè| ~(z)))

	)

55 
	#STEP
(
f
, 
a
, 
b
, 
c
, 
d
, 
x
, 
t
, 
s
) \

56 (
a
è+ğ
	`f
((
b
), (
c
), (
d
)è+ (
x
è+ (
t
); \

57 (
a
èğ((×è<< (
s
)) | (((a) & 0xffffffff) >> (32 - (s)))); \

58 (
a
è+ğ(
b
);

	)

68 #ià
defšed
(
__i386__
è|| defšed(
__x86_64__
è|| defšed(
__vax__
)

69 
	#SET
(
n
) \

70 (*(
MD5_u32¶us
 *)&
±r
[(
n
è* 4])

	)

71 
	#GET
(
n
) \

72 
	`SET
(
n
)

	)

74 
	#SET
(
n
) \

75 (
ùx
->
block
[(
n
)] = \

76 (
MD5_u32¶us
)
±r
[(
n
) * 4] | \

77 ((
MD5_u32¶us
)
±r
[(
n
) * 4 + 1] << 8) | \

78 ((
MD5_u32¶us
)
±r
[(
n
) * 4 + 2] << 16) | \

79 ((
MD5_u32¶us
)
±r
[(
n
è* 4 + 3] << 24))

	)

80 
	#GET
(
n
) \

81 (
ùx
->
block
[(
n
)])

	)

89 
	$body
(
MD5_CTX
 *
ùx
, *
d©a
, 
size
)

91 *
±r
;

92 
MD5_u32¶us
 
a
, 
b
, 
c
, 
d
;

93 
MD5_u32¶us
 
§ved_a
, 
§ved_b
, 
§ved_c
, 
§ved_d
;

95 
±r
 = 
d©a
;

97 
a
 = 
ùx
->a;

98 
b
 = 
ùx
->b;

99 
c
 = 
ùx
->c;

100 
d
 = 
ùx
->d;

103 
§ved_a
 = 
a
;

104 
§ved_b
 = 
b
;

105 
§ved_c
 = 
c
;

106 
§ved_d
 = 
d
;

109 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(0), 0xd76aa478, 7)

110 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(1), 0xe8c7b756, 12)

111 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(2), 0x242070db, 17)

112 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(3), 0xc1bdceee, 22)

113 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(4), 0xf57c0faf, 7)

114 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(5), 0x4787c62a, 12)

115 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(6), 0xa8304613, 17)

116 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(7), 0xfd469501, 22)

117 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(8), 0x698098d8, 7)

118 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(9), 0x8b44f7af, 12)

119 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(10), 0xffff5bb1, 17)

120 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(11), 0x895cd7be, 22)

121 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(12), 0x6b901122, 7)

122 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(13), 0xfd987193, 12)

123 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(14), 0xa679438e, 17)

124 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(15), 0x49b40821, 22)

127 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(1), 0xf61e2562, 5)

128 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(6), 0xc040b340, 9)

129 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(11), 0x265e5a51, 14)

130 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(0), 0xe9b6c7aa, 20)

131 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(5), 0xd62f105d, 5)

132 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(10), 0x02441453, 9)

133 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(15), 0xd8a1e681, 14)

134 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(4), 0xe7d3fbc8, 20)

135 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(9), 0x21e1cde6, 5)

136 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(14), 0xc33707d6, 9)

137 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(3), 0xf4d50d87, 14)

138 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(8), 0x455a14ed, 20)

139 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(13), 0xa9e3e905, 5)

140 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(2), 0xfcefa3f8, 9)

141 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(7), 0x676f02d9, 14)

142 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(12), 0x8d2a4c8a, 20)

145 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(5), 0xfffa3942, 4)

146 
	`STEP
(
H
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(8), 0x8771f681, 11)

147 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(11), 0x6d9d6122, 16)

148 
	`STEP
(
H
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(14), 0xfde5380c, 23)

149 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(1), 0xa4beea44, 4)

150 
	`STEP
(
H
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(4), 0x4bdecfa9, 11)

151 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(7), 0xf6bb4b60, 16)

152 
	`STEP
(
H
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(10), 0xbebfbc70, 23)

153 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(13), 0x289b7ec6, 4)

154 
	`STEP
(
H
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(0), 0xeaa127fa, 11)

155 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(3), 0xd4ef3085, 16)

156 
	`STEP
(
H
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(6), 0x04881d05, 23)

157 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(9), 0xd9d4d039, 4)

158 
	`STEP
(
H
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(12), 0xe6db99e5, 11)

159 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(15), 0x1fa27cf8, 16)

160 
	`STEP
(
H
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(2), 0xc4ac5665, 23)

163 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(0), 0xf4292244, 6)

164 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(7), 0x432aff97, 10)

165 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(14), 0xab9423a7, 15)

166 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(5), 0xfc93a039, 21)

167 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(12), 0x655b59c3, 6)

168 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(3), 0x8f0ccc92, 10)

169 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(10), 0xffeff47d, 15)

170 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(1), 0x85845dd1, 21)

171 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(8), 0x6fa87e4f, 6)

172 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(15), 0xfe2ce6e0, 10)

173 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(6), 0xa3014314, 15)

174 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(13), 0x4e0811a1, 21)

175 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(4), 0xf7537e82, 6)

176 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(11), 0xbd3af235, 10)

177 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(2), 0x2ad7d2bb, 15)

178 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(9), 0xeb86d391, 21)

180 
a
 +ğ
§ved_a
;

181 
b
 +ğ
§ved_b
;

182 
c
 +ğ
§ved_c
;

183 
d
 +ğ
§ved_d
;

185 
±r
 += 64;

186 } 
size
 -= 64);

188 
ùx
->
a
 =‡;

189 
ùx
->
b
 = b;

190 
ùx
->
c
 = c;

191 
ùx
->
d
 = d;

193  
±r
;

194 
	}
}

197 
	$MD5_In™
(
MD5_CTX
 *
ùx
)

199 
ùx
->
a
 = 0x67452301;

200 
ùx
->
b
 = 0xefcdab89;

201 
ùx
->
c
 = 0x98badcfe;

202 
ùx
->
d
 = 0x10325476;

204 
ùx
->
lo
 = 0;

205 
ùx
->
hi
 = 0;

206 
	}
}

209 
	$MD5_Upd©e
(
MD5_CTX
 *
ùx
, *
d©a
, 
size
)

211 
MD5_u32¶us
 
§ved_lo
;

212 
u£d
, 
ä“
;

214 
§ved_lo
 = 
ùx
->
lo
;

215 ià((
ùx
->
lo
 = (
§ved_lo
 + 
size
) & 0x1fffffff) < saved_lo) {

216 
ùx
->
hi
++;

218 
ùx
->
hi
 +ğ
size
 >> 29;

220 
u£d
 = 
§ved_lo
 & 0x3f;

222 ià(
u£d
) {

223 
ä“
 = 64 - 
u£d
;

225 ià(
size
 < 
ä“
) {

226 
	`memıy
(&
ùx
->
bufãr
[
u£d
], 
d©a
, 
size
);

230 
	`memıy
(&
ùx
->
bufãr
[
u£d
], 
d©a
, 
ä“
);

231 
d©a
 = (*)d©¨+ 
ä“
;

232 
size
 -ğ
ä“
;

233 
	`body
(
ùx
, ctx->
bufãr
, 64);

236 ià(
size
 >= 64) {

237 
d©a
 = 
	`body
(
ùx
, d©a, 
size
 & ~()0x3f);

238 
size
 &= 0x3f;

241 
	`memıy
(
ùx
->
bufãr
, 
d©a
, 
size
);

242 
	}
}

245 
	$MD5_Fš®
(*
»suÉ
, 
MD5_CTX
 *
ùx
)

247 
u£d
, 
ä“
;

249 
u£d
 = 
ùx
->
lo
 & 0x3f;

251 
ùx
->
bufãr
[
u£d
++] = 0x80;

253 
ä“
 = 64 - 
u£d
;

255 ià(
ä“
 < 8) {

256 
	`mem£t
(&
ùx
->
bufãr
[
u£d
], 0, 
ä“
);

257 
	`body
(
ùx
, ctx->
bufãr
, 64);

258 
u£d
 = 0;

259 
ä“
 = 64;

262 
	`mem£t
(&
ùx
->
bufãr
[
u£d
], 0, 
ä“
 - 8);

264 
ùx
->
lo
 <<= 3;

265 
ùx
->
bufãr
[56] = ctx->
lo
;

266 
ùx
->
bufãr
[57] = ctx->
lo
 >> 8;

267 
ùx
->
bufãr
[58] = ctx->
lo
 >> 16;

268 
ùx
->
bufãr
[59] = ctx->
lo
 >> 24;

269 
ùx
->
bufãr
[60] = ctx->
hi
;

270 
ùx
->
bufãr
[61] = ctx->
hi
 >> 8;

271 
ùx
->
bufãr
[62] = ctx->
hi
 >> 16;

272 
ùx
->
bufãr
[63] = ctx->
hi
 >> 24;

274 
	`body
(
ùx
, ctx->
bufãr
, 64);

276 
»suÉ
[0] = 
ùx
->
a
;

277 
»suÉ
[1] = 
ùx
->
a
 >> 8;

278 
»suÉ
[2] = 
ùx
->
a
 >> 16;

279 
»suÉ
[3] = 
ùx
->
a
 >> 24;

280 
»suÉ
[4] = 
ùx
->
b
;

281 
»suÉ
[5] = 
ùx
->
b
 >> 8;

282 
»suÉ
[6] = 
ùx
->
b
 >> 16;

283 
»suÉ
[7] = 
ùx
->
b
 >> 24;

284 
»suÉ
[8] = 
ùx
->
c
;

285 
»suÉ
[9] = 
ùx
->
c
 >> 8;

286 
»suÉ
[10] = 
ùx
->
c
 >> 16;

287 
»suÉ
[11] = 
ùx
->
c
 >> 24;

288 
»suÉ
[12] = 
ùx
->
d
;

289 
»suÉ
[13] = 
ùx
->
d
 >> 8;

290 
»suÉ
[14] = 
ùx
->
d
 >> 16;

291 
»suÉ
[15] = 
ùx
->
d
 >> 24;

293 
	`mem£t
(
ùx
, 0, (*ctx));

294 
	}
}

301 
	$md5_sigÇtu»
(*
key
, 
Ëngth
, *
»suÉ
)

303 
MD5_CTX
 
my_md5
;

305 
	`MD5_In™
(&
my_md5
);

306 ()
	`MD5_Upd©e
(&
my_md5
, 
key
, 
Ëngth
);

307 
	`MD5_Fš®
(
»suÉ
, &
my_md5
);

308 
	}
}

310 
ušt32_t


311 
	$hash_md5
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
)

313 
»suÉs
[16];

315 
	`md5_sigÇtu»
((*)
key
, ()
key_Ëngth
, 
»suÉs
);

317  ((
ušt32_t
è(
»suÉs
[3] & 0xFF) << 24) |

318 ((
ušt32_t
è(
»suÉs
[2] & 0xFF) << 16) |

319 ((
ušt32_t
è(
»suÉs
[1] & 0xFF) << 8) |

320 (
»suÉs
[0] & 0xFF);

321 
	}
}

	@hashkit/nc_modula.c

18 
	~<¡dio.h
>

19 
	~<¡dlib.h
>

21 
	~<nc_cÜe.h
>

22 
	~<nc_£rv”.h
>

23 
	~<nc_hashk™.h
>

25 
	#MODULA_CONTINUUM_ADDITION
 10

	)

26 
	#MODULA_POINTS_PER_SERVER
 1

	)

28 
r¡©us_t


29 
	$moduÏ_upd©e
(
£rv”_poŞ
 *
poŞ
)

31 
ušt32_t
 
n£rv”
;

32 
ušt32_t
 
Æive_£rv”
;

33 
ušt32_t
 
poš‹r_³r_£rv”
;

34 
ušt32_t
 
poš‹r_couÁ”
;

35 
ušt32_t
 
pošts_³r_£rv”
;

36 
ušt32_t
 
cÚtšuum_šdex
;

37 
ušt32_t
 
cÚtšuum_add™iÚ
;

38 
ušt32_t
 
£rv”_šdex
;

39 
ušt32_t
 
weight_šdex
;

40 
ušt32_t
 
tÙ®_weight
;

41 
št64_t
 
now
;

43 
now
 = 
	`nc_u£c_now
();

44 ià(
now
 < 0) {

45  
NC_ERROR
;

48 
n£rv”
 = 
	`¬¿y_n
(&
poŞ
->
£rv”
);

49 
Æive_£rv”
 = 0;

50 
tÙ®_weight
 = 0;

51 
poŞ
->
Ãxt_»bud
 = 0LL;

53 
£rv”_šdex
 = 0; s”v”_šdex < 
n£rv”
; server_index++) {

54 
£rv”
 *£rv” = 
	`¬¿y_g‘
(&
poŞ
->£rv”, 
£rv”_šdex
);

56 ià(
poŞ
->
auto_ejeù_ho¡s
) {

57 ià(
£rv”
->
Ãxt_»Œy
 <ğ
now
) {

58 
£rv”
->
Ãxt_»Œy
 = 0LL;

59 
Æive_£rv”
++;

60 } ià(
poŞ
->
Ãxt_»bud
 == 0LL ||

61 
£rv”
->
Ãxt_»Œy
 < 
poŞ
->
Ãxt_»bud
) {

62 
poŞ
->
Ãxt_»bud
 = 
£rv”
->
Ãxt_»Œy
;

65 
Æive_£rv”
++;

68 
	`ASSERT
(
£rv”
->
weight
 > 0);

71 ià(!
poŞ
->
auto_ejeù_ho¡s
 || 
£rv”
->
Ãxt_»Œy
 <ğ
now
) {

72 
tÙ®_weight
 +ğ
£rv”
->
weight
;

76 
poŞ
->
Æive_£rv”
 =‚live_server;

78 ià(
Æive_£rv”
 == 0) {

79 
	`ASSERT
(
poŞ
->
cÚtšuum
 !ğ
NULL
);

80 
	`ASSERT
(
poŞ
->
ncÚtšuum
 != 0);

82 
	`log_debug
(
LOG_DEBUG
, "nØliv£rv” fÜ…oŞ %"
PRIu32
" '%.*s'",

83 
poŞ
->
idx
,…oŞ->
Çme
.
Ën
,…oŞ->Çme.
d©a
);

85  
NC_OK
;

87 
	`log_debug
(
LOG_DEBUG
, "%"
PRIu32
" of %"PRIu32" servers‡re†ive for…ool "

88 "%"
PRIu32
" '%.*s'", 
Æive_£rv”
, 
n£rv”
, 
poŞ
->
idx
,

89 
poŞ
->
Çme
.
Ën
,…oŞ->Çme.
d©a
);

91 
cÚtšuum_add™iÚ
 = 
MODULA_CONTINUUM_ADDITION
;

92 
pošts_³r_£rv”
 = 
MODULA_POINTS_PER_SERVER
;

98 ià(
tÙ®_weight
 > 
poŞ
->
n£rv”_cÚtšuum
) {

99 
cÚtšuum
 *continuum;

100 
ušt32_t
 
n£rv”_cÚtšuum
 = 
tÙ®_weight
 + 
MODULA_CONTINUUM_ADDITION
;

101 
ušt32_t
 
ncÚtšuum
 = 
n£rv”_cÚtšuum
 * 
MODULA_POINTS_PER_SERVER
;

103 
cÚtšuum
 = 
	`nc_»®loc
(
poŞ
->cÚtšuum, (*cÚtšuumè* 
ncÚtšuum
);

104 ià(
cÚtšuum
 =ğ
NULL
) {

105  
NC_ENOMEM
;

108 
poŞ
->
cÚtšuum
 = continuum;

109 
poŞ
->
n£rv”_cÚtšuum
 =‚server_continuum;

114 
cÚtšuum_šdex
 = 0;

115 
poš‹r_couÁ”
 = 0;

116 
£rv”_šdex
 = 0; s”v”_šdex < 
n£rv”
; server_index++) {

117 
£rv”
 *£rv” = 
	`¬¿y_g‘
(&
poŞ
->£rv”, 
£rv”_šdex
);

119 ià(
poŞ
->
auto_ejeù_ho¡s
 && 
£rv”
->
Ãxt_»Œy
 > 
now
) {

123 
weight_šdex
 = 0; weight_šdex < 
£rv”
->
weight
; weight_index++) {

124 
poš‹r_³r_£rv”
 = 1;

126 
poŞ
->
cÚtšuum
[
cÚtšuum_šdex
].
šdex
 = 
£rv”_šdex
;

127 
poŞ
->
cÚtšuum
[
cÚtšuum_šdex
++].
v®ue
 = 0;

129 
poš‹r_couÁ”
 +ğ
poš‹r_³r_£rv”
;

132 
poŞ
->
ncÚtšuum
 = 
poš‹r_couÁ”
;

134 
	`log_debug
(
LOG_VERB
, "upd©ed…oŞ %"
PRIu32
" '%.*s' with %"PRIu32" of "

135 "%"
PRIu32
" servers†ive in %"PRIu32" slots‡nd %"PRIu32" "

136 "aùivpošt š %"
PRIu32
" slÙs", 
poŞ
->
idx
,

137 
poŞ
->
Çme
.
Ën
,…oŞ->Çme.
d©a
, 
Æive_£rv”
, 
n£rv”
,

138 
poŞ
->
n£rv”_cÚtšuum
,…oŞ->
ncÚtšuum
,

139 (
poŞ
->
n£rv”_cÚtšuum
 + 
cÚtšuum_add™iÚ
è* 
pošts_³r_£rv”
);

141  
NC_OK
;

143 
	}
}

145 
ušt32_t


146 
	$moduÏ_di¥©ch
(
cÚtšuum
 *cÚtšuum, 
ušt32_t
 
ncÚtšuum
, ušt32_ˆ
hash
)

148 
cÚtšuum
 *
c
;

150 
	`ASSERT
(
cÚtšuum
 !ğ
NULL
);

151 
	`ASSERT
(
ncÚtšuum
 != 0);

153 
c
 = 
cÚtšuum
 + 
hash
 % 
ncÚtšuum
;

155  
c
->
šdex
;

156 
	}
}

	@hashkit/nc_murmur.c

35 
	~<nc_cÜe.h
>

37 
ušt32_t


38 
	$hash_murmur
(cÚ¡ *
key
, 
size_t
 
Ëngth
)

45 cÚ¡ 
m
 = 0x5bd1e995;

46 cÚ¡ 
ušt32_t
 
£ed
 = (0xd—db“à* (ušt32_t)
Ëngth
);

47 cÚ¡ 
r
 = 24;

52 
ušt32_t
 
h
 = 
£ed
 ^ (ušt32_t)
Ëngth
;

56 cÚ¡ * 
d©a
 = (cÚ¡ *)
key
;

58 
Ëngth
 >= 4) {

59 
k
 = *(*)
d©a
;

61 
k
 *ğ
m
;

62 
k
 ^ğk >> 
r
;

63 
k
 *ğ
m
;

65 
h
 *ğ
m
;

66 
h
 ^ğ
k
;

68 
d©a
 += 4;

69 
Ëngth
 -= 4;

74 
Ëngth
) {

76 
h
 ^ğ((
ušt32_t
)
d©a
[2]) << 16;

79 
h
 ^ğ((
ušt32_t
)
d©a
[1]) << 8;

82 
h
 ^ğ
d©a
[0];

83 
h
 *ğ
m
;

94 
h
 ^= h >> 13;

95 
h
 *ğ
m
;

96 
h
 ^= h >> 15;

98  
h
;

99 
	}
}

	@hashkit/nc_one_at_a_time.c

32 
	~<nc_cÜe.h
>

34 
ušt32_t


35 
	$hash_Úe_©_a_time
(cÚ¡ *
key
, 
size_t
 
key_Ëngth
)

37 cÚ¡ *
±r
 = 
key
;

38 
ušt32_t
 
v®ue
 = 0;

40 
key_Ëngth
--) {

41 
ušt32_t
 
v®
 = (ušt32_tè*
±r
++;

42 
v®ue
 +ğ
v®
;

43 
v®ue
 += (value << 10);

44 
v®ue
 ^= (value >> 6);

46 
v®ue
 += (value << 3);

47 
v®ue
 ^= (value >> 11);

48 
v®ue
 += (value << 15);

50  
v®ue
;

51 
	}
}

	@hashkit/nc_random.c

18 
	~<¡dio.h
>

19 
	~<¡dlib.h
>

21 
	~<nc_cÜe.h
>

22 
	~<nc_£rv”.h
>

23 
	~<nc_hashk™.h
>

25 
	#RANDOM_CONTINUUM_ADDITION
 10

	)

26 
	#RANDOM_POINTS_PER_SERVER
 1

	)

28 
r¡©us_t


29 
	$¿ndom_upd©e
(
£rv”_poŞ
 *
poŞ
)

31 
ušt32_t
 
n£rv”
;

32 
ušt32_t
 
Æive_£rv”
;

33 
ušt32_t
 
poš‹r_³r_£rv”
;

34 
ušt32_t
 
poš‹r_couÁ”
;

35 
ušt32_t
 
pošts_³r_£rv”
;

36 
ušt32_t
 
cÚtšuum_šdex
;

37 
ušt32_t
 
cÚtšuum_add™iÚ
;

38 
ušt32_t
 
£rv”_šdex
;

39 
št64_t
 
now
;

41 
now
 = 
	`nc_u£c_now
();

42 ià(
now
 < 0) {

43  
NC_ERROR
;

46 
n£rv”
 = 
	`¬¿y_n
(&
poŞ
->
£rv”
);

47 
Æive_£rv”
 = 0;

48 
poŞ
->
Ãxt_»bud
 = 0LL;

50 
£rv”_šdex
 = 0; s”v”_šdex < 
n£rv”
; server_index++) {

51 
£rv”
 *£rv” = 
	`¬¿y_g‘
(&
poŞ
->£rv”, 
£rv”_šdex
);

53 ià(
poŞ
->
auto_ejeù_ho¡s
) {

54 ià(
£rv”
->
Ãxt_»Œy
 <ğ
now
) {

55 
£rv”
->
Ãxt_»Œy
 = 0LL;

56 
Æive_£rv”
++;

57 } ià(
poŞ
->
Ãxt_»bud
 == 0LL ||

58 
£rv”
->
Ãxt_»Œy
 < 
poŞ
->
Ãxt_»bud
) {

59 
poŞ
->
Ãxt_»bud
 = 
£rv”
->
Ãxt_»Œy
;

62 
Æive_£rv”
++;

66 
poŞ
->
Æive_£rv”
 =‚live_server;

68 ià(
Æive_£rv”
 == 0) {

69 
	`ASSERT
(
poŞ
->
cÚtšuum
 !ğ
NULL
);

70 
	`ASSERT
(
poŞ
->
ncÚtšuum
 != 0);

72 
	`log_debug
(
LOG_DEBUG
, "nØliv£rv” fÜ…oŞ %"
PRIu32
" '%.*s'",

73 
poŞ
->
idx
,…oŞ->
Çme
.
Ën
,…oŞ->Çme.
d©a
);

75  
NC_OK
;

77 
	`log_debug
(
LOG_DEBUG
, "%"
PRIu32
" of %"PRIu32" servers‡re†ive for…ool "

78 "%"
PRIu32
" '%.*s'", 
Æive_£rv”
, 
n£rv”
, 
poŞ
->
idx
,

79 
poŞ
->
Çme
.
Ën
,…oŞ->Çme.
d©a
);

81 
cÚtšuum_add™iÚ
 = 
RANDOM_CONTINUUM_ADDITION
;

82 
pošts_³r_£rv”
 = 
RANDOM_POINTS_PER_SERVER
;

88 ià(
Æive_£rv”
 > 
poŞ
->
n£rv”_cÚtšuum
) {

89 
cÚtšuum
 *continuum;

90 
ušt32_t
 
n£rv”_cÚtšuum
 = 
Æive_£rv”
 + 
RANDOM_CONTINUUM_ADDITION
;

91 
ušt32_t
 
ncÚtšuum
 = 
n£rv”_cÚtšuum
 * 
RANDOM_POINTS_PER_SERVER
;

93 
cÚtšuum
 = 
	`nc_»®loc
(
poŞ
->cÚtšuum, (*cÚtšuumè* 
ncÚtšuum
);

94 ià(
cÚtšuum
 =ğ
NULL
) {

95  
NC_ENOMEM
;

98 
	`¤ªdom
((
ušt32_t
)
	`time
(
NULL
));

100 
poŞ
->
cÚtšuum
 = continuum;

101 
poŞ
->
n£rv”_cÚtšuum
 =‚server_continuum;

106 
cÚtšuum_šdex
 = 0;

107 
poš‹r_couÁ”
 = 0;

108 
£rv”_šdex
 = 0; s”v”_šdex < 
n£rv”
; server_index++) {

109 
£rv”
 *£rv” = 
	`¬¿y_g‘
(&
poŞ
->£rv”, 
£rv”_šdex
);

111 ià(
poŞ
->
auto_ejeù_ho¡s
 && 
£rv”
->
Ãxt_»Œy
 > 
now
) {

115 
poš‹r_³r_£rv”
 = 1;

117 
poŞ
->
cÚtšuum
[
cÚtšuum_šdex
].
šdex
 = 
£rv”_šdex
;

118 
poŞ
->
cÚtšuum
[
cÚtšuum_šdex
++].
v®ue
 = 0;

120 
poš‹r_couÁ”
 +ğ
poš‹r_³r_£rv”
;

122 
poŞ
->
ncÚtšuum
 = 
poš‹r_couÁ”
;

124 
	`log_debug
(
LOG_VERB
, "upd©ed…oŞ %"
PRIu32
" '%.*s' with %"PRIu32" of "

125 "%"
PRIu32
" servers†ive in %"PRIu32" slots‡nd %"PRIu32" "

126 "aùivpošt š %"
PRIu32
" slÙs", 
poŞ
->
idx
,

127 
poŞ
->
Çme
.
Ën
,…oŞ->Çme.
d©a
, 
Æive_£rv”
, 
n£rv”
,

128 
poŞ
->
n£rv”_cÚtšuum
,…oŞ->
ncÚtšuum
,

129 (
poŞ
->
n£rv”_cÚtšuum
 + 
cÚtšuum_add™iÚ
è* 
pošts_³r_£rv”
);

131  
NC_OK
;

133 
	}
}

135 
ušt32_t


136 
	$¿ndom_di¥©ch
(
cÚtšuum
 *cÚtšuum, 
ušt32_t
 
ncÚtšuum
, ušt32_ˆ
hash
)

138 
cÚtšuum
 *
c
;

140 
	`ASSERT
(
cÚtšuum
 !ğ
NULL
);

141 
	`ASSERT
(
ncÚtšuum
 != 0);

143 
c
 = 
cÚtšuum
 + 
	`¿ndom
(è% 
ncÚtšuum
;

145  
c
->
šdex
;

146 
	}
}

	@hdr_histogram/hdr_atomic.h

7 #iâdeà
HDR_ATOMIC_H__


8 
	#HDR_ATOMIC_H__


	)

11 #ià
defšed
(
_MSC_VER
)

13 
	~<¡dšt.h
>

14 
	~<šŒš.h
>

16 
__šlše
 * 
	$hdr_©omic_lßd_poš‹r
(** 
poš‹r
)

18 
	`_R—dB¬r›r
();

19  *
poš‹r
;

20 
	}
}

22 
	$hdr_©omic_¡Üe_poš‹r
(** 
poš‹r
, * 
v®ue
)

24 
	`_Wr™eB¬r›r
();

25 *
poš‹r
 = 
v®ue
;

26 
	}
}

28 
št64_t
 
__šlše
 
	$hdr_©omic_lßd_64
(
št64_t
* 
f›ld
)

30 
	`_R—dB¬r›r
();

31  *
f›ld
;

32 
	}
}

34 
__šlše
 
	$hdr_©omic_¡Üe_64
(
št64_t
* 
f›ld
, iÁ64_ˆ
v®ue
)

36 
	`_Wr™eB¬r›r
();

37 *
f›ld
 = 
v®ue
;

38 
	}
}

40 
št64_t
 
__šlše
 
	$hdr_©omic_exchªge_64
(vŞ©
št64_t
* 
f›ld
, iÁ64_ˆ
š™Ÿl
)

42  
	`_IÁ”lockedExchªge64
(
f›ld
, 
š™Ÿl
);

43 
	}
}

45 
št64_t
 
__šlše
 
	$hdr_©omic_add_ãtch_64
(vŞ©
št64_t
* 
f›ld
, iÁ64_ˆ
v®ue
)

47  
	`_IÁ”lockedExchªgeAdd64
(
f›ld
, 
v®ue
) + value;

48 
	}
}

51 
	#hdr_©omic_lßd_poš‹r
(
x
è
	`__©omic_lßd_n
(x, 
__ATOMIC_SEQ_CST
)

	)

52 
	#hdr_©omic_¡Üe_poš‹r
(
f
,
v
è
	`__©omic_¡Üe_n
(f,v, 
__ATOMIC_SEQ_CST
)

	)

53 
	#hdr_©omic_lßd_64
(
x
è
	`__©omic_lßd_n
(x, 
__ATOMIC_SEQ_CST
)

	)

54 
	#hdr_©omic_¡Üe_64
(
f
,
v
è
	`__©omic_¡Üe_n
(f,v, 
__ATOMIC_SEQ_CST
)

	)

55 
	#hdr_©omic_exchªge_64
(
f
,
i
è
	`__©omic_exchªge_n
(f,i, 
__ATOMIC_SEQ_CST
)

	)

56 
	#hdr_©omic_add_ãtch_64
(
f›ld
, 
v®ue
è
	`__©omic_add_ãtch
(f›ld, v®ue, 
__ATOMIC_SEQ_CST
)

	)

	@hdr_histogram/hdr_encoding.c

5 
	~<”ºo.h
>

6 
	~<¡ddef.h
>

7 
	~<m©h.h
>

9 
	~"hdr_’codšg.h
"

10 
	~"hdr_‹¡s.h
"

12 
	$zig_zag_’code_i64
(
ušt8_t
* 
bufãr
, 
št64_t
 
sigÃd_v®ue
)

14 
št64_t
 
v®ue
 = 
sigÃd_v®ue
;

16 
v®ue
 = (value << 1) ^ (value >> 63);

17 
by‹sWr™‹n
 = 0;

18 ià(
v®ue
 >> 7 == 0)

20 
bufãr
[0] = (
ušt8_t
è
v®ue
;

21 
by‹sWr™‹n
 = 1;

25 
bufãr
[0] = (
ušt8_t
è((
v®ue
 & 0x7F) | 0x80);

26 ià(
v®ue
 >> 14 == 0)

28 
bufãr
[1] = (
ušt8_t
è(
v®ue
 >> 7);

29 
by‹sWr™‹n
 = 2;

33 
bufãr
[1] = (
ušt8_t
è((
v®ue
 >> 7 | 0x80));

34 ià(
v®ue
 >> 21 == 0)

36 
bufãr
[2] = (
ušt8_t
è(
v®ue
 >> 14);

37 
by‹sWr™‹n
 = 3;

41 
bufãr
[2] = (
ušt8_t
è(
v®ue
 >> 14 | 0x80);

42 ià(
v®ue
 >> 28 == 0)

44 
bufãr
[3] = (
ušt8_t
è(
v®ue
 >> 21);

45 
by‹sWr™‹n
 = 4;

49 
bufãr
[3] = (
ušt8_t
è(
v®ue
 >> 21 | 0x80);

50 ià(
v®ue
 >> 35 == 0)

52 
bufãr
[4] = (
ušt8_t
è(
v®ue
 >> 28);

53 
by‹sWr™‹n
 = 5;

57 
bufãr
[4] = (
ušt8_t
è(
v®ue
 >> 28 | 0x80);

58 ià(
v®ue
 >> 42 == 0)

60 
bufãr
[5] = (
ušt8_t
è(
v®ue
 >> 35);

61 
by‹sWr™‹n
 = 6;

65 
bufãr
[5] = (
ušt8_t
è(
v®ue
 >> 35 | 0x80);

66 ià(
v®ue
 >> 49 == 0)

68 
bufãr
[6] = (
ušt8_t
è(
v®ue
 >> 42);

69 
by‹sWr™‹n
 = 7;

73 
bufãr
[6] = (
ušt8_t
è(
v®ue
 >> 42 | 0x80);

74 ià(
v®ue
 >> 56 == 0)

76 
bufãr
[7] = (
ušt8_t
è(
v®ue
 >> 49);

77 
by‹sWr™‹n
 = 8;

81 
bufãr
[7] = (
ušt8_t
è(
v®ue
 >> 49 | 0x80);

82 
bufãr
[8] = (
ušt8_t
è(
v®ue
 >> 56);

83 
by‹sWr™‹n
 = 9;

93  
by‹sWr™‹n
;

94 
	}
}

96 
	$zig_zag_decode_i64
(cÚ¡ 
ušt8_t
* 
bufãr
, 
št64_t
* 
»tV®
)

98 
ušt64_t
 
v
 = 
bufãr
[0];

99 
ušt64_t
 
v®ue
 = 
v
 & 0x7F;

100 
by‹sR—d
 = 1;

101 ià((
v
 & 0x80) != 0)

103 
by‹sR—d
 = 2;

104 
v
 = 
bufãr
[1];

105 
v®ue
 |ğ(
v
 & 0x7F) << 7;

106 ià((
v
 & 0x80) != 0)

108 
by‹sR—d
 = 3;

109 
v
 = 
bufãr
[2];

110 
v®ue
 |ğ(
v
 & 0x7F) << 14;

111 ià((
v
 & 0x80) != 0)

113 
by‹sR—d
 = 4;

114 
v
 = 
bufãr
[3];

115 
v®ue
 |ğ(
v
 & 0x7F) << 21;

116 ià((
v
 & 0x80) != 0)

118 
by‹sR—d
 = 5;

119 
v
 = 
bufãr
[4];

120 
v®ue
 |ğ(
v
 & 0x7F) << 28;

121 ià((
v
 & 0x80) != 0)

123 
by‹sR—d
 = 6;

124 
v
 = 
bufãr
[5];

125 
v®ue
 |ğ(
v
 & 0x7F) << 35;

126 ià((
v
 & 0x80) != 0)

128 
by‹sR—d
 = 7;

129 
v
 = 
bufãr
[6];

130 
v®ue
 |ğ(
v
 & 0x7F) << 42;

131 ià((
v
 & 0x80) != 0)

133 
by‹sR—d
 = 8;

134 
v
 = 
bufãr
[7];

135 
v®ue
 |ğ(
v
 & 0x7F) << 49;

136 ià((
v
 & 0x80) != 0)

138 
by‹sR—d
 = 9;

139 
v
 = 
bufãr
[8];

140 
v®ue
 |ğ
v
 << 56;

150 
v®ue
 = (value >> 1) ^ (-(value & 1));

151 *
»tV®
 = (
št64_t
è
v®ue
;

153  
by‹sR—d
;

154 
	}
}

156 cÚ¡ 
	gba£64_bË
[] =

165 
	$g‘_ba£_64
(
ušt32_t
 
_24_b™_v®ue
, 
shiá
)

167 
ušt32_t
 
_6_b™_v®ue
 = 0x3F & (
_24_b™_v®ue
 >> 
shiá
);

168  
ba£64_bË
[
_6_b™_v®ue
];

169 
	}
}

171 
	$äom_ba£_64
(
c
)

173 ià('A' <ğ
c
 && c <= 'Z')

175  
c
 - 'A';

177 ià('a' <ğ
c
 && c <= 'z')

179  (
c
 - 'a') + 26;

181 ià('0' <ğ
c
 && c <= '9')

183  (
c
 - '0') + 52;

185 ià('+' =ğ
c
)

189 ià('/' =ğ
c
)

193 ià('=' =ğ
c
)

198  
EINVAL
;

199 
	}
}

201 
size_t
 
	$hdr_ba£64_’coded_Ën
(
size_t
 
decoded_size
)

203  (
size_t
è(
	`û
(
decoded_size
 / 3.0) * 4.0);

204 
	}
}

206 
size_t
 
	$hdr_ba£64_decoded_Ën
(
size_t
 
’coded_size
)

208  (
’coded_size
 / 4) * 3;

209 
	}
}

211 
	$hdr_ba£64_’code_block_·d
(cÚ¡ 
ušt8_t
* 
šput
, * 
ouut
, 
size_t
 
·d
)

213 
ušt32_t
 
_24_b™_v®ue
 = 0;

215 
·d
)

218 
_24_b™_v®ue
 = (
šput
[0] << 16) + (input[1] << 8);

220 
ouut
[0] = 
	`g‘_ba£_64
(
_24_b™_v®ue
, 18);

221 
ouut
[1] = 
	`g‘_ba£_64
(
_24_b™_v®ue
, 12);

222 
ouut
[2] = 
	`g‘_ba£_64
(
_24_b™_v®ue
, 6);

223 
ouut
[3] = '=';

228 
_24_b™_v®ue
 = (
šput
[0] << 16);

230 
ouut
[0] = 
	`g‘_ba£_64
(
_24_b™_v®ue
, 18);

231 
ouut
[1] = 
	`g‘_ba£_64
(
_24_b™_v®ue
, 12);

232 
ouut
[2] = '=';

233 
ouut
[3] = '=';

241 
	}
}

246 
	$hdr_ba£64_’code_block
(cÚ¡ 
ušt8_t
* 
šput
, * 
ouut
)

248 
ušt32_t
 
_24_b™_v®ue
 = (
šput
[0] << 16) + (input[1] << 8) + (input[2]);

250 
ouut
[0] = 
	`g‘_ba£_64
(
_24_b™_v®ue
, 18);

251 
ouut
[1] = 
	`g‘_ba£_64
(
_24_b™_v®ue
, 12);

252 
ouut
[2] = 
	`g‘_ba£_64
(
_24_b™_v®ue
, 6);

253 
ouut
[3] = 
	`g‘_ba£_64
(
_24_b™_v®ue
, 0);

254 
	}
}

256 
	$hdr_ba£64_’code
(

257 cÚ¡ 
ušt8_t
* 
šput
, 
size_t
 
šput_Ën
, * 
ouut
, size_ˆ
ouut_Ën
)

259 ià(
	`hdr_ba£64_’coded_Ën
(
šput_Ën
è!ğ
ouut_Ën
)

261  
EINVAL
;

264 
size_t
 
i
 = 0;

265 
size_t
 
j
 = 0;

266 ; 
šput_Ën
 - 
i
 >ğ3 && 
j
 < 
ouut_Ën
; i += 3, j += 4)

268 
	`hdr_ba£64_’code_block
(&
šput
[
i
], &
ouut
[
j
]);

271 
size_t
 
»maššg
 = 
šput_Ën
 - 
i
;

273 
	`hdr_ba£64_’code_block_·d
(&
šput
[
i
], &
ouut
[
j
], 
»maššg
);

276 
	}
}

281 
	$hdr_ba£64_decode_block
(cÚ¡ * 
šput
, 
ušt8_t
* 
ouut
)

283 
ušt32_t
 
_24_b™_v®ue
 = 0;

285 
_24_b™_v®ue
 |ğ
	`äom_ba£_64
(
šput
[0]) << 18;

286 
_24_b™_v®ue
 |ğ
	`äom_ba£_64
(
šput
[1]) << 12;

287 
_24_b™_v®ue
 |ğ
	`äom_ba£_64
(
šput
[2]) << 6;

288 
_24_b™_v®ue
 |ğ
	`äom_ba£_64
(
šput
[3]);

290 
ouut
[0] = (
ušt8_t
è((
_24_b™_v®ue
 >> 16) & 0xFF);

291 
ouut
[1] = (
ušt8_t
è((
_24_b™_v®ue
 >> 8) & 0xFF);

292 
ouut
[2] = (
ušt8_t
è((
_24_b™_v®ue
) & 0xFF);

293 
	}
}

295 
	$hdr_ba£64_decode
(

296 cÚ¡ * 
šput
, 
size_t
 
šput_Ën
, 
ušt8_t
* 
ouut
, size_ˆ
ouut_Ën
)

298 
size_t
 
i
, 
j
;

300 ià(
šput_Ën
 < 4 ||

301 (
šput_Ën
 & 3) != 0 ||

302 (
šput_Ën
 / 4è* 3 !ğ
ouut_Ën
)

304  
EINVAL
;

307 
i
 = 0, 
j
 = 0; i < 
šput_Ën
; i += 4, j += 3)

309 
	`hdr_ba£64_decode_block
(&
šput
[
i
], &
ouut
[
j
]);

313 
	}
}

	@hdr_histogram/hdr_encoding.h

5 #iâdeà
HDR_ENCODING_H


6 
	#HDR_ENCODING_H


	)

8 
	~<¡dšt.h
>

10 
	#MAX_BYTES_LEB128
 9

	)

12 #ifdeà
__ılu¥lus


23 
zig_zag_’code_i64
(
ušt8_t
* 
bufãr
, 
št64_t
 
sigÃd_v®ue
);

32 
zig_zag_decode_i64
(cÚ¡ 
ušt8_t
* 
bufãr
, 
št64_t
* 
sigÃd_v®ue
);

40 
size_t
 
hdr_ba£64_’coded_Ën
(size_ˆ
decoded_size
);

50 
hdr_ba£64_’code
(

51 cÚ¡ 
ušt8_t
* 
šput
, 
size_t
 
šput_Ën
, * 
ouut
, size_ˆ
ouut_Ën
);

60 
size_t
 
hdr_ba£64_decoded_Ën
(size_ˆ
’coded_size
);

70 
hdr_ba£64_decode
(

71 cÚ¡ * 
šput
, 
size_t
 
šput_Ën
, 
ušt8_t
* 
ouut
, size_ˆ
ouut_Ën
);

73 #ifdeà
__ılu¥lus


	@hdr_histogram/hdr_endian.h

6 #iâdeà
HDR_ENDIAN_H__


7 
	#HDR_ENDIAN_H__


	)

9 #ià(
defšed
(
_WIN16
è|| defšed(
_WIN32
è|| defšed(
_WIN64
)è&& !defšed(
__WINDOWS__
)

11 
	#__WINDOWS__


	)

15 #ià
defšed
(
__lšux__
è|| defšed(
__CYGWIN__
)

17 
	~<’dŸn.h
>

19 #–ià
defšed
(
__APPLE__
)

21 
	~<libk”n/OSBy‹Ord”.h
>

23 
	#htobe16
(
x
è
	`OSSw­Ho¡ToBigIÁ16
(x)

	)

24 
	#htŞe16
(
x
è
	`OSSw­Ho¡ToL™eIÁ16
(x)

	)

25 
	#be16toh
(
x
è
	`OSSw­BigToHo¡IÁ16
(x)

	)

26 
	#Ë16toh
(
x
è
	`OSSw­L™eToHo¡IÁ16
(x)

	)

28 
	#htobe32
(
x
è
	`OSSw­Ho¡ToBigIÁ32
(x)

	)

29 
	#htŞe32
(
x
è
	`OSSw­Ho¡ToL™eIÁ32
(x)

	)

30 
	#be32toh
(
x
è
	`OSSw­BigToHo¡IÁ32
(x)

	)

31 
	#Ë32toh
(
x
è
	`OSSw­L™eToHo¡IÁ32
(x)

	)

33 
	#htobe64
(
x
è
	`OSSw­Ho¡ToBigIÁ64
(x)

	)

34 
	#htŞe64
(
x
è
	`OSSw­Ho¡ToL™eIÁ64
(x)

	)

35 
	#be64toh
(
x
è
	`OSSw­BigToHo¡IÁ64
(x)

	)

36 
	#Ë64toh
(
x
è
	`OSSw­L™eToHo¡IÁ64
(x)

	)

38 
	#__BYTE_ORDER
 
BYTE_ORDER


	)

39 
	#__BIG_ENDIAN
 
BIG_ENDIAN


	)

40 
	#__LITTLE_ENDIAN
 
LITTLE_ENDIAN


	)

41 
	#__PDP_ENDIAN
 
PDP_ENDIAN


	)

43 #–ià
defšed
(
__O³nBSD__
)

45 
	~<sys/’dŸn.h
>

47 #–ià
defšed
(
__N‘BSD__
è|| defšed(
__F»eBSD__
è|| defšed(
__D¿gÚFly__
)

49 
	~<sys/’dŸn.h
>

51 
	#be16toh
(
x
è
	`b‘oh16
(x)

	)

52 
	#Ë16toh
(
x
è
	`Ëtoh16
(x)

	)

54 
	#be32toh
(
x
è
	`b‘oh32
(x)

	)

55 
	#Ë32toh
(
x
è
	`Ëtoh32
(x)

	)

57 
	#be64toh
(
x
è
	`b‘oh64
(x)

	)

58 
	#Ë64toh
(
x
è
	`Ëtoh64
(x)

	)

60 #–ià
defšed
(
__WINDOWS__
)

62 
	~<wšsock2.h
>

64 #ià
BYTE_ORDER
 =ğ
LITTLE_ENDIAN


66 
	#htobe16
(
x
è
	`htÚs
(x)

	)

67 
	#htŞe16
(
x
è(x)

	)

68 
	#be16toh
(
x
è
	`Áohs
(x)

	)

69 
	#Ë16toh
(
x
è(x)

	)

71 
	#htobe32
(
x
è
	`htÚl
(x)

	)

72 
	#htŞe32
(
x
è(x)

	)

73 
	#be32toh
(
x
è
	`Áohl
(x)

	)

74 
	#Ë32toh
(
x
è(x)

	)

76 
	#htobe64
(
x
è
	`htÚÎ
(x)

	)

77 
	#htŞe64
(
x
è(x)

	)

78 
	#be64toh
(
x
è
	`ÁohÎ
(x)

	)

79 
	#Ë64toh
(
x
è(x)

	)

81 #–ià
BYTE_ORDER
 =ğ
BIG_ENDIAN


84 
	#htobe16
(
x
è(x)

	)

85 
	#htŞe16
(
x
è
	`__butš_bsw­16
(x)

	)

86 
	#be16toh
(
x
è(x)

	)

87 
	#Ë16toh
(
x
è
	`__butš_bsw­16
(x)

	)

89 
	#htobe32
(
x
è(x)

	)

90 
	#htŞe32
(
x
è
	`__butš_bsw­32
(x)

	)

91 
	#be32toh
(
x
è(x)

	)

92 
	#Ë32toh
(
x
è
	`__butš_bsw­32
(x)

	)

94 
	#htobe64
(
x
è(x)

	)

95 
	#htŞe64
(
x
è
	`__butš_bsw­64
(x)

	)

96 
	#be64toh
(
x
è(x)

	)

97 
	#Ë64toh
(
x
è
	`__butš_bsw­64
(x)

	)

101 #”rÜ 
by‹
 
Üd”
 
nÙ
 
suµÜ‹d


105 
	#__BYTE_ORDER
 
BYTE_ORDER


	)

106 
	#__BIG_ENDIAN
 
BIG_ENDIAN


	)

107 
	#__LITTLE_ENDIAN
 
LITTLE_ENDIAN


	)

108 
	#__PDP_ENDIAN
 
PDP_ENDIAN


	)

112 #”rÜ 
¶©fÜm
 
nÙ
 
suµÜ‹d


	@hdr_histogram/hdr_histogram.c

7 
	~<¡dlib.h
>

8 
	~<¡dboŞ.h
>

9 
	~<m©h.h
>

10 
	~<as£¹.h
>

11 
	~<¡dio.h
>

12 
	~<¡ršg.h
>

13 
	~<¡dšt.h
>

14 
	~<”ºo.h
>

15 
	~<š‰y³s.h
>

17 
	~"hdr_hi¡og¿m.h
"

18 
	~"hdr_‹¡s.h
"

28 
št32_t
 
	$nÜm®ize_šdex
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št32_t
 
šdex
)

30 ià(
h
->
nÜm®izšg_šdex_off£t
 == 0)

32  
šdex
;

35 
št32_t
 
nÜm®ized_šdex
 = 
šdex
 - 
h
->
nÜm®izšg_šdex_off£t
;

36 
št32_t
 
adju¡m’t
 = 0;

38 ià(
nÜm®ized_šdex
 < 0)

40 
adju¡m’t
 = 
h
->
couÁs_Ën
;

42 ià(
nÜm®ized_šdex
 >ğ
h
->
couÁs_Ën
)

44 
adju¡m’t
 = -
h
->
couÁs_Ën
;

47  
nÜm®ized_šdex
 + 
adju¡m’t
;

48 
	}
}

50 
št64_t
 
	$couÁs_g‘_dœeù
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št32_t
 
šdex
)

52  
h
->
couÁs
[
šdex
];

53 
	}
}

55 
št64_t
 
	$couÁs_g‘_nÜm®i£d
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št32_t
 
šdex
)

57  
	`couÁs_g‘_dœeù
(
h
, 
	`nÜm®ize_šdex
(h, 
šdex
));

58 
	}
}

60 
	$couÁs_šc_nÜm®i£d
(

61 
hdr_hi¡og¿m
* 
h
, 
št32_t
 
šdex
, 
št64_t
 
v®ue
)

63 
št32_t
 
nÜm®i£d_šdex
 = 
	`nÜm®ize_šdex
(
h
, 
šdex
);

64 
h
->
couÁs
[
nÜm®i£d_šdex
] +ğ
v®ue
;

65 
h
->
tÙ®_couÁ
 +ğ
v®ue
;

66 
	}
}

68 
	$upd©e_mš_max
(
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
)

70 
h
->
mš_v®ue
 = (
v®ue
 < h->min_value && value != 0) ? value : h->min_value;

71 
h
->
max_v®ue
 = (
v®ue
 > h->max_value) ? value : h->max_value;

72 
	}
}

82 
št64_t
 
	$pow”
(
št64_t
 
ba£
, iÁ64_ˆ
exp
)

84 
št64_t
 
»suÉ
 = 1;

85 
exp
)

87 
»suÉ
 *ğ
ba£
; 
exp
--;

89  
»suÉ
;

90 
	}
}

92 #ià
defšed
(
_MSC_VER
)

93 #´agm¨
šŒšsic
(
_B™SÿnRev”£64
)

96 
št32_t
 
	$g‘_buck‘_šdex
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
)

98 #ià
	`defšed
(
_MSC_VER
)

99 
ušt32_t
 
Ëadšg_z”o
 = 0;

100 
	`_B™SÿnRev”£64
(&
Ëadšg_z”o
, 
v®ue
 | 
h
->
sub_buck‘_mask
);

101 
št32_t
 
pow2ûšg
 = 64 - (63 - 
Ëadšg_z”o
);

103 
št32_t
 
pow2ûšg
 = 64 - 
	`__butš_şzÎ
(
v®ue
 | 
h
->
sub_buck‘_mask
);

105  
pow2ûšg
 - 
h
->
un™_magn™ude
 - (h->
sub_buck‘_h®f_couÁ_magn™ude
 + 1);

106 
	}
}

108 
št32_t
 
	$g‘_sub_buck‘_šdex
(
št64_t
 
v®ue
, 
št32_t
 
buck‘_šdex
, iÁ32_ˆ
un™_magn™ude
)

110  (
št32_t
)(
v®ue
 >> (
buck‘_šdex
 + 
un™_magn™ude
));

111 
	}
}

113 
št32_t
 
	$couÁs_šdex
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št32_t
 
buck‘_šdex
, iÁ32_ˆ
sub_buck‘_šdex
)

117 
št32_t
 
buck‘_ba£_šdex
 = (
buck‘_šdex
 + 1è<< 
h
->
sub_buck‘_h®f_couÁ_magn™ude
;

119 
št32_t
 
off£t_š_buck‘
 = 
sub_buck‘_šdex
 - 
h
->
sub_buck‘_h®f_couÁ
;

121  
buck‘_ba£_šdex
 + 
off£t_š_buck‘
;

122 
	}
}

124 
št64_t
 
	$v®ue_äom_šdex
(
št32_t
 
buck‘_šdex
, iÁ32_ˆ
sub_buck‘_šdex
, iÁ32_ˆ
un™_magn™ude
)

126  ((
št64_t
è
sub_buck‘_šdex
è<< (
buck‘_šdex
 + 
un™_magn™ude
);

127 
	}
}

129 
št32_t
 
	$couÁs_šdex_fÜ
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
)

131 
št32_t
 
buck‘_šdex
 = 
	`g‘_buck‘_šdex
(
h
, 
v®ue
);

132 
št32_t
 
sub_buck‘_šdex
 = 
	`g‘_sub_buck‘_šdex
(
v®ue
, 
buck‘_šdex
, 
h
->
un™_magn™ude
);

134  
	`couÁs_šdex
(
h
, 
buck‘_šdex
, 
sub_buck‘_šdex
);

135 
	}
}

137 
št64_t
 
	$hdr_v®ue_©_šdex
(cÚ¡ 
hdr_hi¡og¿m
 *
h
, 
št32_t
 
šdex
)

139 
št32_t
 
buck‘_šdex
 = (
šdex
 >> 
h
->
sub_buck‘_h®f_couÁ_magn™ude
) - 1;

140 
št32_t
 
sub_buck‘_šdex
 = (
šdex
 & (
h
->
sub_buck‘_h®f_couÁ
 - 1)) + h->sub_bucket_half_count;

142 ià(
buck‘_šdex
 < 0)

144 
sub_buck‘_šdex
 -ğ
h
->
sub_buck‘_h®f_couÁ
;

145 
buck‘_šdex
 = 0;

148  
	`v®ue_äom_šdex
(
buck‘_šdex
, 
sub_buck‘_šdex
, 
h
->
un™_magn™ude
);

149 
	}
}

151 
št64_t
 
	$hdr_size_of_equiv®’t_v®ue_¿nge
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
)

153 
št32_t
 
buck‘_šdex
 = 
	`g‘_buck‘_šdex
(
h
, 
v®ue
);

154 
št32_t
 
sub_buck‘_šdex
 = 
	`g‘_sub_buck‘_šdex
(
v®ue
, 
buck‘_šdex
, 
h
->
un™_magn™ude
);

155 
št32_t
 
adju¡ed_buck‘
 = (
sub_buck‘_šdex
 >ğ
h
->
sub_buck‘_couÁ
è? (
buck‘_šdex
 + 1) : bucket_index;

156  
	`INT64_C
(1è<< (
h
->
un™_magn™ude
 + 
adju¡ed_buck‘
);

157 
	}
}

159 
št64_t
 
	$lowe¡_equiv®’t_v®ue
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
)

161 
št32_t
 
buck‘_šdex
 = 
	`g‘_buck‘_šdex
(
h
, 
v®ue
);

162 
št32_t
 
sub_buck‘_šdex
 = 
	`g‘_sub_buck‘_šdex
(
v®ue
, 
buck‘_šdex
, 
h
->
un™_magn™ude
);

163  
	`v®ue_äom_šdex
(
buck‘_šdex
, 
sub_buck‘_šdex
, 
h
->
un™_magn™ude
);

164 
	}
}

166 
št64_t
 
	$hdr_Ãxt_nÚ_equiv®’t_v®ue
(cÚ¡ 
hdr_hi¡og¿m
 *
h
, 
št64_t
 
v®ue
)

168  
	`lowe¡_equiv®’t_v®ue
(
h
, 
v®ue
è+ 
	`hdr_size_of_equiv®’t_v®ue_¿nge
(h, value);

169 
	}
}

171 
št64_t
 
	$highe¡_equiv®’t_v®ue
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
)

173  
	`hdr_Ãxt_nÚ_equiv®’t_v®ue
(
h
, 
v®ue
) - 1;

174 
	}
}

176 
št64_t
 
	$hdr_medŸn_equiv®’t_v®ue
(cÚ¡ 
hdr_hi¡og¿m
 *
h
, 
št64_t
 
v®ue
)

178  
	`lowe¡_equiv®’t_v®ue
(
h
, 
v®ue
è+ (
	`hdr_size_of_equiv®’t_v®ue_¿nge
(h, value) >> 1);

179 
	}
}

181 
št64_t
 
	$nÚ_z”o_mš
(cÚ¡ 
hdr_hi¡og¿m
* 
h
)

183 ià(
INT64_MAX
 =ğ
h
->
mš_v®ue
)

185  
INT64_MAX
;

188  
	`lowe¡_equiv®’t_v®ue
(
h
, h->
mš_v®ue
);

189 
	}
}

191 
	$hdr_»£t_š‹º®_couÁ”s
(
hdr_hi¡og¿m
* 
h
)

193 
mš_nÚ_z”o_šdex
 = -1;

194 
max_šdex
 = -1;

195 
št64_t
 
ob£rved_tÙ®_couÁ
 = 0;

196 
i
;

198 
i
 = 0; i < 
h
->
couÁs_Ën
; i++)

200 
št64_t
 
couÁ_©_šdex
;

202 ià((
couÁ_©_šdex
 = 
	`couÁs_g‘_dœeù
(
h
, 
i
)) > 0)

204 
ob£rved_tÙ®_couÁ
 +ğ
couÁ_©_šdex
;

205 
max_šdex
 = 
i
;

206 ià(
mš_nÚ_z”o_šdex
 =ğ-1 && 
i
 != 0)

208 
mš_nÚ_z”o_šdex
 = 
i
;

213 ià(
max_šdex
 == -1)

215 
h
->
max_v®ue
 = 0;

219 
št64_t
 
max_v®ue
 = 
	`hdr_v®ue_©_šdex
(
h
, 
max_šdex
);

220 
h
->
max_v®ue
 = 
	`highe¡_equiv®’t_v®ue
(h, max_value);

223 ià(
mš_nÚ_z”o_šdex
 == -1)

225 
h
->
mš_v®ue
 = 
INT64_MAX
;

229 
h
->
mš_v®ue
 = 
	`hdr_v®ue_©_šdex
(h, 
mš_nÚ_z”o_šdex
);

232 
h
->
tÙ®_couÁ
 = 
ob£rved_tÙ®_couÁ
;

233 
	}
}

235 
št32_t
 
	$buck‘s_Ãeded_to_cov”_v®ue
(
št64_t
 
v®ue
, 
št32_t
 
sub_buck‘_couÁ
, iÁ32_ˆ
un™_magn™ude
)

237 
št64_t
 
sm®Ë¡_uÁ¿ckabË_v®ue
 = ((št64_tè
sub_buck‘_couÁ
è<< 
un™_magn™ude
;

238 
št32_t
 
buck‘s_Ãeded
 = 1;

239 
sm®Ë¡_uÁ¿ckabË_v®ue
 <ğ
v®ue
)

241 ià(
sm®Ë¡_uÁ¿ckabË_v®ue
 > 
INT64_MAX
 / 2)

243  
buck‘s_Ãeded
 + 1;

245 
sm®Ë¡_uÁ¿ckabË_v®ue
 <<= 1;

246 
buck‘s_Ãeded
++;

249  
buck‘s_Ãeded
;

250 
	}
}

260 
	$hdr_ÿlcuÏ‹_buck‘_cÚfig
(

261 
št64_t
 
lowe¡_ŒackabË_v®ue
,

262 
št64_t
 
highe¡_ŒackabË_v®ue
,

263 
signifiÿÁ_figu»s
,

264 
hdr_hi¡og¿m_buck‘_cÚfig
* 
cfg
)

266 ià(
lowe¡_ŒackabË_v®ue
 < 1 ||

267 
signifiÿÁ_figu»s
 < 1 || 5 < significant_figures)

269  
EINVAL
;

271 ià(
lowe¡_ŒackabË_v®ue
 * 2 > 
highe¡_ŒackabË_v®ue
)

273  
EINVAL
;

276 
cfg
->
lowe¡_ŒackabË_v®ue
 =†owest_trackable_value;

277 
cfg
->
signifiÿÁ_figu»s
 = significant_figures;

278 
cfg
->
highe¡_ŒackabË_v®ue
 = highest_trackable_value;

280 
št64_t
 
Ïrge¡_v®ue_w™h_sšgË_un™_»sŞutiÚ
 = 2 * 
	`pow”
(10, 
signifiÿÁ_figu»s
);

281 
št32_t
 
sub_buck‘_couÁ_magn™ude
 = (št32_tè
	`û
(
	`log
(()
Ïrge¡_v®ue_w™h_sšgË_un™_»sŞutiÚ
) /†og(2));

282 
cfg
->
sub_buck‘_h®f_couÁ_magn™ude
 = ((
sub_buck‘_couÁ_magn™ude
 > 1) ? sub_bucket_count_magnitude : 1) - 1;

284 
cfg
->
un™_magn™ude
 = (
št32_t
è
	`æoÜ
(
	`log
(()
lowe¡_ŒackabË_v®ue
) /†og(2));

286 
cfg
->
sub_buck‘_couÁ
 = (
št32_t
è
	`pow
(2, (cfg->
sub_buck‘_h®f_couÁ_magn™ude
 + 1));

287 
cfg
->
sub_buck‘_h®f_couÁ
 = cfg->
sub_buck‘_couÁ
 / 2;

288 
cfg
->
sub_buck‘_mask
 = ((
št64_t
ècfg->
sub_buck‘_couÁ
 - 1è<< cfg->
un™_magn™ude
;

291 
cfg
->
buck‘_couÁ
 = 
	`buck‘s_Ãeded_to_cov”_v®ue
(
highe¡_ŒackabË_v®ue
, cfg->
sub_buck‘_couÁ
, (
št32_t
)cfg->
un™_magn™ude
);

292 
cfg
->
couÁs_Ën
 = (cfg->
buck‘_couÁ
 + 1è* (cfg->
sub_buck‘_couÁ
 / 2);

295 
	}
}

297 
	$hdr_š™_´—Îoÿ‹d
(
hdr_hi¡og¿m
* 
h
, 
hdr_hi¡og¿m_buck‘_cÚfig
* 
cfg
)

299 
h
->
lowe¡_ŒackabË_v®ue
 = 
cfg
->lowest_trackable_value;

300 
h
->
highe¡_ŒackabË_v®ue
 = 
cfg
->highest_trackable_value;

301 
h
->
un™_magn™ude
 = (
št32_t
)
cfg
->unit_magnitude;

302 
h
->
signifiÿÁ_figu»s
 = (
št32_t
)
cfg
->significant_figures;

303 
h
->
sub_buck‘_h®f_couÁ_magn™ude
 = 
cfg
->sub_bucket_half_count_magnitude;

304 
h
->
sub_buck‘_h®f_couÁ
 = 
cfg
->sub_bucket_half_count;

305 
h
->
sub_buck‘_mask
 = 
cfg
->sub_bucket_mask;

306 
h
->
sub_buck‘_couÁ
 = 
cfg
->sub_bucket_count;

307 
h
->
mš_v®ue
 = 
INT64_MAX
;

308 
h
->
max_v®ue
 = 0;

309 
h
->
nÜm®izšg_šdex_off£t
 = 0;

310 
h
->
cÚv”siÚ_¿tio
 = 1.0;

311 
h
->
buck‘_couÁ
 = 
cfg
->bucket_count;

312 
h
->
couÁs_Ën
 = 
cfg
->counts_len;

313 
h
->
tÙ®_couÁ
 = 0;

314 
	}
}

316 
	$hdr_š™
(

317 
št64_t
 
lowe¡_ŒackabË_v®ue
,

318 
št64_t
 
highe¡_ŒackabË_v®ue
,

319 
signifiÿÁ_figu»s
,

320 
hdr_hi¡og¿m
** 
»suÉ
)

322 
hdr_hi¡og¿m_buck‘_cÚfig
 
cfg
;

324 
r
 = 
	`hdr_ÿlcuÏ‹_buck‘_cÚfig
(
lowe¡_ŒackabË_v®ue
, 
highe¡_ŒackabË_v®ue
, 
signifiÿÁ_figu»s
, &
cfg
);

325 ià(
r
)

327  
r
;

330 
size_t
 
hi¡og¿m_size
 = (
hdr_hi¡og¿m
è+ 
cfg
.
couÁs_Ën
 * (
št64_t
);

331 
hdr_hi¡og¿m
* 
hi¡og¿m
 = 
	`m®loc
(
hi¡og¿m_size
);

333 ià(!
hi¡og¿m
)

335  
ENOMEM
;

339 
	`mem£t
((*è
hi¡og¿m
, 0, 
hi¡og¿m_size
);

341 
	`hdr_š™_´—Îoÿ‹d
(
hi¡og¿m
, &
cfg
);

342 *
»suÉ
 = 
hi¡og¿m
;

345 
	}
}

348 
	$hdr_®loc
(
št64_t
 
highe¡_ŒackabË_v®ue
, 
signifiÿÁ_figu»s
, 
hdr_hi¡og¿m
** 
»suÉ
)

350  
	`hdr_š™
(1, 
highe¡_ŒackabË_v®ue
, 
signifiÿÁ_figu»s
, 
»suÉ
);

351 
	}
}

354 
	$hdr_»£t
(
hdr_hi¡og¿m
 *
h
)

356 
h
->
tÙ®_couÁ
=0;

357 
h
->
mš_v®ue
 = 
INT64_MAX
;

358 
h
->
max_v®ue
 = 0;

359 
	`mem£t
((*è&
h
->
couÁs
, 0, ((
št64_t
è* h->
couÁs_Ën
));

361 
	}
}

363 
size_t
 
	$hdr_g‘_memÜy_size
(
hdr_hi¡og¿m
 *
h
)

365  (
hdr_hi¡og¿m
è+ 
h
->
couÁs_Ën
 * (
št64_t
);

366 
	}
}

377 
boŞ
 
	$hdr_»cÜd_v®ue
(
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
)

379  
	`hdr_»cÜd_v®ues
(
h
, 
v®ue
, 1);

380 
	}
}

382 
boŞ
 
	$hdr_»cÜd_v®ues
(
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
, iÁ64_ˆ
couÁ
)

384 ià(
v®ue
 < 0)

386  
çl£
;

389 
št32_t
 
couÁs_šdex
 = 
	`couÁs_šdex_fÜ
(
h
, 
v®ue
);

391 ià(
couÁs_šdex
 < 0 || 
h
->
couÁs_Ën
 <= counts_index)

393  
çl£
;

396 
	`couÁs_šc_nÜm®i£d
(
h
, 
couÁs_šdex
, 
couÁ
);

397 
	`upd©e_mš_max
(
h
, 
v®ue
);

399  
Œue
;

400 
	}
}

402 
boŞ
 
	$hdr_»cÜd_cÜ»ùed_v®ue
(
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
, iÁ64_ˆ
ex³ùed_š‹rv®
)

404  
	`hdr_»cÜd_cÜ»ùed_v®ues
(
h
, 
v®ue
, 1, 
ex³ùed_š‹rv®
);

405 
	}
}

408 
boŞ
 
	$hdr_»cÜd_cÜ»ùed_v®ues
(
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
, iÁ64_ˆ
couÁ
, iÁ64_ˆ
ex³ùed_š‹rv®
)

410 ià(!
	`hdr_»cÜd_v®ues
(
h
, 
v®ue
, 
couÁ
))

412  
çl£
;

415 ià(
ex³ùed_š‹rv®
 <ğ0 || 
v®ue
 <=ƒxpected_interval)

417  
Œue
;

420 
št64_t
 
missšg_v®ue
 = 
v®ue
 - 
ex³ùed_š‹rv®
;

421 ; 
missšg_v®ue
 >ğ
ex³ùed_š‹rv®
; missing_value -=ƒxpected_interval)

423 ià(!
	`hdr_»cÜd_v®ues
(
h
, 
missšg_v®ue
, 
couÁ
))

425  
çl£
;

429  
Œue
;

430 
	}
}

432 
št64_t
 
	$hdr_add
(
hdr_hi¡og¿m
* 
h
, cÚ¡ hdr_hi¡og¿m* 
äom
)

434 
hdr_™”
 
™”
;

435 
	`hdr_™”_»cÜded_š™
(&
™”
, 
äom
);

436 
št64_t
 
drİ³d
 = 0;

438 
	`hdr_™”_Ãxt
(&
™”
))

440 
št64_t
 
v®ue
 = 
™”
.value;

441 
št64_t
 
couÁ
 = 
™”
.count;

443 ià(!
	`hdr_»cÜd_v®ues
(
h
, 
v®ue
, 
couÁ
))

445 
drİ³d
 +ğ
couÁ
;

449  
drİ³d
;

450 
	}
}

452 
št64_t
 
	$hdr_add_whe_cÜ»ùšg_fÜ_coÜdš©ed_omissiÚ
(

453 
hdr_hi¡og¿m
* 
h
, hdr_hi¡og¿m* 
äom
, 
št64_t
 
ex³ùed_š‹rv®
)

455 
hdr_™”
 
™”
;

456 
	`hdr_™”_»cÜded_š™
(&
™”
, 
äom
);

457 
št64_t
 
drİ³d
 = 0;

459 
	`hdr_™”_Ãxt
(&
™”
))

461 
št64_t
 
v®ue
 = 
™”
.value;

462 
št64_t
 
couÁ
 = 
™”
.count;

464 ià(!
	`hdr_»cÜd_cÜ»ùed_v®ues
(
h
, 
v®ue
, 
couÁ
, 
ex³ùed_š‹rv®
))

466 
drİ³d
 +ğ
couÁ
;

470  
drİ³d
;

471 
	}
}

484 
št64_t
 
	$hdr_max
(cÚ¡ 
hdr_hi¡og¿m
* 
h
)

486 ià(0 =ğ
h
->
max_v®ue
)

491  
	`highe¡_equiv®’t_v®ue
(
h
, h->
max_v®ue
);

492 
	}
}

494 
št64_t
 
	$hdr_mš
(cÚ¡ 
hdr_hi¡og¿m
* 
h
)

496 ià(0 < 
	`hdr_couÁ_©_šdex
(
h
, 0))

501  
	`nÚ_z”o_mš
(
h
);

502 
	}
}

504 
št64_t
 
	$hdr_v®ue_©_³rûÁe
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
³rûÁe
)

506 
hdr_™”
 
™”
;

507 
	`hdr_™”_š™
(&
™”
, 
h
);

509 
»que¡ed_³rûÁe
 = 
³rûÁe
 < 100.0 ?…ercentile : 100.0;

510 
št64_t
 
couÁ_©_³rûÁe
 =

511 (
št64_t
è(((
»que¡ed_³rûÁe
 / 100è* 
h
->
tÙ®_couÁ
) + 0.5);

512 
couÁ_©_³rûÁe
 = count_at_percentile > 1 ? count_at_percentile : 1;

513 
št64_t
 
tÙ®
 = 0;

515 
	`hdr_™”_Ãxt
(&
™”
))

517 
tÙ®
 +ğ
™”
.
couÁ
;

519 ià(
tÙ®
 >ğ
couÁ_©_³rûÁe
)

521 
št64_t
 
v®ue_äom_šdex
 = 
™”
.
v®ue
;

522  
	`highe¡_equiv®’t_v®ue
(
h
, 
v®ue_äom_šdex
);

527 
	}
}

529 
	$hdr_m—n
(cÚ¡ 
hdr_hi¡og¿m
* 
h
)

531 
hdr_™”
 
™”
;

532 
št64_t
 
tÙ®
 = 0;

534 
	`hdr_™”_š™
(&
™”
, 
h
);

536 
	`hdr_™”_Ãxt
(&
™”
))

538 ià(0 !ğ
™”
.
couÁ
)

540 
tÙ®
 +ğ
™”
.
couÁ
 * 
	`hdr_medŸn_equiv®’t_v®ue
(
h
, i‹r.
v®ue
);

544  (
tÙ®
 * 1.0è/ 
h
->
tÙ®_couÁ
;

545 
	}
}

547 
	$hdr_¡ddev
(cÚ¡ 
hdr_hi¡og¿m
* 
h
)

549 
m—n
 = 
	`hdr_m—n
(
h
);

550 
geom‘ric_dev_tÙ®
 = 0.0;

552 
hdr_™”
 
™”
;

553 
	`hdr_™”_š™
(&
™”
, 
h
);

555 
	`hdr_™”_Ãxt
(&
™”
))

557 ià(0 !ğ
™”
.
couÁ
)

559 
dev
 = (
	`hdr_medŸn_equiv®’t_v®ue
(
h
, 
™”
.
v®ue
è* 1.0è- 
m—n
;

560 
geom‘ric_dev_tÙ®
 +ğ(
dev
 * devè* 
™”
.
couÁ
;

564  
	`sq¹
(
geom‘ric_dev_tÙ®
 / 
h
->
tÙ®_couÁ
);

565 
	}
}

567 
boŞ
 
	$hdr_v®ues_¬e_equiv®’t
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
a
, iÁ64_ˆ
b
)

569  
	`lowe¡_equiv®’t_v®ue
(
h
, 
a
è=ğlowe¡_equiv®’t_v®ue(h, 
b
);

570 
	}
}

572 
št64_t
 
	$hdr_lowe¡_equiv®’t_v®ue
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
)

574  
	`lowe¡_equiv®’t_v®ue
(
h
, 
v®ue
);

575 
	}
}

577 
št64_t
 
	$hdr_couÁ_©_v®ue
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
)

579  
	`couÁs_g‘_nÜm®i£d
(
h
, 
	`couÁs_šdex_fÜ
(h, 
v®ue
));

580 
	}
}

582 
št64_t
 
	$hdr_couÁ_©_šdex
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št32_t
 
šdex
)

584  
	`couÁs_g‘_nÜm®i£d
(
h
, 
šdex
);

585 
	}
}

597 
boŞ
 
	$has_buck‘s
(
hdr_™”
* 
™”
)

599  
™”
->
couÁs_šdex
 < i‹r->
h
->
couÁs_Ën
;

600 
	}
}

602 
boŞ
 
	$has_Ãxt
(
hdr_™”
* 
™”
)

604  
™”
->
cumuÏtive_couÁ
 < i‹r->
h
->
tÙ®_couÁ
;

605 
	}
}

607 
boŞ
 
	$move_Ãxt
(
hdr_™”
* 
™”
)

609 
™”
->
couÁs_šdex
++;

611 ià(!
	`has_buck‘s
(
™”
))

613  
çl£
;

616 
™”
->
couÁ
 = 
	`couÁs_g‘_nÜm®i£d
(™”->
h
, i‹r->
couÁs_šdex
);

617 
™”
->
cumuÏtive_couÁ
 +ğ™”->
couÁ
;

619 
™”
->
v®ue
 = 
	`hdr_v®ue_©_šdex
(™”->
h
, i‹r->
couÁs_šdex
);

620 
™”
->
highe¡_equiv®’t_v®ue
 = 
	`highe¡_equiv®’t_v®ue
(™”->
h
, i‹r->
v®ue
);

621 
™”
->
lowe¡_equiv®’t_v®ue
 = 
	`lowe¡_equiv®’t_v®ue
(™”->
h
, i‹r->
v®ue
);

622 
™”
->
medŸn_equiv®’t_v®ue
 = 
	`hdr_medŸn_equiv®’t_v®ue
(™”->
h
, i‹r->
v®ue
);

624  
Œue
;

625 
	}
}

627 
št64_t
 
	$³ek_Ãxt_v®ue_äom_šdex
(
hdr_™”
* 
™”
)

629  
	`hdr_v®ue_©_šdex
(
™”
->
h
, i‹r->
couÁs_šdex
 + 1);

630 
	}
}

632 
boŞ
 
	$Ãxt_v®ue_g»©”_thª_»pÜtšg_Ëv–_uµ”_bound
(

633 
hdr_™”
 *
™”
, 
št64_t
 
»pÜtšg_Ëv–_uµ”_bound
)

635 ià(
™”
->
couÁs_šdex
 >ğ™”->
h
->
couÁs_Ën
)

637  
çl£
;

640  
	`³ek_Ãxt_v®ue_äom_šdex
(
™”
è> 
»pÜtšg_Ëv–_uµ”_bound
;

641 
	}
}

643 
boŞ
 
	$_basic_™”_Ãxt
(
hdr_™”
 *
™”
)

645 ià(!
	`has_Ãxt
(
™”
))

647  
çl£
;

650 
	`move_Ãxt
(
™”
);

652  
Œue
;

653 
	}
}

655 
	$_upd©e_™”©ed_v®ues
(
hdr_™”
* 
™”
, 
št64_t
 
Ãw_v®ue_™”©ed_to
)

657 
™”
->
v®ue_™”©ed_äom
 = i‹r->
v®ue_™”©ed_to
;

658 
™”
->
v®ue_™”©ed_to
 = 
Ãw_v®ue_™”©ed_to
;

659 
	}
}

661 
boŞ
 
	$_®l_v®ues_™”_Ãxt
(
hdr_™”
* 
™”
)

663 
boŞ
 
»suÉ
 = 
	`move_Ãxt
(
™”
);

665 ià(
»suÉ
)

667 
	`_upd©e_™”©ed_v®ues
(
™”
, i‹r->
v®ue
);

670  
»suÉ
;

671 
	}
}

673 
	$hdr_™”_š™
(
hdr_™”
* 
™”
, cÚ¡ 
hdr_hi¡og¿m
* 
h
)

675 
™”
->
h
 = h;

677 
™”
->
couÁs_šdex
 = -1;

678 
™”
->
couÁ
 = 0;

679 
™”
->
cumuÏtive_couÁ
 = 0;

680 
™”
->
v®ue
 = 0;

681 
™”
->
highe¡_equiv®’t_v®ue
 = 0;

682 
™”
->
v®ue_™”©ed_äom
 = 0;

683 
™”
->
v®ue_™”©ed_to
 = 0;

685 
™”
->
_Ãxt_å
 = 
_®l_v®ues_™”_Ãxt
;

686 
	}
}

688 
boŞ
 
	$hdr_™”_Ãxt
(
hdr_™”
* 
™”
)

690  
™”
->
	`_Ãxt_å
(iter);

691 
	}
}

701 
boŞ
 
	$_³rûÁe_™”_Ãxt
(
hdr_™”
* 
™”
)

703 
hdr_™”_³rûÁes
* 
³rûÁes
 = &
™”
->
¥ecifics
.percentiles;

705 ià(!
	`has_Ãxt
(
™”
))

707 ià(
³rûÁes
->
£’_Ï¡_v®ue
)

709  
çl£
;

712 
³rûÁes
->
£’_Ï¡_v®ue
 = 
Œue
;

713 
³rûÁes
->
³rûÁe
 = 100.0;

715  
Œue
;

718 ià(
™”
->
couÁs_šdex
 =ğ-1 && !
	`_basic_™”_Ãxt
(iter))

720  
çl£
;

725 
cu¼’t_³rûÁe
 = (100.0 * (è
™”
->
cumuÏtive_couÁ
è/ i‹r->
h
->
tÙ®_couÁ
;

726 ià(
™”
->
couÁ
 != 0 &&

727 
³rûÁes
->
³rûÁe_to_™”©e_to
 <ğ
cu¼’t_³rûÁe
)

729 
	`_upd©e_™”©ed_v®ues
(
™”
, 
	`highe¡_equiv®’t_v®ue
(™”->
h
, i‹r->
v®ue
));

731 
³rûÁes
->
³rûÁe
 =…”ûÁes->
³rûÁe_to_™”©e_to
;

732 
št64_t
 
‹mp
 = (št64_t)(
	`log
(100 / (100.0 - (
³rûÁes
->
³rûÁe_to_™”©e_to
))) /†og(2)) + 1;

733 
št64_t
 
h®f_di¡ªû
 = (št64_tè
	`pow
(2, (è
‹mp
);

734 
št64_t
 
³rûÁe_»pÜtšg_ticks
 = 
³rûÁes
->
ticks_³r_h®f_di¡ªû
 * 
h®f_di¡ªû
;

735 
³rûÁes
->
³rûÁe_to_™”©e_to
 +ğ100.0 / 
³rûÁe_»pÜtšg_ticks
;

737  
Œue
;

740 
	`_basic_™”_Ãxt
(
™”
));

742  
Œue
;

743 
	}
}

745 
	$hdr_™”_³rûÁe_š™
(
hdr_™”
* 
™”
, cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št32_t
 
ticks_³r_h®f_di¡ªû
)

747 
™”
->
h
 = h;

749 
	`hdr_™”_š™
(
™”
, 
h
);

751 
™”
->
¥ecifics
.
³rûÁes
.
£’_Ï¡_v®ue
 = 
çl£
;

752 
™”
->
¥ecifics
.
³rûÁes
.
ticks_³r_h®f_di¡ªû
 =icks_per_half_distance;

753 
™”
->
¥ecifics
.
³rûÁes
.
³rûÁe_to_™”©e_to
 = 0.0;

754 
™”
->
¥ecifics
.
³rûÁes
.
³rûÁe
 = 0.0;

756 
™”
->
_Ãxt_å
 = 
_³rûÁe_™”_Ãxt
;

757 
	}
}

759 
	$fÜm©_lše_¡ršg
(* 
¡r
, 
size_t
 
Ën
, 
signifiÿÁ_figu»s
, 
fÜm©_ty³
 
fÜm©
)

761 #ià
	`defšed
(
_MSC_VER
)

762 
	#¢´štf
 
_¢´štf


	)

763 #´agm¨
	`w¬nšg
(
push
)

764 #´agm¨
	`w¬nšg
(
di§bË
: 4996)

766 cÚ¡ * 
fÜm©_¡r
 = "%s%d%s";

768 
fÜm©
)

770 
CSV
:

771 
	`¢´štf
(
¡r
, 
Ën
, 
fÜm©_¡r
, "%.", 
signifiÿÁ_figu»s
, "f,%f,%d,%.2f\n");

773 
CLASSIC
:

774 
	`¢´štf
(
¡r
, 
Ën
, 
fÜm©_¡r
, "%12.", 
signifiÿÁ_figu»s
, "f %12f %12d %12.2f\n");

777 
	`¢´štf
(
¡r
, 
Ën
, 
fÜm©_¡r
, "%12.", 
signifiÿÁ_figu»s
, "f %12f %12d %12.2f\n");

779 #ià
	`defšed
(
_MSC_VER
)

780 #undeà
¢´štf


781 #´agm¨
	`w¬nšg
(
pİ
)

783 
	}
}

795 
boŞ
 
	$_»cÜded_™”_Ãxt
(
hdr_™”
* 
™”
)

797 
	`_basic_™”_Ãxt
(
™”
))

799 ià(
™”
->
couÁ
 != 0)

801 
	`_upd©e_™”©ed_v®ues
(
™”
, i‹r->
v®ue
);

803 
™”
->
¥ecifics
.
»cÜded
.
couÁ_added_š_this_™”©iÚ_¡•
 = i‹r->
couÁ
;

804  
Œue
;

808  
çl£
;

809 
	}
}

811 
	$hdr_™”_»cÜded_š™
(
hdr_™”
* 
™”
, cÚ¡ 
hdr_hi¡og¿m
* 
h
)

813 
	`hdr_™”_š™
(
™”
, 
h
);

815 
™”
->
¥ecifics
.
»cÜded
.
couÁ_added_š_this_™”©iÚ_¡•
 = 0;

817 
™”
->
_Ãxt_å
 = 
_»cÜded_™”_Ãxt
;

818 
	}
}

829 
boŞ
 
	$_™”_lš—r_Ãxt
(
hdr_™”
* 
™”
)

831 
hdr_™”_lš—r
* 
lš—r
 = &
™”
->
¥ecifics
.linear;

833 
lš—r
->
couÁ_added_š_this_™”©iÚ_¡•
 = 0;

835 ià(
	`has_Ãxt
(
™”
) ||

836 
	`Ãxt_v®ue_g»©”_thª_»pÜtšg_Ëv–_uµ”_bound
(

837 
™”
, 
lš—r
->
Ãxt_v®ue_»pÜtšg_Ëv–_lowe¡_equiv®’t
))

841 ià(
™”
->
v®ue
 >ğ
lš—r
->
Ãxt_v®ue_»pÜtšg_Ëv–_lowe¡_equiv®’t
)

843 
	`_upd©e_™”©ed_v®ues
(
™”
, 
lš—r
->
Ãxt_v®ue_»pÜtšg_Ëv–
);

845 
lš—r
->
Ãxt_v®ue_»pÜtšg_Ëv–
 +ğlš—r->
v®ue_un™s_³r_buck‘
;

846 
lš—r
->
Ãxt_v®ue_»pÜtšg_Ëv–_lowe¡_equiv®’t
 =

847 
	`lowe¡_equiv®’t_v®ue
(
™”
->
h
, 
lš—r
->
Ãxt_v®ue_»pÜtšg_Ëv–
);

849  
Œue
;

852 ià(!
	`move_Ãxt
(
™”
))

854  
Œue
;

857 
lš—r
->
couÁ_added_š_this_™”©iÚ_¡•
 +ğ
™”
->
couÁ
;

859 
Œue
);

862  
çl£
;

863 
	}
}

866 
	$hdr_™”_lš—r_š™
(
hdr_™”
* 
™”
, cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue_un™s_³r_buck‘
)

868 
	`hdr_™”_š™
(
™”
, 
h
);

870 
™”
->
¥ecifics
.
lš—r
.
couÁ_added_š_this_™”©iÚ_¡•
 = 0;

871 
™”
->
¥ecifics
.
lš—r
.
v®ue_un™s_³r_buck‘
 = value_units_per_bucket;

872 
™”
->
¥ecifics
.
lš—r
.
Ãxt_v®ue_»pÜtšg_Ëv–
 = 
v®ue_un™s_³r_buck‘
;

873 
™”
->
¥ecifics
.
lš—r
.
Ãxt_v®ue_»pÜtšg_Ëv–_lowe¡_equiv®’t
 = 
	`lowe¡_equiv®’t_v®ue
(
h
, 
v®ue_un™s_³r_buck‘
);

875 
™”
->
_Ãxt_å
 = 
_™”_lš—r_Ãxt
;

876 
	}
}

886 
boŞ
 
	$_log_™”_Ãxt
(
hdr_™”
 *
™”
)

888 
hdr_™”_log
* 
log¬™hmic
 = &
™”
->
¥ecifics
.
log
;

890 
log¬™hmic
->
couÁ_added_š_this_™”©iÚ_¡•
 = 0;

892 ià(
	`has_Ãxt
(
™”
) ||

893 
	`Ãxt_v®ue_g»©”_thª_»pÜtšg_Ëv–_uµ”_bound
(

894 
™”
, 
log¬™hmic
->
Ãxt_v®ue_»pÜtšg_Ëv–_lowe¡_equiv®’t
))

898 ià(
™”
->
v®ue
 >ğ
log¬™hmic
->
Ãxt_v®ue_»pÜtšg_Ëv–_lowe¡_equiv®’t
)

900 
	`_upd©e_™”©ed_v®ues
(
™”
, 
log¬™hmic
->
Ãxt_v®ue_»pÜtšg_Ëv–
);

902 
log¬™hmic
->
Ãxt_v®ue_»pÜtšg_Ëv–
 *ğ(
št64_t
îog¬™hmic->
log_ba£
;

903 
log¬™hmic
->
Ãxt_v®ue_»pÜtšg_Ëv–_lowe¡_equiv®’t
 = 
	`lowe¡_equiv®’t_v®ue
(
™”
->
h
,†og¬™hmic->
Ãxt_v®ue_»pÜtšg_Ëv–
);

905  
Œue
;

908 ià(!
	`move_Ãxt
(
™”
))

910  
Œue
;

913 
log¬™hmic
->
couÁ_added_š_this_™”©iÚ_¡•
 +ğ
™”
->
couÁ
;

915 
Œue
);

918  
çl£
;

919 
	}
}

921 
	$hdr_™”_log_š™
(

922 
hdr_™”
* 
™”
,

923 cÚ¡ 
hdr_hi¡og¿m
* 
h
,

924 
št64_t
 
v®ue_un™s_fœ¡_buck‘
,

925 
log_ba£
)

927 
	`hdr_™”_š™
(
™”
, 
h
);

928 
™”
->
¥ecifics
.
log
.
couÁ_added_š_this_™”©iÚ_¡•
 = 0;

929 
™”
->
¥ecifics
.
log
.
log_ba£
 =†og_base;

930 
™”
->
¥ecifics
.
log
.
Ãxt_v®ue_»pÜtšg_Ëv–
 = 
v®ue_un™s_fœ¡_buck‘
;

931 
™”
->
¥ecifics
.
log
.
Ãxt_v®ue_»pÜtšg_Ëv–_lowe¡_equiv®’t
 = 
	`lowe¡_equiv®’t_v®ue
(
h
, 
v®ue_un™s_fœ¡_buck‘
);

933 
™”
->
_Ãxt_å
 = 
_log_™”_Ãxt
;

934 
	}
}

938 cÚ¡ * 
	$fÜm©_h—d_¡ršg
(
fÜm©_ty³
 
fÜm©
)

940 
fÜm©
)

942 
CSV
:

944 
CLASSIC
:

949 
	}
}

951 cÚ¡ 
	gCLASSIC_FOOTER
[] =

953 "#[Max = %12.3f, TÙ® couÁ = %12" 
PRIu64
 "]\n"

956 
	$hdr_³rûÁes_´št
(

957 
hdr_hi¡og¿m
* 
h
, 
FILE
* 
¡»am
, 
št32_t
 
ticks_³r_h®f_di¡ªû
,

958 
v®ue_sÿË
, 
fÜm©_ty³
 
fÜm©
)

960 
lše_fÜm©
[25];

961 
	`fÜm©_lše_¡ršg
(
lše_fÜm©
, 25, 
h
->
signifiÿÁ_figu»s
, 
fÜm©
);

962 cÚ¡ * 
h—d_fÜm©
 = 
	`fÜm©_h—d_¡ršg
(
fÜm©
);

963 
rc
 = 0;

965 
hdr_™”
 
™”
;

966 
	`hdr_™”_³rûÁe_š™
(&
™”
, 
h
, 
ticks_³r_h®f_di¡ªû
);

968 ià(
	`årštf
(

969 
¡»am
, 
h—d_fÜm©
,

972 
rc
 = 
EIO
;

973 
ş—nup
;

976 
hdr_™”_³rûÁes
 * 
³rûÁes
 = &
™”
.
¥ecifics
.percentiles;

977 
	`hdr_™”_Ãxt
(&
™”
))

979 
v®ue
 = 
™”
.
highe¡_equiv®’t_v®ue
 / 
v®ue_sÿË
;

980 
³rûÁe
 = 
³rûÁes
->percentile / 100.0;

981 
št64_t
 
tÙ®_couÁ
 = 
™”
.
cumuÏtive_couÁ
;

982 
šv”‹d_³rûÁe
 = (1.0 / (1.0 - 
³rûÁe
));

984 ià(
	`årštf
(

985 
¡»am
, 
lše_fÜm©
, 
v®ue
, 
³rûÁe
, 
tÙ®_couÁ
, 
šv”‹d_³rûÁe
) < 0)

987 
rc
 = 
EIO
;

988 
ş—nup
;

992 ià(
CLASSIC
 =ğ
fÜm©
)

994 
m—n
 = 
	`hdr_m—n
(
h
è/ 
v®ue_sÿË
;

995 
¡ddev
 = 
	`hdr_¡ddev
(
h
è/ 
v®ue_sÿË
;

996 
max
 = 
	`hdr_max
(
h
è/ 
v®ue_sÿË
;

998 ià(
	`årštf
(

999 
¡»am
, 
CLASSIC_FOOTER
, 
m—n
, 
¡ddev
, 
max
,

1000 
h
->
tÙ®_couÁ
, h->
buck‘_couÁ
, h->
sub_buck‘_couÁ
) < 0)

1002 
rc
 = 
EIO
;

1003 
ş—nup
;

1007 
ş—nup
:

1008  
rc
;

1009 
	}
}

	@hdr_histogram/hdr_histogram.h

10 #iâdeà
HDR_HISTOGRAM_H


11 
	#HDR_HISTOGRAM_H
 1

	)

13 
	~<¡dšt.h
>

14 
	~<¡dboŞ.h
>

15 
	~<¡dio.h
>

17 
	shdr_hi¡og¿m


19 
št64_t
 
	mlowe¡_ŒackabË_v®ue
;

20 
št64_t
 
	mhighe¡_ŒackabË_v®ue
;

21 
št32_t
 
	mun™_magn™ude
;

22 
št32_t
 
	msignifiÿÁ_figu»s
;

23 
št32_t
 
	msub_buck‘_h®f_couÁ_magn™ude
;

24 
št32_t
 
	msub_buck‘_h®f_couÁ
;

25 
št64_t
 
	msub_buck‘_mask
;

26 
št32_t
 
	msub_buck‘_couÁ
;

27 
št32_t
 
	mbuck‘_couÁ
;

28 
št64_t
 
	mmš_v®ue
;

29 
št64_t
 
	mmax_v®ue
;

30 
št32_t
 
	mnÜm®izšg_šdex_off£t
;

31 
	mcÚv”siÚ_¿tio
;

32 
št32_t
 
	mcouÁs_Ën
;

33 
št64_t
 
	mtÙ®_couÁ
;

34 
št64_t
 
	mcouÁs
[0];

37 #ifdeà
__ılu¥lus


62 
hdr_š™
(

63 
št64_t
 
lowe¡_ŒackabË_v®ue
,

64 
št64_t
 
highe¡_ŒackabË_v®ue
,

65 
signifiÿÁ_figu»s
,

66 
hdr_hi¡og¿m
** 
»suÉ
);

74 
hdr_®loc
(
št64_t
 
highe¡_ŒackabË_v®ue
, 
signifiÿÁ_figu»s
, 
hdr_hi¡og¿m
** 
»suÉ
);

86 
hdr_»£t
(
hdr_hi¡og¿m
 *
h
);

94 
size_t
 
hdr_g‘_memÜy_size
(
hdr_hi¡og¿m
 *
h
);

105 
boŞ
 
hdr_»cÜd_v®ue
(
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
);

118 
boŞ
 
hdr_»cÜd_v®ues
(
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
, iÁ64_ˆ
couÁ
);

136 
boŞ
 
hdr_»cÜd_cÜ»ùed_v®ue
(
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
, iÁ64_ˆ
ex³xùed_š‹rv®
);

148 
boŞ
 
hdr_»cÜd_cÜ»ùed_v®ues
(
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
, iÁ64_ˆ
couÁ
, iÁ64_ˆ
ex³ùed_š‹rv®
);

160 
št64_t
 
hdr_add
(
hdr_hi¡og¿m
* 
h
, cÚ¡ hdr_hi¡og¿m* 
äom
);

172 
št64_t
 
hdr_add_whe_cÜ»ùšg_fÜ_coÜdš©ed_omissiÚ
(

173 
hdr_hi¡og¿m
* 
h
, hdr_hi¡og¿m* 
äom
, 
št64_t
 
ex³ùed_š‹rv®
);

181 
št64_t
 
hdr_mš
(cÚ¡ 
hdr_hi¡og¿m
* 
h
);

189 
št64_t
 
hdr_max
(cÚ¡ 
hdr_hi¡og¿m
* 
h
);

197 
št64_t
 
hdr_v®ue_©_³rûÁe
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
³rûÁe
);

205 
hdr_¡ddev
(cÚ¡ 
hdr_hi¡og¿m
* 
h
);

213 
hdr_m—n
(cÚ¡ 
hdr_hi¡og¿m
* 
h
);

225 
boŞ
 
hdr_v®ues_¬e_equiv®’t
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
a
, iÁ64_ˆ
b
);

236 
št64_t
 
hdr_lowe¡_equiv®’t_v®ue
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, iÁ64_ˆ
v®ue
);

247 
št64_t
 
hdr_couÁ_©_v®ue
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, iÁ64_ˆ
v®ue
);

248 
št64_t
 
hdr_couÁ_©_šdex
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št32_t
 
šdex
);

249 
št64_t
 
hdr_v®ue_©_šdex
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št32_t
 
šdex
);

251 
	shdr_™”_³rûÁes


253 
boŞ
 
£’_Ï¡_v®ue
;

254 
št32_t
 
ticks_³r_h®f_di¡ªû
;

255 
³rûÁe_to_™”©e_to
;

256 
³rûÁe
;

259 
	shdr_™”_»cÜded


261 
št64_t
 
couÁ_added_š_this_™”©iÚ_¡•
;

264 
	shdr_™”_lš—r


266 
št64_t
 
v®ue_un™s_³r_buck‘
;

267 
št64_t
 
couÁ_added_š_this_™”©iÚ_¡•
;

268 
št64_t
 
Ãxt_v®ue_»pÜtšg_Ëv–
;

269 
št64_t
 
Ãxt_v®ue_»pÜtšg_Ëv–_lowe¡_equiv®’t
;

272 
	shdr_™”_log


274 
log_ba£
;

275 
št64_t
 
couÁ_added_š_this_™”©iÚ_¡•
;

276 
št64_t
 
Ãxt_v®ue_»pÜtšg_Ëv–
;

277 
št64_t
 
Ãxt_v®ue_»pÜtšg_Ëv–_lowe¡_equiv®’t
;

288 
	shdr_™”


290 cÚ¡ 
hdr_hi¡og¿m
* 
h
;

292 
št32_t
 
couÁs_šdex
;

294 
št64_t
 
couÁ
;

296 
št64_t
 
cumuÏtive_couÁ
;

298 
št64_t
 
v®ue
;

299 
št64_t
 
highe¡_equiv®’t_v®ue
;

300 
št64_t
 
lowe¡_equiv®’t_v®ue
;

301 
št64_t
 
medŸn_equiv®’t_v®ue
;

302 
št64_t
 
v®ue_™”©ed_äom
;

303 
št64_t
 
v®ue_™”©ed_to
;

307 
hdr_™”_³rûÁes
 
³rûÁes
;

308 
hdr_™”_»cÜded
 
»cÜded
;

309 
hdr_™”_lš—r
 
lš—r
;

310 
hdr_™”_log
 
log
;

311 } 
¥ecifics
;

313 
boŞ
 (*
_Ãxt_å
)(
hdr_™”
* 
™”
);

323 
hdr_™”_š™
(
hdr_™”
* 
™”
, cÚ¡ 
hdr_hi¡og¿m
* 
h
);

328 
hdr_™”_³rûÁe_š™
(
hdr_™”
* 
™”
, cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št32_t
 
ticks_³r_h®f_di¡ªû
);

333 
hdr_™”_»cÜded_š™
(
hdr_™”
* 
™”
, cÚ¡ 
hdr_hi¡og¿m
* 
h
);

338 
hdr_™”_lš—r_š™
(

339 
hdr_™”
* 
™”
,

340 cÚ¡ 
hdr_hi¡og¿m
* 
h
,

341 
št64_t
 
v®ue_un™s_³r_buck‘
);

346 
hdr_™”_log_š™
(

347 
hdr_™”
* 
™”
,

348 cÚ¡ 
hdr_hi¡og¿m
* 
h
,

349 
št64_t
 
v®ue_un™s_fœ¡_buck‘
,

350 
log_ba£
);

359 
boŞ
 
hdr_™”_Ãxt
(
hdr_™”
* 
™”
);

362 
CLASSIC
,

363 
CSV


364 } 
	tfÜm©_ty³
;

378 
hdr_³rûÁes_´št
(

379 
hdr_hi¡og¿m
* 
h
, 
FILE
* 
¡»am
, 
št32_t
 
ticks_³r_h®f_di¡ªû
,

380 
v®ue_sÿË
, 
fÜm©_ty³
 
fÜm©
);

385 
	shdr_hi¡og¿m_buck‘_cÚfig


387 
št64_t
 
lowe¡_ŒackabË_v®ue
;

388 
št64_t
 
highe¡_ŒackabË_v®ue
;

389 
št64_t
 
un™_magn™ude
;

390 
št64_t
 
signifiÿÁ_figu»s
;

391 
št32_t
 
sub_buck‘_h®f_couÁ_magn™ude
;

392 
št32_t
 
sub_buck‘_h®f_couÁ
;

393 
št64_t
 
sub_buck‘_mask
;

394 
št32_t
 
sub_buck‘_couÁ
;

395 
št32_t
 
buck‘_couÁ
;

396 
št32_t
 
couÁs_Ën
;

399 
hdr_ÿlcuÏ‹_buck‘_cÚfig
(

400 
št64_t
 
lowe¡_ŒackabË_v®ue
,

401 
št64_t
 
highe¡_ŒackabË_v®ue
,

402 
signifiÿÁ_figu»s
,

403 
hdr_hi¡og¿m_buck‘_cÚfig
* 
cfg
);

405 
hdr_š™_´—Îoÿ‹d
(
hdr_hi¡og¿m
* 
h
, 
hdr_hi¡og¿m_buck‘_cÚfig
* 
cfg
);

407 
št64_t
 
hdr_size_of_equiv®’t_v®ue_¿nge
(cÚ¡ 
hdr_hi¡og¿m
 *
h
, iÁ64_ˆ
v®ue
);

408 
št64_t
 
hdr_Ãxt_nÚ_equiv®’t_v®ue
(cÚ¡ 
hdr_hi¡og¿m
 *
h
, iÁ64_ˆ
v®ue
);

409 
št64_t
 
hdr_medŸn_equiv®’t_v®ue
(cÚ¡ 
hdr_hi¡og¿m
 *
h
, iÁ64_ˆ
v®ue
);

411 #ifdeà
__ılu¥lus


	@hdr_histogram/hdr_histogram_log.c

7 
	~<¡dšt.h
>

8 
	~<¡dlib.h
>

9 
	~<¡dboŞ.h
>

10 
	~<š‰y³s.h
>

11 
	~<¡dio.h
>

12 
	~<¡ršg.h
>

13 #ià
defšed
(
_MSC_VER
)

14 #undeà
HAVE_UNISTD_H


16 
	~<zlib.h
>

17 
	~<”ºo.h
>

18 
	~<ùy³.h
>

19 
	~<m©h.h
>

20 
	~<time.h
>

22 
	~"hdr_’codšg.h
"

23 
	~"hdr_hi¡og¿m.h
"

24 
	~"hdr_hi¡og¿m_log.h
"

25 
	~"hdr_‹¡s.h
"

27 #ià
defšed
(
_MSC_VER
)

28 
	~<št§ã.h
>

29 
SSIZE_T
 
	tssize_t
;

30 #´agm¨
comm’t
(
lib
, "ws2_32.lib")

31 #´agm¨
w¬nšg
(
push
)

32 #´agm¨
w¬nšg
(
di§bË
: 4996)

35 
	~"hdr_’dŸn.h
"

38 
št32_t
 
couÁs_šdex_fÜ
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
);

41 
	#FAIL_AND_CLEANUP
(
Ïb–
, 
”rÜ_Çme
, 
”rÜ
) \

44 
”rÜ_Çme
 = 
”rÜ
; \

45 
Ïb–
; \

47 0)

	)

49 
	$»®loc_bufãr
(

50 ** 
bufãr
, 
size_t
 
nmemb
, 
ssize_t
 
size
)

52 
size_t
 
Ën
 = 
nmemb
 * 
size
;

53 ià(
NULL
 =ğ*
bufãr
)

55 *
bufãr
 = 
	`m®loc
(
Ën
);

59 *
bufãr
 = 
	`»®loc
(*bufãr, 
Ën
);

62 ià(
NULL
 =ğ*
bufãr
)

64  
ENOMEM
;

68 
	`mem£t
(*
bufãr
, 0, 
Ën
);

71 
	}
}

81 
ssize_t
 
	$nuÎ_Œašg_wh™e¥aû
(* 
s
, 
ssize_t
 
Ën
)

83 
ssize_t
 
i
 = 
Ën
;

84 --
i
 != -1)

86 ià(
	`is¥aû
(
s
[
i
]))

88 
s
[
i
] = '\0';

92  
i
 + 1;

97 
	}
}

107 cÚ¡ 
št32_t
 
	gV0_ENCODING_COOKIE
 = 0x1c849308;

108 cÚ¡ 
št32_t
 
	gV0_COMPRESSION_COOKIE
 = 0x1c849309;

110 cÚ¡ 
št32_t
 
	gV1_ENCODING_COOKIE
 = 0x1c849301;

111 cÚ¡ 
št32_t
 
	gV1_COMPRESSION_COOKIE
 = 0x1c849302;

113 cÚ¡ 
št32_t
 
	gV2_ENCODING_COOKIE
 = 0x1c849303;

114 cÚ¡ 
št32_t
 
	gV2_COMPRESSION_COOKIE
 = 0x1c849304;

116 
št32_t
 
	$g‘_cook›_ba£
(
št32_t
 
cook›
)

118  (
cook›
 & ~0xf0);

119 
	}
}

121 
št32_t
 
	$wÜd_size_äom_cook›
(
št32_t
 
cook›
)

123  (
cook›
 & 0xf0) >> 4;

124 
	}
}

126 cÚ¡ * 
	$hdr_¡»¼Ü
(
”ºum
)

128 
”ºum
)

130 
HDR_COMPRESSION_COOKIE_MISMATCH
:

132 
HDR_ENCODING_COOKIE_MISMATCH
:

134 
HDR_DEFLATE_INIT_FAIL
:

136 
HDR_DEFLATE_FAIL
:

138 
HDR_INFLATE_INIT_FAIL
:

140 
HDR_INFLATE_FAIL
:

142 
HDR_LOG_INVALID_VERSION
:

144 
HDR_TRAILING_ZEROS_INVALID
:

146 
HDR_VALUE_TRUNCATED
:

148 
HDR_ENCODED_INPUT_TOO_LONG
:

151  
	`¡»¼Ü
(
”ºum
);

153 
	}
}

155 
	$¡rm_š™
(
z_¡»am
* 
¡rm
)

157 
¡rm
->
zä“
 = 
NULL
;

158 
¡rm
->
z®loc
 = 
NULL
;

159 
¡rm
->
İaque
 = 
NULL
;

160 
¡rm
->
Ãxt_š
 = 
NULL
;

161 
¡rm
->
ava_š
 = 0;

162 
	}
}

164 
	uušt64_dbl_cvt


166 
ušt64_t
 
	ml
;

167 
	md
;

170 
	$št64_b™s_to_doubË
(
št64_t
 
i
)

172 
ušt64_dbl_cvt
 
x
;

174 
x
.
l
 = (
ušt64_t
è
i
;

175  
x
.
d
;

176 
	}
}

178 
ušt64_t
 
	$doubË_to_št64_b™s
(
d
)

180 
ušt64_dbl_cvt
 
x
;

182 
x
.
d
 = d;

183  
x
.
l
;

184 
	}
}

186 #´agm¨
·ck
(
push
, 1)

189 
št32_t
 
	mcook›
;

190 
št32_t
 
	msignifiÿÁ_figu»s
;

191 
št64_t
 
	mlowe¡_ŒackabË_v®ue
;

192 
št64_t
 
	mhighe¡_ŒackabË_v®ue
;

193 
št64_t
 
	mtÙ®_couÁ
;

194 
št64_t
 
	mcouÁs
[0];

195 } 
	t_’codšg_æyweight_v0
;

199 
št32_t
 
	mcook›
;

200 
št32_t
 
	m·ylßd_Ën
;

201 
št32_t
 
	mnÜm®izšg_šdex_off£t
;

202 
št32_t
 
	msignifiÿÁ_figu»s
;

203 
št64_t
 
	mlowe¡_ŒackabË_v®ue
;

204 
št64_t
 
	mhighe¡_ŒackabË_v®ue
;

205 
ušt64_t
 
	mcÚv”siÚ_¿tio_b™s
;

206 
ušt8_t
 
	mcouÁs
[0];

207 } 
	t_’codšg_æyweight_v1
;

211 
št32_t
 
	mcook›
;

212 
št32_t
 
	mËngth
;

213 
ušt8_t
 
	md©a
[0];

214 } 
	t_com´essiÚ_æyweight
;

215 #´agm¨
·ck
(
pİ
)

217 
	$hdr_’code_com´es£d
(

218 
hdr_hi¡og¿m
* 
h
,

219 
ušt8_t
** 
com´es£d_hi¡og¿m
,

220 
size_t
* 
com´es£d_Ën
)

222 
_’codšg_æyweight_v1
* 
’coded
 = 
NULL
;

223 
_com´essiÚ_æyweight
* 
com´es£d
 = 
NULL
;

224 
»suÉ
 = 0;

226 
št32_t
 
Ën_to_max
 = 
	`couÁs_šdex_fÜ
(
h
, h->
max_v®ue
) + 1;

227 
št32_t
 
couÁs_lim™
 = 
Ën_to_max
 < 
h
->
couÁs_Ën
 ?†en_to_max : h->counts_len;

229 cÚ¡ 
size_t
 
’coded_Ën
 = (
_’codšg_æyweight_v1
è+ 
MAX_BYTES_LEB128
 * (size_tè
couÁs_lim™
;

230 ià((
’coded
 = (
_’codšg_æyweight_v1
*è
	`ÿÎoc
(
’coded_Ën
, (
ušt8_t
))è=ğ
NULL
)

232 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
ENOMEM
);

235 
d©a_šdex
 = 0;

236 
i
;

237 
i
 = 0; i < 
couÁs_lim™
;)

239 
št64_t
 
v®ue
 = 
h
->
couÁs
[
i
];

240 
i
++;

242 ià(
v®ue
 == 0)

244 
št32_t
 
z”os
 = 1;

246 
i
 < 
couÁs_lim™
 && 0 =ğ
h
->
couÁs
[i])

248 
z”os
++;

249 
i
++;

252 
d©a_šdex
 +ğ
	`zig_zag_’code_i64
(&
’coded
->
couÁs
[d©a_šdex], -
z”os
);

256 
d©a_šdex
 +ğ
	`zig_zag_’code_i64
(&
’coded
->
couÁs
[d©a_šdex], 
v®ue
);

260 
št32_t
 
·ylßd_Ën
 = 
d©a_šdex
;

261 
uLÚg
 
’coded_size
 = (
_’codšg_æyweight_v1
è+ 
d©a_šdex
;

263 
’coded
->
cook›
 = 
	`htobe32
(
V2_ENCODING_COOKIE
 | 0x10);

264 
’coded
->
·ylßd_Ën
 = 
	`htobe32
(payload_len);

265 
’coded
->
nÜm®izšg_šdex_off£t
 = 
	`htobe32
(
h
->normalizing_index_offset);

266 
’coded
->
signifiÿÁ_figu»s
 = 
	`htobe32
(
h
->significant_figures);

267 
’coded
->
lowe¡_ŒackabË_v®ue
 = 
	`htobe64
(
h
->lowest_trackable_value);

268 
’coded
->
highe¡_ŒackabË_v®ue
 = 
	`htobe64
(
h
->highest_trackable_value);

269 
’coded
->
cÚv”siÚ_¿tio_b™s
 = 
	`htobe64
(
	`doubË_to_št64_b™s
(
h
->
cÚv”siÚ_¿tio
));

273 
uLÚgf
 
de¡L’
 = 
	`com´essBound
(
’coded_size
);

274 
size_t
 
com´es£d_size
 = (
_com´essiÚ_æyweight
è+ 
de¡L’
;

276 ià((
com´es£d
 = (
_com´essiÚ_æyweight
*è
	`m®loc
(
com´es£d_size
)è=ğ
NULL
)

278 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
ENOMEM
);

281 ià(
Z_OK
 !ğ
	`com´ess
(
com´es£d
->
d©a
, &
de¡L’
, (
By‹f
*è
’coded
, 
’coded_size
))

283 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_DEFLATE_FAIL
);

286 
com´es£d
->
cook›
 = 
	`htobe32
(
V2_COMPRESSION_COOKIE
 | 0x10);

287 
com´es£d
->
Ëngth
 = 
	`htobe32
((
št32_t
)
de¡L’
);

289 *
com´es£d_hi¡og¿m
 = (
ušt8_t
*è
com´es£d
;

290 *
com´es£d_Ën
 = (
_com´essiÚ_æyweight
è+ 
de¡L’
;

292 
ş—nup
:

293 
	`ä“
(
’coded
);

294 ià(
»suÉ
 =ğ
HDR_DEFLATE_FAIL
)

296 
	`ä“
(
com´es£d
);

299  
»suÉ
;

300 
	}
}

311 
hdr_»£t_š‹º®_couÁ”s
(
hdr_hi¡og¿m
* 
h
);

313 
	$_­¶y_to_couÁs_16
(
hdr_hi¡og¿m
* 
h
, cÚ¡ 
št16_t
* 
couÁs_d©a
, cÚ¡ 
št32_t
 
couÁs_lim™
)

315 
i
;

316 
i
 = 0; i < 
couÁs_lim™
; i++)

318 
h
->
couÁs
[
i
] = 
	`be16toh
(
couÁs_d©a
[i]);

320 
	}
}

322 
	$_­¶y_to_couÁs_32
(
hdr_hi¡og¿m
* 
h
, cÚ¡ 
št32_t
* 
couÁs_d©a
, cÚ¡ iÁ32_ˆ
couÁs_lim™
)

324 
i
;

325 
i
 = 0; i < 
couÁs_lim™
; i++)

327 
h
->
couÁs
[
i
] = 
	`be32toh
(
couÁs_d©a
[i]);

329 
	}
}

331 
	$_­¶y_to_couÁs_64
(
hdr_hi¡og¿m
* 
h
, cÚ¡ 
št64_t
* 
couÁs_d©a
, cÚ¡ 
št32_t
 
couÁs_lim™
)

333 
i
;

334 
i
 = 0; i < 
couÁs_lim™
; i++)

336 
h
->
couÁs
[
i
] = 
	`be64toh
(
couÁs_d©a
[i]);

338 
	}
}

340 
	$_­¶y_to_couÁs_zz
(
hdr_hi¡og¿m
* 
h
, cÚ¡ 
ušt8_t
* 
couÁs_d©a
, cÚ¡ 
št32_t
 
d©a_lim™
)

342 
št64_t
 
d©a_šdex
 = 0;

343 
št32_t
 
couÁs_šdex
 = 0;

344 
št64_t
 
v®ue
;

346 
d©a_šdex
 < 
d©a_lim™
 && 
couÁs_šdex
 < 
h
->
couÁs_Ën
)

348 
d©a_šdex
 +ğ
	`zig_zag_decode_i64
(&
couÁs_d©a
[d©a_šdex], &
v®ue
);

350 ià(
v®ue
 < 0)

352 
št64_t
 
z”os
 = -
v®ue
;

354 ià(
v®ue
 <ğ
INT32_MIN
 || 
couÁs_šdex
 + 
z”os
 > 
h
->
couÁs_Ën
)

356  
HDR_TRAILING_ZEROS_INVALID
;

359 
couÁs_šdex
 +ğ(
št32_t
è
z”os
;

363 
h
->
couÁs
[
couÁs_šdex
] = 
v®ue
;

364 
couÁs_šdex
++;

368 ià(
d©a_šdex
 > 
d©a_lim™
)

370  
HDR_VALUE_TRUNCATED
;

372 ià(
d©a_šdex
 < 
d©a_lim™
)

374  
HDR_ENCODED_INPUT_TOO_LONG
;

378 
	}
}

380 
	$_­¶y_to_couÁs
(

381 
hdr_hi¡og¿m
* 
h
, cÚ¡ 
št32_t
 
wÜd_size
, cÚ¡ 
ušt8_t
* 
couÁs_d©a
, cÚ¡ iÁ32_ˆ
couÁs_lim™
)

383 
wÜd_size
)

386 
	`_­¶y_to_couÁs_16
(
h
, (
št16_t
*è
couÁs_d©a
, 
couÁs_lim™
);

390 
	`_­¶y_to_couÁs_32
(
h
, (
št32_t
*è
couÁs_d©a
, 
couÁs_lim™
);

394 
	`_­¶y_to_couÁs_64
(
h
, (
št64_t
*è
couÁs_d©a
, 
couÁs_lim™
);

398  
	`_­¶y_to_couÁs_zz
(
h
, 
couÁs_d©a
, 
couÁs_lim™
);

403 
	}
}

405 
	$hdr_decode_com´es£d_v0
(

406 
_com´essiÚ_æyweight
* 
com´essiÚ_æyweight
,

407 
size_t
 
Ëngth
,

408 
hdr_hi¡og¿m
** 
hi¡og¿m
)

410 
hdr_hi¡og¿m
* 
h
 = 
NULL
;

411 
»suÉ
 = 0;

412 
ušt8_t
* 
couÁs_¬¿y
 = 
NULL
;

413 
_’codšg_æyweight_v0
 
’codšg_æyweight
;

414 
z_¡»am
 
¡rm
;

416 
	`¡rm_š™
(&
¡rm
);

417 ià(
	`šæ©eIn™
(&
¡rm
è!ğ
Z_OK
)

419 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_INFLATE_FAIL
);

422 
št32_t
 
com´es£d_Ëngth
 = 
	`be32toh
(
com´essiÚ_æyweight
->
Ëngth
);

424 ià(
com´es£d_Ëngth
 < 0 || 
Ëngth
 - (
_com´essiÚ_æyweight
è< (
size_t
)compressed_length)

426 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
EINVAL
);

429 
¡rm
.
Ãxt_š
 = 
com´essiÚ_æyweight
->
d©a
;

430 
¡rm
.
ava_š
 = (
uIÁ
è
com´es£d_Ëngth
;

431 
¡rm
.
Ãxt_out
 = (
ušt8_t
 *è&
’codšg_æyweight
;

432 
¡rm
.
ava_out
 = (
_’codšg_æyweight_v0
);

434 ià(
	`šæ©e
(&
¡rm
, 
Z_SYNC_FLUSH
è!ğ
Z_OK
)

436 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_INFLATE_FAIL
);

439 
št32_t
 
’codšg_cook›
 = 
	`g‘_cook›_ba£
(
	`be32toh
(
’codšg_æyweight
.
cook›
));

440 ià(
V0_ENCODING_COOKIE
 !ğ
’codšg_cook›
)

442 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_ENCODING_COOKIE_MISMATCH
);

445 
št32_t
 
wÜd_size
 = 
	`wÜd_size_äom_cook›
(
	`be32toh
(
’codšg_æyweight
.
cook›
));

446 
št64_t
 
lowe¡_ŒackabË_v®ue
 = 
	`be64toh
(
’codšg_æyweight
.lowest_trackable_value);

447 
št64_t
 
highe¡_ŒackabË_v®ue
 = 
	`be64toh
(
’codšg_æyweight
.highest_trackable_value);

448 
št32_t
 
signifiÿÁ_figu»s
 = 
	`be32toh
(
’codšg_æyweight
.significant_figures);

450 ià(
	`hdr_š™
(

451 
lowe¡_ŒackabË_v®ue
,

452 
highe¡_ŒackabË_v®ue
,

453 
signifiÿÁ_figu»s
,

454 &
h
) != 0)

456 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
ENOMEM
);

459 
št32_t
 
couÁs_¬¿y_Ën
 = 
h
->
couÁs_Ën
 * 
wÜd_size
;

460 ià((
couÁs_¬¿y
 = 
	`ÿÎoc
(1, (
size_t
è
couÁs_¬¿y_Ën
)è=ğ
NULL
)

462 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
ENOMEM
);

465 
¡rm
.
Ãxt_out
 = 
couÁs_¬¿y
;

466 
¡rm
.
ava_out
 = (
uIÁ
è
couÁs_¬¿y_Ën
;

468 ià(
	`šæ©e
(&
¡rm
, 
Z_FINISH
è!ğ
Z_STREAM_END
)

470 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_INFLATE_FAIL
);

473 
	`_­¶y_to_couÁs
(
h
, 
wÜd_size
, 
couÁs_¬¿y
, h->
couÁs_Ën
);

475 
	`hdr_»£t_š‹º®_couÁ”s
(
h
);

476 
h
->
nÜm®izšg_šdex_off£t
 = 0;

477 
h
->
cÚv”siÚ_¿tio
 = 1.0;

479 
ş—nup
:

480 ()
	`šæ©eEnd
(&
¡rm
);

481 
	`ä“
(
couÁs_¬¿y
);

483 ià(
»suÉ
 != 0)

485 
	`ä“
(
h
);

487 ià(
NULL
 =ğ*
hi¡og¿m
)

489 *
hi¡og¿m
 = 
h
;

493 
	`hdr_add
(*
hi¡og¿m
, 
h
);

494 
	`ä“
(
h
);

497  
»suÉ
;

498 
	}
}

500 
	$hdr_decode_com´es£d_v1
(

501 
_com´essiÚ_æyweight
* 
com´essiÚ_æyweight
,

502 
size_t
 
Ëngth
,

503 
hdr_hi¡og¿m
** 
hi¡og¿m
)

505 
hdr_hi¡og¿m
* 
h
 = 
NULL
;

506 
»suÉ
 = 0;

507 
ušt8_t
* 
couÁs_¬¿y
 = 
NULL
;

508 
_’codšg_æyweight_v1
 
’codšg_æyweight
;

509 
z_¡»am
 
¡rm
;

511 
	`¡rm_š™
(&
¡rm
);

512 ià(
	`šæ©eIn™
(&
¡rm
è!ğ
Z_OK
)

514 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_INFLATE_FAIL
);

517 
št32_t
 
com´es£d_Ëngth
 = 
	`be32toh
(
com´essiÚ_æyweight
->
Ëngth
);

519 ià(
com´es£d_Ëngth
 < 0 || 
Ëngth
 - (
_com´essiÚ_æyweight
è< (
size_t
)compressed_length)

521 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
EINVAL
);

524 
¡rm
.
Ãxt_š
 = 
com´essiÚ_æyweight
->
d©a
;

525 
¡rm
.
ava_š
 = (
uIÁ
è
com´es£d_Ëngth
;

526 
¡rm
.
Ãxt_out
 = (
ušt8_t
 *è&
’codšg_æyweight
;

527 
¡rm
.
ava_out
 = (
_’codšg_æyweight_v1
);

529 ià(
	`šæ©e
(&
¡rm
, 
Z_SYNC_FLUSH
è!ğ
Z_OK
)

531 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_INFLATE_FAIL
);

534 
št32_t
 
’codšg_cook›
 = 
	`g‘_cook›_ba£
(
	`be32toh
(
’codšg_æyweight
.
cook›
));

535 ià(
V1_ENCODING_COOKIE
 !ğ
’codšg_cook›
)

537 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_ENCODING_COOKIE_MISMATCH
);

540 
št32_t
 
wÜd_size
 = 
	`wÜd_size_äom_cook›
(
	`be32toh
(
’codšg_æyweight
.
cook›
));

541 
št32_t
 
couÁs_lim™
 = 
	`be32toh
(
’codšg_æyweight
.
·ylßd_Ën
è/ 
wÜd_size
;

542 
št64_t
 
lowe¡_ŒackabË_v®ue
 = 
	`be64toh
(
’codšg_æyweight
.lowest_trackable_value);

543 
št64_t
 
highe¡_ŒackabË_v®ue
 = 
	`be64toh
(
’codšg_æyweight
.highest_trackable_value);

544 
št32_t
 
signifiÿÁ_figu»s
 = 
	`be32toh
(
’codšg_æyweight
.significant_figures);

546 ià(
	`hdr_š™
(

547 
lowe¡_ŒackabË_v®ue
,

548 
highe¡_ŒackabË_v®ue
,

549 
signifiÿÁ_figu»s
,

550 &
h
) != 0)

552 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
ENOMEM
);

556 
št32_t
 
couÁs_¬¿y_Ën
 = 
couÁs_lim™
 * 
wÜd_size
;

558 ià((
couÁs_¬¿y
 = 
	`ÿÎoc
(1, (
size_t
è
couÁs_¬¿y_Ën
)è=ğ
NULL
)

560 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
ENOMEM
);

563 
¡rm
.
Ãxt_out
 = 
couÁs_¬¿y
;

564 
¡rm
.
ava_out
 = (
uIÁ
è
couÁs_¬¿y_Ën
;

566 ià(
	`šæ©e
(&
¡rm
, 
Z_FINISH
è!ğ
Z_STREAM_END
)

568 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_INFLATE_FAIL
);

571 
	`_­¶y_to_couÁs
(
h
, 
wÜd_size
, 
couÁs_¬¿y
, 
couÁs_lim™
);

573 
h
->
nÜm®izšg_šdex_off£t
 = 
	`be32toh
(
’codšg_æyweight
.normalizing_index_offset);

574 
h
->
cÚv”siÚ_¿tio
 = 
	`št64_b™s_to_doubË
(
	`be64toh
(
’codšg_æyweight
.
cÚv”siÚ_¿tio_b™s
));

575 
	`hdr_»£t_š‹º®_couÁ”s
(
h
);

577 
ş—nup
:

578 ()
	`šæ©eEnd
(&
¡rm
);

579 
	`ä“
(
couÁs_¬¿y
);

581 ià(
»suÉ
 != 0)

583 
	`ä“
(
h
);

585 ià(
NULL
 =ğ*
hi¡og¿m
)

587 *
hi¡og¿m
 = 
h
;

591 
	`hdr_add
(*
hi¡og¿m
, 
h
);

592 
	`ä“
(
h
);

595  
»suÉ
;

596 
	}
}

598 
	$hdr_decode_com´es£d_v2
(

599 
_com´essiÚ_æyweight
* 
com´essiÚ_æyweight
,

600 
size_t
 
Ëngth
,

601 
hdr_hi¡og¿m
** 
hi¡og¿m
)

603 
hdr_hi¡og¿m
* 
h
 = 
NULL
;

604 
»suÉ
 = 0;

605 
ušt8_t
* 
couÁs_¬¿y
 = 
NULL
;

606 
_’codšg_æyweight_v1
 
’codšg_æyweight
;

607 
z_¡»am
 
¡rm
;

609 
	`¡rm_š™
(&
¡rm
);

610 ià(
	`šæ©eIn™
(&
¡rm
è!ğ
Z_OK
)

612 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_INFLATE_FAIL
);

615 
št32_t
 
com´es£d_Ëngth
 = 
	`be32toh
(
com´essiÚ_æyweight
->
Ëngth
);

617 ià(
com´es£d_Ëngth
 < 0 || 
Ëngth
 - (
_com´essiÚ_æyweight
è< (
size_t
)compressed_length)

619 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
EINVAL
);

622 
¡rm
.
Ãxt_š
 = 
com´essiÚ_æyweight
->
d©a
;

623 
¡rm
.
ava_š
 = (
uIÁ
è
com´es£d_Ëngth
;

624 
¡rm
.
Ãxt_out
 = (
ušt8_t
 *è&
’codšg_æyweight
;

625 
¡rm
.
ava_out
 = (
_’codšg_æyweight_v1
);

627 ià(
	`šæ©e
(&
¡rm
, 
Z_SYNC_FLUSH
è!ğ
Z_OK
)

629 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_INFLATE_FAIL
);

632 
št32_t
 
’codšg_cook›
 = 
	`g‘_cook›_ba£
(
	`be32toh
(
’codšg_æyweight
.
cook›
));

633 ià(
V2_ENCODING_COOKIE
 !ğ
’codšg_cook›
)

635 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_ENCODING_COOKIE_MISMATCH
);

638 
št32_t
 
couÁs_lim™
 = 
	`be32toh
(
’codšg_æyweight
.
·ylßd_Ën
);

639 
št64_t
 
lowe¡_ŒackabË_v®ue
 = 
	`be64toh
(
’codšg_æyweight
.lowest_trackable_value);

640 
št64_t
 
highe¡_ŒackabË_v®ue
 = 
	`be64toh
(
’codšg_æyweight
.highest_trackable_value);

641 
št32_t
 
signifiÿÁ_figu»s
 = 
	`be32toh
(
’codšg_æyweight
.significant_figures);

643 ià(
	`hdr_š™
(

644 
lowe¡_ŒackabË_v®ue
,

645 
highe¡_ŒackabË_v®ue
,

646 
signifiÿÁ_figu»s
,

647 &
h
) != 0)

649 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
ENOMEM
);

655 ià((
couÁs_¬¿y
 = 
	`ÿÎoc
(1, (
size_t
è
couÁs_lim™
 + 9)è=ğ
NULL
)

657 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
ENOMEM
);

660 
¡rm
.
Ãxt_out
 = 
couÁs_¬¿y
;

661 
¡rm
.
ava_out
 = (
uIÁ
è
couÁs_lim™
;

663 ià(
	`šæ©e
(&
¡rm
, 
Z_FINISH
è!ğ
Z_STREAM_END
)

665 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
HDR_INFLATE_FAIL
);

668 
r
 = 
	`_­¶y_to_couÁs_zz
(
h
, 
couÁs_¬¿y
, 
couÁs_lim™
);

669 ià(0 !ğ
r
)

671 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
r
);

674 
h
->
nÜm®izšg_šdex_off£t
 = 
	`be32toh
(
’codšg_æyweight
.normalizing_index_offset);

675 
h
->
cÚv”siÚ_¿tio
 = 
	`št64_b™s_to_doubË
(
	`be64toh
(
’codšg_æyweight
.
cÚv”siÚ_¿tio_b™s
));

676 
	`hdr_»£t_š‹º®_couÁ”s
(
h
);

678 
ş—nup
:

679 ()
	`šæ©eEnd
(&
¡rm
);

680 
	`ä“
(
couÁs_¬¿y
);

682 ià(
»suÉ
 != 0)

684 
	`ä“
(
h
);

686 ià(
NULL
 =ğ*
hi¡og¿m
)

688 *
hi¡og¿m
 = 
h
;

692 
	`hdr_add
(*
hi¡og¿m
, 
h
);

693 
	`ä“
(
h
);

696  
»suÉ
;

697 
	}
}

699 
	$hdr_decode_com´es£d
(

700 
ušt8_t
* 
bufãr
, 
size_t
 
Ëngth
, 
hdr_hi¡og¿m
** 
hi¡og¿m
)

702 ià(
Ëngth
 < (
_com´essiÚ_æyweight
))

704  
EINVAL
;

707 
_com´essiÚ_æyweight
* 
com´essiÚ_æyweight
 = (_com´essiÚ_æyweight*è
bufãr
;

709 
št32_t
 
com´essiÚ_cook›
 = 
	`g‘_cook›_ba£
(
	`be32toh
(
com´essiÚ_æyweight
->
cook›
));

710 ià(
V0_COMPRESSION_COOKIE
 =ğ
com´essiÚ_cook›
)

712  
	`hdr_decode_com´es£d_v0
(
com´essiÚ_æyweight
, 
Ëngth
, 
hi¡og¿m
);

714 ià(
V1_COMPRESSION_COOKIE
 =ğ
com´essiÚ_cook›
)

716  
	`hdr_decode_com´es£d_v1
(
com´essiÚ_æyweight
, 
Ëngth
, 
hi¡og¿m
);

718 ià(
V2_COMPRESSION_COOKIE
 =ğ
com´essiÚ_cook›
)

720  
	`hdr_decode_com´es£d_v2
(
com´essiÚ_æyweight
, 
Ëngth
, 
hi¡og¿m
);

723  
HDR_COMPRESSION_COOKIE_MISMATCH
;

724 
	}
}

734 
	$hdr_log_wr™”_š™
(
hdr_log_wr™”
* 
wr™”
)

736 ()
wr™”
;

738 
	}
}

740 
	#LOG_VERSION
 "1.2"

	)

741 
	#LOG_MAJOR_VERSION
 1

	)

743 
	$´št_u£r_´efix
(
FILE
* 
f
, cÚ¡ * 
´efix
)

745 ià(!
´efix
)

750  
	`årštf
(
f
, "#[%s]\n", 
´efix
);

751 
	}
}

753 
	$´št_v”siÚ
(
FILE
* 
f
, cÚ¡ * 
v”siÚ
)

755  
	`årštf
(
f
, "#[Hi¡og¿m†og fÜm© v”siÚ %s]\n", 
v”siÚ
);

756 
	}
}

758 
	$´št_time
(
FILE
* 
f
, 
hdr_time¥ec
* 
time¡amp
)

760 
time_¡r
[128];

761 
tm
 
d©e_time
;

763 ià(!
time¡amp
)

768 #ià
	`defšed
(
__WINDOWS__
)

769 
	`_gmtime32_s
(&
d©e_time
, &
time¡amp
->
tv_£c
);

771 
	`gmtime_r
(&
time¡amp
->
tv_£c
, &
d©e_time
);

773 
ms
 = 
time¡amp
->
tv_n£c
 / 1000000;

774 
	`¡ráime
(
time_¡r
, 128, "%¨%b %X %Z %Y", &
d©e_time
);

776  
	`årštf
(

777 
f
, "#[StartTime: %d.%ld (seconds sinceƒpoch), %s]\n",

778 (è
time¡amp
->
tv_£c
, 
ms
, 
time_¡r
);

779 
	}
}

781 
	$´št_h—d”
(
FILE
* 
f
)

783  
	`årštf
(
f
, "\"StartTimestamp\",\"EndTimestamp\",\"Interval_Max\",\"Interval_Compressed_Histogram\"\n");

784 
	}
}

791 
	$hdr_log_wr™e_h—d”
(

792 
hdr_log_wr™”
* 
wr™”
, 
FILE
* 
fe
,

793 cÚ¡ * 
u£r_´efix
, 
hdr_time¥ec
* 
time¡amp
)

795 ()
wr™”
;

797 ià(
	`´št_u£r_´efix
(
fe
, 
u£r_´efix
) < 0)

799  
EIO
;

801 ià(
	`´št_v”siÚ
(
fe
, 
LOG_VERSION
) < 0)

803  
EIO
;

805 ià(
	`´št_time
(
fe
, 
time¡amp
) < 0)

807  
EIO
;

809 ià(
	`´št_h—d”
(
fe
) < 0)

811  
EIO
;

815 
	}
}

817 
	$hdr_log_wr™e
(

818 
hdr_log_wr™”
* 
wr™”
,

819 
FILE
* 
fe
,

820 cÚ¡ 
hdr_time¥ec
* 
¡¬t_time¡amp
,

821 cÚ¡ 
hdr_time¥ec
* 
’d_time¡amp
,

822 
hdr_hi¡og¿m
* 
hi¡og¿m
)

824 
ušt8_t
* 
com´es£d_hi¡og¿m
 = 
NULL
;

825 
size_t
 
com´es£d_Ën
 = 0;

826 * 
’coded_hi¡og¿m
 = 
NULL
;

827 
rc
 = 0;

828 
»suÉ
 = 0;

829 
size_t
 
’coded_Ën
;

831 ()
wr™”
;

833 
rc
 = 
	`hdr_’code_com´es£d
(
hi¡og¿m
, &
com´es£d_hi¡og¿m
, &
com´es£d_Ën
);

834 ià(
rc
 != 0)

836 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
rc
);

839 
’coded_Ën
 = 
	`hdr_ba£64_’coded_Ën
(
com´es£d_Ën
);

840 
’coded_hi¡og¿m
 = 
	`ÿÎoc
(
’coded_Ën
 + 1, ());

842 
rc
 = 
	`hdr_ba£64_’code
(

843 
com´es£d_hi¡og¿m
, 
com´es£d_Ën
, 
’coded_hi¡og¿m
, 
’coded_Ën
);

844 ià(
rc
 != 0)

846 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
rc
);

849 ià(
	`årštf
(

850 
fe
, "%d.%d,%d.%d,%"
PRIu64
".0,%s\n",

851 (è
¡¬t_time¡amp
->
tv_£c
, (è(¡¬t_time¡amp->
tv_n£c
 / 1000000),

852 (è
’d_time¡amp
->
tv_£c
, (èÓnd_time¡amp->
tv_n£c
 / 1000000),

853 
	`hdr_max
(
hi¡og¿m
),

854 
’coded_hi¡og¿m
) < 0)

856 
»suÉ
 = 
EIO
;

859 
ş—nup
:

860 
	`ä“
(
com´es£d_hi¡og¿m
);

861 
	`ä“
(
’coded_hi¡og¿m
);

863  
»suÉ
;

864 
	}
}

874 
	$hdr_log_»ad”_š™
(
hdr_log_»ad”
* 
»ad”
)

876 
»ad”
->
majÜ_v”siÚ
 = 0;

877 
»ad”
->
mšÜ_v”siÚ
 = 0;

878 
»ad”
->
¡¬t_time¡amp
.
tv_£c
 = 0;

879 
»ad”
->
¡¬t_time¡amp
.
tv_n£c
 = 0;

882 
	}
}

884 
	$sÿn_log_fÜm©
(
hdr_log_»ad”
* 
»ad”
, cÚ¡ * 
lše
)

886 cÚ¡ * 
fÜm©
 = "#[Histogram†og format version %d.%d]";

887 
	`ssÿnf
(
lše
, 
fÜm©
, &
»ad”
->
majÜ_v”siÚ
, &»ad”->
mšÜ_v”siÚ
);

888 
	}
}

890 
	$sÿn_¡¬t_time
(
hdr_log_»ad”
* 
»ad”
, cÚ¡ * 
lše
)

892 cÚ¡ * 
fÜm©
 = "#[StartTime: %d.%d [^\n]";

893 
time¡amp_s
 = 0;

894 
Œašg_ms
 = 0;

896 ià(
	`ssÿnf
(
lše
, 
fÜm©
, &
time¡amp_s
, &
Œašg_ms
) == 2)

898 
»ad”
->
¡¬t_time¡amp
.
tv_£c
 = 
time¡amp_s
;

899 
»ad”
->
¡¬t_time¡amp
.
tv_n£c
 = 
Œašg_ms
 * 1000000;

901 
	}
}

903 
	$sÿn_h—d”_lše
(
hdr_log_»ad”
* 
»ad”
, cÚ¡ * 
lše
)

905 
	`sÿn_log_fÜm©
(
»ad”
, 
lše
);

906 
	`sÿn_¡¬t_time
(
»ad”
, 
lše
);

907 
	}
}

909 
boŞ
 
	$v®id©e_log_v”siÚ
(
hdr_log_»ad”
* 
»ad”
)

911  
»ad”
->
majÜ_v”siÚ
 =ğ
LOG_MAJOR_VERSION
 &&

912 (
»ad”
->
mšÜ_v”siÚ
 == 0 ||„eader->minor_version == 1 ||„eader->minor_version == 2);

913 
	}
}

915 
	#HEADER_LINE_LENGTH
 128

	)

917 
	$hdr_log_»ad_h—d”
(
hdr_log_»ad”
* 
»ad”
, 
FILE
* 
fe
)

919 
lše
[
HEADER_LINE_LENGTH
];

921 
boŞ
 
·rsšg_h—d”
 = 
Œue
;

925 
c
 = 
	`fg‘c
(
fe
);

926 
	`ung‘c
(
c
, 
fe
);

928 
c
)

932 ià(
	`fg‘s
(
lše
, 
HEADER_LINE_LENGTH
, 
fe
è=ğ
NULL
)

934  
EIO
;

937 
	`sÿn_h—d”_lše
(
»ad”
, 
lše
);

941 ià(
	`fg‘s
(
lše
, 
HEADER_LINE_LENGTH
, 
fe
è=ğ
NULL
)

943  
EIO
;

946 
·rsšg_h—d”
 = 
çl£
;

950 
·rsšg_h—d”
 = 
çl£
;

953 
·rsšg_h—d”
);

955 ià(!
	`v®id©e_log_v”siÚ
(
»ad”
))

957  
HDR_LOG_INVALID_VERSION
;

961 
	}
}

963 
	$upd©e_time¥ec
(
hdr_time¥ec
* 
ts
, 
time_s
, 
time_ms
)

965 ià(
NULL
 =ğ
ts
)

970 
ts
->
tv_£c
 = 
time_s
;

971 
ts
->
tv_n£c
 = 
time_ms
 * 1000000;

972 
	}
}

974 #ià
defšed
(
_MSC_VER
)

976 
ssize_t
 
	$hdr_»ad_chunk
(* 
bufãr
, 
size_t
 
Ëngth
, 
‹rmš©Ü
, 
FILE
* 
¡»am
)

978 ià(
bufãr
 =ğ
NULL
 || 
Ëngth
 == 0)

983 
size_t
 
i
 = 0; i < 
Ëngth
; ++i)

985 
c
 = 
	`fg‘c
(
¡»am
);

986 
bufãr
[
i
] = ()
c
;

987 ià(
c
 =ğ(è'\0' || c =ğ(è
‹rmš©Ü
 || c =ğ
EOF
)

989 
bufãr
[
i
] = '\0';

990  
i
;

994  
Ëngth
;

995 
	}
}

998 
ssize_t
 
	$hdr_g‘lše
(** 
lš•Œ
, 
FILE
* 
¡»am
)

1000 ià(
¡»am
 =ğ
NULL
)

1005 
size_t
 
®loÿtiÚ
 = 128;

1006 
size_t
 
u£d
 = 0;

1008 * 
sü©ch
 = 
NULL
;

1011 
®loÿtiÚ
 +=‡llocation;

1013 * 
befÜe
 = 
sü©ch
;

1014 
sü©ch
 = 
	`»®loc
(sü©ch, 
®loÿtiÚ
);

1015 ià(
sü©ch
 =ğ
NULL
)

1017 ià(
befÜe
)

1019 
	`ä“
(
befÜe
);

1024 
size_t
 
wª‹d
 = 
®loÿtiÚ
 - 
u£d
 - 1;

1025 
size_t
 
»ad_Ëngth
 = 
	`hdr_»ad_chunk
(
sü©ch
 + 
u£d
, 
wª‹d
, '\n', 
¡»am
);

1026 
u£d
 +ğ
»ad_Ëngth
;

1029 ià(
»ad_Ëngth
 < 
wª‹d
 || 
sü©ch
[
u£d
 - 1] == '\n' || scratch[used - 1] == '\0')

1031 
sü©ch
[
u£d
] = '\0';

1032 *
lš•Œ
 = 
sü©ch
;

1033  
u£d
;

1036 
	}
}

1039 
ssize_t
 
	$hdr_g‘lše
(** 
lš•Œ
, 
FILE
* 
¡»am
)

1041 
size_t
 
lše_Ëngth
 = 0;

1042  
	`g‘lše
(
lš•Œ
, &
lše_Ëngth
, 
¡»am
);

1043 
	}
}

1046 
	$hdr_log_»ad
(

1047 
hdr_log_»ad”
* 
»ad”
, 
FILE
* 
fe
, 
hdr_hi¡og¿m
** 
hi¡og¿m
,

1048 
hdr_time¥ec
* 
time¡amp
, hdr_time¥ec* 
š‹rv®
)

1050 cÚ¡ * 
fÜm©
 = "%d.%d,%d.%d,%d.%d,%s";

1051 * 
ba£64_hi¡og¿m
 = 
NULL
;

1052 
ušt8_t
* 
com´es£d_hi¡og¿m
 = 
NULL
;

1053 * 
lše
 = 
NULL
;

1054 
»suÉ
 = 0;

1056 
begš_s
 = 0;

1057 
begš_ms
 = 0;

1058 
’d_s
 = 0;

1059 
’d_ms
 = 0;

1060 
š‹rv®_max_s
 = 0;

1061 
š‹rv®_max_ms
 = 0;

1063 ()
»ad”
;

1065 
ssize_t
 
»ad
 = 
	`hdr_g‘lše
(&
lše
, 
fe
);

1066 ià(-1 =ğ
»ad
)

1068 ià(0 =ğ
”ºo
)

1070 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
EOF
);

1074 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
EIO
);

1078 
	`nuÎ_Œašg_wh™e¥aû
(
lše
, 
»ad
);

1079 ià(
	`¡¾’
(
lše
) == 0)

1081 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
EOF
);

1084 
r
;

1085 
r
 = 
	`»®loc_bufãr
((**)&
ba£64_hi¡og¿m
, (), 
»ad
);

1086 ià(
r
 != 0)

1088 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
ENOMEM
);

1091 
r
 = 
	`»®loc_bufãr
((**)&
com´es£d_hi¡og¿m
, (
ušt8_t
), 
»ad
);

1092 ià(
r
 != 0)

1094 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
ENOMEM
);

1097 
num_tok’s
 = 
	`ssÿnf
(

1098 
lše
, 
fÜm©
, &
begš_s
, &
begš_ms
, &
’d_s
, &
’d_ms
,

1099 &
š‹rv®_max_s
, &
š‹rv®_max_ms
, 
ba£64_hi¡og¿m
);

1101 ià(
num_tok’s
 != 7)

1103 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
EINVAL
);

1106 
size_t
 
ba£64_Ën
 = 
	`¡¾’
(
ba£64_hi¡og¿m
);

1107 
size_t
 
com´es£d_Ën
 = 
	`hdr_ba£64_decoded_Ën
(
ba£64_Ën
);

1109 
r
 = 
	`hdr_ba£64_decode
(

1110 
ba£64_hi¡og¿m
, 
ba£64_Ën
, 
com´es£d_hi¡og¿m
, 
com´es£d_Ën
);

1112 ià(
r
 != 0)

1114 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
r
);

1117 
r
 = 
	`hdr_decode_com´es£d
(
com´es£d_hi¡og¿m
, 
com´es£d_Ën
, 
hi¡og¿m
);

1118 ià(
r
 != 0)

1120 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
r
);

1123 
	`upd©e_time¥ec
(
time¡amp
, 
begš_s
, 
begš_ms
);

1124 
	`upd©e_time¥ec
(
š‹rv®
, 
’d_s
, 
’d_ms
);

1126 
ş—nup
:

1127 
	`ä“
(
lše
);

1128 
	`ä“
(
ba£64_hi¡og¿m
);

1129 
	`ä“
(
com´es£d_hi¡og¿m
);

1131  
»suÉ
;

1132 
	}
}

1134 
	$hdr_log_’code
(
hdr_hi¡og¿m
* 
hi¡og¿m
, ** 
’coded_hi¡og¿m
)

1136 *
’coded_hi¡og¿m_tmp
 = 
NULL
;

1137 
ušt8_t
* 
com´es£d_hi¡og¿m
 = 
NULL
;

1138 
size_t
 
com´es£d_Ën
 = 0;

1139 
rc
 = 0;

1140 
»suÉ
 = 0;

1141 
size_t
 
’coded_Ën
;

1143 
rc
 = 
	`hdr_’code_com´es£d
(
hi¡og¿m
, &
com´es£d_hi¡og¿m
, &
com´es£d_Ën
);

1144 ià(
rc
 != 0)

1146 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
rc
);

1149 
’coded_Ën
 = 
	`hdr_ba£64_’coded_Ën
(
com´es£d_Ën
);

1150 
’coded_hi¡og¿m_tmp
 = 
	`ÿÎoc
(
’coded_Ën
 + 1, ());

1152 
rc
 = 
	`hdr_ba£64_’code
(

1153 
com´es£d_hi¡og¿m
, 
com´es£d_Ën
, 
’coded_hi¡og¿m_tmp
, 
’coded_Ën
);

1154 ià(
rc
 != 0)

1156 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
rc
);

1159 *
’coded_hi¡og¿m
 = 
’coded_hi¡og¿m_tmp
;

1161 
ş—nup
:

1162 
	`ä“
(
com´es£d_hi¡og¿m
);

1164  
»suÉ
;

1165 
	}
}

1167 
	$hdr_log_decode
(
hdr_hi¡og¿m
** 
hi¡og¿m
, * 
ba£64_hi¡og¿m
, 
size_t
 
ba£64_Ën
)

1169 
r
;

1170 
ušt8_t
* 
com´es£d_hi¡og¿m
 = 
NULL
;

1171 
»suÉ
 = 0;

1173 
size_t
 
com´es£d_Ën
 = 
	`hdr_ba£64_decoded_Ën
(
ba£64_Ën
);

1174 
com´es£d_hi¡og¿m
 = 
	`m®loc
((
ušt8_t
)*
com´es£d_Ën
);

1175 
	`mem£t
(
com´es£d_hi¡og¿m
, 0, 
com´es£d_Ën
);

1177 
r
 = 
	`hdr_ba£64_decode
(

1178 
ba£64_hi¡og¿m
, 
ba£64_Ën
, 
com´es£d_hi¡og¿m
, 
com´es£d_Ën
);

1180 ià(
r
 != 0)

1182 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
r
);

1185 
r
 = 
	`hdr_decode_com´es£d
(
com´es£d_hi¡og¿m
, 
com´es£d_Ën
, 
hi¡og¿m
);

1186 ià(
r
 != 0)

1188 
	`FAIL_AND_CLEANUP
(
ş—nup
, 
»suÉ
, 
r
);

1191 
ş—nup
:

1192 
	`ä“
(
com´es£d_hi¡og¿m
);

1194  
»suÉ
;

1195 
	}
}

1197 #ià
defšed
(
_MSC_VER
)

1198 #´agm¨
w¬nšg
(
pİ
)

	@hdr_histogram/hdr_histogram_log.h

10 #iâdeà
HDR_HISTOGRAM_H_LOG


11 
	#HDR_HISTOGRAM_H_LOG
 1

	)

13 
	#HDR_COMPRESSION_COOKIE_MISMATCH
 -29999

	)

14 
	#HDR_ENCODING_COOKIE_MISMATCH
 -29998

	)

15 
	#HDR_DEFLATE_INIT_FAIL
 -29997

	)

16 
	#HDR_DEFLATE_FAIL
 -29996

	)

17 
	#HDR_INFLATE_INIT_FAIL
 -29995

	)

18 
	#HDR_INFLATE_FAIL
 -29994

	)

19 
	#HDR_LOG_INVALID_VERSION
 -29993

	)

20 
	#HDR_TRAILING_ZEROS_INVALID
 -29992

	)

21 
	#HDR_VALUE_TRUNCATED
 -29991

	)

22 
	#HDR_ENCODED_INPUT_TOO_LONG
 -29990

	)

24 
	~<¡dšt.h
>

25 
	~<¡dboŞ.h
>

26 
	~<¡dio.h
>

28 
	~"hdr_time.h
"

29 
	~"hdr_hi¡og¿m.h
"

31 #ifdeà
__ılu¥lus


38 
hdr_log_’code
(
hdr_hi¡og¿m
* 
hi¡og¿m
, ** 
’coded_hi¡og¿m
);

43 
hdr_log_decode
(
hdr_hi¡og¿m
** 
hi¡og¿m
, * 
ba£64_hi¡og¿m
, 
size_t
 
ba£64_Ën
);

45 
	shdr_log_wr™”


47 
ušt32_t
 
nÚû
;

56 
hdr_log_wr™”_š™
(
hdr_log_wr™”
* 
wr™”
);

69 
hdr_log_wr™e_h—d”
(

70 
hdr_log_wr™”
* 
wr™”
,

71 
FILE
* 
fe
,

72 cÚ¡ * 
u£r_´efix
,

73 
hdr_time¥ec
* 
time¡amp
);

96 
hdr_log_wr™e
(

97 
hdr_log_wr™”
* 
wr™”
,

98 
FILE
* 
fe
,

99 cÚ¡ 
hdr_time¥ec
* 
¡¬t_time¡amp
,

100 cÚ¡ 
hdr_time¥ec
* 
’d_time¡amp
,

101 
hdr_hi¡og¿m
* 
hi¡og¿m
);

103 
	shdr_log_»ad”


105 
majÜ_v”siÚ
;

106 
mšÜ_v”siÚ
;

107 
hdr_time¥ec
 
¡¬t_time¡amp
;

116 
hdr_log_»ad”_š™
(
hdr_log_»ad”
* 
»ad”
);

126 
hdr_log_»ad_h—d”
(
hdr_log_»ad”
* 
»ad”
, 
FILE
* 
fe
);

150 
hdr_log_»ad
(

151 
hdr_log_»ad”
* 
»ad”
, 
FILE
* 
fe
, 
hdr_hi¡og¿m
** 
hi¡og¿m
,

152 
hdr_time¥ec
* 
time¡amp
, hdr_time¥ec* 
š‹rv®
);

160 cÚ¡ * 
hdr_¡»¼Ü
(
”ºum
);

162 #ifdeà
__ılu¥lus


	@hdr_histogram/hdr_interval_recorder.c

7 
	~"hdr_©omic.h
"

8 
	~"hdr_š‹rv®_»cÜd”.h
"

10 
	$hdr_š‹rv®_»cÜd”_š™
(
hdr_š‹rv®_»cÜd”
* 
r
)

12  
	`hdr_wr™”_»ad”_pha£r_š™
(&
r
->
pha£r
);

13 
	}
}

15 
	$hdr_š‹rv®_»cÜd”_de¡roy
(
hdr_š‹rv®_»cÜd”
* 
r
)

17 
	`hdr_wr™”_»ad”_pha£r_de¡Üy
(&
r
->
pha£r
);

18 
	}
}

20 
hdr_š‹rv®_»cÜd”_upd©e
(

21 
hdr_š‹rv®_»cÜd”
* 
r
,

22 (*
upd©e_aùiÚ
)(*, *),

23 * 
¬g
)

25 
št64_t
 
v®
 = 
	`hdr_pha£r_wr™”_’‹r
(&
r
->
pha£r
);

27 * 
aùive
 = 
	`hdr_©omic_lßd_poš‹r
(&
r
->active);

29 
	`upd©e_aùiÚ
(
aùive
, 
¬g
);

31 
	`hdr_pha£r_wr™”_ex™
(&
r
->
pha£r
, 
v®
);

32 
	}
}

34 * 
	$hdr_š‹rv®_»cÜd”_§m¶e
(
hdr_š‹rv®_»cÜd”
* 
r
)

36 * 
‹mp
;

38 
	`hdr_pha£r_»ad”_lock
(&
r
->
pha£r
);

40 
‹mp
 = 
r
->
šaùive
;

43 
r
->
šaùive
 = 
	`hdr_©omic_lßd_poš‹r
(&r->
aùive
);

46 
	`hdr_©omic_¡Üe_poš‹r
(&
r
->
aùive
, 
‹mp
);

48 
	`hdr_pha£r_æ_pha£
(&
r
->
pha£r
, 0);

50 
	`hdr_pha£r_»ad”_uÆock
(&
r
->
pha£r
);

52  
r
->
šaùive
;

53 
	}
}

	@hdr_histogram/hdr_interval_recorder.h

7 #iâdeà
HDR_INTERVAL_RECORDER_H


8 
	#HDR_INTERVAL_RECORDER_H
 1

	)

10 
	~"hdr_wr™”_»ad”_pha£r.h
"

12 
	$HDR_ALIGN_PREFIX
(8)

13 
	shdr_š‹rv®_»cÜd”


15 * 
aùive
;

16 * 
šaùive
;

17 
hdr_wr™”_»ad”_pha£r
 
pha£r
;

19 
	`HDR_ALIGN_SUFFIX
(8);

21 #ifdeà
__ılu¥lus


25 
	`hdr_š‹rv®_»cÜd”_š™
(
hdr_š‹rv®_»cÜd”
* 
r
);

27 
	`hdr_š‹rv®_»cÜd”_de¡roy
(
hdr_š‹rv®_»cÜd”
* 
r
);

29 
	`hdr_š‹rv®_»cÜd”_upd©e
(

30 
hdr_š‹rv®_»cÜd”
* 
r
,

31 (*
upd©e_aùiÚ
)(*, *),

32 * 
¬g
);

34 * 
	`hdr_š‹rv®_»cÜd”_§m¶e
(
hdr_š‹rv®_»cÜd”
* 
r
);

36 #ifdeà
__ılu¥lus


37 
	}
}

	@hdr_histogram/hdr_tests.h

1 #iâdeà
HDR_TESTS_H


2 
	#HDR_TESTS_H


	)

6 
	~"hdr_hi¡og¿m.h
"

8 #ifdeà
__ılu¥lus


12 
hdr_»£t_š‹º®_couÁ”s
(
hdr_hi¡og¿m
* 
h
);

13 
št32_t
 
couÁs_šdex_fÜ
(cÚ¡ 
hdr_hi¡og¿m
* 
h
, 
št64_t
 
v®ue
);

14 
hdr_’code_com´es£d
(
hdr_hi¡og¿m
* 
h
, 
ušt8_t
** 
com´es£d_hi¡og¿m
, 
size_t
* 
com´es£d_Ën
);

15 
hdr_decode_com´es£d
(
ušt8_t
* 
bufãr
, 
size_t
 
Ëngth
, 
hdr_hi¡og¿m
** 
hi¡og¿m
);

16 
hdr_ba£64_decode_block
(cÚ¡ * 
šput
, 
ušt8_t
* 
ouut
);

17 
hdr_ba£64_’code_block
(cÚ¡ 
ušt8_t
* 
šput
, * 
ouut
);

19 #ifdeà
__ılu¥lus


	@hdr_histogram/hdr_thread.c

7 
	~<¡dlib.h
>

8 
	~"hdr_th»ad.h
"

10 
hdr_mu‹x
* 
	$hdr_mu‹x_®loc
()

12  
	`m®loc
((
hdr_mu‹x
));

13 
	}
}

15 
	$hdr_mu‹x_ä“
(
hdr_mu‹x
* 
mu‹x
)

17 
	`ä“
(
mu‹x
);

18 
	}
}

20 #ià
defšed
(
_WIN32
è|| defšed(
_WIN64
è|| defšed(
__CYGWIN__
)

22 #ià!
defšed
(
WIN32_LEAN_AND_MEAN
)

23 
	#WIN32_LEAN_AND_MEAN


	)

26 
	~<wšdows.h
>

28 
	$hdr_mu‹x_š™
(
hdr_mu‹x
* 
mu‹x
)

30 
	`In™ŸlizeCr™iÿlSeùiÚ
((
CRITICAL_SECTION
*)(
mu‹x
->
_ü™iÿl_£ùiÚ
));

32 
	}
}

34 
	$hdr_mu‹x_de¡roy
(
hdr_mu‹x
* 
mu‹x
)

36 
	`D–‘eCr™iÿlSeùiÚ
((
CRITICAL_SECTION
*)(
mu‹x
->
_ü™iÿl_£ùiÚ
));

37 
	}
}

39 
	$hdr_mu‹x_lock
(
hdr_mu‹x
* 
mu‹x
)

41 
	`EÁ”Cr™iÿlSeùiÚ
((
CRITICAL_SECTION
*)(
mu‹x
->
_ü™iÿl_£ùiÚ
));

42 
	}
}

44 
	$hdr_mu‹x_uÆock
(
hdr_mu‹x
* 
mu‹x
)

46 
	`L—veCr™iÿlSeùiÚ
((
CRITICAL_SECTION
*)(
mu‹x
->
_ü™iÿl_£ùiÚ
));

47 
	}
}

50 
	~<±h»ad.h
>

52 
	$hdr_mu‹x_š™
(
hdr_mu‹x
* 
mu‹x
)

54  
	`±h»ad_mu‹x_š™
(&
mu‹x
->
_mu‹x
, 
NULL
);

55 
	}
}

57 
	$hdr_mu‹x_de¡roy
(
hdr_mu‹x
* 
mu‹x
)

59 
	`±h»ad_mu‹x_de¡roy
(&
mu‹x
->
_mu‹x
);

60 
	}
}

62 
	$hdr_mu‹x_lock
(
hdr_mu‹x
* 
mu‹x
)

64 
	`±h»ad_mu‹x_lock
(&
mu‹x
->
_mu‹x
);

65 
	}
}

67 
	$hdr_mu‹x_uÆock
(
hdr_mu‹x
* 
mu‹x
)

69 
	`±h»ad_mu‹x_uÆock
(&
mu‹x
->
_mu‹x
);

70 
	}
}

	@hdr_histogram/hdr_thread.h

7 #iâdeà
HDR_THREAD_H__


8 
	#HDR_THREAD_H__


	)

10 
	~<¡dšt.h
>

12 #ià
defšed
(
_WIN32
è|| defšed(
_WIN64
è|| defšed(
__CYGWIN__
)

15 
	#HDR_ALIGN_PREFIX
(
®ignm’t
è
	`__deş¥ec
Ğ
	`®ign
×lignm’tè)

	)

16 
	#HDR_ALIGN_SUFFIX
(
®ignm’t
)

	)

18 
	shdr_mu‹x


20 
ušt8_t
 
	m_ü™iÿl_£ùiÚ
[40];

21 } 
	thdr_mu‹x
;

25 
	~<±h»ad.h
>

27 
	#HDR_ALIGN_PREFIX
(
®ignm’t
)

	)

28 
	#HDR_ALIGN_SUFFIX
(
®ignm’t
è
	`__©Œibu‹__
((
	`®igÃd
×lignm’t)))

	)

30 
	shdr_mu‹x


32 
±h»ad_mu‹x_t
 
	m_mu‹x
;

33 } 
	thdr_mu‹x
;

36 #ifdeà
__ılu¥lus


40 
hdr_mu‹x
* 
hdr_mu‹x_®loc
();

41 
hdr_mu‹x_ä“
(
hdr_mu‹x
*);

43 
hdr_mu‹x_š™
(
hdr_mu‹x
* 
mu‹x
);

44 
hdr_mu‹x_de¡roy
(
hdr_mu‹x
* 
mu‹x
);

46 
hdr_mu‹x_lock
(
hdr_mu‹x
* 
mu‹x
);

47 
hdr_mu‹x_uÆock
(
hdr_mu‹x
* 
mu‹x
);

49 #ifdeà
__ılu¥lus


	@hdr_histogram/hdr_time.c

7 
	~"hdr_time.h
"

9 #ià
defšed
(
_WIN32
è|| defšed(
_WIN64
)

11 #ià!
defšed
(
WIN32_LEAN_AND_MEAN
)

12 
	#WIN32_LEAN_AND_MEAN


	)

15 
	~<wšdows.h
>

17 
	gs_şockP”iodS‘
 = 0;

18 
	gs_şockP”iod
 = 1.0;

20 
	$hdr_g‘time
(
hdr_time¥ec
* 
t
)

22 
LARGE_INTEGER
 
num
;

24 ià(!
s_şockP”iodS‘
)

26 
	`Qu”yP”fÜmªûF»qu’cy
(&
num
);

27 
s_şockP”iod
 = 1.0 / (è
num
.
QuadP¬t
;

28 
s_şockP”iodS‘
 = 1;

31 
	`Qu”yP”fÜmªûCouÁ”
(&
num
);

32 
£cÚds
 = 
num
.
QuadP¬t
 * 
s_şockP”iod
;

33 
š‹g¿l
;

34 
»mašd”
 = 
	`modf
(
£cÚds
, &
š‹g¿l
);

36 
t
->
tv_£c
 = (è
š‹g¿l
;

37 
t
->
tv_n£c
 = (è(
»mašd”
 * 1000000000);

38 
	}
}

40 #–ià
defšed
(
__APPLE__
)

42 
	~<mach/şock.h
>

43 
	~<mach/mach.h
>

46 
	$hdr_g‘time
(
hdr_time¥ec
* 
ts
)

48 
şock_£rv_t
 
cşock
;

49 
mach_time¥ec_t
 
mts
;

50 
	`ho¡_g‘_şock_£rviû
(
	`mach_ho¡_£lf
(), 
CALENDAR_CLOCK
, &
cşock
);

51 
	`şock_g‘_time
(
cşock
, &
mts
);

52 
	`mach_pÜt_d—Îoÿ‹
(
	`mach_sk_£lf
(), 
cşock
);

53 
ts
->
tv_£c
 = 
mts
.tv_sec;

54 
ts
->
tv_n£c
 = 
mts
.tv_nsec;

55 
	}
}

57 #–ià
defšed
(
__lšux__
è|| defšed(
__CYGWIN__
)

60 
	$hdr_g‘time
(
hdr_time¥ec
* 
t
)

62 
	`şock_g‘time
(
CLOCK_MONOTONIC
, (
time¥ec
*)
t
);

63 
	}
}

	@hdr_histogram/hdr_time.h

7 #iâdeà
HDR_TIME_H__


8 
	#HDR_TIME_H__


	)

10 
	~<m©h.h
>

11 
	~<time.h
>

13 #ià
defšed
(
_WIN32
è|| defšed(
_WIN64
è|| defšed(
__CYGWIN__
)

15 
	shdr_time¥ec


17 
	mtv_£c
;

18 
	mtv_n£c
;

19 } 
	thdr_time¥ec
;

23 
time¥ec
 
	thdr_time¥ec
;

27 #ifdeà
__ılu¥lus


31 #ià
defšed
(
_MSC_VER
)

32 
hdr_g‘time
(
hdr_time¥ec
* 
t
);

34 
hdr_g‘time
(
hdr_time¥ec
* 
t
);

37 #ifdeà
__ılu¥lus


	@hdr_histogram/hdr_writer_reader_phaser.c

7 
	~<¡dšt.h
>

8 
	~<¡dlib.h
>

9 
	~<¡dboŞ.h
>

10 
	~<¡dlib.h
>

11 
	~<”ºo.h
>

13 #ià
defšed
(
_MSC_VER
)

14 
	~<WšSock2.h
>

16 
	~<uni¡d.h
>

17 
	~<sched.h
>

20 
	~"hdr_©omic.h
"

21 
	~"hdr_th»ad.h
"

23 
	~"hdr_wr™”_»ad”_pha£r.h
"

25 
št64_t
 
	$_hdr_pha£r_g‘_•och
(
št64_t
* 
f›ld
)

27  
	`hdr_©omic_lßd_64
(
f›ld
);

28 
	}
}

30 
	$_hdr_pha£r_£t_•och
(
št64_t
* 
f›ld
, iÁ64_ˆ
v®
)

32 
	`hdr_©omic_¡Üe_64
(
f›ld
, 
v®
);

33 
	}
}

35 
št64_t
 
	$_hdr_pha£r_»£t_•och
(
št64_t
* 
f›ld
, iÁ64_ˆ
š™Ÿl_v®ue
)

37  
	`hdr_©omic_exchªge_64
(
f›ld
, 
š™Ÿl_v®ue
);

38 
	}
}

40 
	$hdr_wr™”_»ad”_pha£r_š™
(
hdr_wr™”_»ad”_pha£r
* 
p
)

42 ià(
NULL
 =ğ
p
)

44  
EINVAL
;

47 
p
->
¡¬t_•och
 = 0;

48 
p
->
ev’_’d_•och
 = 0;

49 
p
->
odd_’d_•och
 = 
INT64_MIN
;

50 
p
->
»ad”_mu‹x
 = 
	`hdr_mu‹x_®loc
();

52 ià(!
p
->
»ad”_mu‹x
)

54  
ENOMEM
;

57 
rc
 = 
	`hdr_mu‹x_š™
(
p
->
»ad”_mu‹x
);

58 ià(0 !ğ
rc
)

60  
rc
;

66 
	}
}

68 
	$hdr_wr™”_»ad”_pha£r_de¡Üy
(
hdr_wr™”_»ad”_pha£r
* 
p
)

70 
	`hdr_mu‹x_de¡roy
(
p
->
»ad”_mu‹x
);

71 
	}
}

73 
št64_t
 
	$hdr_pha£r_wr™”_’‹r
(
hdr_wr™”_»ad”_pha£r
* 
p
)

75  
	`hdr_©omic_add_ãtch_64
(&
p
->
¡¬t_•och
, 1);

76 
	}
}

78 
	$hdr_pha£r_wr™”_ex™
(

79 
hdr_wr™”_»ad”_pha£r
* 
p
, 
št64_t
 
ü™iÿl_v®ue_©_’‹r
)

81 
št64_t
* 
’d_•och
 =

82 (
ü™iÿl_v®ue_©_’‹r
 < 0è? &
p
->
odd_’d_•och
 : &p->
ev’_’d_•och
;

83 
	`hdr_©omic_add_ãtch_64
(
’d_•och
, 1);

84 
	}
}

86 
	$hdr_pha£r_»ad”_lock
(
hdr_wr™”_»ad”_pha£r
* 
p
)

88 
	`hdr_mu‹x_lock
(
p
->
»ad”_mu‹x
);

89 
	}
}

91 
	$hdr_pha£r_»ad”_uÆock
(
hdr_wr™”_»ad”_pha£r
* 
p
)

93 
	`hdr_mu‹x_uÆock
(
p
->
»ad”_mu‹x
);

94 
	}
}

96 
	$hdr_pha£r_æ_pha£
(

97 
hdr_wr™”_»ad”_pha£r
* 
p
, 
št64_t
 
¦“p_time_ns
)

101 
št64_t
 
¡¬t_•och
 = 
	`_hdr_pha£r_g‘_•och
(&
p
->start_epoch);

103 
boŞ
 
Ãxt_pha£_is_ev’
 = (
¡¬t_•och
 < 0);

106 
št64_t
 
š™Ÿl_¡¬t_v®ue
;

107 ià(
Ãxt_pha£_is_ev’
)

109 
š™Ÿl_¡¬t_v®ue
 = 0;

110 
	`_hdr_pha£r_£t_•och
(&
p
->
ev’_’d_•och
, 
š™Ÿl_¡¬t_v®ue
);

114 
š™Ÿl_¡¬t_v®ue
 = 
INT64_MIN
;

115 
	`_hdr_pha£r_£t_•och
(&
p
->
odd_’d_•och
, 
š™Ÿl_¡¬t_v®ue
);

119 
št64_t
 
¡¬t_v®ue_©_æ
 =

120 
	`_hdr_pha£r_»£t_•och
(&
p
->
¡¬t_•och
, 
š™Ÿl_¡¬t_v®ue
);

122 
boŞ
 
ÿught_up
 = 
çl£
;

125 
št64_t
* 
’d_•och
 =

126 
Ãxt_pha£_is_ev’
 ? &
p
->
odd_’d_•och
 : &p->
ev’_’d_•och
;

128 
ÿught_up
 = 
	`_hdr_pha£r_g‘_•och
(
’d_•och
è=ğ
¡¬t_v®ue_©_æ
;

130 ià(!
ÿught_up
)

132 ià(
¦“p_time_ns
 == 0)

134 #ià
	`defšed
(
_MSC_VER
)

135 
	`SË•
(0);

137 
	`sched_y›ld
();

142 #ià
	`defšed
(
_MSC_VER
)

143 
timev®
 
tv
;

145 
tv
.
tv_£c
 = ()
¦“p_time_ns
 / 1000000;

146 
tv
.
tv_u£c
 = 
¦“p_time_ns
 % 1000000;

147 
	`£Ëù
(0, 
NULL
, NULL, NULL, &
tv
);

149 
	`u¦“p
(
¦“p_time_ns
 / 1000);

154 !
ÿught_up
);

155 
	}
}

	@hdr_histogram/hdr_writer_reader_phaser.h

7 #iâdeà
HDR_WRITER_READER_PHASER_H


8 
	#HDR_WRITER_READER_PHASER_H
 1

	)

10 
	~<¡dlib.h
>

11 
	~<¡dboŞ.h
>

12 
	~<¡dlib.h
>

13 
	~<hdr_th»ad.h
>

14 
	~<”ºo.h
>

16 
	$HDR_ALIGN_PREFIX
(8)

17 
	shdr_wr™”_»ad”_pha£r


19 
št64_t
 
¡¬t_•och
;

20 
št64_t
 
ev’_’d_•och
;

21 
št64_t
 
odd_’d_•och
;

22 
hdr_mu‹x
* 
»ad”_mu‹x
;

24 
	`HDR_ALIGN_SUFFIX
(8);

26 #ifdeà
__ılu¥lus


30 
	`hdr_wr™”_»ad”_pha£r_š™
(
hdr_wr™”_»ad”_pha£r
* 
p
);

32 
	`hdr_wr™”_»ad”_pha£r_de¡Üy
(
hdr_wr™”_»ad”_pha£r
* 
p
);

34 
št64_t
 
	`hdr_pha£r_wr™”_’‹r
(
hdr_wr™”_»ad”_pha£r
* 
p
);

36 
	`hdr_pha£r_wr™”_ex™
(

37 
hdr_wr™”_»ad”_pha£r
* 
p
, 
št64_t
 
ü™iÿl_v®ue_©_’‹r
);

39 
	`hdr_pha£r_»ad”_lock
(
hdr_wr™”_»ad”_pha£r
* 
p
);

41 
	`hdr_pha£r_»ad”_uÆock
(
hdr_wr™”_»ad”_pha£r
* 
p
);

43 
	`hdr_pha£r_æ_pha£
(

44 
hdr_wr™”_»ad”_pha£r
* 
p
, 
št64_t
 
¦“p_time_ns
);

46 #ifdeà
__ılu¥lus


47 
	}
}

	@nc.c

18 
	~<¡dio.h
>

19 
	~<¡dlib.h
>

20 
	~<uni¡d.h
>

21 
	~<sigÇl.h
>

22 
	~<g‘İt.h
>

23 
	~<fú.h
>

24 
	~<sys/¡©.h
>

25 
	~<sys/ut¢ame.h
>

27 
	~<nc_cÜe.h
>

28 
	~<nc_cÚf.h
>

29 
	~<nc_sigÇl.h
>

31 
	#NC_CONF_PATH
 "cÚf/nutüack”.yml"

	)

33 
	#NC_LOG_DEFAULT
 
LOG_NOTICE


	)

34 
	#NC_LOG_MIN
 
LOG_EMERG


	)

35 
	#NC_LOG_MAX
 
LOG_PVERB


	)

36 
	#NC_LOG_PATH
 
NULL


	)

38 
	#NC_STATS_PORT
 
STATS_PORT


	)

39 
	#NC_STATS_ADDR
 
STATS_ADDR


	)

40 
	#NC_STATS_INTERVAL
 
STATS_INTERVAL


	)

42 
	#NC_PID_FILE
 
NULL


	)

44 
	#NC_MBUF_SIZE
 
MBUF_SIZE


	)

45 
	#NC_MBUF_MIN_SIZE
 
MBUF_MIN_SIZE


	)

46 
	#NC_MBUF_MAX_SIZE
 
MBUF_MAX_SIZE


	)

49 
	#NC_PROXY_PORT
 22100

	)

51 
	gshow_h–p
;

52 
	gshow_v”siÚ
;

53 
	g‹¡_cÚf
;

54 
	gd«mÚize
;

55 
	gdesüibe_¡©s
;

57 
İtiÚ
 
	glÚg_İtiÚs
[] = {

58 { "h–p", 
no_¬gum’t
, 
NULL
, 'h' },

59 { "v”siÚ", 
no_¬gum’t
, 
NULL
, 'V' },

60 { "‹¡-cÚf", 
no_¬gum’t
, 
NULL
, 't' },

61 { "d«mÚize", 
no_¬gum’t
, 
NULL
, 'd' },

62 { "desüibe-¡©s", 
no_¬gum’t
, 
NULL
, 'D' },

63 { "v”bo£", 
»quœed_¬gum’t
, 
NULL
, 'v' },

64 { "ouut", 
»quœed_¬gum’t
, 
NULL
, 'o' },

65 { "cÚf-fe", 
»quœed_¬gum’t
, 
NULL
, 'c' },

66 { "¡©s-pÜt", 
»quœed_¬gum’t
, 
NULL
, 's' },

67 { "¡©s-š‹rv®", 
»quœed_¬gum’t
, 
NULL
, 'i' },

68 { "¡©s-addr", 
»quœed_¬gum’t
, 
NULL
, 'a' },

69 { "pid-fe", 
»quœed_¬gum’t
, 
NULL
, 'p' },

70 { "mbuf-size", 
»quœed_¬gum’t
, 
NULL
, 'm' },

71 { "´oxy-addr", 
»quœed_¬gum’t
, 
NULL
, 'x' },

72 { "´oxy-pÜt", 
»quœed_¬gum’t
, 
NULL
, 'y' },

73 { "zook“³r", 
»quœed_¬gum’t
, 
NULL
, 'z' },

74 { "zkcÚfig", 
»quœed_¬gum’t
, 
NULL
, 'g' },

75 { "poŞ", 
»quœed_¬gum’t
, 
NULL
, 'l' },

76 { 
NULL
, 0, NULL, 0 }

79 
	gshÜt_İtiÚs
[] = "hVtdDv:o:c:s:i:a:p:m:x:y:z:g:l:";

81 
r¡©us_t


82 
	$nc_d«mÚize
(
dump_cÜe
)

84 
r¡©us_t
 
¡©us
;

85 
pid_t
 
pid
, 
sid
;

86 
fd
;

88 
pid
 = 
	`fÜk
();

89 
pid
) {

91 
	`log_”rÜ
("fÜk(èçed: %s", 
	`¡»¼Ü
(
”ºo
));

92  
NC_ERROR
;

99 
	`_ex™
(0);

104 
sid
 = 
	`£tsid
();

105 ià(
sid
 < 0) {

106 
	`log_”rÜ
("£tsid(èçed: %s", 
	`¡»¼Ü
(
”ºo
));

107  
NC_ERROR
;

110 ià(
	`sigÇl
(
SIGHUP
, 
SIG_IGN
è=ğ
SIG_ERR
) {

111 
	`log_”rÜ
("sigÇl(SIGHUP, SIG_IGNèçed: %s", 
	`¡»¼Ü
(
”ºo
));

112  
NC_ERROR
;

115 
pid
 = 
	`fÜk
();

116 
pid
) {

118 
	`log_”rÜ
("fÜk(èçed: %s", 
	`¡»¼Ü
(
”ºo
));

119  
NC_ERROR
;

126 
	`_ex™
(0);

132 ià(
dump_cÜe
 == 0) {

133 
¡©us
 = 
	`chdœ
("/");

134 ià(
¡©us
 < 0) {

135 
	`log_”rÜ
("chdœ(\"/\"èçed: %s", 
	`¡»¼Ü
(
”ºo
));

136  
NC_ERROR
;

141 
	`umask
(0);

145 
fd
 = 
	`İ’
("/dev/nuÎ", 
O_RDWR
);

146 ià(
fd
 < 0) {

147 
	`log_”rÜ
("İ’(\"/dev/nuÎ\"èçed: %s", 
	`¡»¼Ü
(
”ºo
));

148  
NC_ERROR
;

151 
¡©us
 = 
	`dup2
(
fd
, 
STDIN_FILENO
);

152 ià(
¡©us
 < 0) {

153 
	`log_”rÜ
("dup2(%d, STDINèçed: %s", 
fd
, 
	`¡»¼Ü
(
”ºo
));

154 
	`şo£
(
fd
);

155  
NC_ERROR
;

158 
¡©us
 = 
	`dup2
(
fd
, 
STDOUT_FILENO
);

159 ià(
¡©us
 < 0) {

160 
	`log_”rÜ
("dup2(%d, STDOUTèçed: %s", 
fd
, 
	`¡»¼Ü
(
”ºo
));

161 
	`şo£
(
fd
);

162  
NC_ERROR
;

165 
¡©us
 = 
	`dup2
(
fd
, 
STDERR_FILENO
);

166 ià(
¡©us
 < 0) {

167 
	`log_”rÜ
("dup2(%d, STDERRèçed: %s", 
fd
, 
	`¡»¼Ü
(
”ºo
));

168 
	`şo£
(
fd
);

169  
NC_ERROR
;

172 ià(
fd
 > 
STDERR_FILENO
) {

173 
¡©us
 = 
	`şo£
(
fd
);

174 ià(
¡©us
 < 0) {

175 
	`log_”rÜ
("şo£(%dèçed: %s", 
fd
, 
	`¡»¼Ü
(
”ºo
));

176  
NC_ERROR
;

180  
NC_OK
;

181 
	}
}

184 
	$nc_´št_run
(
š¡ªû
 *
nci
)

186 
¡©us
;

187 
ut¢ame
 
Çme
;

189 
¡©us
 = 
	`uÇme
(&
Çme
);

190 ià(
¡©us
 < 0) {

191 
	`loga
("nutüack”-% ¡¬‹d oÀpid %d", 
NC_VERSION_STRING
, 
nci
->
pid
);

193 
	`loga
("nutcracker-%s built for %s %s %s started on…id %d",

194 
NC_VERSION_STRING
, 
Çme
.
sy¢ame
,‚ame.
»Ëa£
,‚ame.
machše
,

195 
nci
->
pid
);

198 
	`loga
("run,„abbit„un / dighat hole, forgethe sun / "

201 
	}
}

204 
	$nc_´št_dÚe
()

206 
	`loga
("done,„abbit done");

207 
	}
}

210 
	$nc_show_u§ge
()

212 
	`log_¡d”r
(

213 "U§ge:‚utüack” [-?hVdDt] [-v v”bos™y†ev–] [-Øouuˆfe]" 
CRLF


214 " [-øcÚàfe] [- ¡© pÜt] [-¨¡© addr]" 
CRLF


215 " [-˜¡© š‹rv®] [-°pid fe] [-m mbuàsize]" 
CRLF


217 
	`log_¡d”r
(

218 "O±iÚs:" 
CRLF


219 " -h, --h–° :hi h–p" 
CRLF


220 " -V, --v”siÚ : show v”siÚ‡ndƒx™" 
CRLF


221 " -t, --‹¡-cÚà :e¡ cÚfigu¿tiÚ fÜ syÁaxƒ¼Ü ªdƒx™" 
CRLF


222 " -d, --d«mÚiz :„uÀa ¨d«mÚ" 
CRLF


224 
	`log_¡d”r
(

225 " -v, --v”bo£=N : s‘†oggšg†ev– (deçuÉ: %d, mš: %d, max: %d)" 
CRLF


226 " -o, --ouut=S : s‘†oggšg f(deçuÉ: %s)" 
CRLF


227 " -c, --cÚf-fe=S : s‘ cÚfigu¿tiÚ f(deçuÉ: %s)" 
CRLF


228 " -s, --¡©s-pÜt=N : s‘ st mÚ™Üšg…Üˆ(deçuÉ: %d)" 
CRLF


229 " -a, --¡©s-addr=S : s‘ st mÚ™Üšg i°(deçuÉ: %s)" 
CRLF


230 " -i, --¡©s-š‹rv®=N : s‘ st agg»g©iÚ iÁ”v® iÀm£ø(deçuÉ: %d m£c)" 
CRLF


231 " -p, --pid-fe=S : s‘…id f(deçuÉ: %s)" 
CRLF


232 " -m, --mbuf-size=N : s‘ sizoàmbuàchunk iÀby‹ (deçuÉ: %d by‹s)" 
CRLF


233 " -x, --´oxy-add¸ : s‘…roxy†i¡’‡dd»s (MUST…rovide)" 
CRLF


234 " -y, --´oxy-pÜˆ : s‘…roxy†i¡’…Üˆ(MUST…rovide)" 
CRLF


235 " -z, --zook“³¸ : s‘ zook“³¸£rv” ho¡ (MUST…rovide)" 
CRLF


236 " -g, --zkcÚfig : s‘ zk…oŞ cÚfig f·th (deçuÉ: %s)" 
CRLF


237 " -l, --poŞ=S :…oŞ‚am(MUST…rovide)" 
CRLF


239 
NC_LOG_DEFAULT
, 
NC_LOG_MIN
, 
NC_LOG_MAX
,

240 
NC_LOG_PATH
 !ğ
NULL
 ? NC_LOG_PATH : "stderr",

241 
NC_CONF_PATH
,

242 
NC_STATS_PORT
, 
NC_STATS_ADDR
, 
NC_STATS_INTERVAL
,

243 
NC_PID_FILE
 !ğ
NULL
 ? NC_PID_FILE : "off",

244 
NC_MBUF_SIZE
,

245 
CONF_DEFAULT_CONF_ZNODE
);

246 
	}
}

248 
r¡©us_t


249 
	$nc_ü—‹_pidfe
(
š¡ªû
 *
nci
)

251 
pid
[
NC_UINTMAX_MAXLEN
];

252 
fd
, 
pid_Ën
;

253 
ssize_t
 
n
;

255 
fd
 = 
	`İ’
(
nci
->
pid_f’ame
, 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
, 0644);

256 ià(
fd
 < 0) {

257 
	`log_”rÜ
("İ’šg…id f'%s' faed: %s", 
nci
->
pid_f’ame
,

258 
	`¡»¼Ü
(
”ºo
));

259  
NC_ERROR
;

261 
nci
->
pidfe
 = 1;

263 
pid_Ën
 = 
	`nc_¢´štf
(
pid
, 
NC_UINTMAX_MAXLEN
, "%d", 
nci
->pid);

265 
n
 = 
	`nc_wr™e
(
fd
, 
pid
, 
pid_Ën
);

266 ià(
n
 < 0) {

267 
	`log_”rÜ
("wr™tØpid f'%s' faed: %s", 
nci
->
pid_f’ame
,

268 
	`¡»¼Ü
(
”ºo
));

269  
NC_ERROR
;

272 
	`şo£
(
fd
);

274  
NC_OK
;

275 
	}
}

278 
	$nc_»move_pidfe
(
š¡ªû
 *
nci
)

280 
¡©us
;

282 
¡©us
 = 
	`uÆšk
(
nci
->
pid_f’ame
);

283 ià(
¡©us
 < 0) {

284 
	`log_”rÜ
("unlink of…id file '%s' failed, ignored: %s",

285 
nci
->
pid_f’ame
, 
	`¡»¼Ü
(
”ºo
));

287 
	}
}

290 
	$nc_£t_deçuÉ_İtiÚs
(
š¡ªû
 *
nci
)

292 
¡©us
;

294 
nci
->
ùx
 = 
NULL
;

296 
nci
->
log_Ëv–
 = 
NC_LOG_DEFAULT
;

297 
nci
->
log_f’ame
 = 
NC_LOG_PATH
;

299 
nci
->
cÚf_f’ame
 = 
NC_CONF_PATH
;

301 
nci
->
¡©s_pÜt
 = 
NC_STATS_PORT
;

302 
nci
->
¡©s_addr
 = 
NC_STATS_ADDR
;

303 
nci
->
¡©s_š‹rv®
 = 
NC_STATS_INTERVAL
;

305 
¡©us
 = 
	`nc_g‘ho¡Çme
(
nci
->
ho¡Çme
, 
NC_MAXHOSTNAMELEN
);

306 ià(
¡©us
 < 0) {

307 
	`log_w¬n
("g‘ho¡Çmçed, ignÜed: %s", 
	`¡»¼Ü
(
”ºo
));

308 
	`nc_¢´štf
(
nci
->
ho¡Çme
, 
NC_MAXHOSTNAMELEN
, "unknown");

310 
nci
->
ho¡Çme
[
NC_MAXHOSTNAMELEN
 - 1] = '\0';

312 
nci
->
mbuf_chunk_size
 = 
NC_MBUF_SIZE
;

314 
nci
->
pid
 = (
pid_t
)-1;

315 
nci
->
pid_f’ame
 = 
NULL
;

316 
nci
->
pidfe
 = 0;

318 
nci
->
´oxy_pÜt
 = 
NC_PROXY_PORT
;

319 
nci
->
´oxy_
 = 
NULL
;

321 
nci
->
zk_cÚfig_roÙ
 = 
CONF_DEFAULT_CONF_ZNODE
;

322 
nci
->
zk_£rv”s
 = 
NULL
;

323 
nci
->
poŞ_Çme
 = 
NULL
;

324 
	}
}

326 
r¡©us_t


327 
	$nc_g‘_İtiÚs
(
¬gc
, **
¬gv
, 
š¡ªû
 *
nci
)

329 
c
, 
v®ue
;

331 
İ‹¼
 = 0;

334 
c
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, 
shÜt_İtiÚs
, 
lÚg_İtiÚs
, 
NULL
);

335 ià(
c
 == -1) {

340 
c
) {

342 
show_v”siÚ
 = 1;

343 
show_h–p
 = 1;

347 
show_v”siÚ
 = 1;

351 
‹¡_cÚf
 = 1;

355 
d«mÚize
 = 1;

359 
desüibe_¡©s
 = 1;

360 
show_v”siÚ
 = 1;

364 
v®ue
 = 
	`nc_©oi
(
İrg
, 
	`¡¾’
(optarg));

365 ià(
v®ue
 < 0) {

366 
	`log_¡d”r
("nutcracker: option -v„equires‡‚umber");

367  
NC_ERROR
;

369 
nci
->
log_Ëv–
 = 
v®ue
;

373 
nci
->
log_f’ame
 = 
İrg
;

377 
nci
->
poŞ_Çme
 = 
İrg
;

381 
nci
->
cÚf_f’ame
 = 
İrg
;

385 
v®ue
 = 
	`nc_©oi
(
İrg
, 
	`¡¾’
(optarg));

386 ià(
v®ue
 < 0) {

387 
	`log_¡d”r
("nutcracker: option -s„equires‡‚umber");

388  
NC_ERROR
;

390 ià(!
	`nc_v®id_pÜt
(
v®ue
)) {

391 
	`log_¡d”r
("nutcracker: option -s value %d is‚ot‡ valid "

392 "pÜt", 
v®ue
);

393  
NC_ERROR
;

396 
nci
->
¡©s_pÜt
 = (
ušt16_t
)
v®ue
;

397 
	`log_¡d”r
("nutüack”: st ¤v oÀpÜˆ%d", 
v®ue
);

401 
v®ue
 = 
	`nc_©oi
(
İrg
, 
	`¡¾’
(optarg));

402 ià(
v®ue
 < 0) {

403 
	`log_¡d”r
("nutcracker: option -i„equires‡‚umber");

404  
NC_ERROR
;

407 
nci
->
¡©s_š‹rv®
 = 
v®ue
;

411 
nci
->
¡©s_addr
 = 
İrg
;

415 
nci
->
pid_f’ame
 = 
İrg
;

419 
v®ue
 = 
	`nc_©oi
(
İrg
, 
	`¡¾’
(optarg));

420 ià(
v®ue
 <= 0) {

421 
	`log_¡d”r
("nutcracker: option -m„equires‡‚on-zero‚umber");

422  
NC_ERROR
;

425 ià(
v®ue
 < 
NC_MBUF_MIN_SIZE
 || v®u> 
NC_MBUF_MAX_SIZE
) {

426 
	`log_¡d”r
("nutcracker: mbuf chunk size must be between %zu‡nd"

427 " %zu by‹s", 
NC_MBUF_MIN_SIZE
, 
NC_MBUF_MAX_SIZE
);

428  
NC_ERROR
;

431 
nci
->
mbuf_chunk_size
 = (
size_t
)
v®ue
;

435 
nci
->
´oxy_
 = 
İrg
;

436 
	`log_¡d”r
("nutüack”:…roxy†i¡’‡dddr: %s", 
nci
->
´oxy_
);

440 
nci
->
´oxy_pÜt
 = (
ušt16_t
)
	`nc_©oi
(
İrg
, 
	`¡¾’
(optarg));

441 
	`log_¡d”r
("nutcracker:…roxy†isten…ort: %d",

442 
nci
->
´oxy_pÜt
);

446 
nci
->
zk_£rv”s
 = 
İrg
;

447 
	`log_¡d”r
("nutcracker: use zookeeper %s",

448 
nci
->
zk_£rv”s
);

452 
nci
->
zk_cÚfig_roÙ
ğ
İrg
;

453 
	`log_¡d”r
("nutcracker: use zookeeper config…ath %s",

454 
nci
->
zk_cÚfig_roÙ
);

458 
İtİt
) {

462 
	`log_¡d”r
("nutcracker: option -%c„equires‡ file‚ame",

463 
İtİt
);

470 
	`log_¡d”r
("nutüack”: o±iÚ -%ø»quœe ¨numb”", 
İtİt
);

474 
	`log_¡d”r
("nutüack”: o±iÚ -%ø»quœe ¨¡ršg", 
İtİt
);

478 
	`log_¡d”r
("nutüack”: inv®id o±iÚ -- '%c'", 
İtİt
);

481  
NC_ERROR
;

484 
	`log_¡d”r
("nutüack”: inv®id o±iÚ -- '%c'", 
İtİt
);

485  
NC_ERROR
;

490  
NC_OK
;

491 
	}
}

497 
boŞ


498 
	$nc_‹¡_cÚf
(
š¡ªû
 *
nci
)

500 
cÚf
 *
cf
;

502 
cf
 = 
	`cÚf_ü—‹
(
nci
->
cÚf_f’ame
);

503 ià(
cf
 =ğ
NULL
) {

504 
	`log_¡d”r
("nutcracker: configuration file '%s' syntax is invalid",

505 
nci
->
cÚf_f’ame
);

506  
çl£
;

509 
	`cÚf_de¡roy
(
cf
);

511 
	`log_¡d”r
("nutcracker: configuration file '%s' syntax is ok",

512 
nci
->
cÚf_f’ame
);

513  
Œue
;

514 
	}
}

516 
r¡©us_t


517 
	$nc_´e_run
(
š¡ªû
 *
nci
)

519 
r¡©us_t
 
¡©us
;

521 
¡©us
 = 
	`log_š™
(
nci
->
log_Ëv–
,‚ci->
log_f’ame
);

522 ià(
¡©us
 !ğ
NC_OK
) {

523  
¡©us
;

526 ià(
d«mÚize
) {

527 
¡©us
 = 
	`nc_d«mÚize
(1);

528 ià(
¡©us
 !ğ
NC_OK
) {

529  
¡©us
;

533 
nci
->
pid
 = 
	`g‘pid
();

535 
¡©us
 = 
	`sigÇl_š™
();

536 ià(
¡©us
 !ğ
NC_OK
) {

537  
¡©us
;

540 ià(
nci
->
pid_f’ame
) {

541 
¡©us
 = 
	`nc_ü—‹_pidfe
(
nci
);

542 ià(
¡©us
 !ğ
NC_OK
) {

543  
¡©us
;

547 
	`nc_´št_run
(
nci
);

549  
NC_OK
;

550 
	}
}

553 
	$nc_po¡_run
(
š¡ªû
 *
nci
)

555 ià(
nci
->
pidfe
) {

556 
	`nc_»move_pidfe
(
nci
);

559 ià(
nci
->
ùx
 &&‚ci->ùx->
zkh
) {

560 
	`ZKClo£
(
nci
->
ùx
->
zkh
);

563 
	`sigÇl_deš™
();

565 
	`nc_´št_dÚe
();

567 
	`log_deš™
();

568 
	}
}

571 
	$nc_run
(
š¡ªû
 *
nci
)

573 
r¡©us_t
 
¡©us
;

574 
cÚ‹xt
 *
ùx
;

576 
ùx
 = 
	`cÜe_¡¬t
(
nci
);

577 ià(
ùx
 =ğ
NULL
) {

583 
¡©us
 = 
	`cÜe_loİ
(
ùx
);

584 ià(
¡©us
 !ğ
NC_OK
) {

589 
	`cÜe_¡İ
(
ùx
);

590 
	}
}

593 
	$maš
(
¬gc
, **
¬gv
)

595 
r¡©us_t
 
¡©us
;

596 
š¡ªû
 
nci
;

598 
	`nc_£t_deçuÉ_İtiÚs
(&
nci
);

600 
¡©us
 = 
	`nc_g‘_İtiÚs
(
¬gc
, 
¬gv
, &
nci
);

601 ià(
¡©us
 !ğ
NC_OK
) {

602 
	`nc_show_u§ge
();

603 
	`ex™
(1);

606 ià(
show_v”siÚ
) {

607 
	`log_¡d”r
("Thi i nutüack”-%s" 
CRLF
, 
NC_VERSION_STRING
);

608 ià(
show_h–p
) {

609 
	`nc_show_u§ge
();

612 ià(
desüibe_¡©s
) {

613 
	`¡©s_desüibe
();

616 
	`ex™
(0);

619 ià(
nci
.
´oxy_
 =ğ
NULL
) {

620 
	`log_¡d”r
("mu¡…rovid´oxy_‡nd…roxy_pÜt" 
CRLF
);

621 
	`nc_show_u§ge
();

622 
	`ex™
(1);

625 ià(
nci
.
poŞ_Çme
 =ğ
NULL
) {

626 
	`log_¡d”r
("mu¡…rovidpoŞ_Çme" 
CRLF
);

627 
	`nc_show_u§ge
();

628 
	`ex™
(1);

631 ià(
‹¡_cÚf
) {

632 ià(!
	`nc_‹¡_cÚf
(&
nci
)) {

633 
	`ex™
(1);

635 
	`ex™
(0);

638 
¡©us
 = 
	`nc_´e_run
(&
nci
);

639 ià(
¡©us
 !ğ
NC_OK
) {

640 
	`nc_po¡_run
(&
nci
);

641 
	`ex™
(1);

644 
	`nc_run
(&
nci
);

646 
	`nc_po¡_run
(&
nci
);

648 
	`ex™
(1);

649 
	}
}

	@nc_array.c

18 
	~<¡dlib.h
>

20 
	~<nc_cÜe.h
>

22 
¬¿y
 *

23 
	$¬¿y_ü—‹
(
ušt32_t
 
n
, 
size_t
 
size
)

25 
¬¿y
 *
a
;

27 
	`ASSERT
(
n
 !ğ0 && 
size
 != 0);

29 
a
 = 
	`nc_®loc
((*a));

30 ià(
a
 =ğ
NULL
) {

31  
NULL
;

34 
a
->
–em
 = 
	`nc_®loc
(
n
 * 
size
);

35 ià(
a
->
–em
 =ğ
NULL
) {

36 
	`nc_ä“
(
a
);

37  
NULL
;

40 
a
->
ÃËm
 = 0;

41 
a
->
size
 = size;

42 
a
->
ÇÎoc
 = 
n
;

44  
a
;

45 
	}
}

48 
	$¬¿y_de¡roy
(
¬¿y
 *
a
)

50 
	`¬¿y_deš™
(
a
);

51 
	`nc_ä“
(
a
);

52 
	}
}

54 
r¡©us_t


55 
	$¬¿y_š™
(
¬¿y
 *
a
, 
ušt32_t
 
n
, 
size_t
 
size
)

57 
	`ASSERT
(
n
 !ğ0 && 
size
 != 0);

59 
a
->
–em
 = 
	`nc_®loc
(
n
 * 
size
);

60 ià(
a
->
–em
 =ğ
NULL
) {

61  
NC_ENOMEM
;

64 
a
->
ÃËm
 = 0;

65 
a
->
size
 = size;

66 
a
->
ÇÎoc
 = 
n
;

68  
NC_OK
;

69 
	}
}

72 
	$¬¿y_deš™
(
¬¿y
 *
a
)

74 
	`ASSERT
(
a
->
ÃËm
 == 0);

76 ià(
a
->
–em
 !ğ
NULL
) {

77 
	`nc_ä“
(
a
->
–em
);

79 
	}
}

81 
ušt32_t


82 
	$¬¿y_idx
(
¬¿y
 *
a
, *
–em
)

84 
ušt8_t
 *
p
, *
q
;

85 
ušt32_t
 
off
, 
idx
;

87 
	`ASSERT
(
–em
 >ğ
a
->elem);

89 
p
 = 
a
->
–em
;

90 
q
 = 
–em
;

91 
off
 = (
ušt32_t
)(
q
 - 
p
);

93 
	`ASSERT
(
off
 % (
ušt32_t
)
a
->
size
 == 0);

95 
idx
 = 
off
 / (
ušt32_t
)
a
->
size
;

97  
idx
;

98 
	}
}

101 
	$¬¿y_push
(
¬¿y
 *
a
)

103 *
–em
, *
Ãw
;

104 
size_t
 
size
;

106 ià(
a
->
ÃËm
 =ğa->
ÇÎoc
) {

109 
size
 = 
a
->siz*‡->
ÇÎoc
;

110 
Ãw
 = 
	`nc_»®loc
(
a
->
–em
, 2 * 
size
);

111 ià(
Ãw
 =ğ
NULL
) {

112  
NULL
;

115 
a
->
–em
 = 
Ãw
;

116 
a
->
ÇÎoc
 *= 2;

119 
–em
 = (
ušt8_t
 *)
a
->–em +‡->
size
 *‡->
ÃËm
;

120 
a
->
ÃËm
++;

122  
–em
;

123 
	}
}

126 
	$¬¿y_pİ
(
¬¿y
 *
a
)

128 *
–em
;

130 
	`ASSERT
(
a
->
ÃËm
 != 0);

132 
a
->
ÃËm
--;

133 
–em
 = (
ušt8_t
 *)
a
->–em +‡->
size
 *‡->
ÃËm
;

135  
–em
;

136 
	}
}

139 
	$¬¿y_g‘
(
¬¿y
 *
a
, 
ušt32_t
 
idx
)

141 *
–em
;

143 
	`ASSERT
(
a
->
ÃËm
 != 0);

144 
	`ASSERT
(
idx
 < 
a
->
ÃËm
);

146 
–em
 = (
ušt8_t
 *)
a
->–em + (a->
size
 * 
idx
);

148  
–em
;

149 
	}
}

152 
	$¬¿y_tİ
(
¬¿y
 *
a
)

154 
	`ASSERT
(
a
->
ÃËm
 != 0);

156  
	`¬¿y_g‘
(
a
,‡->
ÃËm
 - 1);

157 
	}
}

160 
	$¬¿y_sw­
(
¬¿y
 *
a
, ¬¿y *
b
)

162 
¬¿y
 
tmp
;

164 
tmp
 = *
a
;

165 *
a
 = *
b
;

166 *
b
 = 
tmp
;

167 
	}
}

174 
	$¬¿y_sÜt
(
¬¿y
 *
a
, 
¬¿y_com·»_t
 
com·»
)

176 
	`ASSERT
(
a
->
ÃËm
 != 0);

178 
	`qsÜt
(
a
->
–em
,‡->
ÃËm
,‡->
size
, 
com·»
);

179 
	}
}

185 
r¡©us_t


186 
	$¬¿y_—ch
(
¬¿y
 *
a
, 
¬¿y_—ch_t
 
func
, *
d©a
)

188 
ušt32_t
 
i
, 
ÃËm
;

190 
	`ASSERT
(
	`¬¿y_n
(
a
) != 0);

191 
	`ASSERT
(
func
 !ğ
NULL
);

193 
i
 = 0, 
ÃËm
 = 
	`¬¿y_n
(
a
); i <‚elem; i++) {

194 *
–em
 = 
	`¬¿y_g‘
(
a
, 
i
);

195 
r¡©us_t
 
¡©us
;

197 
¡©us
 = 
	`func
(
–em
, 
d©a
);

198 ià(
¡©us
 !ğ
NC_OK
) {

199  
¡©us
;

203  
NC_OK
;

204 
	}
}

	@nc_array.h

18 #iâdeà
_NC_ARRAY_H_


19 
	#_NC_ARRAY_H_


	)

21 
	~<nc_cÜe.h
>

23 (*
	t¬¿y_com·»_t
)(const *, const *);

24 
	$r¡©us_t
 (*
	t¬¿y_—ch_t
)(*, *);

26 
	s¬¿y
 {

27 
ušt32_t
 
ÃËm
;

28 *
–em
;

29 
size_t
 
size
;

30 
ušt32_t
 
ÇÎoc
;

33 
	#nuÎ_¬¿y
 { 0, 
NULL
, 0, 0 
	}

	)
}

35 
šlše
 

36 
	$¬¿y_nuÎ
(
¬¿y
 *
a
)

38 
a
->
ÃËm
 = 0;

39 
a
->
–em
 = 
NULL
;

40 
a
->
size
 = 0;

41 
a
->
ÇÎoc
 = 0;

42 
	}
}

44 
šlše
 

45 
	$¬¿y_£t
(
¬¿y
 *
a
, *
–em
, 
size_t
 
size
, 
ušt32_t
 
ÇÎoc
)

47 
a
->
ÃËm
 = 0;

48 
a
->
–em
 =ƒlem;

49 
a
->
size
 = size;

50 
a
->
ÇÎoc
 =‚alloc;

51 
	}
}

53 
šlše
 
ušt32_t


54 
	$¬¿y_n
(cÚ¡ 
¬¿y
 *
a
)

56  
a
->
ÃËm
;

57 
	}
}

59 
¬¿y
 *
¬¿y_ü—‹
(
ušt32_t
 
n
, 
size_t
 
size
);

60 
¬¿y_de¡roy
(
¬¿y
 *
a
);

61 
r¡©us_t
 
¬¿y_š™
(
¬¿y
 *
a
, 
ušt32_t
 
n
, 
size_t
 
size
);

62 
¬¿y_deš™
(
¬¿y
 *
a
);

64 
ušt32_t
 
¬¿y_idx
(
¬¿y
 *
a
, *
–em
);

65 *
¬¿y_push
(
¬¿y
 *
a
);

66 *
¬¿y_pİ
(
¬¿y
 *
a
);

67 *
¬¿y_g‘
(
¬¿y
 *
a
, 
ušt32_t
 
idx
);

68 *
¬¿y_tİ
(
¬¿y
 *
a
);

69 
¬¿y_sw­
(
¬¿y
 *
a
, ¬¿y *
b
);

70 
¬¿y_sÜt
(
¬¿y
 *
a
, 
¬¿y_com·»_t
 
com·»
);

71 
r¡©us_t
 
¬¿y_—ch
(
¬¿y
 *
a
, 
¬¿y_—ch_t
 
func
, *
d©a
);

	@nc_client.c

18 
	~<nc_cÜe.h
>

19 
	~<nc_£rv”.h
>

20 
	~<nc_ş›Á.h
>

23 
	$ş›Á_»f
(
cÚn
 *cÚn, *
owÃr
)

25 
£rv”_poŞ
 *
poŞ
 = 
owÃr
;

27 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

28 
	`ASSERT
(
cÚn
->
owÃr
 =ğ
NULL
);

35 
cÚn
->
çmy
 = 0;

36 
cÚn
->
add¾’
 = 0;

37 
cÚn
->
addr
 = 
NULL
;

39 
poŞ
->
nc_cÚn_q
++;

40 
	`TAILQ_INSERT_TAIL
(&
poŞ
->
c_cÚn_q
, 
cÚn
, 
cÚn_tqe
);

43 
cÚn
->
owÃr
 = owner;

45 
	`log_debug
(
LOG_VVERB
, "»àcÚÀ%°owÃ¸%°štØpoŞ '%.*s'", 
cÚn
, 
poŞ
,

46 
poŞ
->
Çme
.
Ën
,…oŞ->Çme.
d©a
);

47 
	}
}

50 
	$ş›Á_uÄef
(
cÚn
 *conn)

52 
£rv”_poŞ
 *
poŞ
;

54 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

55 
	`ASSERT
(
cÚn
->
owÃr
 !ğ
NULL
);

57 
poŞ
 = 
cÚn
->
owÃr
;

58 
cÚn
->
owÃr
 = 
NULL
;

60 
	`ASSERT
(
poŞ
->
nc_cÚn_q
 != 0);

61 
poŞ
->
nc_cÚn_q
--;

62 
	`TAILQ_REMOVE
(&
poŞ
->
c_cÚn_q
, 
cÚn
, 
cÚn_tqe
);

64 
	`log_debug
(
LOG_VVERB
, "uÄeàcÚÀ%°owÃ¸%°äom…oŞ '%.*s'", 
cÚn
,

65 
poŞ
,…oŞ->
Çme
.
Ën
,…oŞ->Çme.
d©a
);

66 
	}
}

68 
boŞ


69 
	$ş›Á_aùive
(
cÚn
 *conn)

71 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

73 
	`ASSERT
(
	`TAILQ_EMPTY
(&
cÚn
->
imsg_q
));

75 ià(!
	`TAILQ_EMPTY
(&
cÚn
->
omsg_q
)) {

76 
	`log_debug
(
LOG_VVERB
, "ø%d i aùive", 
cÚn
->
sd
);

77  
Œue
;

80 ià(
cÚn
->
rmsg
 !ğ
NULL
) {

81 
	`log_debug
(
LOG_VVERB
, "ø%d i aùive", 
cÚn
->
sd
);

82  
Œue
;

85 ià(
cÚn
->
smsg
 !ğ
NULL
) {

86 
	`log_debug
(
LOG_VVERB
, "ø%d i aùive", 
cÚn
->
sd
);

87  
Œue
;

90 
	`log_debug
(
LOG_VVERB
, "ø%d i šaùive", 
cÚn
->
sd
);

92  
çl£
;

93 
	}
}

96 
	$ş›Á_şo£_¡©s
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
, 
”r_t
 
”r
,

97 
eof
)

99 
	`¡©s_poŞ_deü
(
ùx
, 
poŞ
, 
ş›Á_cÚÃùiÚs
);

101 ià(
eof
) {

102 
	`¡©s_poŞ_šü
(
ùx
, 
poŞ
, 
ş›Á_eof
);

106 
”r
) {

107 
EPIPE
:

108 
ETIMEDOUT
:

109 
ECONNRESET
:

110 
ECONNABORTED
:

111 
ENOTCONN
:

112 
ENETDOWN
:

113 
ENETUNREACH
:

114 
EHOSTDOWN
:

115 
EHOSTUNREACH
:

117 
	`¡©s_poŞ_šü
(
ùx
, 
poŞ
, 
ş›Á_”r
);

120 
	}
}

123 
	$ş›Á_şo£
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

125 
r¡©us_t
 
¡©us
;

126 
msg
 *msg, *
nmsg
;

128 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

130 
	`ş›Á_şo£_¡©s
(
ùx
, 
cÚn
->
owÃr
, cÚn->
”r
, cÚn->
eof
);

132 ià(
cÚn
->
sd
 < 0) {

133 
cÚn
->
	`uÄef
(conn);

134 
	`cÚn_put
(
cÚn
);

138 
msg
 = 
cÚn
->
rmsg
;

139 ià(
msg
 !ğ
NULL
) {

140 
cÚn
->
rmsg
 = 
NULL
;

142 
	`ASSERT
(
msg
->
³”
 =ğ
NULL
);

143 
	`ASSERT
(
msg
->
»que¡
 && !msg->
dÚe
);

145 
	`log_debug
(
LOG_INFO
, "şo£ c %d disÿrdšg…’dšg„eq %"
PRIu64
"†en "

146 "%"
PRIu32
"y³ %d", 
cÚn
->
sd
, 
msg
->
id
, msg->
mËn
,

147 
msg
->
ty³
);

149 
	`»q_put
(
msg
);

152 
	`ASSERT
(
cÚn
->
smsg
 =ğ
NULL
);

153 
	`ASSERT
(
	`TAILQ_EMPTY
(&
cÚn
->
imsg_q
));

155 
msg
 = 
	`TAILQ_FIRST
(&
cÚn
->
omsg_q
); msg !ğ
NULL
; msg = 
nmsg
) {

156 
nmsg
 = 
	`TAILQ_NEXT
(
msg
, 
c_tqe
);

159 
cÚn
->
	`dequeue_outq
(
ùx
, cÚn, 
msg
);

161 ià(
msg
->
dÚe
) {

162 
	`log_debug
(
LOG_INFO
, "şo£ c %d disÿrdšg % »q %"
PRIu64
"†en "

163 "%"
PRIu32
"y³ %d", 
cÚn
->
sd
,

164 
msg
->
”rÜ
 ? "”rÜ": "com¶‘ed", msg->
id
, msg->
mËn
,

165 
msg
->
ty³
);

166 
	`»q_put
(
msg
);

168 
msg
->
sw®low
 = 1;

170 
	`ASSERT
(
msg
->
»que¡
);

171 
	`ASSERT
(
msg
->
³”
 =ğ
NULL
);

173 
	`log_debug
(
LOG_INFO
, "şo£ c %d scheduË sw®low oà»q %"
PRIu64
" "

174 "ËÀ%"
PRIu32
"y³ %d", 
cÚn
->
sd
, 
msg
->
id
, msg->
mËn
,

175 
msg
->
ty³
);

178 
	`ASSERT
(
	`TAILQ_EMPTY
(&
cÚn
->
omsg_q
));

180 
cÚn
->
	`uÄef
(conn);

182 
¡©us
 = 
	`şo£
(
cÚn
->
sd
);

183 ià(
¡©us
 < 0) {

184 
	`log_”rÜ
("şo£ c %d faed, ignÜed: %s", 
cÚn
->
sd
, 
	`¡»¼Ü
(
”ºo
));

186 
cÚn
->
sd
 = -1;

188 
	`cÚn_put
(
cÚn
);

189 
	}
}

	@nc_client.h

18 #iâdeà
_NC_CLIENT_H_


19 
	#_NC_CLIENT_H_


	)

21 
	~<nc_cÜe.h
>

23 
boŞ
 
ş›Á_aùive
(
cÚn
 *conn);

24 
ş›Á_»f
(
cÚn
 *cÚn, *
owÃr
);

25 
ş›Á_uÄef
(
cÚn
 *conn);

26 
ş›Á_şo£
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn);

	@nc_conf.c

18 
	~<nc_cÜe.h
>

19 
	~<nc_cÚf.h
>

20 
	~<nc_£rv”.h
>

21 
	~<´Ùo/nc_´Ùo.h
>

22 
	~"·rsÚ/·rsÚ.h
"

23 
	~"zkut.h
"

25 
	#DEFINE_ACTION
(
_hash
, 
_Çme
è
	`¡ršg
(#_Çme),

	)

26 
¡ršg
 
	ghash_¡ršgs
[] = {

27 
HASH_CODEC
Ğ
DEFINE_ACTION
 )

28 
nuÎ_¡ršg


30 #undeà
DEFINE_ACTION


32 
	#DEFINE_ACTION
(
_hash
, 
_Çme
è
hash_
##_Çme,

	)

33 
hash_t
 
	ghash_®gos
[] = {

34 
HASH_CODEC
Ğ
DEFINE_ACTION
 )

35 
NULL


37 #undeà
DEFINE_ACTION


39 
	#DEFINE_ACTION
(
_di¡
, 
_Çme
è
	`¡ršg
(#_Çme),

	)

40 
¡ršg
 
	gdi¡_¡ršgs
[] = {

41 
DIST_CODEC
Ğ
DEFINE_ACTION
 )

42 
nuÎ_¡ršg


44 #undeà
DEFINE_ACTION


46 
cÚf_£rv”_to_cÚf_li¡’
(
cÚf_£rv”
* 
cs
,

47 
cÚf_li¡’
* 
ş
);

48 
r¡©us_t
 
¡ršg_to_cÚf_£rv”
(cÚ¡ 
ušt8_t
* 
§ddr
,

49 
cÚf_£rv”
* 
¤v
);

50 
r¡©us_t
 
cÚf_sh¬ds_to_£rv”_sh¬ds
(
¬¿y
* 
cf_sh¬ds
,

51 
¬¿y
* 
¤v_sh¬ds
,

52 
£rv”_poŞ
* 
¥
);

53 
r¡©us_t
 
·r£_poŞ_cÚf_fe
(
cÚf
 *
cf
, *
poŞ_Çme
);

54 
r¡©us_t
 
cÚf_jsÚ_to_cÚf_poŞ
(
JSON_Objeù
 *
pobj
,

55 
cÚf_poŞ
 *
poŞ
,

56 *
poŞ_Çme
);

57 
boŞ
 
§n™y_check_poŞ_cÚf_jsÚ
(
JSON_Objeù
 *
pobj
);

58 
boŞ
 
§n™y_check_sh¬d_cÚf_jsÚ
(
JSON_Objeù
 *
sobj
);

59 
di¥Ïy_£rv”_sh¬d
(
sh¬d
 *
¤v_sd
);

60 
r¡©us_t
 
cÚf_sh¬d_to_£rv”_sh¬d
(
cÚf_sh¬d
 *
cÚf_sd
,

61 
sh¬d
 *
¤v_sd
,

62 
£rv”_poŞ
 *
¥
);

63 
£rv”
* 
fšd_£rv”_äom_cÚf_£rv”
(
cÚf_£rv”
 *
cÚf_¤v
,

64 
¬¿y
 *
¤vs
);

65 
boŞ
 
cÚf_m©ch_£rv”
(
cÚf_£rv”
 *
cÚf_¤v
, 
£rv”
 *
¤v
);

66 
£t_£rv”_sh¬d_¡©us
(
cÚf_sh¬d
 *
cÚf_sd
,

67 
sh¬d
 *
¤v_sd
);

68 
boŞ
 
is_v®id_cÚf_£rv”
(
cÚf_£rv”
 *
cÚf_¤v
);

69 
r¡©us_t
 
upd©e_£rv”_sh¬ds_äom_cÚf_jsÚ
(
JSON_Objeù
 *
pobj
,

70 
¬¿y
 *
¤v_sh¬ds
,

71 
£rv”_poŞ
 *
¥
);

73 
commªd
 
	gcÚf_commªds
[] = {

74 { 
¡ršg
("listen"),

75 
cÚf_£t_li¡’
,

76 
off£tof
(
cÚf_poŞ
, 
li¡’
) },

78 { 
¡ršg
("hash"),

79 
cÚf_£t_hash
,

80 
off£tof
(
cÚf_poŞ
, 
hash
) },

82 { 
¡ršg
("hash_tag"),

83 
cÚf_£t_hashg
,

84 
off£tof
(
cÚf_poŞ
, 
hash_g
) },

86 { 
¡ršg
("distribution"),

87 
cÚf_£t_di¡ributiÚ
,

88 
off£tof
(
cÚf_poŞ
, 
di¡ributiÚ
) },

90 { 
¡ršg
("timeout"),

91 
cÚf_£t_num
,

92 
off£tof
(
cÚf_poŞ
, 
timeout
) },

94 { 
¡ršg
("backlog"),

95 
cÚf_£t_num
,

96 
off£tof
(
cÚf_poŞ
, 
backlog
) },

98 { 
¡ršg
("client_connections"),

99 
cÚf_£t_num
,

100 
off£tof
(
cÚf_poŞ
, 
ş›Á_cÚÃùiÚs
) },

102 { 
¡ršg
("redis"),

103 
cÚf_£t_boŞ
,

104 
off£tof
(
cÚf_poŞ
, 
»dis
) },

106 { 
¡ršg
("tcpkeepalive"),

107 
cÚf_£t_boŞ
,

108 
off£tof
(
cÚf_poŞ
, 
tık“·live
) },

110 { 
¡ršg
("redis_auth"),

111 
cÚf_£t_¡ršg
,

112 
off£tof
(
cÚf_poŞ
, 
»dis_auth
) },

114 { 
¡ršg
("redis_db"),

115 
cÚf_£t_num
,

116 
off£tof
(
cÚf_poŞ
, 
»dis_db
) },

118 { 
¡ršg
("preconnect"),

119 
cÚf_£t_boŞ
,

120 
off£tof
(
cÚf_poŞ
, 
´ecÚÃù
) },

122 { 
¡ršg
("auto_eject_hosts"),

123 
cÚf_£t_boŞ
,

124 
off£tof
(
cÚf_poŞ
, 
auto_ejeù_ho¡s
) },

126 { 
¡ršg
("server_connections"),

127 
cÚf_£t_num
,

128 
off£tof
(
cÚf_poŞ
, 
£rv”_cÚÃùiÚs
) },

130 { 
¡ršg
("server_retry_timeout"),

131 
cÚf_£t_num
,

132 
off£tof
(
cÚf_poŞ
, 
£rv”_»Œy_timeout
) },

134 { 
¡ršg
("server_failure_limit"),

135 
cÚf_£t_num
,

136 
off£tof
(
cÚf_poŞ
, 
£rv”_çu»_lim™
) },

138 { 
¡ršg
("servers"),

139 
cÚf_add_£rv”
,

140 
off£tof
(
cÚf_poŞ
, 
£rv”
) },

142 
nuÎ_commªd


146 
	$cÚf_£rv”_š™
(
cÚf_£rv”
 *
cs
)

148 
	`¡ršg_š™
(&
cs
->
²ame
);

149 
	`¡ršg_š™
(&
cs
->
Çme
);

150 
	`¡ršg_š™
(&
cs
->
addr¡r
);

151 
cs
->
pÜt
 = 0;

152 
cs
->
weight
 = 0;

154 
	`mem£t
(&
cs
->
šfo
, 0, (cs->info));

156 
cs
->
v®id
 = 0;

158 
	`log_debug
(
LOG_VVERB
, "š™ cÚà£rv” %p", 
cs
);

159 
	}
}

162 
	$cÚf_£rv”_deš™
(
cÚf_£rv”
 *
cs
)

164 
	`¡ršg_deš™
(&
cs
->
²ame
);

165 
	`¡ršg_deš™
(&
cs
->
Çme
);

166 
	`¡ršg_deš™
(&
cs
->
addr¡r
);

167 
cs
->
v®id
 = 0;

168 
	`log_debug
(
LOG_VVERB
, "deš™ cÚà£rv” %p", 
cs
);

169 
	}
}

172 
	$cÚf_sh¬d_deš™
(
cÚf_sh¬d
 *
cs
) {

173 
	`cÚf_£rv”_deš™
(&
cs
->
ma¡”
);

174 
	`¬¿y_n
(&
cs
->
¦aves
) != 0) {

175 
	`cÚf_£rv”_deš™
(
	`¬¿y_pİ
(&
cs
->
¦aves
));

177 
	`¬¿y_deš™
(&
cs
->
¦aves
);

178 
	}
}

180 
r¡©us_t


181 
	$cÚf_£rv”_to_£rv”
(
cÚf_£rv”
 *
cs
, 
£rv”
 *
s
)

184 
s
->
owÃr
 = 
NULL
;

186 
	`¡ršg_š™
(&
s
->
²ame
);

187 
	`¡ršg_š™
(&
s
->
Çme
);

188 
	`¡ršg_š™
(&
s
->
addr¡r
);

189 
	`¡ršg_du¶iÿ‹
(&
s
->
²ame
, &
cs
->pname);

190 
	`¡ršg_du¶iÿ‹
(&
s
->
Çme
, &
cs
->name);

191 
	`¡ršg_du¶iÿ‹
(&
s
->
addr¡r
, &
cs
->addrstr);

196 
s
->
pÜt
 = (
ušt16_t
)
cs
->port;

197 
s
->
weight
 = (
ušt32_t
)
cs
->weight;

199 
	`nc_memıy
(&
s
->
šfo
, &
cs
->info, (cs->info));

201 
s
->
ns_cÚn_q
 = 0;

202 
	`TAILQ_INIT
(&
s
->
s_cÚn_q
);

204 
s
->
Ãxt_»Œy
 = 0LL;

205 
s
->
çu»_couÁ
 = 0;

207 
	`log_debug
(
LOG_VERB
, "ŒªsfÜmØ£rv” %"
PRIu32
" '%.*s'",

208 
s
->
idx
, s->
²ame
.
Ën
, s->²ame.
d©a
);

210  
NC_OK
;

211 
	}
}

214 
r¡©us_t


215 
	$cÚf_£rv”_—ch_ŒªsfÜm
(*
–em
, *
d©a
)

217 
cÚf_£rv”
 *
cs
 = 
–em
;

218 
¬¿y
 *
£rv”
 = 
d©a
;

219 
£rv”
 *
s
;

221 
	`ASSERT
(
cs
->
v®id
);

223 
s
 = 
	`¬¿y_push
(
£rv”
);

224 
	`ASSERT
(
s
 !ğ
NULL
);

226 
s
->
idx
 = 
	`¬¿y_idx
(
£rv”
, s);

227 
s
->
owÃr
 = 
NULL
;

229 
s
->
²ame
 = 
cs
->pname;

230 
s
->
Çme
 = 
cs
->name;

231 
s
->
addr¡r
 = 
cs
->addrstr;

232 
s
->
pÜt
 = (
ušt16_t
)
cs
->port;

233 
s
->
weight
 = (
ušt32_t
)
cs
->weight;

235 
	`nc_memıy
(&
s
->
šfo
, &
cs
->info, (cs->info));

237 
s
->
ns_cÚn_q
 = 0;

238 
	`TAILQ_INIT
(&
s
->
s_cÚn_q
);

240 
s
->
Ãxt_»Œy
 = 0LL;

241 
s
->
çu»_couÁ
 = 0;

243 
	`log_debug
(
LOG_VERB
, "ŒªsfÜmØ£rv” %"
PRIu32
" '%.*s'",

244 
s
->
idx
, s->
²ame
.
Ën
, s->²ame.
d©a
);

246  
NC_OK
;

247 
	}
}

249 
r¡©us_t


250 
	$cÚf_poŞ_š™
(
cÚf_poŞ
 *
ı
, 
¡ršg
 *
Çme
)

252 
r¡©us_t
 
¡©us
;

254 
	`¡ršg_š™
(&
ı
->
Çme
);

256 
	`¡ršg_š™
(&
ı
->
li¡’
.
²ame
);

257 
	`¡ršg_š™
(&
ı
->
li¡’
.
Çme
);

258 
	`¡ršg_š™
(&
ı
->
»dis_auth
);

259 
ı
->
li¡’
.
pÜt
 = 0;

260 
	`mem£t
(&
ı
->
li¡’
.
šfo
, 0, (cp->listen.info));

261 
ı
->
li¡’
.
v®id
 = 0;

263 
ı
->
hash
 = 
CONF_UNSET_HASH
;

264 
	`¡ršg_š™
(&
ı
->
hash_g
);

265 
ı
->
di¡ributiÚ
 = 
CONF_UNSET_DIST
;

267 
ı
->
timeout
 = 
CONF_UNSET_NUM
;

268 
ı
->
backlog
 = 
CONF_UNSET_NUM
;

270 
ı
->
ş›Á_cÚÃùiÚs
 = 
CONF_UNSET_NUM
;

272 
ı
->
»dis
 = 
CONF_UNSET_NUM
;

273 
ı
->
tık“·live
 = 
CONF_UNSET_NUM
;

274 
ı
->
»dis_db
 = 
CONF_UNSET_NUM
;

275 
ı
->
´ecÚÃù
 = 
CONF_UNSET_NUM
;

276 
ı
->
auto_ejeù_ho¡s
 = 
CONF_UNSET_NUM
;

277 
ı
->
£rv”_cÚÃùiÚs
 = 
CONF_UNSET_NUM
;

278 
ı
->
£rv”_»Œy_timeout
 = 
CONF_UNSET_NUM
;

279 
ı
->
£rv”_çu»_lim™
 = 
CONF_UNSET_NUM
;

281 
	`¬¿y_nuÎ
(&
ı
->
£rv”
);

283 
ı
->
v®id
 = 0;

285 
¡©us
 = 
	`¡ršg_du¶iÿ‹
(&
ı
->
Çme
,‚ame);

286 ià(
¡©us
 !ğ
NC_OK
) {

287  
¡©us
;

290 
¡©us
 = 
	`¬¿y_š™
(&
ı
->
£rv”
, 
CONF_DEFAULT_SERVERS
,

291 (
cÚf_£rv”
));

292 ià(
¡©us
 !ğ
NC_OK
) {

293 
	`¡ršg_deš™
(&
ı
->
Çme
);

294  
¡©us
;

297 
	`log_debug
(
LOG_VVERB
, "š™ cÚàpoŞ %p, '%.*s'", 
ı
, 
Çme
->
Ën
,‚ame->
d©a
);

299  
NC_OK
;

300 
	}
}

303 
	$cÚf_poŞ_deš™
(
cÚf_poŞ
 *
ı
)

305 
	`¡ršg_deš™
(&
ı
->
Çme
);

307 
	`¡ršg_deš™
(&
ı
->
li¡’
.
²ame
);

308 
	`¡ršg_deš™
(&
ı
->
li¡’
.
Çme
);

310 ià(
ı
->
»dis_auth
.
Ën
 > 0) {

311 
	`¡ršg_deš™
(&
ı
->
»dis_auth
);

314 
	`¬¿y_n
(&
ı
->
£rv”
) != 0) {

315 
	`cÚf_£rv”_deš™
(
	`¬¿y_pİ
(&
ı
->
£rv”
));

317 
	`¬¿y_deš™
(&
ı
->
£rv”
);

319 
	`¬¿y_n
(&
ı
->
´ox›s
) != 0) {

321 
	`cÚf_£rv”_deš™
(
	`¬¿y_pİ
(&
ı
->
´ox›s
));

323 
	`¬¿y_deš™
(&
ı
->
´ox›s
);

325 
	`¬¿y_n
(&
ı
->
sh¬ds
) != 0) {

326 
	`cÚf_sh¬d_deš™
(
	`¬¿y_pİ
(&
ı
->
sh¬ds
));

328 
	`¬¿y_deš™
(&
ı
->
sh¬ds
);

330 
	`log_debug
(
LOG_VVERB
, "deš™ cÚàpoŞ %p", 
ı
);

331 
	}
}

333 
r¡©us_t


334 
	$cÚf_poŞ_—ch_ŒªsfÜm
(*
–em
, *
d©a
)

336 
r¡©us_t
 
¡©us
;

337 
cÚf_poŞ
 *
ı
 = 
–em
;

338 
¬¿y
 *
£rv”_poŞ
 = 
d©a
;

339 
£rv”_poŞ
 *
¥
;

341 
	`ASSERT
(
ı
->
v®id
);

343 
¥
 = 
	`¬¿y_push
(
£rv”_poŞ
);

344 
	`ASSERT
(
¥
 !ğ
NULL
);

346 
¥
->
idx
 = 
	`¬¿y_idx
(
£rv”_poŞ
, sp);

347 
¥
->
ùx
 = 
NULL
;

349 
¥
->
p_cÚn
 = 
NULL
;

350 
¥
->
nc_cÚn_q
 = 0;

351 
	`TAILQ_INIT
(&
¥
->
c_cÚn_q
);

353 
	`¬¿y_nuÎ
(&
¥
->
£rv”
);

354 
¥
->
ncÚtšuum
 = 0;

355 
¥
->
n£rv”_cÚtšuum
 = 0;

356 
¥
->
cÚtšuum
 = 
NULL
;

357 
¥
->
Æive_£rv”
 = 0;

358 
¥
->
Ãxt_»bud
 = 0LL;

360 
¥
->
Çme
 = 
ı
->name;

361 
¥
->
addr¡r
 = 
ı
->
li¡’
.
²ame
;

362 
¥
->
pÜt
 = (
ušt16_t
)
ı
->
li¡’
.port;

364 
	`nc_memıy
(&
¥
->
šfo
, &
ı
->
li¡’
.info, (cp->listen.info));

365 
¥
->
³rm
 = 
ı
->
li¡’
.perm;

367 
¥
->
key_hash_ty³
 = 
ı
->
hash
;

368 
¥
->
key_hash
 = 
hash_®gos
[
ı
->
hash
];

369 
¥
->
di¡_ty³
 = 
ı
->
di¡ributiÚ
;

370 
¥
->
hash_g
 = 
ı
->hash_tag;

372 
¥
->
tık“·live
 = 
ı
->tcpkeepalive ? 1 : 0;

374 
¥
->
»dis
 = 
ı
->redis ? 1 : 0;

375 
¥
->
timeout
 = 
ı
->timeout;

376 
¥
->
backlog
 = 
ı
->backlog;

377 
¥
->
»dis_db
 = 
ı
->redis_db;

379 
¥
->
»dis_auth
 = 
ı
->redis_auth;

380 
¥
->
»quœe_auth
 = 
ı
->
»dis_auth
.
Ën
 > 0 ? 1 : 0;

382 
¥
->
ş›Á_cÚÃùiÚs
 = (
ušt32_t
)
ı
->client_connections;

383 
¥
->
£rv”_cÚÃùiÚs
 = (
ušt32_t
)
ı
->server_connections;

384 
¥
->
£rv”_»Œy_timeout
 = (
št64_t
)
ı
->server_retry_timeout * 1000LL;

385 
¥
->
£rv”_çu»_lim™
 = (
ušt32_t
)
ı
->server_failure_limit;

386 
¥
->
auto_ejeù_ho¡s
 = 
ı
->auto_eject_hosts ? 1 : 0;

387 
¥
->
´ecÚÃù
 = 
ı
->preconnect ? 1 : 0;

390 
	`±h»ad_mu‹x_š™
(&
¥
->
lock
, 
NULL
);

399 
¥
->
sh¬d_¿nge_mš
 = 
ı
->shard_range_min;

400 
¥
->
sh¬d_¿nge_max
 = 
ı
->shard_range_max;

402 
	`log_debug
(
LOG_VERB
, "ŒªsfÜmØpoŞ %"
PRIu32
" '%.*s'", 
¥
->
idx
,

403 
¥
->
Çme
.
Ën
, sp->Çme.
d©a
);

406 
	`log_debug
(
LOG_NOTICE
, "š™ sh¬d ©…oŞ %d (\"%s\")", 
¥
->
idx
, sp->
Çme
.
d©a
);

409 
	`¬¿y_š™
(&
¥
->
sh¬ds
, 16, (
sh¬d
));

411 
¡©us
 = 
	`cÚf_sh¬ds_to_£rv”_sh¬ds
(&
ı
->
sh¬ds
, &
¥
->shards, sp);

412 ià(
¡©us
 !ğ
NC_OK
) {

413  
¡©us
;

416 
sh¬d
* 
¤v_sd
 = 
NULL
;

417 
ušt32_t
 
i
 = 0; i < 
	`¬¿y_n
(&
¥
->
sh¬ds
); i++) {

418 
¤v_sd
 = (
sh¬d
*è
	`¬¿y_g‘
(&
¥
->
sh¬ds
, 
i
);

419 
	`di¥Ïy_£rv”_sh¬d
(
¤v_sd
);

422 
	`dump_£rv”_poŞ
(
¥
);

424  
NC_OK
;

425 
	}
}

428 
	$cÚf_dump
(
cÚf
 *
cf
)

430 
ušt32_t
 
i
, 
j
, 
ÅoŞ
, 
n£rv”
;

431 
cÚf_poŞ
 *
ı
;

432 
¡ršg
 *
s
;

434 
ÅoŞ
 = 
	`¬¿y_n
(&
cf
->
poŞ
);

435 ià(
ÅoŞ
 == 0) {

439 
	`log_debug
(
LOG_VVERB
, "%"
PRIu32
"…oŞ š cÚfigu¿tiÚ f'%s'", 
ÅoŞ
,

440 
cf
->
âame
);

442 
i
 = 0; i < 
ÅoŞ
; i++) {

443 
ı
 = 
	`¬¿y_g‘
(&
cf
->
poŞ
, 
i
);

445 
	`log_debug
(
LOG_VVERB
, "%.*s", 
ı
->
Çme
.
Ën
, cp->Çme.
d©a
);

446 
	`log_debug
(
LOG_VVERB
, "†isten: %.*s",

447 
ı
->
li¡’
.
²ame
.
Ën
, cp->li¡’.²ame.
d©a
);

448 
	`log_debug
(
LOG_VVERB
, "imeout: %d", 
ı
->
timeout
);

449 
	`log_debug
(
LOG_VVERB
, " backlog: %d", 
ı
->
backlog
);

450 
	`log_debug
(
LOG_VVERB
, " hash: %d", 
ı
->
hash
);

451 
	`log_debug
(
LOG_VVERB
, " hash_g: \"%.*s\"", 
ı
->
hash_g
.
Ën
,

452 
ı
->
hash_g
.
d©a
);

453 
	`log_debug
(
LOG_VVERB
, " di¡ributiÚ: %d", 
ı
->
di¡ributiÚ
);

454 
	`log_debug
(
LOG_VVERB
, " client_connections: %d",

455 
ı
->
ş›Á_cÚÃùiÚs
);

456 
	`log_debug
(
LOG_VVERB
, "„edis: %d", 
ı
->
»dis
);

457 
	`log_debug
(
LOG_VVERB
, "…»cÚÃù: %d", 
ı
->
´ecÚÃù
);

458 
	`log_debug
(
LOG_VVERB
, "‡uto_ejeù_ho¡s: %d", 
ı
->
auto_ejeù_ho¡s
);

459 
	`log_debug
(
LOG_VVERB
, " server_connections: %d",

460 
ı
->
£rv”_cÚÃùiÚs
);

461 
	`log_debug
(
LOG_VVERB
, " server_retry_timeout: %d",

462 
ı
->
£rv”_»Œy_timeout
);

463 
	`log_debug
(
LOG_VVERB
, " server_failure_limit: %d",

464 
ı
->
£rv”_çu»_lim™
);

466 
n£rv”
 = 
	`¬¿y_n
(&
ı
->
£rv”
);

467 
	`log_debug
(
LOG_VVERB
, " s”v”s: %"
PRIu32
"", 
n£rv”
);

469 
j
 = 0; j < 
n£rv”
; j++) {

470 
s
 = 
	`¬¿y_g‘
(&
ı
->
£rv”
, 
j
);

471 
	`log_debug
(
LOG_VVERB
, " %.*s", 
s
->
Ën
, s->
d©a
);

474 
	}
}

476 
r¡©us_t


477 
	$cÚf_yaml_š™
(
cÚf
 *
cf
)

479 
rv
;

481 
	`ASSERT
(!
cf
->
v®id_·r£r
);

483 
rv
 = 
	`f£ek
(
cf
->
fh
, 0L, 
SEEK_SET
);

484 ià(
rv
 < 0) {

485 
	`log_”rÜ
("conf: failedo seekohe beginning of file '%s': %s",

486 
cf
->
âame
, 
	`¡»¼Ü
(
”ºo
));

487  
NC_ERROR
;

490 
rv
 = 
	`yaml_·r£r_š™Ÿlize
(&
cf
->
·r£r
);

491 ià(!
rv
) {

492 
	`log_”rÜ
("conf: failed (err %d)o initialize yaml…arser",

493 
cf
->
·r£r
.
”rÜ
);

494  
NC_ERROR
;

497 
	`yaml_·r£r_£t_šput_fe
(&
cf
->
·r£r
, cf->
fh
);

498 
cf
->
v®id_·r£r
 = 1;

500  
NC_OK
;

501 
	}
}

504 
	$cÚf_yaml_deš™
(
cÚf
 *
cf
)

506 ià(
cf
->
v®id_·r£r
) {

507 
	`yaml_·r£r_d–‘e
(&
cf
->
·r£r
);

508 
cf
->
v®id_·r£r
 = 0;

510 
	}
}

512 
r¡©us_t


513 
	$cÚf_tok’_Ãxt
(
cÚf
 *
cf
)

515 
rv
;

517 
	`ASSERT
(
cf
->
v®id_·r£r
 && !cf->
v®id_tok’
);

519 
rv
 = 
	`yaml_·r£r_sÿn
(&
cf
->
·r£r
, &cf->
tok’
);

520 ià(!
rv
) {

521 
	`log_”rÜ
("cÚf: faed (”¸%dètØsÿÀÃxˆtok’", 
cf
->
·r£r
.
”rÜ
);

522  
NC_ERROR
;

524 
cf
->
v®id_tok’
 = 1;

526  
NC_OK
;

527 
	}
}

530 
	$cÚf_tok’_dÚe
(
cÚf
 *
cf
)

532 
	`ASSERT
(
cf
->
v®id_·r£r
);

534 ià(
cf
->
v®id_tok’
) {

535 
	`yaml_tok’_d–‘e
(&
cf
->
tok’
);

536 
cf
->
v®id_tok’
 = 0;

538 
	}
}

540 
r¡©us_t


541 
	$cÚf_ev’t_Ãxt
(
cÚf
 *
cf
)

543 
rv
;

545 
	`ASSERT
(
cf
->
v®id_·r£r
 && !cf->
v®id_ev’t
);

547 
rv
 = 
	`yaml_·r£r_·r£
(&
cf
->
·r£r
, &cf->
ev’t
);

548 ià(!
rv
) {

549 
	`log_”rÜ
("cÚf: faed (”¸%dètØg‘‚exˆev’t", 
cf
->
·r£r
.
”rÜ
);

550  
NC_ERROR
;

552 
cf
->
v®id_ev’t
 = 1;

554  
NC_OK
;

555 
	}
}

558 
	$cÚf_ev’t_dÚe
(
cÚf
 *
cf
)

560 ià(
cf
->
v®id_ev’t
) {

561 
	`yaml_ev’t_d–‘e
(&
cf
->
ev’t
);

562 
cf
->
v®id_ev’t
 = 0;

564 
	}
}

566 
r¡©us_t


567 
	$cÚf_push_sÿÏr
(
cÚf
 *
cf
)

569 
r¡©us_t
 
¡©us
;

570 
¡ršg
 *
v®ue
;

571 
ušt8_t
 *
sÿÏr
;

572 
ušt32_t
 
sÿÏr_Ën
;

574 
sÿÏr
 = 
cf
->
ev’t
.
d©a
.sÿÏr.
v®ue
;

575 
sÿÏr_Ën
 = (
ušt32_t
)
cf
->
ev’t
.
d©a
.
sÿÏr
.
Ëngth
;

576 ià(
sÿÏr_Ën
 == 0) {

577  
NC_ERROR
;

580 
	`log_debug
(
LOG_VVERB
, "push '%.*s'", 
sÿÏr_Ën
, 
sÿÏr
);

582 
v®ue
 = 
	`¬¿y_push
(&
cf
->
¬g
);

583 ià(
v®ue
 =ğ
NULL
) {

584  
NC_ENOMEM
;

586 
	`¡ršg_š™
(
v®ue
);

588 
¡©us
 = 
	`¡ršg_cİy
(
v®ue
, 
sÿÏr
, 
sÿÏr_Ën
);

589 ià(
¡©us
 !ğ
NC_OK
) {

590 
	`¬¿y_pİ
(&
cf
->
¬g
);

591  
¡©us
;

594  
NC_OK
;

595 
	}
}

598 
	$cÚf_pİ_sÿÏr
(
cÚf
 *
cf
)

600 
¡ršg
 *
v®ue
;

602 
v®ue
 = 
	`¬¿y_pİ
(&
cf
->
¬g
);

603 
	`log_debug
(
LOG_VVERB
, "pİ '%.*s'", 
v®ue
->
Ën
, v®ue->
d©a
);

604 
	`¡ršg_deš™
(
v®ue
);

605 
	}
}

607 
r¡©us_t


608 
	$cÚf_hªdËr
(
cÚf
 *
cf
, *
d©a
)

610 
commªd
 *
cmd
;

611 
¡ršg
 *
key
, *
v®ue
;

612 
ušt32_t
 
Çrg
;

614 ià(
	`¬¿y_n
(&
cf
->
¬g
) == 1) {

615 
v®ue
 = 
	`¬¿y_tİ
(&
cf
->
¬g
);

616 
	`log_debug
(
LOG_VVERB
, "cÚàhªdË¸Ú '%.*s'", 
v®ue
->
Ën
, v®ue->
d©a
);

617  
	`cÚf_poŞ_š™
(
d©a
, 
v®ue
);

620 
Çrg
 = 
	`¬¿y_n
(&
cf
->
¬g
);

621 
v®ue
 = 
	`¬¿y_g‘
(&
cf
->
¬g
, 
Çrg
 - 1);

622 
key
 = 
	`¬¿y_g‘
(&
cf
->
¬g
, 
Çrg
 - 2);

624 
	`log_debug
(
LOG_VVERB
, "cÚàhªdË¸Ú %.*s: %.*s", 
key
->
Ën
, key->
d©a
,

625 
v®ue
->
Ën
, v®ue->
d©a
);

627 
cmd
 = 
cÚf_commªds
; cmd->
Çme
.
Ën
 != 0; cmd++) {

628 *
rv
;

630 ià(
	`¡ršg_com·»
(
key
, &
cmd
->
Çme
) != 0) {

634 
rv
 = 
cmd
->
	`£t
(
cf
, cmd, 
d©a
);

635 ià(
rv
 !ğ
CONF_OK
) {

636 
	`log_”rÜ
("cÚf: dœeùiv\"%.*s\" %s", 
key
->
Ën
, key->
d©a
, 
rv
);

637  
NC_ERROR
;

640  
NC_OK
;

643 
	`log_”rÜ
("cÚf: dœeùiv\"%.*s\" i unknown", 
key
->
Ën
, key->
d©a
);

645  
NC_ERROR
;

646 
	}
}

648 
r¡©us_t


649 
	$cÚf_begš_·r£
(
cÚf
 *
cf
)

651 
r¡©us_t
 
¡©us
;

652 
boŞ
 
dÚe
;

654 
	`ASSERT
(
cf
->
sound
 && !cf->
·r£d
);

655 
	`ASSERT
(
cf
->
d•th
 == 0);

657 
¡©us
 = 
	`cÚf_yaml_š™
(
cf
);

658 ià(
¡©us
 !ğ
NC_OK
) {

659  
¡©us
;

662 
dÚe
 = 
çl£
;

664 
¡©us
 = 
	`cÚf_ev’t_Ãxt
(
cf
);

665 ià(
¡©us
 !ğ
NC_OK
) {

666  
¡©us
;

669 
	`log_debug
(
LOG_VVERB
, "Ãxˆbegšƒv’ˆ%d", 
cf
->
ev’t
.
ty³
);

671 
cf
->
ev’t
.
ty³
) {

672 
YAML_STREAM_START_EVENT
:

673 
YAML_DOCUMENT_START_EVENT
:

676 
YAML_MAPPING_START_EVENT
:

677 
	`ASSERT
(
cf
->
d•th
 < 
CONF_MAX_DEPTH
);

678 
cf
->
d•th
++;

679 
dÚe
 = 
Œue
;

683 
	`NOT_REACHED
();

686 
	`cÚf_ev’t_dÚe
(
cf
);

688 } !
dÚe
);

690  
NC_OK
;

691 
	}
}

693 
r¡©us_t


694 
	$cÚf_’d_·r£
(
cÚf
 *
cf
)

696 
r¡©us_t
 
¡©us
;

697 
boŞ
 
dÚe
;

699 
	`ASSERT
(
cf
->
sound
 && !cf->
·r£d
);

700 
	`ASSERT
(
cf
->
d•th
 == 0);

702 
dÚe
 = 
çl£
;

704 
¡©us
 = 
	`cÚf_ev’t_Ãxt
(
cf
);

705 ià(
¡©us
 !ğ
NC_OK
) {

706  
¡©us
;

709 
	`log_debug
(
LOG_VVERB
, "Ãxˆ’dƒv’ˆ%d", 
cf
->
ev’t
.
ty³
);

711 
cf
->
ev’t
.
ty³
) {

712 
YAML_STREAM_END_EVENT
:

713 
dÚe
 = 
Œue
;

716 
YAML_DOCUMENT_END_EVENT
:

720 
	`NOT_REACHED
();

723 
	`cÚf_ev’t_dÚe
(
cf
);

724 } !
dÚe
);

726 
	`cÚf_yaml_deš™
(
cf
);

728  
NC_OK
;

729 
	}
}

731 
r¡©us_t


732 
	$cÚf_·r£_cÜe
(
cÚf
 *
cf
, *
d©a
)

734 
r¡©us_t
 
¡©us
;

735 
boŞ
 
dÚe
, 
Ëaf
, 
Ãw_poŞ
;

737 
	`ASSERT
(
cf
->
sound
);

739 
¡©us
 = 
	`cÚf_ev’t_Ãxt
(
cf
);

740 ià(
¡©us
 !ğ
NC_OK
) {

741  
¡©us
;

744 
	`log_debug
(
LOG_VVERB
, "Ãxˆev’ˆ%d d•th %"
PRIu32
" seq %d", 
cf
->
ev’t
.
ty³
,

745 
cf
->
d•th
, cf->
£q
);

747 
dÚe
 = 
çl£
;

748 
Ëaf
 = 
çl£
;

749 
Ãw_poŞ
 = 
çl£
;

751 
cf
->
ev’t
.
ty³
) {

752 
YAML_MAPPING_END_EVENT
:

753 
cf
->
d•th
--;

754 ià(
cf
->
d•th
 == 1) {

755 
	`cÚf_pİ_sÿÏr
(
cf
);

756 } ià(
cf
->
d•th
 == 0) {

757 
dÚe
 = 
Œue
;

761 
YAML_MAPPING_START_EVENT
:

762 
cf
->
d•th
++;

765 
YAML_SEQUENCE_START_EVENT
:

766 
cf
->
£q
 = 1;

769 
YAML_SEQUENCE_END_EVENT
:

770 
	`cÚf_pİ_sÿÏr
(
cf
);

771 
cf
->
£q
 = 0;

774 
YAML_SCALAR_EVENT
:

775 
¡©us
 = 
	`cÚf_push_sÿÏr
(
cf
);

776 ià(
¡©us
 !ğ
NC_OK
) {

781 ià(
cf
->
£q
) {

783 
	`ASSERT
(
cf
->
d•th
 =ğ
CONF_MAX_DEPTH
);

784 
Ëaf
 = 
Œue
;

785 } ià(
cf
->
d•th
 =ğ
CONF_ROOT_DEPTH
) {

787 
d©a
 = 
	`¬¿y_push
(&
cf
->
poŞ
);

788 ià(
d©a
 =ğ
NULL
) {

789 
¡©us
 = 
NC_ENOMEM
;

792 
Ãw_poŞ
 = 
Œue
;

793 } ià(
	`¬¿y_n
(&
cf
->
¬g
è=ğcf->
d•th
 + 1) {

795 
	`ASSERT
(
cf
->
d•th
 =ğ
CONF_MAX_DEPTH
);

796 
Ëaf
 = 
Œue
;

801 
	`NOT_REACHED
();

805 
	`cÚf_ev’t_dÚe
(
cf
);

807 ià(
¡©us
 !ğ
NC_OK
) {

808  
¡©us
;

811 ià(
dÚe
) {

813  
NC_OK
;

816 ià(
Ëaf
 || 
Ãw_poŞ
) {

817 
¡©us
 = 
	`cÚf_hªdËr
(
cf
, 
d©a
);

819 ià(
Ëaf
) {

820 
	`cÚf_pİ_sÿÏr
(
cf
);

821 ià(!
cf
->
£q
) {

822 
	`cÚf_pİ_sÿÏr
(
cf
);

826 ià(
¡©us
 !ğ
NC_OK
) {

827  
¡©us
;

831  
	`cÚf_·r£_cÜe
(
cf
, 
d©a
);

832 
	}
}

834 
r¡©us_t


835 
	$cÚf_·r£
(
cÚf
 *
cf
)

837 
r¡©us_t
 
¡©us
;

839 
	`ASSERT
(
cf
->
sound
 && !cf->
·r£d
);

840 
	`ASSERT
(
	`¬¿y_n
(&
cf
->
¬g
) == 0);

842 
¡©us
 = 
	`cÚf_begš_·r£
(
cf
);

843 ià(
¡©us
 !ğ
NC_OK
) {

844  
¡©us
;

847 
¡©us
 = 
	`cÚf_·r£_cÜe
(
cf
, 
NULL
);

848 ià(
¡©us
 !ğ
NC_OK
) {

849  
¡©us
;

852 
¡©us
 = 
	`cÚf_’d_·r£
(
cf
);

853 ià(
¡©us
 !ğ
NC_OK
) {

854  
¡©us
;

857 
cf
->
·r£d
 = 1;

859  
NC_OK
;

860 
	}
}

862 
cÚf
 *

863 
	$cÚf_İ’
(*
f’ame
)

865 
r¡©us_t
 
¡©us
;

866 
cÚf
 *
cf
;

867 
FILE
 *
fh
;

869 
fh
 = 
	`fİ’
(
f’ame
, "r");

870 ià(
fh
 =ğ
NULL
) {

871 
	`log_”rÜ
("cÚf: faedØİ’ cÚfigu¿tiÚ '%s': %s", 
f’ame
,

872 
	`¡»¼Ü
(
”ºo
));

873  
NULL
;

876 
cf
 = 
	`nc_®loc
((*cf));

877 ià(
cf
 =ğ
NULL
) {

878 
	`fşo£
(
fh
);

879  
NULL
;

881 
	`mem£t
(
cf
, 0, (*cf));

883 
¡©us
 = 
	`¬¿y_š™
(&
cf
->
¬g
, 
CONF_DEFAULT_ARGS
, (
¡ršg
));

884 ià(
¡©us
 !ğ
NC_OK
) {

885 
	`nc_ä“
(
cf
);

886 
	`fşo£
(
fh
);

887  
NULL
;

890 
¡©us
 = 
	`¬¿y_š™
(&
cf
->
poŞ
, 
CONF_DEFAULT_POOL
, (
cÚf_poŞ
));

891 ià(
¡©us
 !ğ
NC_OK
) {

892 
	`¬¿y_deš™
(&
cf
->
¬g
);

893 
	`nc_ä“
(
cf
);

894 
	`fşo£
(
fh
);

895  
NULL
;

898 
cf
->
âame
 = 
f’ame
;

899 
cf
->
fh
 = fh;

900 
cf
->
d•th
 = 0;

902 
cf
->
£q
 = 0;

903 
cf
->
v®id_·r£r
 = 0;

904 
cf
->
v®id_ev’t
 = 0;

905 
cf
->
v®id_tok’
 = 0;

906 
cf
->
sound
 = 0;

907 
cf
->
·r£d
 = 0;

908 
cf
->
v®id
 = 0;

910 
	`log_debug
(
LOG_VVERB
, "İ’ed cÚà'%s'", 
f’ame
);

912  
cf
;

913 
	}
}

915 
r¡©us_t


916 
	$cÚf_v®id©e_docum’t
(
cÚf
 *
cf
)

918 
r¡©us_t
 
¡©us
;

919 
ušt32_t
 
couÁ
;

920 
boŞ
 
dÚe
;

922 
¡©us
 = 
	`cÚf_yaml_š™
(
cf
);

923 ià(
¡©us
 !ğ
NC_OK
) {

924  
¡©us
;

927 
couÁ
 = 0;

928 
dÚe
 = 
çl£
;

930 
yaml_docum’t_t
 
docum’t
;

931 
yaml_node_t
 *
node
;

932 
rv
;

934 
rv
 = 
	`yaml_·r£r_lßd
(&
cf
->
·r£r
, &
docum’t
);

935 ià(!
rv
) {

936 
	`log_”rÜ
("conf: failed (err %d)o gethe‚ext yaml document",

937 
cf
->
·r£r
.
”rÜ
);

938 
	`cÚf_yaml_deš™
(
cf
);

939  
NC_ERROR
;

942 
node
 = 
	`yaml_docum’t_g‘_roÙ_node
(&
docum’t
);

943 ià(
node
 =ğ
NULL
) {

944 
dÚe
 = 
Œue
;

946 
couÁ
++;

949 
	`yaml_docum’t_d–‘e
(&
docum’t
);

950 } !
dÚe
);

952 
	`cÚf_yaml_deš™
(
cf
);

954 ià(
couÁ
 != 1) {

955 
	`log_”rÜ
("cÚf: '%s' mu¡ cÚš oÆy 1 docum’t; found %"
PRIu32
" "

956 "docum’ts", 
cf
->
âame
, 
couÁ
);

957  
NC_ERROR
;

960  
NC_OK
;

961 
	}
}

963 
r¡©us_t


964 
	$cÚf_v®id©e_tok’s
(
cÚf
 *
cf
)

966 
r¡©us_t
 
¡©us
;

967 
boŞ
 
dÚe
, 
”rÜ
;

968 
ty³
;

970 
¡©us
 = 
	`cÚf_yaml_š™
(
cf
);

971 ià(
¡©us
 !ğ
NC_OK
) {

972  
¡©us
;

975 
dÚe
 = 
çl£
;

976 
”rÜ
 = 
çl£
;

978 
¡©us
 = 
	`cÚf_tok’_Ãxt
(
cf
);

979 ià(
¡©us
 !ğ
NC_OK
) {

980  
¡©us
;

982 
ty³
 = 
cf
->
tok’
.type;

984 
ty³
) {

985 
YAML_NO_TOKEN
:

986 
”rÜ
 = 
Œue
;

987 
	`log_”rÜ
("cÚf:‚Øtok’ (%dèi di§Îowed", 
ty³
);

990 
YAML_VERSION_DIRECTIVE_TOKEN
:

991 
”rÜ
 = 
Œue
;

992 
	`log_”rÜ
("cÚf: v”siÚ dœeùivtok’ (%dèi di§Îowed", 
ty³
);

995 
YAML_TAG_DIRECTIVE_TOKEN
:

996 
”rÜ
 = 
Œue
;

997 
	`log_”rÜ
("cÚf:ag dœeùivtok’ (%dèi di§Îowed", 
ty³
);

1000 
YAML_DOCUMENT_START_TOKEN
:

1001 
”rÜ
 = 
Œue
;

1002 
	`log_”rÜ
("cÚf: docum’ˆ¡¬ˆtok’ (%dèi di§Îowed", 
ty³
);

1005 
YAML_DOCUMENT_END_TOKEN
:

1006 
”rÜ
 = 
Œue
;

1007 
	`log_”rÜ
("cÚf: docum’ˆ’dok’ (%dèi di§Îowed", 
ty³
);

1010 
YAML_FLOW_SEQUENCE_START_TOKEN
:

1011 
”rÜ
 = 
Œue
;

1012 
	`log_”rÜ
("cÚf: flow sequ’û s¹ok’ (%dèi di§Îowed", 
ty³
);

1015 
YAML_FLOW_SEQUENCE_END_TOKEN
:

1016 
”rÜ
 = 
Œue
;

1017 
	`log_”rÜ
("cÚf: flow sequ’ûƒndok’ (%dèi di§Îowed", 
ty³
);

1020 
YAML_FLOW_MAPPING_START_TOKEN
:

1021 
”rÜ
 = 
Œue
;

1022 
	`log_”rÜ
("cÚf: flow m­pšg s¹ok’ (%dèi di§Îowed", 
ty³
);

1025 
YAML_FLOW_MAPPING_END_TOKEN
:

1026 
”rÜ
 = 
Œue
;

1027 
	`log_”rÜ
("cÚf: flow m­pšgƒndok’ (%dèi di§Îowed", 
ty³
);

1030 
YAML_FLOW_ENTRY_TOKEN
:

1031 
”rÜ
 = 
Œue
;

1032 
	`log_”rÜ
("cÚf: flowƒÁryok’ (%dèi di§Îowed", 
ty³
);

1035 
YAML_ALIAS_TOKEN
:

1036 
”rÜ
 = 
Œue
;

1037 
	`log_”rÜ
("cÚf:‡lŸ tok’ (%dèi di§Îowed", 
ty³
);

1040 
YAML_ANCHOR_TOKEN
:

1041 
”rÜ
 = 
Œue
;

1042 
	`log_”rÜ
("cÚf:‡nchÜok’ (%dèi di§Îowed", 
ty³
);

1045 
YAML_TAG_TOKEN
:

1046 
”rÜ
 = 
Œue
;

1047 
	`log_”rÜ
("cÚf:agok’ (%dèi di§Îowed", 
ty³
);

1050 
YAML_BLOCK_SEQUENCE_START_TOKEN
:

1051 
YAML_BLOCK_MAPPING_START_TOKEN
:

1052 
YAML_BLOCK_END_TOKEN
:

1053 
YAML_BLOCK_ENTRY_TOKEN
:

1056 
YAML_KEY_TOKEN
:

1057 
YAML_VALUE_TOKEN
:

1058 
YAML_SCALAR_TOKEN
:

1061 
YAML_STREAM_START_TOKEN
:

1064 
YAML_STREAM_END_TOKEN
:

1065 
dÚe
 = 
Œue
;

1066 
	`log_debug
(
LOG_VVERB
, "cÚà'%s' ha v®idok’s", 
cf
->
âame
);

1070 
”rÜ
 = 
Œue
;

1071 
	`log_”rÜ
("cÚf: unknowÀtok’ (%dèi di§Îowed", 
ty³
);

1075 
	`cÚf_tok’_dÚe
(
cf
);

1076 } !
dÚe
 && !
”rÜ
);

1078 
	`cÚf_yaml_deš™
(
cf
);

1080  !
”rÜ
 ? 
NC_OK
 : 
NC_ERROR
;

1081 
	}
}

1083 
r¡©us_t


1084 
	$cÚf_v®id©e_¡ruùu»
(
cÚf
 *
cf
)

1086 
r¡©us_t
 
¡©us
;

1087 
ty³
, 
d•th
;

1088 
ušt32_t
 
i
, 
couÁ
[
CONF_MAX_DEPTH
 + 1];

1089 
boŞ
 
dÚe
, 
”rÜ
, 
£q
;

1091 
¡©us
 = 
	`cÚf_yaml_š™
(
cf
);

1092 ià(
¡©us
 !ğ
NC_OK
) {

1093  
¡©us
;

1096 
dÚe
 = 
çl£
;

1097 
”rÜ
 = 
çl£
;

1098 
£q
 = 
çl£
;

1099 
d•th
 = 0;

1100 
i
 = 0; i < 
CONF_MAX_DEPTH
 + 1; i++) {

1101 
couÁ
[
i
] = 0;

1127 
¡©us
 = 
	`cÚf_ev’t_Ãxt
(
cf
);

1128 ià(
¡©us
 !ğ
NC_OK
) {

1129  
¡©us
;

1132 
ty³
 = 
cf
->
ev’t
.type;

1134 
	`log_debug
(
LOG_VVERB
, "Ãxˆev’ˆ%d d•th %d seq %d", 
ty³
, 
d•th
, 
£q
);

1136 
ty³
) {

1137 
YAML_STREAM_START_EVENT
:

1138 
YAML_DOCUMENT_START_EVENT
:

1141 
YAML_DOCUMENT_END_EVENT
:

1144 
YAML_STREAM_END_EVENT
:

1145 
dÚe
 = 
Œue
;

1148 
YAML_MAPPING_START_EVENT
:

1149 ià(
d•th
 =ğ
CONF_ROOT_DEPTH
 && 
couÁ
[depth] != 1) {

1150 
”rÜ
 = 
Œue
;

1151 
	`log_”rÜ
("conf: '%s' has morehan one \"key:value\"‡t depth"

1152 " %d", 
cf
->
âame
, 
d•th
);

1153 } ià(
d•th
 >ğ
CONF_MAX_DEPTH
) {

1154 
”rÜ
 = 
Œue
;

1155 
	`log_”rÜ
("cÚf: '%s' ha ¨d•th g»©”hª %d", 
cf
->
âame
,

1156 
CONF_MAX_DEPTH
);

1158 
d•th
++;

1161 
YAML_MAPPING_END_EVENT
:

1162 ià(
d•th
 =ğ
CONF_MAX_DEPTH
) {

1163 ià(
£q
) {

1164 
£q
 = 
çl£
;

1166 
”rÜ
 = 
Œue
;

1167 
	`log_”rÜ
("conf: '%s' missing sequence directive‡t depth "

1168 "%d", 
cf
->
âame
, 
d•th
);

1171 
d•th
--;

1172 
couÁ
[
d•th
] = 0;

1175 
YAML_SEQUENCE_START_EVENT
:

1176 ià(
£q
) {

1177 
”rÜ
 = 
Œue
;

1178 
	`log_”rÜ
("conf: '%s' has morehan one sequence directive",

1179 
cf
->
âame
);

1180 } ià(
d•th
 !ğ
CONF_MAX_DEPTH
) {

1181 
”rÜ
 = 
Œue
;

1182 
	`log_”rÜ
("conf: '%s' has sequence‡t depth %d instead of %d",

1183 
cf
->
âame
, 
d•th
, 
CONF_MAX_DEPTH
);

1184 } ià(
couÁ
[
d•th
] != 1) {

1185 
”rÜ
 = 
Œue
;

1186 
	`log_”rÜ
("conf: '%s' has invalid \"key:value\"‡t depth %d",

1187 
cf
->
âame
, 
d•th
);

1189 
£q
 = 
Œue
;

1192 
YAML_SEQUENCE_END_EVENT
:

1193 
	`ASSERT
(
d•th
 =ğ
CONF_MAX_DEPTH
);

1194 
couÁ
[
d•th
] = 0;

1197 
YAML_SCALAR_EVENT
:

1198 ià(
d•th
 == 0) {

1199 
”rÜ
 = 
Œue
;

1200 
	`log_”rÜ
("conf: '%s' has invalidƒmpty \"key:\"‡t depth %d",

1201 
cf
->
âame
, 
d•th
);

1202 } ià(
d•th
 =ğ
CONF_ROOT_DEPTH
 && 
couÁ
[depth] != 0) {

1203 
”rÜ
 = 
Œue
;

1204 
	`log_”rÜ
("conf: '%s' has invalid mapping \"key:\"‡t depth %d",

1205 
cf
->
âame
, 
d•th
);

1206 } ià(
d•th
 =ğ
CONF_MAX_DEPTH
 && 
couÁ
[depth] == 2) {

1208 
couÁ
[
d•th
] = 0;

1210 
couÁ
[
d•th
]++;

1214 
	`NOT_REACHED
();

1217 
	`cÚf_ev’t_dÚe
(
cf
);

1218 } !
dÚe
 && !
”rÜ
);

1220 
	`cÚf_yaml_deš™
(
cf
);

1222  !
”rÜ
 ? 
NC_OK
 : 
NC_ERROR
;

1223 
	}
}

1225 
r¡©us_t


1226 
	$cÚf_´e_v®id©e
(
cÚf
 *
cf
)

1228 
r¡©us_t
 
¡©us
;

1230 
¡©us
 = 
	`cÚf_v®id©e_docum’t
(
cf
);

1231 ià(
¡©us
 !ğ
NC_OK
) {

1232  
¡©us
;

1235 
¡©us
 = 
	`cÚf_v®id©e_tok’s
(
cf
);

1236 ià(
¡©us
 !ğ
NC_OK
) {

1237  
¡©us
;

1240 
¡©us
 = 
	`cÚf_v®id©e_¡ruùu»
(
cf
);

1241 ià(
¡©us
 !ğ
NC_OK
) {

1242  
¡©us
;

1245 
cf
->
sound
 = 1;

1247  
NC_OK
;

1248 
	}
}

1251 
	$cÚf_£rv”_Çme_cmp
(cÚ¡ *
t1
, cÚ¡ *
t2
)

1253 cÚ¡ 
cÚf_£rv”
 *
s1
 = 
t1
, *
s2
 = 
t2
;

1255  
	`¡ršg_com·»
(&
s1
->
Çme
, &
s2
->name);

1256 
	}
}

1259 
	$cÚf_poŞ_Çme_cmp
(cÚ¡ *
t1
, cÚ¡ *
t2
)

1261 cÚ¡ 
cÚf_poŞ
 *
p1
 = 
t1
, *
p2
 = 
t2
;

1263  
	`¡ršg_com·»
(&
p1
->
Çme
, &
p2
->name);

1264 
	}
}

1267 
	$cÚf_poŞ_li¡’_cmp
(cÚ¡ *
t1
, cÚ¡ *
t2
)

1269 cÚ¡ 
cÚf_poŞ
 *
p1
 = 
t1
, *
p2
 = 
t2
;

1271  
	`¡ršg_com·»
(&
p1
->
li¡’
.
²ame
, &
p2
->listen.pname);

1272 
	}
}

1274 
r¡©us_t


1275 
	$cÚf_v®id©e_£rv”
(
cÚf
 *
cf
, 
cÚf_poŞ
 *
ı
)

1277 
ušt32_t
 
i
, 
n£rv”
;

1278 
boŞ
 
v®id
;

1280 
n£rv”
 = 
	`¬¿y_n
(&
ı
->
£rv”
);

1281 ià(
n£rv”
 == 0) {

1282 
	`log_”rÜ
("cÚf:…oŞ '%.*s' ha nØ£rv”s", 
ı
->
Çme
.
Ën
,

1283 
ı
->
Çme
.
d©a
);

1284  
NC_ERROR
;

1293 
	`¬¿y_sÜt
(&
ı
->
£rv”
, 
cÚf_£rv”_Çme_cmp
);

1294 
v®id
 = 
Œue
, 
i
 = 0; i < 
n£rv”
 - 1; i++) {

1295 
cÚf_£rv”
 *
cs1
, *
cs2
;

1297 
cs1
 = 
	`¬¿y_g‘
(&
ı
->
£rv”
, 
i
);

1298 
cs2
 = 
	`¬¿y_g‘
(&
ı
->
£rv”
, 
i
 + 1);

1300 ià(
	`¡ršg_com·»
(&
cs1
->
Çme
, &
cs2
->name) == 0) {

1301 
	`log_”rÜ
("conf:…ool '%.*s' has servers with same‚ame '%.*s'",

1302 
ı
->
Çme
.
Ën
, cp->Çme.
d©a
, 
cs1
->name.len,

1303 
cs1
->
Çme
.
d©a
);

1304 
v®id
 = 
çl£
;

1308 ià(!
v®id
) {

1309  
NC_ERROR
;

1312  
NC_OK
;

1313 
	}
}

1315 
r¡©us_t


1316 
	$cÚf_v®id©e_poŞ
(
cÚf
 *
cf
, 
cÚf_poŞ
 *
ı
)

1318 
r¡©us_t
 
¡©us
;

1320 
	`ASSERT
(!
ı
->
v®id
);

1321 
	`ASSERT
(!
	`¡ršg_em±y
(&
ı
->
Çme
));

1323 ià(!
ı
->
li¡’
.
v®id
) {

1324 
	`log_”rÜ
("conf: directive \"listen:\" is missing");

1325  
NC_ERROR
;

1330 ià(
ı
->
di¡ributiÚ
 =ğ
CONF_UNSET_DIST
) {

1331 
ı
->
di¡ributiÚ
 = 
CONF_DEFAULT_DIST
;

1334 ià(
ı
->
hash
 =ğ
CONF_UNSET_HASH
) {

1335 
ı
->
hash
 = 
CONF_DEFAULT_HASH
;

1338 ià(
ı
->
timeout
 =ğ
CONF_UNSET_NUM
) {

1339 
ı
->
timeout
 = 
CONF_DEFAULT_TIMEOUT
;

1342 ià(
ı
->
backlog
 =ğ
CONF_UNSET_NUM
) {

1343 
ı
->
backlog
 = 
CONF_DEFAULT_LISTEN_BACKLOG
;

1346 
ı
->
ş›Á_cÚÃùiÚs
 = 
CONF_DEFAULT_CLIENT_CONNECTIONS
;

1348 ià(
ı
->
»dis
 =ğ
CONF_UNSET_NUM
) {

1349 
ı
->
»dis
 = 
CONF_DEFAULT_REDIS
;

1352 ià(
ı
->
tık“·live
 =ğ
CONF_UNSET_NUM
) {

1353 
ı
->
tık“·live
 = 
CONF_DEFAULT_TCPKEEPALIVE
;

1356 ià(
ı
->
»dis_db
 =ğ
CONF_UNSET_NUM
) {

1357 
ı
->
»dis_db
 = 
CONF_DEFAULT_REDIS_DB
;

1360 ià(
ı
->
´ecÚÃù
 =ğ
CONF_UNSET_NUM
) {

1361 
ı
->
´ecÚÃù
 = 
CONF_DEFAULT_PRECONNECT
;

1364 ià(
ı
->
auto_ejeù_ho¡s
 =ğ
CONF_UNSET_NUM
) {

1365 
ı
->
auto_ejeù_ho¡s
 = 
CONF_DEFAULT_AUTO_EJECT_HOSTS
;

1368 ià(
ı
->
£rv”_cÚÃùiÚs
 =ğ
CONF_UNSET_NUM
) {

1369 
ı
->
£rv”_cÚÃùiÚs
 = 
CONF_DEFAULT_SERVER_CONNECTIONS
;

1370 } ià(
ı
->
£rv”_cÚÃùiÚs
 == 0) {

1371 
	`log_”rÜ
("conf: directive \"server_connections:\" cannot be 0");

1372  
NC_ERROR
;

1375 ià(
ı
->
£rv”_»Œy_timeout
 =ğ
CONF_UNSET_NUM
) {

1376 
ı
->
£rv”_»Œy_timeout
 = 
CONF_DEFAULT_SERVER_RETRY_TIMEOUT
;

1379 ià(
ı
->
£rv”_çu»_lim™
 =ğ
CONF_UNSET_NUM
) {

1380 
ı
->
£rv”_çu»_lim™
 = 
CONF_DEFAULT_SERVER_FAILURE_LIMIT
;

1383 ià(!
ı
->
»dis
 && cp->
»dis_auth
.
Ën
 > 0) {

1384 
	`log_”rÜ
("conf: directive \"redis_auth:\" is only valid for‡„edis…ool");

1385  
NC_ERROR
;

1388 
¡©us
 = 
	`cÚf_v®id©e_£rv”
(
cf
, 
ı
);

1389 ià(
¡©us
 !ğ
NC_OK
) {

1390  
¡©us
;

1393 
ı
->
v®id
 = 1;

1395  
NC_OK
;

1396 
	}
}

1398 
r¡©us_t


1399 
	$cÚf_po¡_v®id©e
(
cÚf
 *
cf
)

1401 
r¡©us_t
 
¡©us
;

1402 
ušt32_t
 
i
, 
ÅoŞ
;

1403 
boŞ
 
v®id
;

1405 
	`ASSERT
(
cf
->
sound
 && cf->
·r£d
);

1406 
	`ASSERT
(!
cf
->
v®id
);

1408 
ÅoŞ
 = 
	`¬¿y_n
(&
cf
->
poŞ
);

1409 ià(
ÅoŞ
 == 0) {

1410 
	`log_”rÜ
("cÚf: '%.*s' ha nØpoŞs", 
cf
->
âame
);

1411  
NC_ERROR
;

1415 
i
 = 0; i < 
ÅoŞ
; i++) {

1416 
cÚf_poŞ
 *
ı
 = 
	`¬¿y_g‘
(&
cf
->
poŞ
, 
i
);

1418 
¡©us
 = 
	`cÚf_v®id©e_poŞ
(
cf
, 
ı
);

1419 ià(
¡©us
 !ğ
NC_OK
) {

1420  
¡©us
;

1425 
	`¬¿y_sÜt
(&
cf
->
poŞ
, 
cÚf_poŞ_li¡’_cmp
);

1426 
v®id
 = 
Œue
, 
i
 = 0; i < 
ÅoŞ
 - 1; i++) {

1427 
cÚf_poŞ
 *
p1
, *
p2
;

1429 
p1
 = 
	`¬¿y_g‘
(&
cf
->
poŞ
, 
i
);

1430 
p2
 = 
	`¬¿y_g‘
(&
cf
->
poŞ
, 
i
 + 1);

1432 ià(
	`¡ršg_com·»
(&
p1
->
li¡’
.
²ame
, &
p2
->listen.pname) == 0) {

1433 
	`log_”rÜ
("conf:…ools '%.*s'‡nd '%.*s' havehe same†isten "

1434 "add»s '%.*s'", 
p1
->
Çme
.
Ën
,…1->Çme.
d©a
,

1435 
p2
->
Çme
.
Ën
,…2->Çme.
d©a
, 
p1
->
li¡’
.
²ame
.len,

1436 
p1
->
li¡’
.
²ame
.
d©a
);

1437 
v®id
 = 
çl£
;

1441 ià(!
v®id
) {

1442  
NC_ERROR
;

1446 
	`¬¿y_sÜt
(&
cf
->
poŞ
, 
cÚf_poŞ_Çme_cmp
);

1447 
v®id
 = 
Œue
, 
i
 = 0; i < 
ÅoŞ
 - 1; i++) {

1448 
cÚf_poŞ
 *
p1
, *
p2
;

1450 
p1
 = 
	`¬¿y_g‘
(&
cf
->
poŞ
, 
i
);

1451 
p2
 = 
	`¬¿y_g‘
(&
cf
->
poŞ
, 
i
 + 1);

1453 ià(
	`¡ršg_com·»
(&
p1
->
Çme
, &
p2
->name) == 0) {

1454 
	`log_”rÜ
("cÚf: '%s' ha poŞ w™h samÇm%.*s'", 
cf
->
âame
,

1455 
p1
->
Çme
.
Ën
,…1->Çme.
d©a
);

1456 
v®id
 = 
çl£
;

1460 ià(!
v®id
) {

1461  
NC_ERROR
;

1464  
NC_OK
;

1465 
	}
}

1467 
cÚf
 *

1468 
	$cÚf_ü—‹
(*
f’ame
)

1470 
r¡©us_t
 
¡©us
;

1471 
cÚf
 *
cf
;

1473 
cf
 = 
	`cÚf_İ’
(
f’ame
);

1474 ià(
cf
 =ğ
NULL
) {

1475  
NULL
;

1479 
¡©us
 = 
	`cÚf_´e_v®id©e
(
cf
);

1480 ià(
¡©us
 !ğ
NC_OK
) {

1481 
”rÜ
;

1485 
¡©us
 = 
	`cÚf_·r£
(
cf
);

1486 ià(
¡©us
 !ğ
NC_OK
) {

1487 
”rÜ
;

1491 
¡©us
 = 
	`cÚf_po¡_v®id©e
(
cf
);

1492 ià(
¡©us
 !ğ
NC_OK
) {

1493 
”rÜ
;

1496 
	`cÚf_dump
(
cf
);

1498 
	`fşo£
(
cf
->
fh
);

1499 
cf
->
fh
 = 
NULL
;

1501  
cf
;

1503 
”rÜ
:

1504 
	`log_¡d”r
("nutcracker: configuration file '%s' syntax is invalid",

1505 
f’ame
);

1506 
	`fşo£
(
cf
->
fh
);

1507 
cf
->
fh
 = 
NULL
;

1508 
	`cÚf_de¡roy
(
cf
);

1509  
NULL
;

1510 
	}
}

1513 
	$cÚf_de¡roy
(
cÚf
 *
cf
)

1515 ià(!
cf
) ;

1517 
	`¬¿y_n
(&
cf
->
¬g
) != 0) {

1518 
	`cÚf_pİ_sÿÏr
(
cf
);

1520 
	`¬¿y_deš™
(&
cf
->
¬g
);

1522 
i
 = 0;

1523 
	`¬¿y_n
(&
cf
->
poŞ
) != 0) {

1524 
	`log_debug
(
LOG_NOTICE
, "deš™ cÚàpoŞ %d", 
i
++);

1525 
	`cÚf_poŞ_deš™
(
	`¬¿y_pİ
(&
cf
->
poŞ
));

1527 
	`¬¿y_deš™
(&
cf
->
poŞ
);

1529 
	`nc_ä“
(
cf
);

1530 
	}
}

1533 
	$cÚf_£t_¡ršg
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf)

1535 
r¡©us_t
 
¡©us
;

1536 
ušt8_t
 *
p
;

1537 
¡ršg
 *
f›ld
, *
v®ue
;

1539 
p
 = 
cÚf
;

1540 
f›ld
 = (
¡ršg
 *)(
p
 + 
cmd
->
off£t
);

1542 ià(
f›ld
->
d©a
 !ğ
CONF_UNSET_PTR
) {

1546 
v®ue
 = 
	`¬¿y_tİ
(&
cf
->
¬g
);

1548 
¡©us
 = 
	`¡ršg_du¶iÿ‹
(
f›ld
, 
v®ue
);

1549 ià(
¡©us
 !ğ
NC_OK
) {

1550  
CONF_ERROR
;

1553  
CONF_OK
;

1554 
	}
}

1557 
	$cÚf_£t_li¡’
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf)

1559 
r¡©us_t
 
¡©us
;

1560 
¡ršg
 *
v®ue
;

1561 
cÚf_li¡’
 *
f›ld
;

1562 
ušt8_t
 *
p
, *
Çme
;

1563 
ušt32_t
 
Çm–’
;

1565 
p
 = 
cÚf
;

1566 
f›ld
 = (
cÚf_li¡’
 *)(
p
 + 
cmd
->
off£t
);

1568 ià(
f›ld
->
v®id
 == 1) {

1572 
v®ue
 = 
	`¬¿y_tİ
(&
cf
->
¬g
);

1574 
¡©us
 = 
	`¡ršg_du¶iÿ‹
(&
f›ld
->
²ame
, 
v®ue
);

1575 ià(
¡©us
 !ğ
NC_OK
) {

1576  
CONF_ERROR
;

1579 ià(
v®ue
->
d©a
[0] == '/') {

1580 
ušt8_t
 *
q
, *
¡¬t
, *
³rm
;

1581 
ušt32_t
 
³rmËn
;

1585 
p
 = 
v®ue
->
d©a
 + v®ue->
Ën
 -1;

1586 
¡¬t
 = 
v®ue
->
d©a
;

1587 
q
 = 
	`nc_¡¼chr
(
p
, 
¡¬t
, ' ');

1588 ià(
q
 =ğ
NULL
) {

1590 
Çme
 = 
v®ue
->
d©a
;

1591 
Çm–’
 = 
v®ue
->
Ën
;

1593 
³rm
 = 
q
 + 1;

1594 
³rmËn
 = (
ušt32_t
)(
p
 - 
³rm
 + 1);

1596 
p
 = 
q
 - 1;

1597 
Çme
 = 
¡¬t
;

1598 
Çm–’
 = (
ušt32_t
)(
p
 - 
¡¬t
 + 1);

1600 
”ºo
 = 0;

1601 
f›ld
->
³rm
 = (
mode_t
)
	`¡¹Ş
((*í”m, 
NULL
, 8);

1602 ià(
”ºo
 || 
f›ld
->
³rm
 > 0777) {

1607 
ušt8_t
 *
q
, *
¡¬t
, *
pÜt
;

1608 
ušt32_t
 
pÜ’
;

1611 
p
 = 
v®ue
->
d©a
 + v®ue->
Ën
 - 1;

1612 
¡¬t
 = 
v®ue
->
d©a
;

1613 
q
 = 
	`nc_¡¼chr
(
p
, 
¡¬t
, ':');

1614 ià(
q
 =ğ
NULL
) {

1618 
pÜt
 = 
q
 + 1;

1619 
pÜ’
 = (
ušt32_t
)(
p
 - 
pÜt
 + 1);

1621 
p
 = 
q
 - 1;

1623 
Çme
 = 
¡¬t
;

1624 
Çm–’
 = (
ušt32_t
)(
p
 - 
¡¬t
 + 1);

1626 
f›ld
->
pÜt
 = 
	`nc_©oi
ÕÜt, 
pÜ’
);

1627 ià(
f›ld
->
pÜt
 < 0 || !
	`nc_v®id_pÜt
(field->port)) {

1632 
¡©us
 = 
	`¡ršg_cİy
(&
f›ld
->
Çme
,‚ame, 
Çm–’
);

1633 ià(
¡©us
 !ğ
NC_OK
) {

1634  
CONF_ERROR
;

1637 
¡©us
 = 
	`nc_»sŞve
(&
f›ld
->
Çme
, f›ld->
pÜt
, &f›ld->
šfo
);

1638 ià(
¡©us
 !ğ
NC_OK
) {

1639  
CONF_ERROR
;

1642 
f›ld
->
v®id
 = 1;

1644  
CONF_OK
;

1645 
	}
}

1648 
	$cÚf_add_£rv”
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf)

1650 
r¡©us_t
 
¡©us
;

1651 
¬¿y
 *
a
;

1652 
¡ršg
 *
v®ue
;

1653 
cÚf_£rv”
 *
f›ld
;

1654 
ušt8_t
 *
p
, *
q
, *
¡¬t
;

1655 
ušt8_t
 *
²ame
, *
addr
, *
pÜt
, *
weight
, *
Çme
;

1656 
ušt32_t
 
k
, 
d–imËn
, 
²am–’
, 
add¾’
, 
pÜ’
, 
weigh’
, 
Çm–’
;

1657 
d–im
[] = " ::";

1659 
p
 = 
cÚf
;

1660 
a
 = (
¬¿y
 *)(
p
 + 
cmd
->
off£t
);

1662 
f›ld
 = 
	`¬¿y_push
(
a
);

1663 ià(
f›ld
 =ğ
NULL
) {

1664  
CONF_ERROR
;

1667 
	`cÚf_£rv”_š™
(
f›ld
);

1669 
v®ue
 = 
	`¬¿y_tİ
(&
cf
->
¬g
);

1672 
p
 = 
v®ue
->
d©a
 + v®ue->
Ën
 - 1;

1673 
¡¬t
 = 
v®ue
->
d©a
;

1674 
addr
 = 
NULL
;

1675 
add¾’
 = 0;

1676 
weight
 = 
NULL
;

1677 
weigh’
 = 0;

1678 
pÜt
 = 
NULL
;

1679 
pÜ’
 = 0;

1680 
Çme
 = 
NULL
;

1681 
Çm–’
 = 0;

1683 
d–imËn
 = 
v®ue
->
d©a
[0] == '/' ? 2 : 3;

1685 
k
 = 0; k < (
d–im
); k++) {

1686 
q
 = 
	`nc_¡¼chr
(
p
, 
¡¬t
, 
d–im
[
k
]);

1687 ià(
q
 =ğ
NULL
) {

1688 ià(
k
 == 0) {

1698 
k
) {

1700 
Çme
 = 
q
 + 1;

1701 
Çm–’
 = (
ušt32_t
)(
p
 - 
Çme
 + 1);

1705 
weight
 = 
q
 + 1;

1706 
weigh’
 = (
ušt32_t
)(
p
 - 
weight
 + 1);

1710 
pÜt
 = 
q
 + 1;

1711 
pÜ’
 = (
ušt32_t
)(
p
 - 
pÜt
 + 1);

1715 
	`NOT_REACHED
();

1718 
p
 = 
q
 - 1;

1721 ià(
k
 !ğ
d–imËn
) {

1725 
²ame
 = 
v®ue
->
d©a
;

1726 
²am–’
 = 
Çm–’
 > 0 ? 
v®ue
->
Ën
 - (namelen + 1) : value->len;

1727 
¡©us
 = 
	`¡ršg_cİy
(&
f›ld
->
²ame
,…Çme, 
²am–’
);

1728 ià(
¡©us
 !ğ
NC_OK
) {

1729 
	`¬¿y_pİ
(
a
);

1730  
CONF_ERROR
;

1733 
addr
 = 
¡¬t
;

1734 
add¾’
 = (
ušt32_t
)(
p
 - 
¡¬t
 + 1);

1736 
f›ld
->
weight
 = 
	`nc_©oi
(weight, 
weigh’
);

1737 ià(
f›ld
->
weight
 < 0) {

1739 } ià(
f›ld
->
weight
 == 0) {

1743 ià(
v®ue
->
d©a
[0] != '/') {

1744 
f›ld
->
pÜt
 = 
	`nc_©oi
ÕÜt, 
pÜ’
);

1745 ià(
f›ld
->
pÜt
 < 0 || !
	`nc_v®id_pÜt
(field->port)) {

1750 ià(
Çme
 =ğ
NULL
) {

1756 ià(
f›ld
->
pÜt
 =ğ
CONF_DEFAULT_KETAMA_PORT
) {

1757 
Çme
 = 
addr
;

1758 
Çm–’
 = 
add¾’
;

1760 
Çme
 = 
addr
;

1761 
Çm–’
 = 
add¾’
 + 1 + 
pÜ’
;

1765 
¡©us
 = 
	`¡ršg_cİy
(&
f›ld
->
Çme
,‚ame, 
Çm–’
);

1766 ià(
¡©us
 !ğ
NC_OK
) {

1767  
CONF_ERROR
;

1770 
¡©us
 = 
	`¡ršg_cİy
(&
f›ld
->
addr¡r
, 
addr
, 
add¾’
);

1771 ià(
¡©us
 !ğ
NC_OK
) {

1772  
CONF_ERROR
;

1782 
f›ld
->
v®id
 = 1;

1784  
CONF_OK
;

1785 
	}
}

1788 
	$cÚf_£t_num
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf)

1790 
ušt8_t
 *
p
;

1791 
num
, *
Å
;

1792 
¡ršg
 *
v®ue
;

1794 
p
 = 
cÚf
;

1795 
Å
 = (*)(
p
 + 
cmd
->
off£t
);

1797 ià(*
Å
 !ğ
CONF_UNSET_NUM
) {

1801 
v®ue
 = 
	`¬¿y_tİ
(&
cf
->
¬g
);

1803 
num
 = 
	`nc_©oi
(
v®ue
->
d©a
, v®ue->
Ën
);

1804 ià(
num
 < 0) {

1808 *
Å
 = 
num
;

1810  
CONF_OK
;

1811 
	}
}

1814 
	$cÚf_£t_boŞ
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf)

1816 
ušt8_t
 *
p
;

1817 *
bp
;

1818 
¡ršg
 *
v®ue
, 
Œue_¡r
, 
çl£_¡r
;

1820 
p
 = 
cÚf
;

1821 
bp
 = (*)(
p
 + 
cmd
->
off£t
);

1823 ià(*
bp
 !ğ
CONF_UNSET_NUM
) {

1827 
v®ue
 = 
	`¬¿y_tİ
(&
cf
->
¬g
);

1828 
	`¡ršg_£t_‹xt
(&
Œue_¡r
, "true");

1829 
	`¡ršg_£t_‹xt
(&
çl£_¡r
, "false");

1831 ià(
	`¡ršg_com·»
(
v®ue
, &
Œue_¡r
) == 0) {

1832 *
bp
 = 1;

1833 } ià(
	`¡ršg_com·»
(
v®ue
, &
çl£_¡r
) == 0) {

1834 *
bp
 = 0;

1839  
CONF_OK
;

1840 
	}
}

1843 
	$cÚf_£t_hash
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf)

1845 
ušt8_t
 *
p
;

1846 
hash_ty³_t
 *
hp
;

1847 
¡ršg
 *
v®ue
, *
hash
;

1849 
p
 = 
cÚf
;

1850 
hp
 = (
hash_ty³_t
 *)(
p
 + 
cmd
->
off£t
);

1852 ià(*
hp
 !ğ
CONF_UNSET_HASH
) {

1856 
v®ue
 = 
	`¬¿y_tİ
(&
cf
->
¬g
);

1858 
hash
 = 
hash_¡ršgs
; hash->
Ën
 != 0; hash++) {

1859 ià(
	`¡ršg_com·»
(
v®ue
, 
hash
) != 0) {

1863 *
hp
 = 
hash
 - 
hash_¡ršgs
;

1865  
CONF_OK
;

1869 
	}
}

1872 
	$cÚf_£t_di¡ributiÚ
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf)

1874 
ušt8_t
 *
p
;

1875 
di¡_ty³_t
 *
dp
;

1876 
¡ršg
 *
v®ue
, *
di¡
;

1878 
p
 = 
cÚf
;

1879 
dp
 = (
di¡_ty³_t
 *)(
p
 + 
cmd
->
off£t
);

1881 ià(*
dp
 !ğ
CONF_UNSET_DIST
) {

1885 
v®ue
 = 
	`¬¿y_tİ
(&
cf
->
¬g
);

1887 
di¡
 = 
di¡_¡ršgs
; di¡->
Ën
 != 0; dist++) {

1888 ià(
	`¡ršg_com·»
(
v®ue
, 
di¡
) != 0) {

1892 *
dp
 = 
di¡
 - 
di¡_¡ršgs
;

1894  
CONF_OK
;

1898 
	}
}

1901 
	$cÚf_£t_hashg
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf)

1903 
r¡©us_t
 
¡©us
;

1904 
ušt8_t
 *
p
;

1905 
¡ršg
 *
f›ld
, *
v®ue
;

1907 
p
 = 
cÚf
;

1908 
f›ld
 = (
¡ršg
 *)(
p
 + 
cmd
->
off£t
);

1910 ià(
f›ld
->
d©a
 !ğ
CONF_UNSET_PTR
) {

1914 
v®ue
 = 
	`¬¿y_tİ
(&
cf
->
¬g
);

1916 ià(
v®ue
->
Ën
 != 2) {

1920 
¡©us
 = 
	`¡ršg_du¶iÿ‹
(
f›ld
, 
v®ue
);

1921 ià(
¡©us
 !ğ
NC_OK
) {

1922  
CONF_ERROR
;

1925  
CONF_OK
;

1926 
	}
}

1929 
r¡©us_t


1930 
	$cÚf_jsÚ_´e_v®id©e
(
cÚf
 *
cf
)

1934 
JSON_V®ue
 *
roÙ_v®ue
 = 
	`jsÚ_·r£_fe_w™h_comm’ts
(
cf
->
âame
);

1935 ià(!
roÙ_v®ue
) {

1936 
	`log_¡d”r
("configuration file '%s' invalid JSON syntax\n",

1937 
cf
->
âame
);

1938  
NC_ERROR
;

1940 
	`jsÚ_v®ue_ä“
(
roÙ_v®ue
);

1942  
NC_OK
;

1943 
	}
}

1946 
r¡©us_t


1947 
	$cÚf_jsÚ_po¡_v®id©e
(
cÚf
 *
cf
)

1949 
ušt32_t
 
ÅoŞs
 = 
	`¬¿y_n
(&
cf
->
poŞ
);

1951 
ušt32_t
 
i
 = 0; i < 
ÅoŞs
; i++) {

1952 
cÚf_poŞ
* 
poŞ
 = 
	`¬¿y_g‘
(&
cf
->poŞ, 
i
);

1955 
poŞ
->
hash
 = 
HASH_MURMUR
;

1956 
poŞ
->
»dis
 = 1;

1957 
poŞ
->
»dis_db
 = 0;

1958 
poŞ
->
tık“·live
 = 1;

1959 
poŞ
->
´ecÚÃù
 =1;

1961 
poŞ
->
auto_ejeù_ho¡s
 = 0;

1963 
poŞ
->
£rv”_»Œy_timeout
 = 200000;

1964 
poŞ
->
£rv”_çu»_lim™
 = 2;

1966 ià(
poŞ
->
ş›Á_cÚÃùiÚs
 < 1) {

1967 
poŞ
->
ş›Á_cÚÃùiÚs
 = 1;

1969 ià(
poŞ
->
backlog
 < 1) {

1970 
poŞ
->
backlog
 = 
CONF_DEFAULT_LISTEN_BACKLOG
;

1972 ià(
poŞ
->
£rv”_cÚÃùiÚs
 < 1) {

1973 
poŞ
->
£rv”_cÚÃùiÚs
 = 
CONF_DEFAULT_SERVER_CONNECTIONS
;

1975 ià(
poŞ
->
timeout
 < 1) {

1976 
poŞ
->
timeout
 = 100;

1979  
NC_OK
;

1980 
	}
}

1988 
r¡©us_t


1989 
	$cÚf_jsÚ_š™_poŞ
(
JSON_Objeù
* 
obj
,

1990 
cÚf_poŞ
* 
poŞ
,

1991 *
´oxy_addr
)

1993 
r¡©us_t
 
¡©us
;

1994 
¡ršg
 
¶Çme
;

1999 
	`¡ršg_š™
(&
¶Çme
);

2000 cÚ¡ * 
Çme
 = 
	`jsÚ_objeù_g‘_¡ršg
(
obj
, "name");

2001 
¡©us
 = 
	`¡ršg_cİy
(&
¶Çme
, (
ušt8_t
*)
Çme
, (
ušt32_t
)
	`¡¾’
(name));

2002 ià(
¡©us
 !ğ
NC_OK
) {

2003  
¡©us
;

2007 
	`cÚf_poŞ_š™
(
poŞ
, &
¶Çme
);

2008 
	`¡ršg_deš™
(&
¶Çme
);

2011 
¡©us
 = 
	`¬¿y_š™
(&
poŞ
->
´ox›s
, 
CONF_DEFAULT_PROXIES
,

2012 (
cÚf_£rv”
));

2014 
JSON_A¼ay
* 
j´ox›s
 = 
	`jsÚ_objeù_g‘_¬¿y
(
obj
, "proxy");

2015 
	`ASSERT
(
j´ox›s
 !ğ
NULL
);

2016 
size_t
 
Årox›s
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
j´ox›s
);

2017 
	`ASSERT
(
Årox›s
 > 0);

2018 
size_t
 
i
 = 0; i < 
Årox›s
; i++) {

2019 cÚ¡ * 
p
 = 
	`jsÚ_¬¿y_g‘_¡ršg
(
j´ox›s
, 
i
);

2020 ià(
´oxy_addr
) {

2021 ià((
	`¡¾’
(
´oxy_addr
è!ğ¡¾’(
p
)) ||

2022 (
	`¡ºcmp
(
´oxy_addr
, 
p
, 
	`¡¾’
(proxy_addr)) != 0)) {

2026 
cÚf_£rv”
* 
ı
 = (cÚf_£rv”*è
	`¬¿y_push
(&
poŞ
->
´ox›s
);

2027 
	`¡ršg_to_cÚf_£rv”
((cÚ¡ 
ušt8_t
*è
p
, 
ı
);

2032 ià(
	`¬¿y_n
(&
poŞ
->
´ox›s
) == 0) {

2033 
	`log_debug
(
LOG_NOTICE
, "sk…oŞ \"%s\"", 
Çme
);

2036 
	`¬¿y_deš™
(&
poŞ
->
´ox›s
);

2037 
	`¡ršg_deš™
(&
poŞ
->
Çme
);

2038  
NC_ERROR
;

2041 
	`cÚf_£rv”_to_cÚf_li¡’
(
	`¬¿y_g‘
(&
poŞ
->
´ox›s
, 0),

2042 &
poŞ
->
li¡’
);

2046 
JSON_A¼ay
 * 
hv_¿nge
 = 
	`jsÚ_objeù_g‘_¬¿y
(
obj
, "shard_range");

2047 
	`ASSERT
(
hv_¿nge
 !ğ
NULL
);

2048 
	`ASSERT
(
	`jsÚ_¬¿y_g‘_couÁ
(
hv_¿nge
) == 2);

2049 
poŞ
->
sh¬d_¿nge_mš
 = (
ušt32_t
)
	`jsÚ_¬¿y_g‘_numb”
(
hv_¿nge
, 0);

2050 
poŞ
->
sh¬d_¿nge_max
 = (
ušt32_t
)
	`jsÚ_¬¿y_g‘_numb”
(
hv_¿nge
, 1);

2051 
	`ASSERT
(
poŞ
->
sh¬d_¿nge_mš
 <…oŞ->
sh¬d_¿nge_max
);

2054 
¡©us
 = 
	`¬¿y_š™
(&
poŞ
->
sh¬ds
, 
CONF_DEFAULT_SHARDS
,

2055 (
cÚf_sh¬d
));

2056 
JSON_A¼ay
* 
jsh¬ds
 = 
	`jsÚ_objeù_g‘_¬¿y
(
obj
, "shards");

2057 
size_t
 
nsh¬ds
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
jsh¬ds
);

2058 
	`ASSERT
(
nsh¬ds
 > 0);

2060 
size_t
 
i
 = 0; i < 
nsh¬ds
; i++) {

2062 
cÚf_sh¬d
* 
cfsh¬d
 = (cÚf_sh¬d*è
	`¬¿y_push
(&
poŞ
->
sh¬ds
);

2063 ià(
cfsh¬d
 =ğ
NULL
) {

2064 
¡©us
 = 
NC_ENOMEM
;

2067 
	`mem£t
(
cfsh¬d
, 0, (
cÚf_sh¬d
));

2069 
JSON_Objeù
* 
js
 = 
	`jsÚ_¬¿y_g‘_objeù
(
jsh¬ds
, 
i
);

2070 
cfsh¬d
->
¿nge_begš
 = (
ušt32_t
)
	`jsÚ_objeù_g‘_numb”
(
js
, "range_start");

2071 
cfsh¬d
->
¿nge_’d
 = (
ušt32_t
)
	`jsÚ_objeù_g‘_numb”
(
js
, "range_end");

2074 cÚ¡ * 
jsma¡”
 = 
	`jsÚ_objeù_g‘_¡ršg
(
js
, "master");

2075 
	`¡ršg_to_cÚf_£rv”
((cÚ¡ 
ušt8_t
*)
jsma¡”
, &
cfsh¬d
->
ma¡”
);

2077 
JSON_A¼ay
* 
js¦aves
 = 
	`jsÚ_objeù_g‘_¬¿y
(
js
, "slave");

2078 
size_t
 
n¦aves
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
js¦aves
);

2079 
	`ASSERT
(
n¦aves
 > 0);

2080 
¡©us
 = 
	`¬¿y_š™
(&
cfsh¬d
->
¦aves
, 
CONF_DEFAULT_SLAVES
,

2081 (
cÚf_£rv”
));

2083 
size_t
 
s
 = 0; s < 
n¦aves
; s++) {

2084 cÚ¡ * 
¦v¡r
 = 
	`jsÚ_¬¿y_g‘_¡ršg
(
js¦aves
, 
s
);

2085 
cÚf_£rv”
* 
¦v
 = 
	`¬¿y_push
(&
cfsh¬d
->
¦aves
);

2086 
	`¡ršg_to_cÚf_£rv”
((cÚ¡ 
ušt8_t
*)
¦v¡r
, 
¦v
);

2093  
NC_OK
;

2094 
	}
}

2096 
r¡©us_t


2097 
	$cÚf_jsÚ_·r£
(
cÚf
 *
cf
, 
š¡ªû
 *
nci
)

2099 
r¡©us_t
 
¡©us
 = 
NC_OK
;

2101 
JSON_V®ue
 *
roÙ_v®ue
 = 
	`jsÚ_·r£_fe_w™h_comm’ts
(
cf
->
âame
);

2102 
	`ASSERT
(
roÙ_v®ue
 !ğ
NULL
);

2107 
JSON_Objeù
* 
roÙ_obj
 = 
	`jsÚ_v®ue_g‘_objeù
(
roÙ_v®ue
);

2108 
JSON_A¼ay
* 
poŞs
 = 
	`jsÚ_objeù_g‘_¬¿y
(
roÙ_obj
, "pools");

2109 
size_t
 
num_poŞs
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
poŞs
);

2111 
	`log_debug
(
LOG_INFO
, "cÚà% cÚš %d…oŞs\n", 
cf
->
âame
, 
num_poŞs
);

2113 
´oxy_addr
[200];

2114 
	`¥rštf
(
´oxy_addr
, "%s:%d", 
nci
->
´oxy_
,‚ci->
´oxy_pÜt
);

2116 
size_t
 
i
 = 0; i < 
num_poŞs
; i++) {

2117 
cÚf_poŞ
* 
poŞ
 = (cÚf_poŞ*è
	`¬¿y_push
(&
cf
->pool);

2118 ià(
poŞ
 =ğ
NULL
) {

2119 
¡©us
 = 
NC_ENOMEM
;

2123 
JSON_Objeù
* 
poŞ_obj
 = 
	`jsÚ_¬¿y_g‘_objeù
(
poŞs
, 
i
);

2125 
¡©us
 = 
	`cÚf_jsÚ_š™_poŞ
(
poŞ_obj
, 
poŞ
, 
´oxy_addr
);

2126 ià(
¡©us
 !ğ
NC_OK
) {

2127 
	`¬¿y_pİ
(&
cf
->
poŞ
);

2130 
poŞ
->
v®id
 = 1;

2132 
	`jsÚ_v®ue_ä“
(
roÙ_v®ue
);

2134  
¡©us
;

2135 
	}
}

2140 
	$cÚf_jsÚ_dump
(
cÚf
 *
cf
)

2142 
ušt32_t
 
ÅoŞ
 = 
	`¬¿y_n
(&
cf
->
poŞ
);

2143 
	`log_debug
(
LOG_NOTICE
, "conf %s: have %d…ools, valid = %d\n",

2144 
cf
->
âame
, 
ÅoŞ
, cf->
v®id
);

2145 
ušt32_t
 
i
 = 0; i < 
ÅoŞ
; i++) {

2146 
	`log_debug
(
LOG_NOTICE
, "poŞ %d ::", 
i
);

2148 
cÚf_poŞ
* 
poŞ
 = (cÚf_poŞ*è
	`¬¿y_g‘
(&
cf
->poŞ, 
i
);

2150 
ušt32_t
 
Årox›s
 = 
	`¬¿y_n
(&
poŞ
->
´ox›s
);

2151 
ušt32_t
 
nsh¬ds
 = 
	`¬¿y_n
(&
poŞ
->
sh¬ds
);

2153 
	`log_debug
(
LOG_NOTICE
, "\oŞ‚am: \"%s\"", 
poŞ
->
Çme
.
d©a
);

2154 
	`log_debug
(
LOG_NOTICE
, "\t%d…roxies,†isten: %s",

2155 
Årox›s
, 
poŞ
->
li¡’
.
Çme
.
d©a
);

2156 
	`log_debug
(
LOG_NOTICE
, "\t%d sh¬ds", 
nsh¬ds
);

2157 
	`log_debug
(
LOG_NOTICE
, "\tshard„ange : [%d, %d]",

2158 
poŞ
->
sh¬d_¿nge_mš
,…oŞ->
sh¬d_¿nge_max
);

2160 
ušt32_t
 
j
 = 0; j < 
Årox›s
; j++) {

2161 
cÚf_£rv”
* 
p
 = (cÚf_£rv”*è
	`¬¿y_g‘
(&
poŞ
->
´ox›s
, 
j
);

2162 
	`log_debug
(
LOG_NOTICE
, "\roxy %d : %s", 
j
, 
p
->
²ame
.
d©a
);

2165 
ušt32_t
 
j
 = 0; j < 
nsh¬ds
; j++) {

2166 
cÚf_sh¬d
* 
sh
 = (cÚf_sh¬d*è
	`¬¿y_g‘
(&
poŞ
->
sh¬ds
, 
j
);

2167 
ušt32_t
 
n¦aves
 = 
	`¬¿y_n
(&
sh
->
¦aves
);

2169 
	`log_debug
(
LOG_NOTICE
, "\tshard %d :„ange [%d, %d], 1 master, %d slaves",

2170 
j
, 
sh
->
¿nge_begš
, sh->
¿nge_’d
, 
n¦aves
);

2172 
	`log_debug
(
LOG_NOTICE
, "\t\tma¡” : %s", 
sh
->
ma¡”
.
²ame
.
d©a
);

2175 
ušt32_t
 
k
 = 0; k < 
n¦aves
; k++) {

2176 
cÚf_£rv”
* 
s
 = (cÚf_£rv”*è
	`¬¿y_g‘
(&
sh
->
¦aves
, 
k
);

2177 
	`log_debug
(
LOG_NOTICE
, "\t\t¦av%d : %s", 
k
, 
s
->
²ame
.
d©a
);

2181 
	`log_debug
(
LOG_NOTICE
, "\n");

2183 
	}
}

2185 
cÚf
 *

2186 
	$cÚf_jsÚ_ü—‹_äom_zk
(*
zk£rv”s
, 
š¡ªû
* 
nci
, 
cÚ‹xt
 *
ùx
)

2188 
size_t
 
max_·th
 = 200;

2189 
zk·th
[
max_·th
];

2191 
ùx
->
zkh
 = 
	`ZKCÚÃù
(
zk£rv”s
);

2192 ià(!
ùx
->
zkh
) {

2193 
	`log_”rÜ
("ÿÂÙ cÚÃùØzk %s", 
zk£rv”s
);

2194  
NULL
;

2199 
buæ’
 = 64000;

2200 
buf
[
buæ’
];

2201 
sync
 = 1;

2202 
w©ch
 = 0;

2203 
	`¢´štf
(
zk·th
, 
max_·th
, "%s/´oxy/%s", 
ZK_BASE
, 
nci
->
poŞ_Çme
);

2204 
cÚf_Ën
 = 
	`ZKG‘
(
ùx
->
zkh
, 
zk·th
, 
buf
, 
buæ’
, 
w©ch
, 
sync
);

2205 ià(
cÚf_Ën
 <= 0) {

2206 
	`log_”rÜ
("»ad cÚàäom zk: %s,„‘ %d", 
zk·th
, 
cÚf_Ën
);

2207 
	`ZKClo£
(
ùx
->
zkh
);

2208 
ùx
->
zkh
 = 
NULL
;

2209  
NULL
;

2212 
âame
[500];

2213 
	`¥rštf
(
âame
, "%s-proxy-%s-%d",

2214 
CONF_DEFAULT_FILE_SAVE_PATH
, 
nci
->
´oxy_
,‚ci->
´oxy_pÜt
);

2215 
	`nc_wr™e_fe
(
âame
, 
buf
, 
cÚf_Ën
);

2217 
cÚf
 *
cf
;

2218 
cf
 = 
	`cÚf_jsÚ_ü—‹
(
âame
, 
nci
);

2219 ià(
cf
 =ğ
NULL
) {

2220  
NULL
;

2223 
cf
->
zk_£rv”s
 = 
zk£rv”s
;

2225 
cf
->
âame
 = 
NULL
;

2227  
cf
;

2228 
	}
}

2230 
cÚf
 *

2231 
	$cÚf_jsÚ_ü—‹
(*
f’ame
, 
š¡ªû
* 
nci
)

2233 
r¡©us_t
 
¡©us
 = 
NC_OK
;

2234 
cÚf
 *
cf
;

2236 
cf
 = 
	`cÚf_İ’
(
f’ame
);

2237 ià(
cf
 =ğ
NULL
) {

2238  
NULL
;

2241 
	`fşo£
(
cf
->
fh
);

2242 
cf
->
fh
 = 
NULL
;

2243 
	`¬¿y_nuÎ
(&
cf
->
¬g
);

2246 
¡©us
 = 
	`cÚf_jsÚ_´e_v®id©e
(
cf
);

2247 ià(
¡©us
 !ğ
NC_OK
) {

2248 
”rÜ
;

2253 
¡©us
 = 
	`cÚf_jsÚ_·r£
(
cf
, 
nci
);

2254 ià(
¡©us
 !ğ
NC_OK
) {

2255 
”rÜ
;

2259 
¡©us
 = 
	`cÚf_jsÚ_po¡_v®id©e
(
cf
);

2260 ià(
¡©us
 !ğ
NC_OK
) {

2261 
”rÜ
;

2264 
cf
->
v®id
 = 1;

2265 
	`cÚf_jsÚ_dump
(
cf
);

2267  
cf
;

2269 
”rÜ
:

2270 
	`log_¡d”r
("nutcracker: configuration file '%s' JSON syntax invalid",

2271 
f’ame
);

2272 
	`cÚf_de¡roy
(
cf
);

2273  
NULL
;

2274 
	}
}

2339 
r¡©us_t


2340 
	$¡ršg_to_cÚf_£rv”
(cÚ¡ 
ušt8_t
* 
§ddr
, 
cÚf_£rv”
* 
¤v
)

2342 
	`cÚf_£rv”_š™
(
¤v
);

2343 
ušt32_t
 
Ën
 = (ušt32_t)
	`¡¾’
((cÚ¡ *)
§ddr
);

2344 cÚ¡ 
ušt8_t
 *
s_Çme
, *
s_pÜt
;

2346 
ušt8_t
 *
d–im
 = 
	`nc_¡rchr
((ušt8_t*)
§ddr
,

2347 (
ušt8_t
*è(
§ddr
 + 
Ën
),

2349 
	`ASSERT
(
d–im
 !ğ
NULL
);

2350 
s_Çme
 = 
§ddr
;

2351 
s_pÜt
 = 
d–im
 + 1;

2353 
	`¡ršg_cİy
(&
¤v
->
²ame
, 
§ddr
, 
Ën
);

2354 
	`¡ršg_cİy
(&
¤v
->
Çme
, 
§ddr
, 
Ën
);

2355 
	`¡ršg_cİy
(&
¤v
->
addr¡r
, 
§ddr
, (
ušt32_t
)(
d–im
 - 
s_Çme
));

2357 
¤v
->
pÜt
 = 
	`nc_©oi
(
s_pÜt
, (
ušt32_t
)(
Ën
 - (
d–im
 + 1 - 
s_Çme
)));

2359 
r¡©us_t
 
¡©us
 = 
	`nc_»sŞve
(&
¤v
->
addr¡r
, srv->
pÜt
, &¤v->
šfo
);

2360 ià(
¡©us
 !ğ
NC_OK
) {

2361  
NC_ERROR
;

2364 
¤v
->
v®id
 = 1;

2366  
NC_OK
;

2367 
	}
}

2370 
	$cÚf_£rv”_to_cÚf_li¡’
(
cÚf_£rv”
* 
cs
, 
cÚf_li¡’
* 
ş
)

2372 
	`¡ršg_š™
(&
ş
->
Çme
);

2373 
	`¡ršg_š™
(&
ş
->
²ame
);

2374 
	`¡ršg_du¶iÿ‹
(&
ş
->
Çme
, &
cs
->name);

2375 
	`¡ršg_du¶iÿ‹
(&
ş
->
²ame
, &
cs
->
Çme
);

2377 
ş
->
pÜt
 = 
cs
->port;

2378 
	`nc_memıy
(&
ş
->
šfo
, &
cs
->info, (cl->info));

2380 
ş
->
v®id
 = 1;

2381 
	}
}

2386 
r¡©us_t


2387 
	$cÚf_sh¬ds_to_£rv”_sh¬ds
(
¬¿y
* 
cf_sh¬ds
,

2388 
¬¿y
* 
¤v_sh¬ds
,

2389 
£rv”_poŞ
* 
¥
)

2391 
cÚf_sh¬d
* 
cÚf_sd
 = 
NULL
;

2392 
sh¬d
* 
¤v_sd
 = 
NULL
;

2393 
r¡©us_t
 
rv
 = 
NC_OK
;

2395 
	`¬¿y_š™
(&
¥
->
£rv”
, 16, (server));

2397 
ušt32_t
 
i
 = 0; i < 
	`¬¿y_n
(
cf_sh¬ds
); i++) {

2398 
cÚf_sd
 = 
	`¬¿y_g‘
(
cf_sh¬ds
, 
i
);

2399 
¤v_sd
 = 
	`¬¿y_push
(
¤v_sh¬ds
);

2400 
	`mem£t
(
¤v_sd
, 0, (
sh¬d
));

2401 
¤v_sd
->
idx
 = 
	`¬¿y_idx
(
¤v_sh¬ds
, srv_sd);

2403 
rv
 = 
	`cÚf_sh¬d_to_£rv”_sh¬d
(
cÚf_sd
, 
¤v_sd
, 
¥
);

2406  
rv
;

2407 
	}
}

2414 
cÚf
*

2415 
	$g‘_poŞ_cÚf_äom_zk
(* 
zk£rv”s
, 
cÚ‹xt
 *
ùx
)

2417 
š¡ªû
 *
š¡
 = 
ùx
->
owÃr_š¡
;

2418 *
poŞ_Çme
 = 
š¡
->pool_name;

2420 ià(
ùx
->
zkh
 =ğ
NULL
) {

2421 
ùx
->
zkh
 = 
	`ZKCÚÃù
(
zk£rv”s
);

2422 ià(!
ùx
->
zkh
) {

2423 
	`log_”rÜ
("ÿÂÙ cÚÃùØzk %s", 
zk£rv”s
);

2424  
NULL
;

2428 
size_t
 
max_·th
 = 500;

2429 
·th
[
max_·th
];

2430 
	`¢´štf
(
·th
, 
max_·th
, "%s/%s", 
š¡
->
zk_cÚfig_roÙ
, 
poŞ_Çme
);

2434 
buæ’
 = 10000;

2435 
buf
[
buæ’
];

2436 
sync
 = 1;

2437 
w©ch
 = 0;

2438 
cÚf_Ën
 = 
	`ZKG‘
(
ùx
->
zkh
, 
·th
, 
buf
, 
buæ’
, 
w©ch
, 
sync
);

2439 ià(
cÚf_Ën
 <ğ0 || cÚf_ËÀ>ğ
buæ’
) {

2440 
	`log_”rÜ
("pool \"%s \"conf incorrect: %s,„et %d",

2441 
poŞ_Çme
, 
·th
, 
cÚf_Ën
);

2442 
	`ZKClo£
(
ùx
->
zkh
);

2443 
ùx
->
zkh
 = 
NULL
;

2444  
NULL
;

2448 
	`¥rštf
(
·th
, "%s-poŞ-%s", 
CONF_DEFAULT_FILE_SAVE_PATH
, 
poŞ_Çme
);

2449 
	`nc_wr™e_fe
(
·th
, 
buf
, 
cÚf_Ën
);

2452 
cÚf
 *
cf
;

2453 
cf
 = 
	`ü—‹_poŞ_cÚf_äom_fe
(
·th
, 
ùx
);

2454 ià(
cf
 =ğ
NULL
) {

2455  
NULL
;

2459 
r¡©us_t
 
¡©us
 = 
	`cÚf_jsÚ_po¡_v®id©e
(
cf
);

2460 ià(
¡©us
 !ğ
NC_OK
) {

2461 
	`cÚf_de¡roy
(
cf
);

2462  
NULL
;

2465 
cf
->
zk_£rv”s
 = 
zk£rv”s
;

2466 
cf
->
v®id
 = 1;

2467 
	`cÚf_jsÚ_dump
(
cf
);

2468 
	`cÚf_dump
(
cf
);

2470 
cf
->
âame
 = 
NULL
;

2472  
cf
;

2473 
	}
}

2476 
cÚf
*

2477 
	$ü—‹_poŞ_cÚf_äom_fe
(*
f•©h
, 
cÚ‹xt
 *
ùx
)

2479 
š¡ªû
 *
š¡
 = 
ùx
->
owÃr_š¡
;

2481 
r¡©us_t
 
¡©us
 = 
NC_OK
;

2482 
cÚf
 *
cf
 = 
	`cÚf_İ’
(
f•©h
);

2483 ià(
cf
 =ğ
NULL
) {

2484  
NULL
;

2486 ià(
cf
->
fh
) {

2487 
	`fşo£
(
cf
->
fh
);

2488 
cf
->
fh
 = 
NULL
;

2490 
	`¬¿y_nuÎ
(&
cf
->
¬g
);

2492 
¡©us
 = 
	`·r£_poŞ_cÚf_fe
(
cf
, 
š¡
->
poŞ_Çme
);

2493 ià(
¡©us
 !ğ
NC_OK
) {

2494 
”rÜ
;

2499 
ušt32_t
 
num_poŞs
 = 
	`¬¿y_n
(&
cf
->
poŞ
);

2500 
ušt32_t
 
i
 = 0; i < 
num_poŞs
; i++) {

2501 
cÚf_poŞ
* 
poŞ
 = (cÚf_poŞ*è
	`¬¿y_g‘
(&
cf
->poŞ, 
i
);

2502 
¡r_Ën
 = 200;

2503 
´oxy_¡r
[
¡r_Ën
];

2504 
	`¢´štf
(
´oxy_¡r
, (
size_t
)
¡r_Ën
, "%s:%d",

2505 
š¡
->
´oxy_
, in¡->
´oxy_pÜt
);

2506 
cÚf_£rv”
* 
ı
 = (cÚf_£rv”*)
	`¬¿y_push
(&
poŞ
->
´ox›s
);

2507 
	`¡ršg_to_cÚf_£rv”
((cÚ¡ 
ušt8_t
*)
´oxy_¡r
, 
ı
);

2508 
	`cÚf_£rv”_to_cÚf_li¡’
(
ı
, &
poŞ
->
li¡’
);

2511  
cf
;

2513 
”rÜ
:

2514 
	`log_¡d”r
("cÚfigu¿tiÚ f'%s' JSON syÁax inv®id", 
f•©h
);

2515 
	`cÚf_de¡roy
(
cf
);

2516  
NULL
;

2517 
	}
}

2520 
r¡©us_t


2521 
	$·r£_poŞ_cÚf_fe
(
cÚf
 *
cf
, *
poŞ_Çme
)

2523 
r¡©us_t
 
¡©us
 = 
NC_OK
;

2526 
JSON_V®ue
 *
roÙ_v®ue
 = 
	`jsÚ_·r£_fe_w™h_comm’ts
(
cf
->
âame
);

2527 
	`ASSERT
(
roÙ_v®ue
 !ğ
NULL
);

2528 ià(
JSONObjeù
 !ğ
	`jsÚ_ty³
(
roÙ_v®ue
)) {

2529 
	`log_”rÜ
("cÚfig f”rÜ fÜm© : %s", 
cf
->
âame
);

2530  
NC_ERROR
;

2533 
JSON_Objeù
* 
poŞ_obj
 = 
	`jsÚ_v®ue_g‘_objeù
(
roÙ_v®ue
);

2534 ià(!
	`§n™y_check_poŞ_cÚf_jsÚ
(
poŞ_obj
)) {

2535 
	`log_”rÜ
("cÚfig fšv®id cÚ‹Á : %s", 
cf
->
âame
);

2536  
NC_ERROR
;

2540 
cÚf_poŞ
* 
poŞ
 = (cÚf_poŞ*è
	`¬¿y_push
(&
cf
->pool);

2541 ià(
poŞ
 =ğ
NULL
) {

2542  
NC_ENOMEM
;

2544 
	`mem£t
(
poŞ
, 0, (
cÚf_poŞ
));

2547 
¡©us
 = 
	`cÚf_jsÚ_to_cÚf_poŞ
(
poŞ_obj
, 
poŞ
, 
poŞ_Çme
);

2548 ià(
¡©us
 !ğ
NC_OK
) {

2549 
	`¬¿y_pİ
(&
cf
->
poŞ
);

2551 
poŞ
->
v®id
 = 1;

2554 
	`jsÚ_v®ue_ä“
(
roÙ_v®ue
);

2555  
¡©us
;

2556 
	}
}

2559 
r¡©us_t


2560 
	$cÚf_jsÚ_to_cÚf_poŞ
(
JSON_Objeù
 *
pobj
, 
cÚf_poŞ
 *
poŞ
, *
poŞ_Çme
)

2562 
r¡©us_t
 
¡©us
;

2563 
¡ršg
 
¶Çme
;

2565 
	`¡ršg_š™
(&
¶Çme
);

2566 
¡©us
 = 
	`¡ršg_cİy
(&
¶Çme
,

2567 (
ušt8_t
*)
poŞ_Çme
,

2568 (
ušt32_t
)
	`¡¾’
(
poŞ_Çme
));

2571 
	`cÚf_poŞ_š™
(
poŞ
, &
¶Çme
);

2572 
	`¡ršg_deš™
(&
¶Çme
);

2575 
poŞ
->
»dis
 = 1;

2576 
poŞ
->
»dis_db
 = 0;

2577 
poŞ
->
hash
 = 
HASH_MURMUR
;

2579 cÚ¡ * 
Çme
 = 
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "name");

2580 cÚ¡ * 
id
 = 
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "id");

2583 
poŞ
->
sh¬d_¿nge_mš
 = (
ušt32_t
)
	`©oi
(
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "pool_begin"));

2584 
poŞ
->
sh¬d_¿nge_max
 = (
ušt32_t
)
	`©oi
(
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "pool_end"));

2587 cÚ¡ *
¤v_cÚns
 = 
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "server_connections");

2588 ià(
¤v_cÚns
) {

2589 
poŞ
->
£rv”_cÚÃùiÚs
 = (
ušt32_t
)
	`©oi
(
¤v_cÚns
);

2593 
¡©us
 = 
	`¬¿y_š™
(&
poŞ
->
´ox›s
, 
CONF_DEFAULT_PROXIES
,

2594 (
cÚf_£rv”
));

2597 
¡©us
 = 
	`¬¿y_š™
(&
poŞ
->
sh¬ds
, 
CONF_DEFAULT_SHARDS
,

2598 (
cÚf_sh¬d
));

2599 
JSON_A¼ay
* 
jsh¬ds
 = 
	`jsÚ_objeù_g‘_¬¿y
(
pobj
, "shards");

2600 
size_t
 
nsh¬ds
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
jsh¬ds
);

2603 
size_t
 
i
 = 0; i < 
nsh¬ds
; i++) {

2605 
cÚf_sh¬d
* 
cfsh¬d
 = (cÚf_sh¬d*è
	`¬¿y_push
(&
poŞ
->
sh¬ds
);

2606 ià(
cfsh¬d
 =ğ
NULL
) {

2607 
¡©us
 = 
NC_ENOMEM
;

2610 
	`mem£t
(
cfsh¬d
, 0, (
cÚf_sh¬d
));

2612 
¡©us
 = 
	`¬¿y_š™
(&
cfsh¬d
->
¦aves
, 
CONF_DEFAULT_SLAVES
,

2613 (
cÚf_£rv”
));

2614 ià(
¡©us
 !ğ
NC_OK
) {

2615  
NC_ENOMEM
;

2618 
JSON_Objeù
* 
js
 = 
	`jsÚ_¬¿y_g‘_objeù
(
jsh¬ds
, 
i
);

2619 
cfsh¬d
->
¿nge_begš
 = (
ušt32_t
)
	`©oi
(
	`jsÚ_objeù_g‘_¡ršg
(
js
, "shard_begin"));

2620 
cfsh¬d
->
¿nge_’d
 = (
ušt32_t
)
	`©oi
(
	`jsÚ_objeù_g‘_¡ršg
(
js
, "shard_end"));

2622 cÚ¡ *
¡r_¡©us
 = 
	`jsÚ_objeù_g‘_¡ršg
(
js
, "status");

2623 ià(
¡r_¡©us
) {

2624 
	`¡ºıy
(
cfsh¬d
->
¡©us
, 
¡r_¡©us
, 31);

2625 
cfsh¬d
->
¡©us
[31] = 0;

2627 
	`¡ºıy
(
cfsh¬d
->
¡©us
, "unknown", 8);

2631 cÚ¡ * 
jsma¡”
 = 
	`jsÚ_objeù_g‘_¡ršg
(
js
, "master_target");

2632 ià(
jsma¡”
 && 
	`¡¾’
(jsmaster) > 2) {

2633 
	`¡ršg_to_cÚf_£rv”
((cÚ¡ 
ušt8_t
*)
jsma¡”
, &
cfsh¬d
->
ma¡”
);

2635 
	`log_”rÜ
("poŞ % sh¬d %d: inv®id ma¡”: %s\n", 
Çme
, 
i
, 
jsma¡”
);

2639 
JSON_A¼ay
* 
js¦aves
 = 
	`jsÚ_objeù_g‘_¬¿y
(
js
, "slave_target");

2640 
size_t
 
n¦aves
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
js¦aves
);

2641 ià(
n¦aves
 == 0) ;

2643 
size_t
 
s
 = 0; s < 
n¦aves
; s++) {

2644 cÚ¡ * 
¦v¡r
 = 
	`jsÚ_¬¿y_g‘_¡ršg
(
js¦aves
, 
s
);

2645 
cÚf_£rv”
* 
¦v
 = 
	`¬¿y_push
(&
cfsh¬d
->
¦aves
);

2646 ià(
¦v¡r
 && 
	`¡¾’
(slvstr) > 2) {

2647 
	`¡ršg_to_cÚf_£rv”
((cÚ¡ 
ušt8_t
*)
¦v¡r
, 
¦v
);

2649 
	`log_”rÜ
("poŞ % sh¬d %d: inv®id sÏv: %s\n", 
Çme
, 
i
, 
jsma¡”
);

2654  
¡©us
;

2656 
	}
}

2676 
boŞ


2677 
	$§n™y_check_poŞ_cÚf_jsÚ
(
JSON_Objeù
 *
pobj
)

2679 ià(!
pobj
è 
çl£
;

2681 
ušt32_t
 
poŞ_begš
 = 0, 
poŞ_’d
 = 0;

2683 ià(
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "Çme"è=ğ
NULL
) {

2684  
çl£
;

2686 ià(
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "id"è=ğ
NULL
) {

2687  
çl£
;

2690 ià(
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "poŞ_begš"è=ğ
NULL
) {

2691  
çl£
;

2693 
poŞ_begš
 = 
	`©oi
(
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "pool_begin"));

2696 ià(
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "poŞ_’d"è=ğ
NULL
) {

2697  
çl£
;

2699 
poŞ_’d
 = 
	`©oi
(
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "pool_end"));

2703 
JSON_A¼ay
* 
jsh¬ds
 = 
	`jsÚ_objeù_g‘_¬¿y
(
pobj
, "shards");

2704 
size_t
 
nsh¬ds
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
jsh¬ds
);

2705 ià(
nsh¬ds
 == 0) {

2707  
Œue
;

2710 
ušt32_t
 
sh¬d_¿nge_mš
 = 0xFFFFFFFF, 
sh¬d_¿nge_max
 = 0;

2712 
size_t
 
i
 = 0; i < 
nsh¬ds
; i++) {

2713 
JSON_Objeù
* 
js
 = 
	`jsÚ_¬¿y_g‘_objeù
(
jsh¬ds
, 
i
);

2714 ià(!
	`§n™y_check_sh¬d_cÚf_jsÚ
(
js
)) {

2715  
çl£
;

2719 
ušt32_t
 
begš
 = 
	`©oi
(
	`jsÚ_objeù_g‘_¡ršg
(
js
, "shard_begin"));

2720 
ušt32_t
 
’d
 = 
	`©oi
(
	`jsÚ_objeù_g‘_¡ršg
(
js
, "shard_end"));

2721 ià(
begš
 =ğ
sh¬d_¿nge_mš
) {

2722 
	`log_”rÜ
("du¶iÿ‹d sh¬d„ªgbegš: %d", 
begš
);

2723  
çl£
;

2725 ià(
’d
 =ğ
sh¬d_¿nge_max
) {

2726 
	`log_”rÜ
("du¶iÿ‹d sh¬d„ªg’d: %d", 
’d
);

2727  
çl£
;

2730 ià(
sh¬d_¿nge_mš
 > 
begš
) {

2731 
sh¬d_¿nge_mš
 = 
begš
;

2733 ià(
sh¬d_¿nge_max
 < 
’d
) {

2734 
sh¬d_¿nge_max
 = 
’d
;

2738 ià(
sh¬d_¿nge_mš
 !ğ
poŞ_begš
) {

2739 
	`log_”rÜ
("pool„ange min %d != shard„ange min %d",

2740 
poŞ_begš
, 
sh¬d_¿nge_mš
);

2741  
çl£
;

2743 ià(
sh¬d_¿nge_max
 !ğ
poŞ_’d
) {

2744 
	`log_”rÜ
("pool„ange max %d != shard„ange max %d",

2745 
poŞ_’d
, 
sh¬d_¿nge_max
);

2746  
çl£
;

2749  
Œue
;

2750 
	}
}

2753 
boŞ


2754 
	$§n™y_check_sh¬d_cÚf_jsÚ
(
JSON_Objeù
 *
sobj
)

2756 ià(!
sobj
è 
çl£
;

2758 ià(
	`jsÚ_objeù_g‘_¡ršg
(
sobj
, "sh¬d_begš"è=ğ
NULL
) {

2759  
çl£
;

2761 ià(
	`jsÚ_objeù_g‘_¡ršg
(
sobj
, "sh¬d_’d"è=ğ
NULL
) {

2762  
çl£
;

2764 ià(
	`jsÚ_objeù_g‘_¡ršg
(
sobj
, "ma¡”_rg‘"è=ğ
NULL
) {

2765  
çl£
;

2767 ià(
	`jsÚ_objeù_g‘_¬¿y
(
sobj
, "¦ave_rg‘"è=ğ
NULL
) {

2768  
çl£
;

2771  
Œue
;

2772 
	}
}

2776 
	$di¥Ïy_£rv”_sh¬d
(
sh¬d
 *
¤v_sd
)

2778 
£rv”
 *
¤v
 = 
¤v_sd
->
ma¡”
;

2780 
	`log_debug
(
LOG_NOTICE
, "shard %d [%d ~ %d], master %p, %d slaves",

2781 
¤v_sd
->
idx
, srv_sd->
¿nge_begš
, srv_sd->
¿nge_’d
,

2782 
¤v
, 
	`¬¿y_n
(&
¤v_sd
->
¦aves
));

2784 ià(
¤v
) {

2785 
	`log_debug
(
LOG_NOTICE
, "\tma¡” srv (idx %d): %s", 
¤v
->
idx
, srv->
²ame
.
d©a
);

2786 ià(
¤v
->
owÃr_sh¬d
 !ğ
¤v_sd
) {

2787 
	`log_”rÜ
("ma¡” s”v” % owÃ¸mism©ch\n", 
¤v
->
²ame
.
d©a
);

2791 
ušt32_t
 
j
 = 0; j < 
	`¬¿y_n
(&
¤v_sd
->
¦aves
); j++) {

2792 
£rv”
** 
µ¤v
 = (£rv”**)(
	`¬¿y_g‘
(&
¤v_sd
->
¦aves
, 
j
));

2793 
¤v
 = *
µ¤v
;

2794 
	`log_debug
(
LOG_NOTICE
, "\t¦av¤v (idx %d): %s", 
¤v
->
idx
, srv->
²ame
.
d©a
);

2795 ià(
¤v
->
owÃr_sh¬d
 !ğ
¤v_sd
) {

2796 
	`log_”rÜ
("ma¡” s”v” % owÃ¸mism©ch\n", 
¤v
->
²ame
.
d©a
);

2799 
	}
}

2805 
r¡©us_t


2806 
	$cÚf_sh¬d_to_£rv”_sh¬d
(
cÚf_sh¬d
 *
cÚf_sd
,

2807 
sh¬d
 *
¤v_sd
,

2808 
£rv”_poŞ
 *
¥
)

2810 
r¡©us_t
 
rv
 = 
NC_OK
;

2812 
¤v_sd
->
owÃr
 = 
¥
;

2813 
¤v_sd
->
¿nge_begš
 = 
cÚf_sd
->range_begin;

2814 
¤v_sd
->
¿nge_’d
 = 
cÚf_sd
->range_end;

2816 
£rv”
 *
¤v
;

2819 
cÚf_£rv”
 *
cÚf_¤v
 = &
cÚf_sd
->
ma¡”
;

2820 ià(
	`is_v®id_cÚf_£rv”
(
cÚf_¤v
)) {

2821 
¤v
 = 
	`¬¿y_push
(&
¥
->
£rv”
);

2822 
¤v
->
idx
 = 
	`¬¿y_idx
(&
¥
->
£rv”
, srv);

2823 
rv
 = 
	`cÚf_£rv”_to_£rv”
(
cÚf_¤v
, 
¤v
);

2824 ià(
rv
 !ğ
NC_OK
) {

2825 
	`log_”rÜ
("failedo init master server\n");

2826 
”rÜ_ma¡”
;

2828 
¤v
->
owÃr
 = 
¥
;

2829 
¤v
->
owÃr_sh¬d
 = 
¤v_sd
;

2830 
¤v_sd
->
ma¡”
 = 
¤v
;

2833 
¤v_sd
->
ma¡”
 = 
NULL
;

2838 
	`¬¿y_š™
(&
¤v_sd
->
¦aves
, 4, (
£rv”
*));

2840 
ušt32_t
 
¦aves_added
 = 0;

2842 
ušt32_t
 
i
 = 0; i < 
	`¬¿y_n
(&
cÚf_sd
->
¦aves
); i++) {

2843 
cÚf_¤v
 = 
	`¬¿y_g‘
(&
cÚf_sd
->
¦aves
, 
i
);

2844 ià(!
	`is_v®id_cÚf_£rv”
(
cÚf_¤v
)) {

2847 
¤v
 = 
	`¬¿y_push
(&
¥
->
£rv”
);

2848 
¦aves_added
++;

2850 
¤v
->
idx
 = 
	`¬¿y_idx
(&
¥
->
£rv”
, srv);

2853 
rv
 = 
	`cÚf_£rv”_to_£rv”
(
cÚf_¤v
, 
¤v
);

2854 ià(
rv
 !ğ
NC_OK
) {

2855 
	`log_”rÜ
("failedo init slave server\n");

2856 
”rÜ_¦ave
;

2860 
¤v
->
owÃr
 = 
¥
;

2861 
¤v
->
owÃr_sh¬d
 = 
¤v_sd
;

2863 
£rv”
** 
µ¤v
 = 
	`¬¿y_push
(&
¤v_sd
->
¦aves
);

2864 *
µ¤v
 = 
¤v
;

2868 
	`£t_£rv”_sh¬d_¡©us
(
cÚf_sd
, 
¤v_sd
);

2870  
rv
;

2872 
”rÜ_¦ave
:

2874 
ušt32_t
 
i
 = 0; i < 
¦aves_added
; i++) {

2875 
	`¬¿y_pİ
(&
¥
->
£rv”
);

2878 
”rÜ_ma¡”
:

2879 
	`¬¿y_pİ
(&
¥
->
£rv”
);

2881  
rv
;

2882 
	}
}

2890 
sh¬d
*

2891 
	$fšd_£rv”_sh¬d
(
cÚf_sh¬d
 *
cÚf_sd
, 
¬¿y
 *
¤v_sh¬ds
)

2893 
ušt32_t
 
begš
 = 
cÚf_sd
->
¿nge_begš
;

2895 
ušt32_t
 
i
 = 0; i < 
	`¬¿y_n
(
¤v_sh¬ds
); i++) {

2896 
sh¬d
 *
¤v_sd
 = 
	`¬¿y_g‘
(
¤v_sh¬ds
, 
i
);

2897 ià(
¤v_sd
->
¿nge_begš
 =ğ
begš
) {

2898  
¤v_sd
;

2902  
NULL
;

2903 
	}
}

2910 
£rv”
*

2911 
	$fšd_£rv”_äom_cÚf_£rv”
(
cÚf_£rv”
 *
cÚf_¤v
, 
¬¿y
 *
¤vs
)

2913 
ušt32_t
 
i
 = 0; i < 
	`¬¿y_n
(
¤vs
); i++) {

2914 
£rv”
* 
¤v
 = *(£rv” **)
	`¬¿y_g‘
(
¤vs
, 
i
);

2915 ià(
	`cÚf_m©ch_£rv”
(
cÚf_¤v
, 
¤v
)) {

2916  
¤v
;

2919  
NULL
;

2920 
	}
}

2924 
boŞ


2925 
	$cÚf_m©ch_£rv”
(
cÚf_£rv”
 *
cÚf_¤v
, 
£rv”
 *
¤v
)

2927 ià(!
¤v
è 
çl£
;

2929 ià(
¤v
->
Çme
.
Ën
 !ğ
cÚf_¤v
->name.len ||

2930 
	`¡ºcmp
((cÚ¡ *)
¤v
->
Çme
.
d©a
,

2931 (cÚ¡ *)
cÚf_¤v
->
Çme
.
d©a
,

2932 
¤v
->
Çme
.
Ën
)) {

2933  
çl£
;

2935  
Œue
;

2936 
	}
}

2948 
r¡©us_t


2949 
	$upd©e_£rv”_sh¬ds_äom_cÚf_jsÚ
(
JSON_Objeù
 *
pobj
,

2950 
¬¿y
 *
¤v_sh¬ds
,

2951 
£rv”_poŞ
 *
¥
)

2953 
r¡©us_t
 
rv
 = 
NC_OK
;

2955 ià(!
	`§n™y_check_poŞ_cÚf_jsÚ
(
pobj
)) {

2956 
	`log_”rÜ
("invalid json conf object\n");

2957  
NC_ERROR
;

2961 cÚ¡ *
poŞ_Çme
 = 
	`jsÚ_objeù_g‘_¡ršg
(
pobj
, "name");

2962 ià(
	`¡¾’
(
poŞ_Çme
è!ğ¡¾’((cÚ¡ *)
¥
->
Çme
.
d©a
) ||

2963 
	`¡ºcmp
(
poŞ_Çme
, (cÚ¡ *)
¥
->
Çme
.
d©a
, 
	`¡¾’
(pool_name))) {

2964 
	`log_”rÜ
("pool conf znode‚ame %s !=…ool‚ame %s\n",

2965 
poŞ_Çme
, 
¥
->
Çme
.
d©a
);

2966  
NC_ERROR
;

2970 
cÚf_poŞ
 
cåoŞ
;

2971 
	`mem£t
(&
cåoŞ
, 0, (
cÚf_poŞ
));

2972 
rv
 = 
	`cÚf_jsÚ_to_cÚf_poŞ
(
pobj
, &
cåoŞ
, (*)
poŞ_Çme
);

2975 
cÚf_sh¬d
 *
cÚf_sd
 = 
NULL
;

2976 
cÚf_£rv”
 *
cÚf_¤v
 = 
NULL
;

2978 
sh¬d
* 
¤v_sd
 = 
NULL
;

2979 
£rv”
* 
¤v
 = 
NULL
;

2981 
ušt32_t
 
nsh¬ds
 = 
	`¬¿y_n
(&
cåoŞ
.
sh¬ds
);

2983 
ušt32_t
 
i
 = 0; i < 
nsh¬ds
; i++) {

2986 
cÚf_sd
 = 
	`¬¿y_g‘
(&
cåoŞ
.
sh¬ds
, 
i
);

2988 
¤v_sd
 = 
	`fšd_£rv”_sh¬d
(
cÚf_sd
, 
¤v_sh¬ds
);

2992 ià(
¤v_sd
 =ğ
NULL
) {

2993 
	`log_w¬n
("found‡‚ew conf_shard: [%d : %d]\n",

2994 
cÚf_sd
->
¿nge_begš
, cÚf_sd->
¿nge_’d
);

2995 ià(
	`¡ºcmp
(
cÚf_sd
->
¡©us
, "running", 7) != 0) {

2996 
	`log_w¬n
("new shard [%d : %d] is‡dded but status %s, skip it",

2997 
cÚf_sd
->
¿nge_begš
, cÚf_sd->
¿nge_’d
, cÚf_sd->
¡©us
);

3001 
¤v_sd
 = 
	`¬¿y_push
(
¤v_sh¬ds
);

3002 
	`mem£t
(
¤v_sd
, 0, (
sh¬d
));

3004 
¤v_sd
->
idx
 = 
	`¬¿y_idx
(
¤v_sh¬ds
, srv_sd);

3005 
rv
 = 
	`cÚf_sh¬d_to_£rv”_sh¬d
(
cÚf_sd
, 
¤v_sd
, 
¥
);

3008 
¤v
 = 
¤v_sd
->
ma¡”
;

3009 ià(
¤v
) {

3010 
	`add_£rv”_to_¡©s
(
¤v
, 
¥
);

3013 
ušt32_t
 
j
 = 0; j < 
	`¬¿y_n
(&
¤v_sd
->
¦aves
); j++) {

3014 
¤v
 = *(
£rv”
**)
	`¬¿y_g‘
(&
¤v_sd
->
¦aves
, 
j
);

3015 
	`add_£rv”_to_¡©s
(
¤v
, 
¥
);

3023 ià(
cÚf_sd
->
¿nge_’d
 !ğ
¤v_sd
->range_end ||

3024 
cÚf_sd
->
¿nge_begš
 !ğ
¤v_sd
->range_begin) {

3025 
	`log_w¬n
("conf-shard„ange shrinked. We might have seen‡ split: "

3027 
¤v_sd
->
¿nge_begš
, srv_sd->
¿nge_’d
,

3028 
cÚf_sd
->
¿nge_begš
, cÚf_sd->
¿nge_’d
);

3029 
¤v_sd
->
¿nge_begš
 = 
cÚf_sd
->range_begin;

3030 
¤v_sd
->
¿nge_’d
 = 
cÚf_sd
->range_end;

3035 
¤v
 = 
¤v_sd
->
ma¡”
;

3036 
cÚf_¤v
 = &
cÚf_sd
->
ma¡”
;

3037 ià(!
	`is_v®id_cÚf_£rv”
(
cÚf_¤v
)) {

3039 
	`log_”rÜ
("conf_shard has invalid master conf_server");

3041 } ià(!
	`cÚf_m©ch_£rv”
(
cÚf_¤v
, 
¤v
)) {

3042 
	`log_w¬n
("shard master changed. Use‚ew master: %s\n",

3043 
cÚf_¤v
->
Çme
.
d©a
);

3046 
£rv”
 *
Ãw_¤v
 =

3047 
	`AddS”v”FromAdd»ssSŒšg
(
¤v_sd
, (*)
cÚf_¤v
->
Çme
.
d©a
);

3049 
	`add_£rv”_to_¡©s
(
Ãw_¤v
, 
¥
);

3051 
¤v_sd
->
ma¡”
 = 
Ãw_¤v
;

3058 
ušt32_t
 
j
 = 0; j < 
	`¬¿y_n
(&
cÚf_sd
->
¦aves
); j++) {

3059 
cÚf_¤v
 = 
	`¬¿y_g‘
(&
cÚf_sd
->
¦aves
, 
j
);

3060 
¤v
 = 
	`fšd_£rv”_äom_cÚf_£rv”
(
cÚf_¤v
, &
¤v_sd
->
¦aves
);

3061 ià(
¤v
 =ğ
NULL
) {

3062 
	`log_w¬n
("Add‡‚ew slave server %so shard [%d : %d]\n",

3063 
cÚf_¤v
->
Çme
.
d©a
,

3064 
¤v_sd
->
¿nge_begš
,

3065 
¤v_sd
->
¿nge_’d
);

3066 
£rv”
 *
Ãw_¤v
 =

3067 
	`AddS”v”FromAdd»ssSŒšg
(
¤v_sd
, (*)
cÚf_¤v
->
Çme
.
d©a
);

3068 
£rv”
 **
µ¤v
 = (£rv”**)
	`¬¿y_push
(&
¤v_sd
->
¦aves
);

3069 *
µ¤v
 = 
Ãw_¤v
;

3072 
	`add_£rv”_to_¡©s
(
Ãw_¤v
, 
¥
);

3077 
	`£t_£rv”_sh¬d_¡©us
(
cÚf_sd
, 
¤v_sd
);

3080 
	`cÚf_poŞ_deš™
(&
cåoŞ
);

3082  
rv
;

3083 
	}
}

3086 
	$£t_£rv”_sh¬d_¡©us
(
cÚf_sh¬d
 *
cÚf_sd
, 
sh¬d
 *
¤v_sd
)

3088 
	`log_w¬n
("before: shard [%d : %d] status: can-read %d, can-write %d",

3089 
¤v_sd
->
¿nge_begš
, srv_sd->
¿nge_’d
,

3090 
¤v_sd
->
ÿn_»ad
, srv_sd->
ÿn_wr™e
);

3091 ià(
	`¡ºcmp
(
cÚf_sd
->
¡©us
, "init", 4) == 0) {

3092 
¤v_sd
->
ÿn_»ad
 = 0;

3093 
¤v_sd
->
ÿn_wr™e
 = 0;

3094 } ià(
	`¡ºcmp
(
cÚf_sd
->
¡©us
, "running", 7) == 0) {

3095 
¤v_sd
->
ÿn_»ad
 = 1;

3096 
¤v_sd
->
ÿn_wr™e
 = 1;

3097 } ià(
	`¡ºcmp
(
cÚf_sd
->
¡©us
, "draining", 8) == 0) {

3098 
¤v_sd
->
ÿn_»ad
 = 1;

3099 
¤v_sd
->
ÿn_wr™e
 = 0;

3101 
	`log_”rÜ
("unknowÀsh¬d stu %s\n", 
cÚf_sd
->
¡©us
);

3102 
¤v_sd
->
ÿn_»ad
 = 0;

3103 
¤v_sd
->
ÿn_wr™e
 = 0;

3105 
	`log_w¬n
("after: shard [%d : %d] status: can-read %d, can-write %d",

3106 
¤v_sd
->
¿nge_begš
, srv_sd->
¿nge_’d
,

3107 
¤v_sd
->
ÿn_»ad
, srv_sd->
ÿn_wr™e
);

3108 
	}
}

3110 
boŞ


3111 
	$is_v®id_cÚf_£rv”
(
cÚf_£rv”
 *
cÚf_¤v
)

3113  (
cÚf_¤v
->
Çme
.
d©a
 !ğ
NULL
 &&

3114 
cÚf_¤v
->
pÜt
 != 0 &&

3115 
cÚf_¤v
->
v®id
);

3116 
	}
}

3119 
	$cÚf_poŞ_w©ch”
(
zhªdË_t
 *
zkh
, 
ty³
, 
¡©e
,

3120 cÚ¡ *
·th
, *
ùx
)

3122 
£rv”_poŞ
 *
¥
 = (£rv”_poŞ*)
ùx
;

3123 
	`ASSERT
(
¥
 !ğ
NULL
);

3125 
	`log_”rÜ
("conf_pool_watcher gotƒvent %s, state %s‡t…ath %s",

3126 
	`Ty³2SŒšg
(
ty³
), 
	`S‹2SŒšg
(
¡©e
), 
·th
);

3128 ià(
ty³
 =ğ
ZOO_CREATED_EVENT
 ||y³ =ğ
ZOO_CHANGED_EVENT
) {

3129 
buæ’
 = 10000;

3130 
buf
[
buæ’
];

3131 
	`mem£t
(
buf
, 0, (
size_t
)
buæ’
);

3133 
rc
 = 
	`ZKG‘
(
zkh
, 
·th
, 
buf
, 
buæ’
, 0, 1);

3134 ià(
rc
 < 0 ||„ø>ğ
buæ’
) {

3135 
	`log_”rÜ
("»ad % çed,„‘ %d", 
·th
, 
rc
);

3139 
JSON_V®ue
 *
jroÙ
 = 
	`jsÚ_·r£_¡ršg_w™h_comm’ts
(
buf
);

3140 ià(!
jroÙ
 || (
JSONObjeù
 !ğ
	`jsÚ_ty³
(jroot))) {

3141 
	`log_”rÜ
("poŞ cÚfig znod”rÜ fÜm© : %s", 
buf
);

3142 
ex™
;

3145 
JSON_Objeù
* 
poŞ_obj
 = 
	`jsÚ_v®ue_g‘_objeù
(
jroÙ
);

3146 ià(!
	`§n™y_check_poŞ_cÚf_jsÚ
(
poŞ_obj
)) {

3147 
	`log_”rÜ
("poŞ cÚfig inv®id fÜm©: %s", 
buf
);

3148 
ex™
;

3152 
	`±h»ad_mu‹x_lock
(&
¥
->
lock
);

3153 
	`upd©e_£rv”_sh¬ds_äom_cÚf_jsÚ
(
poŞ_obj
, &
¥
->
sh¬ds
, sp);

3154 
	`±h»ad_mu‹x_uÆock
(&
¥
->
lock
);

3157 } ià(
ty³
 =ğ
ZOO_DELETED_EVENT
) {

3161 
ex™
:

3162 
	`ZKS‘Exi¡sW©ch
(
zkh
, (*)
·th
, 
cÚf_poŞ_w©ch”
, 
ùx
);

3163 
	}
}

3167 
r¡©us_t


3168 
	$add_w©ch”_Ú_cÚf_poŞ
(
cÚ‹xt
 *
ùx
)

3170 ià(
ùx
->
zkh
 =ğ
NULL
) {

3171 
	`log_”rÜ
("NO connectiono ZK isƒstablished.\n");

3172  
NC_ERROR
;

3175 
size_t
 
·thËn
 = 500;

3176 
zk·th
[
·thËn
];

3177 
¬¿y
 *
poŞs
 = &
ùx
->
poŞ
;

3178 
š¡ªû
 *
š¡
 = 
ùx
->
owÃr_š¡
;

3179 
r¡©us_t
 
rv
 = 
NC_OK
;

3182 
ušt32_t
 
i
 = 0; i < 
	`¬¿y_n
(
poŞs
); i++ ) {

3185 
	`¢´štf
(
zk·th
, 
·thËn
, "%s/%s", 
š¡
->
zk_cÚfig_roÙ
, in¡->
poŞ_Çme
);

3187 
£rv”_poŞ
 *
¥
 = (£rv”_poŞ *)
	`¬¿y_g‘
(
poŞs
, 
i
);

3188 
rc
 = 
	`ZKS‘Exi¡sW©ch
(
ùx
->
zkh
, 
zk·th
, 
cÚf_poŞ_w©ch”
, 
¥
);

3189 ià(
rc
 !ğ
ZOK
) {

3190 
	`log_”rÜ
("çedØ£ˆw©ch” oÀznod%s", 
zk·th
);

3191 
rv
 = 
NC_ERROR
;

3193 
	`log_w¬n
("havpuˆw©ch” oÀznod%s", 
zk·th
);

3194 
rv
 = 
NC_OK
;

3198  
rv
;

3199 
	}
}

	@nc_conf.h

18 #iâdeà
_NC_CONF_H_


19 
	#_NC_CONF_H_


	)

21 
	~<uni¡d.h
>

22 
	~<sys/ty³s.h
>

23 
	~<sys/un.h
>

24 
	~<yaml.h
>

26 
	~<nc_cÜe.h
>

27 
	~<hashk™/nc_hashk™.h
>

29 
	#CONF_OK
 (*è
NULL


	)

30 
	#CONF_ERROR
 (*è"ha ª inv®id v®ue"

	)

32 
	#CONF_ROOT_DEPTH
 1

	)

33 
	#CONF_MAX_DEPTH
 
CONF_ROOT_DEPTH
 + 1

	)

35 
	#CONF_DEFAULT_ARGS
 3

	)

36 
	#CONF_DEFAULT_POOL
 8

	)

37 
	#CONF_DEFAULT_SERVERS
 8

	)

38 
	#CONF_DEFAULT_PROXIES
 8

39 
	#CONF_DEFAULT_SHARDS
 8

40 
	#CONF_DEFAULT_SLAVES
 2

41 

	)

42 
	#CONF_UNSET_NUM
 -1

	)

43 
	#CONF_UNSET_PTR
 
NULL


	)

44 
	#CONF_UNSET_HASH
 (
hash_ty³_t
è-1

	)

45 
	#CONF_UNSET_DIST
 (
di¡_ty³_t
è-1

	)

47 
	#CONF_DEFAULT_HASH
 
HASH_FNV1A_64


	)

48 
	#CONF_DEFAULT_DIST
 
DIST_KETAMA


	)

49 
	#CONF_DEFAULT_TIMEOUT
 -1

	)

50 
	#CONF_DEFAULT_LISTEN_BACKLOG
 512

	)

51 
	#CONF_DEFAULT_CLIENT_CONNECTIONS
 0

	)

52 
	#CONF_DEFAULT_REDIS
 
çl£


	)

53 
	#CONF_DEFAULT_REDIS_DB
 0

	)

54 
	#CONF_DEFAULT_PRECONNECT
 
çl£


	)

55 
	#CONF_DEFAULT_AUTO_EJECT_HOSTS
 
çl£


	)

56 
	#CONF_DEFAULT_SERVER_RETRY_TIMEOUT
 30 * 1000

	)

57 
	#CONF_DEFAULT_SERVER_FAILURE_LIMIT
 2

	)

58 
	#CONF_DEFAULT_SERVER_CONNECTIONS
 2

	)

59 
	#CONF_DEFAULT_KETAMA_PORT
 11211

	)

60 
	#CONF_DEFAULT_TCPKEEPALIVE
 
çl£


	)

63 
	#ZK_BASE
 "/di¡kv"

	)

66 
	#CONF_DEFAULT_CONF_ZNODE
 "/di¡kv/´oxy"

	)

69 
	#CONF_DEFAULT_FILE_SAVE_PATH
 "/tmp/nc-cÚf"

	)

71 
	scÚf_li¡’
 {

72 
¡ršg
 
	m²ame
;

73 
¡ršg
 
	mÇme
;

74 
	mpÜt
;

75 
mode_t
 
	m³rm
;

76 
sockšfo
 
	mšfo
;

77 
	mv®id
:1;

80 
	scÚf_£rv”
 {

81 
¡ršg
 
	m²ame
;

82 
¡ršg
 
	mÇme
;

83 
¡ršg
 
	maddr¡r
;

84 
	mpÜt
;

85 
	mweight
;

86 
sockšfo
 
	mšfo
;

87 
	mv®id
:1;

91 
	scÚf_sh¬d
 {

92 
ušt32_t
 
	m¿nge_begš
;

93 
ušt32_t
 
	m¿nge_’d
;

95 
cÚf_£rv”
 
	mma¡”
;

96 
¬¿y
 
	m¦aves
;

98 
	m¡©us
[32];

101 
	scÚf_poŞ
 {

102 
¡ršg
 
	mÇme
;

103 
cÚf_li¡’
 
	mli¡’
;

104 
hash_ty³_t
 
	mhash
;

105 
¡ršg
 
	mhash_g
;

106 
di¡_ty³_t
 
	mdi¡ributiÚ
;

107 
	mtimeout
;

108 
	mbacklog
;

109 
	mş›Á_cÚÃùiÚs
;

110 
	mtık“·live
;

111 
	m»dis
;

112 
¡ršg
 
	m»dis_auth
;

113 
	m»dis_db
;

114 
	m´ecÚÃù
;

115 
	mauto_ejeù_ho¡s
;

116 
	m£rv”_cÚÃùiÚs
;

117 
ušt32_t
 
	m£rv”_»Œy_timeout
;

118 
ušt32_t
 
	m£rv”_çu»_lim™
;

119 
¬¿y
 
	m£rv”
;

120 
	mv®id
:1;

122 
ušt32_t
 
	msh¬d_¿nge_mš
;

123 
ušt32_t
 
	msh¬d_¿nge_max
;

124 
¬¿y
 
	m´ox›s
;

125 
¬¿y
 
	msh¬ds
;

128 
	scÚf
 {

129 *
	mâame
;

130 *
	mzk_£rv”s
;

131 
FILE
 *
	mfh
;

132 
¬¿y
 
	m¬g
;

133 
¬¿y
 
	mpoŞ
;

134 
ušt32_t
 
	md•th
;

135 
yaml_·r£r_t
 
	m·r£r
;

136 
yaml_ev’t_t
 
	mev’t
;

137 
yaml_tok’_t
 
	mtok’
;

138 
	m£q
:1;

139 
	mv®id_·r£r
:1;

140 
	mv®id_ev’t
:1;

141 
	mv®id_tok’
:1;

142 
	msound
:1;

143 
	m·r£d
:1;

144 
	mv®id
:1;

147 
	scommªd
 {

148 
¡ršg
 
	mÇme
;

149 *(*
	m£t
)(
cÚf
 *
	mcf
, 
commªd
 *
	mcmd
, *
	md©a
);

150 
	moff£t
;

153 
	#nuÎ_commªd
 { 
nuÎ_¡ršg
, 
NULL
, 0 }

	)

155 *
cÚf_£t_¡ršg
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf);

156 *
cÚf_£t_li¡’
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf);

157 *
cÚf_add_£rv”
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf);

158 *
cÚf_£t_num
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf);

159 *
cÚf_£t_boŞ
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf);

160 *
cÚf_£t_hash
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf);

161 *
cÚf_£t_di¡ributiÚ
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf);

162 *
cÚf_£t_hashg
(
cÚf
 *
cf
, 
commªd
 *
cmd
, *conf);

164 
r¡©us_t
 
cÚf_£rv”_—ch_ŒªsfÜm
(*
–em
, *
d©a
);

165 
r¡©us_t
 
cÚf_poŞ_—ch_ŒªsfÜm
(*
–em
, *
d©a
);

167 
cÚf
 *
cÚf_ü—‹
(*
f’ame
);

169 
cÚf
 *
cÚf_jsÚ_ü—‹
(*
f’ame
, 
š¡ªû
 *
nci
);

171 
cÚf
 *
cÚf_jsÚ_ü—‹_äom_zk
(*
zk£rv”s
, 
š¡ªû
 *
nci
,

172 
cÚ‹xt
 *
ùx
);

173 
cÚf_de¡roy
(
cÚf
 *
cf
);

174 
cÚf
 *
ü—‹_poŞ_cÚf_äom_fe
(*
f•©h
, 
cÚ‹xt
 *
ùx
);

176 
cÚf
 *
g‘_poŞ_cÚf_äom_zk
(* 
zk£rv”s
, 
cÚ‹xt
 *
ùx
);

177 
r¡©us_t
 
add_w©ch”_Ú_cÚf_poŞ
(
cÚ‹xt
 *
ùx
);

	@nc_connection.c

18 
	~<sys/uio.h
>

20 
	~<nc_cÜe.h
>

21 
	~<nc_£rv”.h
>

22 
	~<nc_ş›Á.h
>

23 
	~<nc_´oxy.h
>

24 
	~<´Ùo/nc_´Ùo.h
>

84 
ušt32_t
 
	gnä“_cÚnq
;

85 
cÚn_tqh
 
	gä“_cÚnq
;

86 
ušt64_t
 
	gÁÙ®_cÚn
;

87 
ušt32_t
 
	gncu¼_cÚn
;

88 
ušt32_t
 
	gncu¼_ccÚn
;

93 
cÚ‹xt
 *

94 
	$cÚn_to_ùx
(
cÚn
 *conn)

96 
£rv”_poŞ
 *
poŞ
;

98 ià(
cÚn
->
´oxy
 || cÚn->
ş›Á
) {

99 
poŞ
 = 
cÚn
->
owÃr
;

101 
£rv”
 *£rv” = 
cÚn
->
owÃr
;

102 
poŞ
 = 
£rv”
->
owÃr
;

105  
poŞ
->
ùx
;

106 
	}
}

108 
cÚn
 *

109 
	$_cÚn_g‘
()

111 
cÚn
 *conn;

113 ià(!
	`TAILQ_EMPTY
(&
ä“_cÚnq
)) {

114 
	`ASSERT
(
nä“_cÚnq
 > 0);

116 
cÚn
 = 
	`TAILQ_FIRST
(&
ä“_cÚnq
);

117 
nä“_cÚnq
--;

118 
	`TAILQ_REMOVE
(&
ä“_cÚnq
, 
cÚn
, 
cÚn_tqe
);

120 
cÚn
 = 
	`nc_®loc
((*conn));

121 ià(
cÚn
 =ğ
NULL
) {

122  
NULL
;

126 
cÚn
->
owÃr
 = 
NULL
;

128 
cÚn
->
sd
 = -1;

131 
	`TAILQ_INIT
(&
cÚn
->
imsg_q
);

132 
	`TAILQ_INIT
(&
cÚn
->
omsg_q
);

133 
cÚn
->
rmsg
 = 
NULL
;

134 
cÚn
->
smsg
 = 
NULL
;

142 
cÚn
->
£nd_by‹s
 = 0;

143 
cÚn
->
»cv_by‹s
 = 0;

145 
cÚn
->
ev’ts
 = 0;

146 
cÚn
->
”r
 = 0;

147 
cÚn
->
»cv_aùive
 = 0;

148 
cÚn
->
»cv_»ady
 = 0;

149 
cÚn
->
£nd_aùive
 = 0;

150 
cÚn
->
£nd_»ady
 = 0;

152 
cÚn
->
ş›Á
 = 0;

153 
cÚn
->
´oxy
 = 0;

154 
cÚn
->
cÚÃùšg
 = 0;

155 
cÚn
->
cÚÃùed
 = 0;

156 
cÚn
->
eof
 = 0;

157 
cÚn
->
dÚe
 = 0;

158 
cÚn
->
»dis
 = 0;

159 
cÚn
->
auth’tiÿ‹d
 = 0;

161 
ÁÙ®_cÚn
++;

162 
ncu¼_cÚn
++;

164  
cÚn
;

165 
	}
}

167 
cÚn
 *

168 
	$cÚn_g‘
(*
owÃr
, 
boŞ
 
ş›Á
, boŞ 
»dis
)

170 
cÚn
 *conn;

172 
cÚn
 = 
	`_cÚn_g‘
();

173 ià(
cÚn
 =ğ
NULL
) {

174  
NULL
;

178 
cÚn
->
»dis
 =„edis ? 1 : 0;

180 
cÚn
->
ş›Á
 = client ? 1 : 0;

182 ià(
cÚn
->
ş›Á
) {

187 
cÚn
->
»cv
 = 
msg_»cv
;

188 
cÚn
->
»cv_Ãxt
 = 
»q_»cv_Ãxt
;

189 
cÚn
->
»cv_dÚe
 = 
»q_»cv_dÚe
;

191 
cÚn
->
£nd
 = 
msg_£nd
;

192 
cÚn
->
£nd_Ãxt
 = 
r¥_£nd_Ãxt
;

193 
cÚn
->
£nd_dÚe
 = 
r¥_£nd_dÚe
;

195 
cÚn
->
şo£
 = 
ş›Á_şo£
;

196 
cÚn
->
aùive
 = 
ş›Á_aùive
;

198 
cÚn
->
»f
 = 
ş›Á_»f
;

199 
cÚn
->
uÄef
 = 
ş›Á_uÄef
;

201 
cÚn
->
’queue_šq
 = 
NULL
;

202 
cÚn
->
dequeue_šq
 = 
NULL
;

203 
cÚn
->
’queue_outq
 = 
»q_ş›Á_’queue_omsgq
;

204 
cÚn
->
dequeue_outq
 = 
»q_ş›Á_dequeue_omsgq
;

205 
cÚn
->
po¡_cÚÃù
 = 
NULL
;

206 
cÚn
->
sw®low_msg
 = 
NULL
;

208 
ncu¼_ccÚn
++;

214 
cÚn
->
»cv
 = 
msg_»cv
;

215 
cÚn
->
»cv_Ãxt
 = 
r¥_»cv_Ãxt
;

216 
cÚn
->
»cv_dÚe
 = 
r¥_»cv_dÚe
;

218 
cÚn
->
£nd
 = 
msg_£nd
;

219 
cÚn
->
£nd_Ãxt
 = 
»q_£nd_Ãxt
;

220 
cÚn
->
£nd_dÚe
 = 
»q_£nd_dÚe
;

222 
cÚn
->
şo£
 = 
£rv”_şo£
;

223 
cÚn
->
aùive
 = 
£rv”_aùive
;

225 
cÚn
->
»f
 = 
£rv”_»f
;

226 
cÚn
->
uÄef
 = 
£rv”_uÄef
;

228 
cÚn
->
’queue_šq
 = 
»q_£rv”_’queue_imsgq
;

229 
cÚn
->
dequeue_šq
 = 
»q_£rv”_dequeue_imsgq
;

230 
cÚn
->
’queue_outq
 = 
»q_£rv”_’queue_omsgq
;

231 
cÚn
->
dequeue_outq
 = 
»q_£rv”_dequeue_omsgq
;

232 ià(
»dis
) {

233 
cÚn
->
po¡_cÚÃù
 = 
»dis_po¡_cÚÃù
;

234 
cÚn
->
sw®low_msg
 = 
»dis_sw®low_msg
;

236 
cÚn
->
po¡_cÚÃù
 = 
memÿche_po¡_cÚÃù
;

237 
cÚn
->
sw®low_msg
 = 
memÿche_sw®low_msg
;

241 
cÚn
->
	`»f
(cÚn, 
owÃr
);

242 
	`log_debug
(
LOG_VVERB
, "g‘ cÚÀ%°ş›Á %d", 
cÚn
, cÚn->
ş›Á
);

244  
cÚn
;

245 
	}
}

247 
cÚn
 *

248 
	$cÚn_g‘_´oxy
(*
owÃr
)

250 
£rv”_poŞ
 *
poŞ
 = 
owÃr
;

251 
cÚn
 *conn;

253 
cÚn
 = 
	`_cÚn_g‘
();

254 ià(
cÚn
 =ğ
NULL
) {

255  
NULL
;

258 
cÚn
->
»dis
 = 
poŞ
->redis;

260 
cÚn
->
´oxy
 = 1;

262 
cÚn
->
»cv
 = 
´oxy_»cv
;

263 
cÚn
->
»cv_Ãxt
 = 
NULL
;

264 
cÚn
->
»cv_dÚe
 = 
NULL
;

266 
cÚn
->
£nd
 = 
NULL
;

267 
cÚn
->
£nd_Ãxt
 = 
NULL
;

268 
cÚn
->
£nd_dÚe
 = 
NULL
;

270 
cÚn
->
şo£
 = 
´oxy_şo£
;

271 
cÚn
->
aùive
 = 
NULL
;

273 
cÚn
->
»f
 = 
´oxy_»f
;

274 
cÚn
->
uÄef
 = 
´oxy_uÄef
;

276 
cÚn
->
’queue_šq
 = 
NULL
;

277 
cÚn
->
dequeue_šq
 = 
NULL
;

278 
cÚn
->
’queue_outq
 = 
NULL
;

279 
cÚn
->
dequeue_outq
 = 
NULL
;

281 
cÚn
->
	`»f
(cÚn, 
owÃr
);

283 
	`log_debug
(
LOG_VVERB
, "g‘ cÚÀ%°´oxy %d", 
cÚn
, cÚn->
´oxy
);

285  
cÚn
;

286 
	}
}

289 
	$cÚn_ä“
(
cÚn
 *conn)

291 
	`log_debug
(
LOG_VVERB
, "ä“ cÚÀ%p", 
cÚn
);

292 
	`nc_ä“
(
cÚn
);

293 
	}
}

296 
	$cÚn_put
(
cÚn
 *conn)

298 
	`ASSERT
(
cÚn
->
sd
 < 0);

299 
	`ASSERT
(
cÚn
->
owÃr
 =ğ
NULL
);

301 
	`log_debug
(
LOG_VVERB
, "puˆcÚÀ%p", 
cÚn
);

303 
nä“_cÚnq
++;

304 
	`TAILQ_INSERT_HEAD
(&
ä“_cÚnq
, 
cÚn
, 
cÚn_tqe
);

306 ià(
cÚn
->
ş›Á
) {

307 
ncu¼_ccÚn
--;

309 
ncu¼_cÚn
--;

310 
	}
}

313 
	$cÚn_š™
()

315 
	`log_debug
(
LOG_DEBUG
, "cÚÀsiz%d", (
cÚn
));

316 
nä“_cÚnq
 = 0;

317 
	`TAILQ_INIT
(&
ä“_cÚnq
);

318 
	}
}

321 
	$cÚn_deš™
()

323 
cÚn
 *cÚn, *
ncÚn
;

325 
cÚn
 = 
	`TAILQ_FIRST
(&
ä“_cÚnq
); cÚÀ!ğ
NULL
;

326 
cÚn
 = 
ncÚn
, 
nä“_cÚnq
--) {

327 
	`ASSERT
(
nä“_cÚnq
 > 0);

328 
ncÚn
 = 
	`TAILQ_NEXT
(
cÚn
, 
cÚn_tqe
);

329 
	`cÚn_ä“
(
cÚn
);

331 
	`ASSERT
(
nä“_cÚnq
 == 0);

332 
	}
}

334 
ssize_t


335 
	$cÚn_»cv
(
cÚn
 *cÚn, *
buf
, 
size_t
 
size
)

337 
ssize_t
 
n
;

339 
	`ASSERT
(
buf
 !ğ
NULL
);

340 
	`ASSERT
(
size
 > 0);

341 
	`ASSERT
(
cÚn
->
»cv_»ady
);

344 
n
 = 
	`nc_»ad
(
cÚn
->
sd
, 
buf
, 
size
);

346 
	`log_debug
(
LOG_VERB
, "»cv oÀsd %d %zd oà%zu", 
cÚn
->
sd
, 
n
, 
size
);

348 ià(
n
 > 0) {

349 ià(
n
 < (
ssize_t
è
size
) {

350 
cÚn
->
»cv_»ady
 = 0;

352 
cÚn
->
»cv_by‹s
 +ğ(
size_t
)
n
;

353  
n
;

356 ià(
n
 == 0) {

357 
cÚn
->
»cv_»ady
 = 0;

358 
cÚn
->
eof
 = 1;

359 
	`log_debug
(
LOG_INFO
, "»cv oÀsd %dƒoàrb %zu sb %zu", 
cÚn
->
sd
,

360 
cÚn
->
»cv_by‹s
, cÚn->
£nd_by‹s
);

361  
n
;

364 ià(
”ºo
 =ğ
EINTR
) {

365 
	`log_debug
(
LOG_VERB
, "»cv oÀsd %d‚Ù„—dy -ƒšŒ", 
cÚn
->
sd
);

367 } ià(
”ºo
 =ğ
EAGAIN
 ||ƒ¼nØ=ğ
EWOULDBLOCK
) {

368 
cÚn
->
»cv_»ady
 = 0;

369 
	`log_debug
(
LOG_VERB
, "»cv oÀsd %d‚Ù„—dy -ƒagaš", 
cÚn
->
sd
);

370  
NC_EAGAIN
;

372 
cÚn
->
»cv_»ady
 = 0;

373 
cÚn
->
”r
 = 
”ºo
;

374 
	`log_”rÜ
("»cv oÀsd %d faed: %s", 
cÚn
->
sd
, 
	`¡»¼Ü
(
”ºo
));

375  
NC_ERROR
;

379 
	`NOT_REACHED
();

381  
NC_ERROR
;

382 
	}
}

384 
ssize_t


385 
	$cÚn_£ndv
(
cÚn
 *cÚn, 
¬¿y
 *
£ndv
, 
size_t
 
n£nd
)

387 
ssize_t
 
n
;

389 
	`ASSERT
(
	`¬¿y_n
(
£ndv
) > 0);

390 
	`ASSERT
(
n£nd
 != 0);

391 
	`ASSERT
(
cÚn
->
£nd_»ady
);

394 
n
 = 
	`nc_wr™ev
(
cÚn
->
sd
, 
£ndv
->
–em
, s’dv->
ÃËm
);

396 
	`log_debug
(
LOG_VERB
, "£ndv oÀsd %d %zd oà%zu iÀ%"
PRIu32
" buffers",

397 
cÚn
->
sd
, 
n
, 
n£nd
, 
£ndv
->
ÃËm
);

399 ià(
n
 > 0) {

400 ià(
n
 < (
ssize_t
è
n£nd
) {

401 
cÚn
->
£nd_»ady
 = 0;

403 
cÚn
->
£nd_by‹s
 +ğ(
size_t
)
n
;

404  
n
;

407 ià(
n
 == 0) {

408 
	`log_w¬n
("£ndv oÀsd %d„‘uºed z”o", 
cÚn
->
sd
);

409 
cÚn
->
£nd_»ady
 = 0;

413 ià(
”ºo
 =ğ
EINTR
) {

414 
	`log_debug
(
LOG_VERB
, "£ndv oÀsd %d‚Ù„—dy -ƒšŒ", 
cÚn
->
sd
);

416 } ià(
”ºo
 =ğ
EAGAIN
 ||ƒ¼nØ=ğ
EWOULDBLOCK
) {

417 
cÚn
->
£nd_»ady
 = 0;

418 
	`log_debug
(
LOG_VERB
, "£ndv oÀsd %d‚Ù„—dy -ƒagaš", 
cÚn
->
sd
);

419  
NC_EAGAIN
;

421 
cÚn
->
£nd_»ady
 = 0;

422 
cÚn
->
”r
 = 
”ºo
;

423 
	`log_”rÜ
("£ndv oÀsd %d faed: %s", 
cÚn
->
sd
, 
	`¡»¼Ü
(
”ºo
));

424  
NC_ERROR
;

428 
	`NOT_REACHED
();

430  
NC_ERROR
;

431 
	}
}

433 
ušt32_t


434 
	$cÚn_ncu¼_cÚn
()

436  
ncu¼_cÚn
;

437 
	}
}

439 
ušt64_t


440 
	$cÚn_ÁÙ®_cÚn
()

442  
ÁÙ®_cÚn
;

443 
	}
}

445 
ušt32_t


446 
	$cÚn_ncu¼_ccÚn
()

448  
ncu¼_ccÚn
;

449 
	}
}

455 
boŞ


456 
	$cÚn_auth’tiÿ‹d
(
cÚn
 *conn)

458 
£rv”_poŞ
 *
poŞ
;

460 
	`ASSERT
(!
cÚn
->
´oxy
);

462 
poŞ
 = 
cÚn
->
ş›Á
 ? cÚn->
owÃr
 : ((
£rv”
 *)conn->owner)->owner;

464 ià(!
poŞ
->
»quœe_auth
) {

465  
Œue
;

468 ià(!
cÚn
->
auth’tiÿ‹d
) {

469  
çl£
;

472  
Œue
;

473 
	}
}

	@nc_connection.h

18 #iâdeà
_NC_CONNECTION_H_


19 
	#_NC_CONNECTION_H_


	)

21 
	~<nc_cÜe.h
>

23 
	$r¡©us_t
 (*
	tcÚn_»cv_t
)(
	tcÚ‹xt
 *, 
	tcÚn
*);

24 
msg
* (*
	tcÚn_»cv_Ãxt_t
)(
	tcÚ‹xt
 *, 
	tcÚn
 *, 
	tboŞ
);

25 (*
	tcÚn_»cv_dÚe_t
)(
	tcÚ‹xt
 *, 
	tcÚn
 *, 
	tmsg
 *, msg *);

27 
	$r¡©us_t
 (*
	tcÚn_£nd_t
)(
	tcÚ‹xt
 *, 
	tcÚn
*);

28 
msg
* (*
	tcÚn_£nd_Ãxt_t
)(
	tcÚ‹xt
 *, 
	tcÚn
 *);

29 (*
	tcÚn_£nd_dÚe_t
)(
	tcÚ‹xt
 *, 
	tcÚn
 *, 
	tmsg
 *);

31 (*
	tcÚn_şo£_t
)(
	tcÚ‹xt
 *, 
	tcÚn
 *);

32 
	$boŞ
 (*
	tcÚn_aùive_t
)(
	tcÚn
 *);

34 (*
	tcÚn_»f_t
)(
	tcÚn
 *, *);

35 (*
	tcÚn_uÄef_t
)(
	tcÚn
 *);

37 (*
	tcÚn_msgq_t
)(
	tcÚ‹xt
 *, 
	tcÚn
 *, 
	tmsg
 *);

38 (*
	tcÚn_po¡_cÚÃù_t
)(
	tcÚ‹xt
 *
	tùx
, 
	tcÚn
 *, 
	t£rv”
 *server);

39 (*
	tcÚn_sw®low_msg_t
)(
	tcÚn
 *, 
	tmsg
 *, msg *);

41 
	scÚn
 {

42 
	`TAILQ_ENTRY
(
cÚn
è
cÚn_tqe
;

43 *
owÃr
;

45 
sd
;

46 
çmy
;

47 
sockËn_t
 
add¾’
;

48 
sockaddr
 *
addr
;

50 
msg_tqh
 
imsg_q
;

51 
msg_tqh
 
omsg_q
;

52 
msg
 *
rmsg
;

53 
msg
 *
smsg
;

55 
cÚn_»cv_t
 
»cv
;

56 
cÚn_»cv_Ãxt_t
 
»cv_Ãxt
;

57 
cÚn_»cv_dÚe_t
 
»cv_dÚe
;

58 
cÚn_£nd_t
 
£nd
;

59 
cÚn_£nd_Ãxt_t
 
£nd_Ãxt
;

60 
cÚn_£nd_dÚe_t
 
£nd_dÚe
;

61 
cÚn_şo£_t
 
şo£
;

62 
cÚn_aùive_t
 
aùive
;

63 
cÚn_po¡_cÚÃù_t
 
po¡_cÚÃù
;

64 
cÚn_sw®low_msg_t
 
sw®low_msg
;

66 
cÚn_»f_t
 
»f
;

67 
cÚn_uÄef_t
 
uÄef
;

69 
cÚn_msgq_t
 
’queue_šq
;

70 
cÚn_msgq_t
 
dequeue_šq
;

71 
cÚn_msgq_t
 
’queue_outq
;

72 
cÚn_msgq_t
 
dequeue_outq
;

74 
size_t
 
»cv_by‹s
;

75 
size_t
 
£nd_by‹s
;

77 
ušt32_t
 
ev’ts
;

78 
”r_t
 
”r
;

79 
»cv_aùive
:1;

80 
»cv_»ady
:1;

81 
£nd_aùive
:1;

82 
£nd_»ady
:1;

84 
ş›Á
:1;

85 
´oxy
:1;

86 
cÚÃùšg
:1;

87 
cÚÃùed
:1;

88 
eof
:1;

89 
dÚe
:1;

90 
»dis
:1;

91 
auth’tiÿ‹d
:1;

94 
	`TAILQ_HEAD
(
cÚn_tqh
, 
cÚn
);

96 
cÚ‹xt
 *
	`cÚn_to_ùx
(
cÚn
 *conn);

97 
cÚn
 *
	`cÚn_g‘
(*
owÃr
, 
boŞ
 
ş›Á
, boŞ 
»dis
);

98 
cÚn
 *
	`cÚn_g‘_´oxy
(*
owÃr
);

99 
	`cÚn_put
(
cÚn
 *conn);

100 
ssize_t
 
	`cÚn_»cv
(
cÚn
 *cÚn, *
buf
, 
size_t
 
size
);

101 
ssize_t
 
	`cÚn_£ndv
(
cÚn
 *cÚn, 
¬¿y
 *
£ndv
, 
size_t
 
n£nd
);

102 
	`cÚn_š™
();

103 
	`cÚn_deš™
();

104 
ušt32_t
 
	`cÚn_ncu¼_cÚn
();

105 
ušt64_t
 
	`cÚn_ÁÙ®_cÚn
();

106 
ušt32_t
 
	`cÚn_ncu¼_ccÚn
();

107 
boŞ
 
	`cÚn_auth’tiÿ‹d
(
cÚn
 *conn);

	@nc_core.c

18 
	~<¡dlib.h
>

19 
	~<uni¡d.h
>

20 
	~<nc_cÜe.h
>

21 
	~<nc_cÚf.h
>

22 
	~<nc_£rv”.h
>

23 
	~<nc_´oxy.h
>

25 
ušt32_t
 
	gùx_id
;

27 
r¡©us_t


28 
	$cÜe_ÿlc_cÚÃùiÚs
(
cÚ‹xt
 *
ùx
)

30 
¡©us
;

31 
¾im™
 
lim™
;

33 
¡©us
 = 
	`g‘¾im™
(
RLIMIT_NOFILE
, &
lim™
);

34 ià(
¡©us
 < 0) {

35 
	`log_”rÜ
("g‘¾im™ faed: %s", 
	`¡»¼Ü
(
”ºo
));

36  
NC_ERROR
;

39 
ùx
->
max_nfd
 = (
ušt32_t
)
lim™
.
¾im_cur
;

40 
ùx
->
max_nccÚn
 = ctx->
max_nfd
 - ctx->
max_nscÚn
 - 
RESERVED_FDS
;

41 
	`log_debug
(
LOG_NOTICE
, "max fd %"
PRIu32
" max client conns %"PRIu32" "

42 "max s”v” cÚn %"
PRIu32
"", 
ùx
->
max_nfd
, ctx->
max_nccÚn
,

43 
ùx
->
max_nscÚn
);

45  
NC_OK
;

46 
	}
}

48 
cÚ‹xt
 *

49 
	$cÜe_ùx_ü—‹
(
š¡ªû
 *
nci
)

51 
r¡©us_t
 
¡©us
;

52 
cÚ‹xt
 *
ùx
;

54 
ùx
 = 
	`nc_®loc
((*ctx));

55 ià(
ùx
 =ğ
NULL
) {

56  
NULL
;

58 
ùx
->
id
 = ++
ùx_id
;

59 
ùx
->
cf
 = 
NULL
;

60 
ùx
->
¡©s
 = 
NULL
;

61 
ùx
->
evb
 = 
NULL
;

62 
	`¬¿y_nuÎ
(&
ùx
->
poŞ
);

63 
ùx
->
max_timeout
 = 
nci
->
¡©s_š‹rv®
;

64 
ùx
->
timeout
 = ctx->
max_timeout
;

65 
ùx
->
max_nfd
 = 0;

66 
ùx
->
max_nccÚn
 = 0;

67 
ùx
->
max_nscÚn
 = 0;

77 
ùx
->
owÃr_š¡
 = 
nci
;

78 
ùx
->
jsÚ_cf
 = 
NULL
;

79 ià(
nci
->
zk_£rv”s
) {

81 
ùx
->
jsÚ_cf
 = 
	`g‘_poŞ_cÚf_äom_zk
(
nci
->
zk_£rv”s
, ctx);

82 } ià(
nci
->
cÚf_f’ame
) {

83 
ùx
->
jsÚ_cf
 = 
	`cÚf_jsÚ_ü—‹
(
nci
->
cÚf_f’ame
,‚ci);

85 ià(!
ùx
->
jsÚ_cf
) {

86 
	`log_debug
(
LOG_NOTICE
, "no conf‡vailable");

87 
	`nc_ä“
(
ùx
);

88  
NULL
;

90 
ùx
->
cf
 = ctx->
jsÚ_cf
;

93 
št64_t
 
lowe¡
 = 1;

94 
št64_t
 
highe¡
 = 1000000000;

95 
sig_dig™s
 = 3;

96 
	`hdr_š™
(
lowe¡
, 
highe¡
, 
sig_dig™s
, &
ùx
->
hi¡og¿m
);

97 
	`±h»ad_mu‹x_š™
(&
ùx
->
hi¡o_lock
, 
NULL
);

100 
¡©us
 = 
	`£rv”_poŞ_š™
(&
ùx
->
poŞ
, &ùx->
jsÚ_cf
->pool, ctx);

101 ià(
¡©us
 !ğ
NC_OK
) {

102 
	`cÚf_de¡roy
(
ùx
->
cf
);

103 
	`nc_ä“
(
ùx
);

104  
NULL
;

111 
¡©us
 = 
	`cÜe_ÿlc_cÚÃùiÚs
(
ùx
);

112 ià(
¡©us
 !ğ
NC_OK
) {

113 
	`£rv”_poŞ_deš™
(&
ùx
->
poŞ
);

114 
	`cÚf_de¡roy
(
ùx
->
cf
);

115 
	`nc_ä“
(
ùx
);

116  
NULL
;

120 
ùx
->
¡©s
 = 
	`¡©s_ü—‹
(
nci
->
¡©s_pÜt
,‚ci->
¡©s_addr
,‚ci->
¡©s_š‹rv®
,

121 
nci
->
ho¡Çme
, &
ùx
->
poŞ
);

122 ià(
ùx
->
¡©s
 =ğ
NULL
) {

123 
	`£rv”_poŞ_deš™
(&
ùx
->
poŞ
);

124 
	`cÚf_de¡roy
(
ùx
->
cf
);

125 
	`nc_ä“
(
ùx
);

126  
NULL
;

128 
ùx
->
¡©s
->
cÚ‹xt
 = ctx;

131 
ùx
->
evb
 = 
	`ev’t_ba£_ü—‹
(
EVENT_SIZE
, &
cÜe_cÜe
);

132 ià(
ùx
->
evb
 =ğ
NULL
) {

133 
	`¡©s_de¡roy
(
ùx
->
¡©s
);

134 
	`£rv”_poŞ_deš™
(&
ùx
->
poŞ
);

135 
	`cÚf_de¡roy
(
ùx
->
cf
);

136 
	`nc_ä“
(
ùx
);

137  
NULL
;

141 
¡©us
 = 
	`£rv”_poŞ_´ecÚÃù
(
ùx
);

142 ià(
¡©us
 !ğ
NC_OK
) {

143 
	`£rv”_poŞ_discÚÃù
(
ùx
);

144 
	`ev’t_ba£_de¡roy
(
ùx
->
evb
);

145 
	`¡©s_de¡roy
(
ùx
->
¡©s
);

146 
	`£rv”_poŞ_deš™
(&
ùx
->
poŞ
);

147 
	`cÚf_de¡roy
(
ùx
->
cf
);

148 
	`nc_ä“
(
ùx
);

149  
NULL
;

153 
¡©us
 = 
	`´oxy_š™
(
ùx
);

154 ià(
¡©us
 !ğ
NC_OK
) {

155 
	`£rv”_poŞ_discÚÃù
(
ùx
);

156 
	`ev’t_ba£_de¡roy
(
ùx
->
evb
);

157 
	`¡©s_de¡roy
(
ùx
->
¡©s
);

158 
	`£rv”_poŞ_deš™
(&
ùx
->
poŞ
);

159 
	`cÚf_de¡roy
(
ùx
->
cf
);

160 
	`nc_ä“
(
ùx
);

161  
NULL
;

164 
	`log_debug
(
LOG_VVERB
, "ü—‹d ctx %°id %"
PRIu32
"", 
ùx
, ctx->
id
);

166  
ùx
;

167 
	}
}

170 
	$cÜe_ùx_de¡roy
(
cÚ‹xt
 *
ùx
)

172 
	`log_debug
(
LOG_VVERB
, "de¡roy ctx %°id %"
PRIu32
"", 
ùx
, ctx->
id
);

173 
	`´oxy_deš™
(
ùx
);

174 
	`£rv”_poŞ_discÚÃù
(
ùx
);

175 
	`ev’t_ba£_de¡roy
(
ùx
->
evb
);

176 
	`¡©s_de¡roy
(
ùx
->
¡©s
);

177 
	`£rv”_poŞ_deš™
(&
ùx
->
poŞ
);

178 
	`cÚf_de¡roy
(
ùx
->
cf
);

179 
	`cÚf_de¡roy
(
ùx
->
jsÚ_cf
);

180 
	`nc_ä“
(
ùx
);

181 
	}
}

183 
cÚ‹xt
 *

184 
	$cÜe_¡¬t
(
š¡ªû
 *
nci
)

186 
cÚ‹xt
 *
ùx
;

188 
	`mbuf_š™
(
nci
);

189 
	`msg_š™
();

190 
	`cÚn_š™
();

192 
ùx
 = 
	`cÜe_ùx_ü—‹
(
nci
);

193 ià(
ùx
 !ğ
NULL
) {

194 
nci
->
ùx
 = ctx;

195  
ùx
;

198 
	`cÚn_deš™
();

199 
	`msg_deš™
();

200 
	`mbuf_deš™
();

202  
NULL
;

203 
	}
}

206 
	$cÜe_¡İ
(
cÚ‹xt
 *
ùx
)

208 
	`cÚn_deš™
();

209 
	`msg_deš™
();

210 
	`mbuf_deš™
();

211 
	`cÜe_ùx_de¡roy
(
ùx
);

212 
	}
}

214 
r¡©us_t


215 
	$cÜe_»cv
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

217 
r¡©us_t
 
¡©us
;

219 
¡©us
 = 
cÚn
->
	`»cv
(
ùx
, conn);

220 ià(
¡©us
 !ğ
NC_OK
) {

221 
	`log_debug
(
LOG_INFO
, "recv on %c %d failed: %s",

222 
cÚn
->
ş›Á
 ? 'c' : (cÚn->
´oxy
 ? 'p' : 's'), cÚn->
sd
,

223 
	`¡»¼Ü
(
”ºo
));

226  
¡©us
;

227 
	}
}

229 
r¡©us_t


230 
	$cÜe_£nd
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

232 
r¡©us_t
 
¡©us
;

234 
¡©us
 = 
cÚn
->
	`£nd
(
ùx
, conn);

235 ià(
¡©us
 !ğ
NC_OK
) {

236 
	`log_debug
(
LOG_INFO
, "send on %c %d failed: status: %dƒrrno: %d %s",

237 
cÚn
->
ş›Á
 ? 'c' : (cÚn->
´oxy
 ? 'p' : 's'), cÚn->
sd
,

238 
¡©us
, 
”ºo
, 
	`¡»¼Ü
(errno));

241  
¡©us
;

242 
	}
}

245 
	$cÜe_şo£
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

247 
r¡©us_t
 
¡©us
;

248 
ty³
, *
addr¡r
;

250 
	`ASSERT
(
cÚn
->
sd
 > 0);

252 ià(
cÚn
->
ş›Á
) {

253 
ty³
 = 'c';

254 
addr¡r
 = 
	`nc_uÄesŞve_³”_desc
(
cÚn
->
sd
);

256 
ty³
 = 
cÚn
->
´oxy
 ? 'p' : 's';

257 
addr¡r
 = 
	`nc_uÄesŞve_addr
(
cÚn
->
addr
, cÚn->
add¾’
);

259 
	`log_debug
(
LOG_NOTICE
, "şo£ %ø%d '%s' oÀev’ˆ%04"
PRIX32
"ƒof %d done "

260 "%d„b %zu sb %zu%ø%s", 
ty³
, 
cÚn
->
sd
, 
addr¡r
, cÚn->
ev’ts
,

261 
cÚn
->
eof
, cÚn->
dÚe
, cÚn->
»cv_by‹s
, cÚn->
£nd_by‹s
,

262 
cÚn
->
”r
 ? ':' : ' ', cÚn->”¸? 
	`¡»¼Ü
(conn->err) : "");

264 
¡©us
 = 
	`ev’t_d–_cÚn
(
ùx
->
evb
, 
cÚn
);

265 ià(
¡©us
 < 0) {

266 
	`log_w¬n
("event del conn %c %d failed, ignored: %s",

267 
ty³
, 
cÚn
->
sd
, 
	`¡»¼Ü
(
”ºo
));

270 
cÚn
->
	`şo£
(
ùx
, conn);

271 
	}
}

274 
	$cÜe_”rÜ
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

276 
r¡©us_t
 
¡©us
;

277 
ty³
 = 
cÚn
->
ş›Á
 ? 'c' : (cÚn->
´oxy
 ? 'p' : 's');

279 
¡©us
 = 
	`nc_g‘_sÛ¼Ü
(
cÚn
->
sd
);

280 ià(
¡©us
 < 0) {

281 
	`log_w¬n
("g‘ sÛ¼ oÀ%ø%d faed, ignÜed: %s", 
ty³
, 
cÚn
->
sd
,

282 
	`¡»¼Ü
(
”ºo
));

284 
cÚn
->
”r
 = 
”ºo
;

286 
	`cÜe_şo£
(
ùx
, 
cÚn
);

287 
	}
}

290 
	$cÜe_timeout
(
cÚ‹xt
 *
ùx
)

293 
msg
 *msg;

294 
cÚn
 *conn;

295 
št64_t
 
now
, 
th’
;

297 
msg
 = 
	`msg_tmo_mš
();

298 ià(
msg
 =ğ
NULL
) {

299 
ùx
->
timeout
 = ctx->
max_timeout
;

305 ià(
msg
->
”rÜ
 || msg->
dÚe
) {

306 
	`msg_tmo_d–‘e
(
msg
);

315 
cÚn
 = 
msg
->
tmo_rbe
.
d©a
;

316 
th’
 = 
msg
->
tmo_rbe
.
key
;

318 
now
 = 
	`nc_m£c_now
();

319 ià(
now
 < 
th’
) {

320 
d–
 = ()(
th’
 - 
now
);

321 
ùx
->
timeout
 = 
	`MIN
(
d–
, ctx->
max_timeout
);

325 
	`log_debug
(
LOG_INFO
, "»q %"
PRIu64
" oÀ %dimedout", 
msg
->
id
, 
cÚn
->
sd
);

327 
	`msg_tmo_d–‘e
(
msg
);

328 
cÚn
->
”r
 = 
ETIMEDOUT
;

330 
	`cÜe_şo£
(
ùx
, 
cÚn
);

332 
	}
}

334 
r¡©us_t


335 
	$cÜe_cÜe
(*
¬g
, 
ušt32_t
 
ev’ts
)

337 
r¡©us_t
 
¡©us
;

338 
cÚn
 *cÚÀğ
¬g
;

339 
cÚ‹xt
 *
ùx
;

341 ià(
cÚn
->
owÃr
 =ğ
NULL
) {

342 
	`log_w¬n
("conn is‡lready unrefed!");

343  
NC_OK
;

346 
ùx
 = 
	`cÚn_to_ùx
(
cÚn
);

348 
	`log_debug
(
LOG_VVERB
, "ev’ˆ%04"
PRIX32
" oÀ%ø%d", 
ev’ts
,

349 
cÚn
->
ş›Á
 ? 'c' : (cÚn->
´oxy
 ? 'p' : 's'), cÚn->
sd
);

351 
cÚn
->
ev’ts
 =ƒvents;

354 ià(
ev’ts
 & 
EVENT_ERR
) {

355 
	`cÜe_”rÜ
(
ùx
, 
cÚn
);

356  
NC_ERROR
;

360 ià(
ev’ts
 & 
EVENT_READ
) {

361 
¡©us
 = 
	`cÜe_»cv
(
ùx
, 
cÚn
);

362 ià(
¡©us
 !ğ
NC_OK
 || 
cÚn
->
dÚe
 || cÚn->
”r
) {

363 
	`cÜe_şo£
(
ùx
, 
cÚn
);

364  
NC_ERROR
;

368 ià(
ev’ts
 & 
EVENT_WRITE
) {

369 
¡©us
 = 
	`cÜe_£nd
(
ùx
, 
cÚn
);

370 ià(
¡©us
 !ğ
NC_OK
 || 
cÚn
->
dÚe
 || cÚn->
”r
) {

371 
	`cÜe_şo£
(
ùx
, 
cÚn
);

372  
NC_ERROR
;

376  
NC_OK
;

377 
	}
}

379 
r¡©us_t


380 
	$cÜe_loİ
(
cÚ‹xt
 *
ùx
)

382 
nsd
;

384 
nsd
 = 
	`ev’t_wa™
(
ùx
->
evb
, ctx->
timeout
);

385 ià(
nsd
 < 0) {

386  
nsd
;

389 
	`cÜe_timeout
(
ùx
);

391 
	`¡©s_sw­
(
ùx
->
¡©s
);

393  
NC_OK
;

394 
	}
}

	@nc_core.h

18 #iâdeà
_NC_CORE_H_


19 
	#_NC_CORE_H_


	)

21 #ifdeà
HAVE_CONFIG_H


22 
	~<cÚfig.h
>

25 #ifdeà
HAVE_DEBUG_LOG


26 
	#NC_DEBUG_LOG
 1

	)

29 #ifdeà
HAVE_ASSERT_PANIC


30 
	#NC_ASSERT_PANIC
 1

	)

33 #ifdeà
HAVE_ASSERT_LOG


34 
	#NC_ASSERT_LOG
 1

	)

37 #ifdeà
HAVE_STATS


38 
	#NC_STATS
 1

	)

40 
	#NC_STATS
 0

	)

43 #ifdeà
HAVE_EPOLL


44 
	#NC_HAVE_EPOLL
 1

	)

45 #–ià
HAVE_KQUEUE


46 
	#NC_HAVE_KQUEUE
 1

	)

47 #–ià
HAVE_EVENT_PORTS


48 
	#NC_HAVE_EVENT_PORTS
 1

	)

50 #”rÜ 
missšg
 
sÿÏbË
 
I
/
O
 
ev’t
 
nÙifiÿtiÚ
 
mechªism


53 #ifdeà
HAVE_LITTLE_ENDIAN


54 
	#NC_LITTLE_ENDIAN
 1

	)

57 #ifdeà
HAVE_BACKTRACE


58 
	#NC_HAVE_BACKTRACE
 1

	)

61 
	#NC_OK
 0

	)

62 
	#NC_ERROR
 -1

	)

63 
	#NC_EAGAIN
 -2

	)

64 
	#NC_ENOMEM
 -3

	)

67 
	#RESERVED_FDS
 32

	)

69 
	tr¡©us_t
;

70 
	t”r_t
;

72 
	g¬¿y
;

73 
	g¡ršg
;

74 
	gcÚ‹xt
;

75 
	gcÚn
;

76 
	gcÚn_tqh
;

77 
	gmsg
;

78 
	gmsg_tqh
;

79 
	g£rv”
;

80 
	g£rv”_poŞ
;

81 
	gmbuf
;

82 
	gmhdr
;

83 
	gcÚf
;

84 
	g¡©s
;

85 
	gš¡ªû
;

86 
	gev’t_ba£
;

88 
	~<¡ddef.h
>

89 
	~<¡dšt.h
>

90 
	~<¡dboŞ.h
>

91 
	~<š‰y³s.h
>

92 
	~<¡ršg.h
>

93 
	~<¡dio.h
>

94 
	~<ùy³.h
>

95 
	~<”ºo.h
>

96 
	~<lim™s.h
>

97 
	~<time.h
>

98 
	~<uni¡d.h
>

99 
	~<±h»ad.h
>

101 
	~<sys/ty³s.h
>

102 
	~<sys/sock‘.h
>

103 
	~<sys/un.h
>

104 
	~<sys/time.h
>

105 
	~<sys/»sourû.h
>

106 
	~<Ãtš‘/š.h
>

108 
	~<nc_¬¿y.h
>

109 
	~<nc_¡ršg.h
>

110 
	~<nc_queue.h
>

111 
	~<nc_rbŒ“.h
>

112 
	~<nc_log.h
>

113 
	~<nc_ut.h
>

114 
	~<ev’t/nc_ev’t.h
>

115 
	~<nc_¡©s.h
>

116 
	~<nc_mbuf.h
>

117 
	~<nc_mes§ge.h
>

118 
	~<nc_cÚÃùiÚ.h
>

119 
	~<nc_£rv”.h
>

120 
	~<zkut.h
>

121 
	~<hdr_hi¡og¿m.h
>

123 
	gš¡ªû
;

125 
	scÚ‹xt
 {

126 
ušt32_t
 
	mid
;

127 
cÚf
 *
	mcf
;

128 
¡©s
 *
	m¡©s
;

131 
ev’t_ba£
 *
	mevb
;

132 
	mmax_timeout
;

133 
	mtimeout
;

135 
ušt32_t
 
	mmax_nfd
;

136 
ušt32_t
 
	mmax_nccÚn
;

137 
ušt32_t
 
	mmax_nscÚn
;

139 
cÚf
 *
	mjsÚ_cf
;

140 
¬¿y
 
	mpoŞ
;

142 
zhªdË_t
 *
	mzkh
;

144 
±h»ad_mu‹x_t
 
	mhi¡o_lock
;

145 
hdr_hi¡og¿m
 *
	mhi¡og¿m
;

147 
š¡ªû
 *
	mowÃr_š¡
;

151 
	sš¡ªû
 {

152 
cÚ‹xt
 *
	mùx
;

153 
	mlog_Ëv–
;

154 *
	mlog_f’ame
;

155 *
	mcÚf_f’ame
;

156 *
	mzk_£rv”s
;

157 *
	mzk_cÚfig_roÙ
;

158 
ušt16_t
 
	m¡©s_pÜt
;

159 
	m¡©s_š‹rv®
;

160 *
	m¡©s_addr
;

161 
	mho¡Çme
[
NC_MAXHOSTNAMELEN
];

162 
size_t
 
	mmbuf_chunk_size
;

163 
pid_t
 
	mpid
;

164 *
	mpid_f’ame
;

165 
	mpidfe
:1;

167 *
	m´oxy_
;

168 
ušt16_t
 
	m´oxy_pÜt
;

169 
	m´oxy_šs
[
NC_MAXHOSTNAMELEN
];

171 *
	mpoŞ_Çme
;

174 
cÚ‹xt
 *
cÜe_¡¬t
(
š¡ªû
 *
nci
);

175 
cÜe_¡İ
(
cÚ‹xt
 *
ùx
);

176 
r¡©us_t
 
cÜe_cÜe
(*
¬g
, 
ušt32_t
 
ev’ts
);

177 
r¡©us_t
 
cÜe_loİ
(
cÚ‹xt
 *
ùx
);

	@nc_log.c

18 
	~<¡dlib.h
>

19 
	~<¡d¬g.h
>

20 
	~<ùy³.h
>

21 
	~<time.h
>

22 
	~<sys/¡©.h
>

23 
	~<fú.h
>

25 
	~<nc_cÜe.h
>

27 
logg”
 
	glogg”
;

30 
	$log_š™
(
Ëv–
, *
Çme
)

32 
logg”
 *
l
 = &logger;

34 
l
->
Ëv–
 = 
	`MAX
(
LOG_EMERG
, 
	`MIN
Öev–, 
LOG_PVERB
));

35 
l
->
Çme
 =‚ame;

36 ià(
Çme
 =ğ
NULL
 || !
	`¡¾’
(name)) {

37 
l
->
fd
 = 
STDERR_FILENO
;

39 
l
->
fd
 = 
	`İ’
(
Çme
, 
O_WRONLY
 | 
O_APPEND
 | 
O_CREAT
, 0644);

40 ià(
l
->
fd
 < 0) {

41 
	`log_¡d”r
("İ’šg†og f'%s' faed: %s", 
Çme
,

42 
	`¡»¼Ü
(
”ºo
));

48 
	}
}

51 
	$log_deš™
()

53 
logg”
 *
l
 = &logger;

55 ià(
l
->
fd
 < 0 ||†->fd =ğ
STDERR_FILENO
) {

59 
	`şo£
(
l
->
fd
);

60 
	}
}

63 
	$log_»İ’
()

65 
logg”
 *
l
 = &logger;

67 ià(
l
->
fd
 !ğ
STDERR_FILENO
) {

68 
	`şo£
(
l
->
fd
);

69 
l
->
fd
 = 
	`İ’
Ö->
Çme
, 
O_WRONLY
 | 
O_APPEND
 | 
O_CREAT
, 0644);

70 ià(
l
->
fd
 < 0) {

71 
	`log_¡d”r_§ã
("»İ’šg†og f'%s' faed, ignÜed: %s", 
l
->
Çme
,

72 
	`¡»¼Ü
(
”ºo
));

75 
	}
}

78 
	$log_Ëv–_up
()

80 
logg”
 *
l
 = &logger;

82 ià(
l
->
Ëv–
 < 
LOG_PVERB
) {

83 
l
->
Ëv–
++;

84 
	`log_§ã
("u°log†ev–Ø%d", 
l
->
Ëv–
);

86 
	}
}

89 
	$log_Ëv–_down
()

91 
logg”
 *
l
 = &logger;

93 ià(
l
->
Ëv–
 > 
LOG_EMERG
) {

94 
l
->
Ëv–
--;

95 
	`log_§ã
("dowÀlog†ev–Ø%d", 
l
->
Ëv–
);

97 
	}
}

100 
	$log_Ëv–_£t
(
Ëv–
)

102 
logg”
 *
l
 = &logger;

104 
l
->
Ëv–
 = 
	`MAX
(
LOG_EMERG
, 
	`MIN
Öev–, 
LOG_PVERB
));

105 
	`loga
("£ˆlog†ev–Ø%d", 
l
->
Ëv–
);

106 
	}
}

109 
	$log_¡ackŒaû
()

111 
logg”
 *
l
 = &logger;

113 ià(
l
->
fd
 < 0) {

116 
	`nc_¡ackŒaû_fd
(
l
->
fd
);

117 
	}
}

120 
	$log_loggabË
(
Ëv–
)

122 
logg”
 *
l
 = &logger;

124 ià(
Ëv–
 > 
l
->level) {

129 
	}
}

132 
	$_log
(cÚ¡ *
fe
, 
lše
, 
·nic
, cÚ¡ *
fmt
, ...)

134 
logg”
 *
l
 = &logger;

135 
Ën
, 
size
, 
”ºo_§ve
;

136 
buf
[
LOG_MAX_LEN
];

137 
va_li¡
 
¬gs
;

138 
ssize_t
 
n
;

139 
timev®
 
tv
;

141 ià(
l
->
fd
 < 0) {

145 
”ºo_§ve
 = 
”ºo
;

146 
Ën
 = 0;

147 
size
 = 
LOG_MAX_LEN
;

149 
	`g‘timeofday
(&
tv
, 
NULL
);

150 
buf
[
Ën
++] = '[';

151 
Ën
 +ğ
	`nc_¡ráime
(
buf
 +†’, 
size
 -†’, "%Y-%m-%d %H:%M:%S.", 
	`loÿÉime
(&
tv
.
tv_£c
));

152 
Ën
 +ğ
	`nc_sú´štf
(
buf
 +†’, 
size
 -†’, "%03ld", 
tv
.
tv_u£c
/1000);

153 
Ën
 +ğ
	`nc_sú´štf
(
buf
 +†’, 
size
 -†’, "] %s:%d ", 
fe
, 
lše
);

155 
	`va_¡¬t
(
¬gs
, 
fmt
);

156 
Ën
 +ğ
	`nc_vsú´štf
(
buf
 +†’, 
size
 -†’, 
fmt
, 
¬gs
);

157 
	`va_’d
(
¬gs
);

159 
buf
[
Ën
++] = '\n';

161 
n
 = 
	`nc_wr™e
(
l
->
fd
, 
buf
, 
Ën
);

162 ià(
n
 < 0) {

163 
l
->
Ã¼Ü
++;

166 
”ºo
 = 
”ºo_§ve
;

168 ià(
·nic
) {

169 
	`abÜt
();

171 
	}
}

174 
	$_log_¡d”r
(cÚ¡ *
fmt
, ...)

176 
logg”
 *
l
 = &logger;

177 
Ën
, 
size
, 
”ºo_§ve
;

178 
buf
[4 * 
LOG_MAX_LEN
];

179 
va_li¡
 
¬gs
;

180 
ssize_t
 
n
;

182 
”ºo_§ve
 = 
”ºo
;

183 
Ën
 = 0;

184 
size
 = 4 * 
LOG_MAX_LEN
;

186 
	`va_¡¬t
(
¬gs
, 
fmt
);

187 
Ën
 +ğ
	`nc_vsú´štf
(
buf
, 
size
, 
fmt
, 
¬gs
);

188 
	`va_’d
(
¬gs
);

190 
buf
[
Ën
++] = '\n';

192 
n
 = 
	`nc_wr™e
(
STDERR_FILENO
, 
buf
, 
Ën
);

193 ià(
n
 < 0) {

194 
l
->
Ã¼Ü
++;

197 
”ºo
 = 
”ºo_§ve
;

198 
	}
}

205 
	$_log_hexdump
(cÚ¡ *
fe
, 
lše
, *
d©a
, 
d©®’
,

206 cÚ¡ *
fmt
, ...)

208 
logg”
 *
l
 = &logger;

209 
buf
[8 * 
LOG_MAX_LEN
];

210 
i
, 
off
, 
Ën
, 
size
, 
”ºo_§ve
;

211 
ssize_t
 
n
;

213 ià(
l
->
fd
 < 0) {

218 
”ºo_§ve
 = 
”ºo
;

219 
off
 = 0;

220 
Ën
 = 0;

221 
size
 = 8 * 
LOG_MAX_LEN
;

223 
d©®’
 !ğ0 && (
Ën
 < 
size
 - 1)) {

224 *
§ve
, *
¡r
;

225 
c
;

226 
§v–’
;

228 
Ën
 +ğ
	`nc_sú´štf
(
buf
 +†’, 
size
 -†’, "%08x ", 
off
);

230 
§ve
 = 
d©a
;

231 
§v–’
 = 
d©®’
;

233 
i
 = 0; 
d©®’
 !ğ0 && i < 16; 
d©a
++, datalen--, i++) {

234 
c
 = ()(*
d©a
);

235 
¡r
 = (
i
 == 7) ? " " : " ";

236 
Ën
 +ğ
	`nc_sú´štf
(
buf
 +†’, 
size
 -†’, "%02x%s", 
c
, 
¡r
);

238  ; 
i
 < 16; i++) {

239 
¡r
 = (
i
 == 7) ? " " : " ";

240 
Ën
 +ğ
	`nc_sú´štf
(
buf
 +†’, 
size
 -†’, " %s", 
¡r
);

243 
d©a
 = 
§ve
;

244 
d©®’
 = 
§v–’
;

246 
Ën
 +ğ
	`nc_sú´štf
(
buf
 +†’, 
size
 -†en, " |");

248 
i
 = 0; 
d©®’
 !ğ0 && i < 16; 
d©a
++, datalen--, i++) {

249 
c
 = ()(
	`i¥ršt
(*
d©a
) ? *data : '.');

250 
Ën
 +ğ
	`nc_sú´štf
(
buf
 +†’, 
size
 -†’, "%c", 
c
);

252 
Ën
 +ğ
	`nc_sú´štf
(
buf
 +†’, 
size
 -†en, "|\n");

254 
off
 += 16;

257 
n
 = 
	`nc_wr™e
(
l
->
fd
, 
buf
, 
Ën
);

258 ià(
n
 < 0) {

259 
l
->
Ã¼Ü
++;

262 ià(
Ën
 >ğ
size
 - 1) {

263 
n
 = 
	`nc_wr™e
(
l
->
fd
, "\n", 1);

264 ià(
n
 < 0) {

265 
l
->
Ã¼Ü
++;

269 
”ºo
 = 
”ºo_§ve
;

270 
	}
}

273 
	$_log_§ã
(cÚ¡ *
fmt
, ...)

275 
logg”
 *
l
 = &logger;

276 
Ën
, 
size
, 
”ºo_§ve
;

277 
buf
[
LOG_MAX_LEN
];

278 
va_li¡
 
¬gs
;

279 
ssize_t
 
n
;

281 ià(
l
->
fd
 < 0) {

285 
”ºo_§ve
 = 
”ºo
;

286 
Ën
 = 0;

287 
size
 = 
LOG_MAX_LEN
;

289 
Ën
 +ğ
	`nc_§ã_¢´štf
(
buf
 +†’, 
size
 -†en, "[.......................] ");

291 
	`va_¡¬t
(
¬gs
, 
fmt
);

292 
Ën
 +ğ
	`nc_§ã_v¢´štf
(
buf
 +†’, 
size
 -†’, 
fmt
, 
¬gs
);

293 
	`va_’d
(
¬gs
);

295 
buf
[
Ën
++] = '\n';

297 
n
 = 
	`nc_wr™e
(
l
->
fd
, 
buf
, 
Ën
);

298 ià(
n
 < 0) {

299 
l
->
Ã¼Ü
++;

302 
”ºo
 = 
”ºo_§ve
;

303 
	}
}

306 
	$_log_¡d”r_§ã
(cÚ¡ *
fmt
, ...)

308 
logg”
 *
l
 = &logger;

309 
Ën
, 
size
, 
”ºo_§ve
;

310 
buf
[
LOG_MAX_LEN
];

311 
va_li¡
 
¬gs
;

312 
ssize_t
 
n
;

314 
”ºo_§ve
 = 
”ºo
;

315 
Ën
 = 0;

316 
size
 = 
LOG_MAX_LEN
;

318 
Ën
 +ğ
	`nc_§ã_¢´štf
(
buf
 +†’, 
size
 -†en, "[.......................] ");

320 
	`va_¡¬t
(
¬gs
, 
fmt
);

321 
Ën
 +ğ
	`nc_§ã_v¢´štf
(
buf
 +†’, 
size
 -†’, 
fmt
, 
¬gs
);

322 
	`va_’d
(
¬gs
);

324 
buf
[
Ën
++] = '\n';

326 
n
 = 
	`nc_wr™e
(
STDERR_FILENO
, 
buf
, 
Ën
);

327 ià(
n
 < 0) {

328 
l
->
Ã¼Ü
++;

331 
”ºo
 = 
”ºo_§ve
;

332 
	}
}

	@nc_log.h

18 #iâdeà
_NC_LOG_H_


19 
	#_NC_LOG_H_


	)

21 
	slogg”
 {

22 *
	mÇme
;

23 
	mËv–
;

24 
	mfd
;

25 
	mÃ¼Ü
;

28 
	#LOG_EMERG
 0

	)

29 
	#LOG_ALERT
 1

	)

30 
	#LOG_CRIT
 2

	)

31 
	#LOG_ERR
 3

	)

32 
	#LOG_WARN
 4

	)

33 
	#LOG_NOTICE
 5

	)

34 
	#LOG_INFO
 6

	)

35 
	#LOG_DEBUG
 7

	)

36 
	#LOG_VERB
 8

	)

37 
	#LOG_VVERB
 9

	)

38 
	#LOG_VVVERB
 10

	)

39 
	#LOG_PVERB
 11

	)

41 
	#LOG_MAX_LEN
 256

	)

54 #ifdeà
NC_DEBUG_LOG


56 
	#log_debug
(
_Ëv–
, ...) do { \

57 ià(
	`log_loggabË
(
_Ëv–
) != 0) { \

58 
	`_log
(
__FILE__
, 
__LINE__
, 0, 
__VA_ARGS__
); \

60 } 0)

	)

62 
	#log_hexdump
(
_Ëv–
, 
_d©a
, 
_d©®’
, ...) do { \

63 ià(
	`log_loggabË
(
_Ëv–
) != 0) { \

64 
	`_log
(
__FILE__
, 
__LINE__
, 0, 
__VA_ARGS__
); \

65 
	`_log_hexdump
(
__FILE__
, 
__LINE__
, (*)(
_d©a
), ()(
_d©®’
), \

66 
__VA_ARGS__
); \

68 } 0)

	)

72 
	#log_debug
(
_Ëv–
, ...)

	)

73 
	#log_hexdump
(
_Ëv–
, 
_d©a
, 
_d©®’
, ...)

	)

77 
	#log_¡d”r
(...) do { \

78 
	`_log_¡d”r
(
__VA_ARGS__
); \

79 } 0)

	)

81 
	#log_§ã
(...) do { \

82 
	`_log_§ã
(
__VA_ARGS__
); \

83 } 0)

	)

85 
	#log_¡d”r_§ã
(...) do { \

86 
	`_log_¡d”r_§ã
(
__VA_ARGS__
); \

87 } 0)

	)

89 
	#loga
(...) do { \

90 
	`_log
(
__FILE__
, 
__LINE__
, 0, 
__VA_ARGS__
); \

91 } 0)

	)

93 
	#loga_hexdump
(
_d©a
, 
_d©®’
, ...) do { \

94 
	`_log
(
__FILE__
, 
__LINE__
, 0, 
__VA_ARGS__
); \

95 
	`_log_hexdump
(
__FILE__
, 
__LINE__
, (*)(
_d©a
), ()(
_d©®’
), \

96 
__VA_ARGS__
); \

98 

	)

99 
	#log_”rÜ
(...) do { \

100 ià(
	`log_loggabË
(
LOG_ALERT
) != 0) { \

101 
	`_log
(
__FILE__
, 
__LINE__
, 0, 
__VA_ARGS__
); \

103 } 0)

	)

105 
	#log_w¬n
(...) do { \

106 ià(
	`log_loggabË
(
LOG_WARN
) != 0) { \

107 
	`_log
(
__FILE__
, 
__LINE__
, 0, 
__VA_ARGS__
); \

109 } 0)

	)

111 
	#log_·nic
(...) do { \

112 ià(
	`log_loggabË
(
LOG_EMERG
) != 0) { \

113 
	`_log
(
__FILE__
, 
__LINE__
, 1, 
__VA_ARGS__
); \

115 } 0)

	)

117 
log_š™
(
Ëv–
, *
f’ame
);

118 
log_deš™
();

119 
log_Ëv–_up
();

120 
log_Ëv–_down
();

121 
log_Ëv–_£t
(
Ëv–
);

122 
log_¡ackŒaû
();

123 
log_»İ’
();

124 
log_loggabË
(
Ëv–
);

125 
_log
(cÚ¡ *
fe
, 
lše
, 
·nic
, cÚ¡ *
fmt
, ...);

126 
_log_¡d”r
(cÚ¡ *
fmt
, ...);

127 
_log_§ã
(cÚ¡ *
fmt
, ...);

128 
_log_¡d”r_§ã
(cÚ¡ *
fmt
, ...);

129 
_log_hexdump
(cÚ¡ *
fe
, 
lše
, *
d©a
, 
d©®’
, cÚ¡ *
fmt
, ...);

	@nc_mbuf.c

18 
	~<¡dlib.h
>

19 
	~<¡ršg.h
>

21 
	~<nc_cÜe.h
>

23 
ušt32_t
 
	gnä“_mbufq
;

24 
mhdr
 
	gä“_mbufq
;

26 
size_t
 
	gmbuf_chunk_size
;

27 
size_t
 
	gmbuf_off£t
;

29 
mbuf
 *

30 
	$_mbuf_g‘
()

32 
mbuf
 *mbuf;

33 
ušt8_t
 *
buf
;

35 ià(!
	`STAILQ_EMPTY
(&
ä“_mbufq
)) {

36 
	`ASSERT
(
nä“_mbufq
 > 0);

38 
mbuf
 = 
	`STAILQ_FIRST
(&
ä“_mbufq
);

39 
nä“_mbufq
--;

40 
	`STAILQ_REMOVE_HEAD
(&
ä“_mbufq
, 
Ãxt
);

42 
	`ASSERT
(
mbuf
->
magic
 =ğ
MBUF_MAGIC
);

43 
dÚe
;

46 
buf
 = 
	`nc_®loc
(
mbuf_chunk_size
);

47 ià(
buf
 =ğ
NULL
) {

48  
NULL
;

70 
mbuf
 = (mbuà*)(
buf
 + 
mbuf_off£t
);

71 
mbuf
->
magic
 = 
MBUF_MAGIC
;

73 
dÚe
:

74 
	`STAILQ_NEXT
(
mbuf
, 
Ãxt
èğ
NULL
;

75  
mbuf
;

76 
	}
}

78 
mbuf
 *

79 
	$mbuf_g‘
()

81 
mbuf
 *mbuf;

82 
ušt8_t
 *
buf
;

84 
mbuf
 = 
	`_mbuf_g‘
();

85 ià(
mbuf
 =ğ
NULL
) {

86  
NULL
;

89 
buf
 = (
ušt8_t
 *)
mbuf
 - 
mbuf_off£t
;

90 
mbuf
->
¡¬t
 = 
buf
;

91 
mbuf
->
’d
 = 
buf
 + 
mbuf_off£t
;

93 
	`ASSERT
(
mbuf
->
’d
 - mbuf->
¡¬t
 =ğ()
mbuf_off£t
);

94 
	`ASSERT
(
mbuf
->
¡¬t
 < mbuf->
’d
);

96 
mbuf
->
pos
 = mbuf->
¡¬t
;

97 
mbuf
->
Ï¡
 = mbuf->
¡¬t
;

99 
	`log_debug
(
LOG_VVERB
, "g‘ mbuà%p", 
mbuf
);

101  
mbuf
;

102 
	}
}

105 
	$mbuf_ä“
(
mbuf
 *mbuf)

107 
ušt8_t
 *
buf
;

109 
	`log_debug
(
LOG_VVERB
, "puˆmbuà%°ËÀ%d", 
mbuf
, mbuf->
Ï¡
 - mbuf->
pos
);

111 
	`ASSERT
(
	`STAILQ_NEXT
(
mbuf
, 
Ãxt
è=ğ
NULL
);

112 
	`ASSERT
(
mbuf
->
magic
 =ğ
MBUF_MAGIC
);

114 
buf
 = (
ušt8_t
 *)
mbuf
 - 
mbuf_off£t
;

115 
	`nc_ä“
(
buf
);

116 
	}
}

119 
	$mbuf_put
(
mbuf
 *mbuf)

121 
	`log_debug
(
LOG_VVERB
, "puˆmbuà%°ËÀ%d", 
mbuf
, mbuf->
Ï¡
 - mbuf->
pos
);

123 
	`ASSERT
(
	`STAILQ_NEXT
(
mbuf
, 
Ãxt
è=ğ
NULL
);

124 
	`ASSERT
(
mbuf
->
magic
 =ğ
MBUF_MAGIC
);

126 
nä“_mbufq
++;

127 
	`STAILQ_INSERT_HEAD
(&
ä“_mbufq
, 
mbuf
, 
Ãxt
);

128 
	}
}

135 
	$mbuf_»wšd
(
mbuf
 *mbuf)

137 
mbuf
->
pos
 = mbuf->
¡¬t
;

138 
mbuf
->
Ï¡
 = mbuf->
¡¬t
;

139 
	}
}

145 
ušt32_t


146 
	$mbuf_Ëngth
(
mbuf
 *mbuf)

148 
	`ASSERT
(
mbuf
->
Ï¡
 >ğmbuf->
pos
);

150  (
ušt32_t
)(
mbuf
->
Ï¡
 - mbuf->
pos
);

151 
	}
}

157 
ušt32_t


158 
	$mbuf_size
(
mbuf
 *mbuf)

160 
	`ASSERT
(
mbuf
->
’d
 >ğmbuf->
Ï¡
);

162  (
ušt32_t
)(
mbuf
->
’d
 - mbuf->
Ï¡
);

163 
	}
}

169 
size_t


170 
	$mbuf_d©a_size
()

172  
mbuf_off£t
;

173 
	}
}

179 
	$mbuf_š£¹
(
mhdr
 *mhdr, 
mbuf
 *mbuf)

181 
	`STAILQ_INSERT_TAIL
(
mhdr
, 
mbuf
, 
Ãxt
);

182 
	`log_debug
(
LOG_VVERB
, "š£¹ mbuà%°ËÀ%d", 
mbuf
, mbuf->
Ï¡
 - mbuf->
pos
);

183 
	}
}

189 
	$mbuf_»move
(
mhdr
 *mhdr, 
mbuf
 *mbuf)

191 
	`log_debug
(
LOG_VVERB
, "»movmbuà%°ËÀ%d", 
mbuf
, mbuf->
Ï¡
 - mbuf->
pos
);

193 
	`STAILQ_REMOVE
(
mhdr
, 
mbuf
, mbuf, 
Ãxt
);

194 
	`STAILQ_NEXT
(
mbuf
, 
Ãxt
èğ
NULL
;

195 
	}
}

204 
	$mbuf_cİy
(
mbuf
 *mbuf, 
ušt8_t
 *
pos
, 
size_t
 
n
)

206 ià(
n
 == 0) {

211 
	`ASSERT
(!
	`mbuf_fuÎ
(
mbuf
è&& 
n
 <ğ
	`mbuf_size
(mbuf));

214 
	`ASSERT
(
pos
 < 
mbuf
->
¡¬t
 ||…o >ğmbuf->
’d
);

216 
	`nc_memıy
(
mbuf
->
Ï¡
, 
pos
, 
n
);

217 
mbuf
->
Ï¡
 +ğ
n
;

218 
	}
}

227 
mbuf
 *

228 
	$mbuf_¥l™
(
mhdr
 *
h
, 
ušt8_t
 *
pos
, 
mbuf_cİy_t
 
cb
, *
cb¬g
)

230 
mbuf
 *mbuf, *
nbuf
;

231 
size_t
 
size
;

233 
	`ASSERT
(!
	`STAILQ_EMPTY
(
h
));

235 
mbuf
 = 
	`STAILQ_LAST
(
h
, mbuf, 
Ãxt
);

236 
	`ASSERT
(
pos
 >ğ
mbuf
->po &&…o <ğmbuf->
Ï¡
);

238 
nbuf
 = 
	`mbuf_g‘
();

239 ià(
nbuf
 =ğ
NULL
) {

240  
NULL
;

243 ià(
cb
 !ğ
NULL
) {

245 
	`cb
(
nbuf
, 
cb¬g
);

249 
size
 = (
size_t
)(
mbuf
->
Ï¡
 - 
pos
);

250 
	`mbuf_cİy
(
nbuf
, 
pos
, 
size
);

253 
mbuf
->
Ï¡
 = 
pos
;

255 
	`log_debug
(
LOG_VVERB
, "¥l™ iÁØmbuà%°ËÀ%"
PRIu32
"‡nd‚buf %p†en "

256 "%"
PRIu32
" cİ›d %zu by‹s", 
mbuf
, 
	`mbuf_Ëngth
(mbuf), 
nbuf
,

257 
	`mbuf_Ëngth
(
nbuf
), 
size
);

259  
nbuf
;

260 
	}
}

263 
	$mbuf_š™
(
š¡ªû
 *
nci
)

265 
nä“_mbufq
 = 0;

266 
	`STAILQ_INIT
(&
ä“_mbufq
);

268 
mbuf_chunk_size
 = 
nci
->mbuf_chunk_size;

269 
mbuf_off£t
 = 
mbuf_chunk_size
 - 
MBUF_HSIZE
;

271 
	`log_debug
(
LOG_DEBUG
, "mbuf hsize %d chunk size %zu offset %zu†ength %zu",

272 
MBUF_HSIZE
, 
mbuf_chunk_size
, 
mbuf_off£t
, mbuf_offset);

273 
	}
}

276 
	$mbuf_deš™
()

278 !
	`STAILQ_EMPTY
(&
ä“_mbufq
)) {

279 
mbuf
 *mbuàğ
	`STAILQ_FIRST
(&
ä“_mbufq
);

280 
	`mbuf_»move
(&
ä“_mbufq
, 
mbuf
);

281 
	`mbuf_ä“
(
mbuf
);

282 
nä“_mbufq
--;

284 
	`ASSERT
(
nä“_mbufq
 == 0);

285 
	}
}

	@nc_mbuf.h

18 #iâdeà
_NC_MBUF_H_


19 
	#_NC_MBUF_H_


	)

21 
	~<nc_cÜe.h
>

23 (*
	tmbuf_cİy_t
)(
	tmbuf
 *, *);

25 
	smbuf
 {

26 
ušt32_t
 
magic
;

27 
	`STAILQ_ENTRY
(
mbuf
è
Ãxt
;

28 
ušt8_t
 *
pos
;

29 
ušt8_t
 *
Ï¡
;

30 
ušt8_t
 *
¡¬t
;

31 
ušt8_t
 *
’d
;

34 
	`STAILQ_HEAD
(
mhdr
, 
mbuf
);

36 
	#MBUF_MAGIC
 0xd—db“f

	)

37 
	#MBUF_MIN_SIZE
 512

	)

38 
	#MBUF_MAX_SIZE
 16777216

	)

39 
	#MBUF_SIZE
 16384

	)

40 
	#MBUF_HSIZE
 (
mbuf
)

	)

42 
šlše
 
boŞ


43 
	$mbuf_em±y
(
mbuf
 *mbuf)

45  
mbuf
->
pos
 =ğmbuf->
Ï¡
 ? 
Œue
 : 
çl£
;

46 
	}
}

48 
šlše
 
boŞ


49 
	$mbuf_fuÎ
(
mbuf
 *mbuf)

51  
mbuf
->
Ï¡
 =ğmbuf->
’d
 ? 
Œue
 : 
çl£
;

52 
	}
}

54 
mbuf_š™
(
š¡ªû
 *
nci
);

55 
mbuf_deš™
();

56 
mbuf
 *
mbuf_g‘
();

57 
mbuf_put
(
mbuf
 *mbuf);

58 
mbuf_»wšd
(
mbuf
 *mbuf);

59 
ušt32_t
 
mbuf_Ëngth
(
mbuf
 *mbuf);

60 
ušt32_t
 
mbuf_size
(
mbuf
 *mbuf);

61 
size_t
 
mbuf_d©a_size
();

62 
mbuf_š£¹
(
mhdr
 *mhdr, 
mbuf
 *mbuf);

63 
mbuf_»move
(
mhdr
 *mhdr, 
mbuf
 *mbuf);

64 
mbuf_cİy
(
mbuf
 *mbuf, 
ušt8_t
 *
pos
, 
size_t
 
n
);

65 
mbuf
 *
mbuf_¥l™
(
mhdr
 *
h
, 
ušt8_t
 *
pos
, 
mbuf_cİy_t
 
cb
, *
cb¬g
);

	@nc_message.c

18 
	~<¡dio.h
>

19 
	~<¡dlib.h
>

21 
	~<sys/uio.h
>

23 
	~<nc_cÜe.h
>

24 
	~<nc_£rv”.h
>

25 
	~<´Ùo/nc_´Ùo.h
>

27 #ià(
IOV_MAX
 > 128)

28 
	#NC_IOV_MAX
 128

	)

30 
	#NC_IOV_MAX
 
IOV_MAX


	)

112 
ušt64_t
 
	gmsg_id
;

113 
ušt64_t
 
	gäag_id
;

114 
ušt32_t
 
	gnä“_msgq
;

115 
msg_tqh
 
	gä“_msgq
;

116 
rbŒ“
 
	gtmo_rbt
;

117 
rbnode
 
	gtmo_rbs
;

119 
	#DEFINE_ACTION
(
_Çme
è
	`¡ršg
(#_Çme),

	)

120 
¡ršg
 
	gmsg_ty³_¡ršgs
[] = {

121 
MSG_TYPE_CODEC
Ğ
DEFINE_ACTION
 )

122 
nuÎ_¡ršg


124 #undeà
DEFINE_ACTION


126 
msg
 *

127 
	$msg_äom_rbe
(
rbnode
 *
node
)

129 
msg
 *msg;

130 
off£t
;

132 
off£t
 = 
	`off£tof
(
msg
, 
tmo_rbe
);

133 
msg
 = (msg *)((*)
node
 - 
off£t
);

135  
msg
;

136 
	}
}

138 
msg
 *

139 
	$msg_tmo_mš
()

141 
rbnode
 *
node
;

143 
node
 = 
	`rbŒ“_mš
(&
tmo_rbt
);

144 ià(
node
 =ğ
NULL
) {

145  
NULL
;

148  
	`msg_äom_rbe
(
node
);

149 
	}
}

152 
	$msg_tmo_š£¹
(
msg
 *msg, 
cÚn
 *conn)

154 
rbnode
 *
node
;

155 
timeout
;

157 
	`ASSERT
(
msg
->
»que¡
);

158 
	`ASSERT
(!
msg
->
qu™
 && !msg->
nÜ•ly
);

160 
timeout
 = 
	`£rv”_timeout
(
cÚn
);

161 ià(
timeout
 <= 0) {

165 
node
 = &
msg
->
tmo_rbe
;

166 
node
->
key
 = 
	`nc_m£c_now
(è+ 
timeout
;

167 
node
->
d©a
 = 
cÚn
;

169 
	`rbŒ“_š£¹
(&
tmo_rbt
, 
node
);

171 
	`log_debug
(
LOG_VERB
, "š£¹ msg %"
PRIu64
" intomo„bt withƒxpiry of "

172 "%d m£c", 
msg
->
id
, 
timeout
);

173 
	}
}

176 
	$msg_tmo_d–‘e
(
msg
 *msg)

178 
rbnode
 *
node
;

180 
node
 = &
msg
->
tmo_rbe
;

184 ià(
node
->
d©a
 =ğ
NULL
) {

188 
	`rbŒ“_d–‘e
(&
tmo_rbt
, 
node
);

190 
	`log_debug
(
LOG_VERB
, "d–‘msg %"
PRIu64
" frommØrbt", 
msg
->
id
);

191 
	}
}

193 
msg
 *

194 
	$_msg_g‘
()

196 
msg
 *msg;

198 ià(!
	`TAILQ_EMPTY
(&
ä“_msgq
)) {

199 
	`ASSERT
(
nä“_msgq
 > 0);

201 
msg
 = 
	`TAILQ_FIRST
(&
ä“_msgq
);

202 
nä“_msgq
--;

203 
	`TAILQ_REMOVE
(&
ä“_msgq
, 
msg
, 
m_tqe
);

204 
dÚe
;

207 
msg
 = 
	`nc_®loc
((*msg));

208 ià(
msg
 =ğ
NULL
) {

209  
NULL
;

212 
dÚe
:

214 
msg
->
id
 = ++
msg_id
;

215 
msg
->
³”
 = 
NULL
;

216 
msg
->
owÃr
 = 
NULL
;

218 
	`rbŒ“_node_š™
(&
msg
->
tmo_rbe
);

220 
	`STAILQ_INIT
(&
msg
->
mhdr
);

221 
msg
->
mËn
 = 0;

222 
msg
->
¡¬t_ts
 = 0;

224 
msg
->
¡©e
 = 0;

225 
msg
->
pos
 = 
NULL
;

226 
msg
->
tok’
 = 
NULL
;

228 
msg
->
·r£r
 = 
NULL
;

229 
msg
->
add_auth
 = 
NULL
;

230 
msg
->
»suÉ
 = 
MSG_PARSE_OK
;

232 
msg
->
äagm’t
 = 
NULL
;

233 
msg
->
»¶y
 = 
NULL
;

234 
msg
->
´e_cßËsû
 = 
NULL
;

235 
msg
->
po¡_cßËsû
 = 
NULL
;

237 
msg
->
ty³
 = 
MSG_UNKNOWN
;

239 
msg
->
keys
 = 
	`¬¿y_ü—‹
(1, (
keypos
));

240 ià(
msg
->
keys
 =ğ
NULL
) {

241 
	`nc_ä“
(
msg
);

242  
NULL
;

245 
msg
->
vËn
 = 0;

246 
msg
->
’d
 = 
NULL
;

248 
msg
->
äag_owÃr
 = 
NULL
;

249 
msg
->
äag_£q
 = 
NULL
;

250 
msg
->
näag
 = 0;

251 
msg
->
näag_dÚe
 = 0;

252 
msg
->
äag_id
 = 0;

254 
msg
->
Çrg_¡¬t
 = 
NULL
;

255 
msg
->
Çrg_’d
 = 
NULL
;

256 
msg
->
Çrg
 = 0;

257 
msg
->
º¬g
 = 0;

258 
msg
->
¾’
 = 0;

259 
msg
->
š‹g”
 = 0;

261 
msg
->
”r
 = 0;

262 
msg
->
”rÜ
 = 0;

263 
msg
->
ã¼Ü
 = 0;

264 
msg
->
»que¡
 = 0;

265 
msg
->
qu™
 = 0;

266 
msg
->
nÜ•ly
 = 0;

267 
msg
->
nofÜw¬d
 = 0;

268 
msg
->
dÚe
 = 0;

269 
msg
->
fdÚe
 = 0;

270 
msg
->
sw®low
 = 0;

271 
msg
->
»dis
 = 0;

273 
msg
->
is_wr™e
 = 0;

274  
msg
;

275 
	}
}

277 
msg
 *

278 
	$msg_g‘
(
cÚn
 *cÚn, 
boŞ
 
»que¡
, boŞ 
»dis
)

280 
msg
 *msg;

282 
msg
 = 
	`_msg_g‘
();

283 ià(
msg
 =ğ
NULL
) {

284  
NULL
;

287 
msg
->
owÃr
 = 
cÚn
;

288 
msg
->
»que¡
 =„equest ? 1 : 0;

289 
msg
->
»dis
 =„edis ? 1 : 0;

291 ià(
»dis
) {

292 ià(
»que¡
) {

293 
msg
->
·r£r
 = 
»dis_·r£_»q
;

295 
msg
->
·r£r
 = 
»dis_·r£_r¥
;

297 
msg
->
add_auth
 = 
»dis_add_auth
;

298 
msg
->
äagm’t
 = 
»dis_äagm’t
;

299 
msg
->
»¶y
 = 
»dis_»¶y
;

300 
msg
->
çu»
 = 
»dis_çu»
;

301 
msg
->
´e_cßËsû
 = 
»dis_´e_cßËsû
;

302 
msg
->
po¡_cßËsû
 = 
»dis_po¡_cßËsû
;

304 ià(
»que¡
) {

305 
msg
->
·r£r
 = 
memÿche_·r£_»q
;

307 
msg
->
·r£r
 = 
memÿche_·r£_r¥
;

309 
msg
->
add_auth
 = 
memÿche_add_auth
;

310 
msg
->
äagm’t
 = 
memÿche_äagm’t
;

311 
msg
->
çu»
 = 
memÿche_çu»
;

312 
msg
->
´e_cßËsû
 = 
memÿche_´e_cßËsû
;

313 
msg
->
po¡_cßËsû
 = 
memÿche_po¡_cßËsû
;

316 ià(
	`log_loggabË
(
LOG_NOTICE
) != 0) {

317 
msg
->
¡¬t_ts
 = 
	`nc_u£c_now
();

320 
	`log_debug
(
LOG_VVERB
, "g‘ msg %°id %"
PRIu64
"„equest %d owner sd %d",

321 
msg
, msg->
id
, msg->
»que¡
, 
cÚn
->
sd
);

323  
msg
;

324 
	}
}

326 
msg
 *

327 
	$msg_g‘_”rÜ
(
boŞ
 
»dis
, 
”r_t
 
”r
)

329 
msg
 *msg;

330 
mbuf
 *mbuf;

331 
n
;

332 *
”r¡r
 = 
”r
 ? 
	`¡»¼Ü
(err) : "unknown";

333 *
´Ù¡r
 = 
»dis
 ? "-ERR" : "SERVER_ERROR";

335 
msg
 = 
	`_msg_g‘
();

336 ià(
msg
 =ğ
NULL
) {

337  
NULL
;

340 
msg
->
¡©e
 = 0;

341 
msg
->
ty³
 = 
MSG_RSP_MC_SERVER_ERROR
;

343 
mbuf
 = 
	`mbuf_g‘
();

344 ià(
mbuf
 =ğ
NULL
) {

345 
	`msg_put
(
msg
);

346  
NULL
;

348 
	`mbuf_š£¹
(&
msg
->
mhdr
, 
mbuf
);

350 
n
 = 
	`nc_sú´štf
(
mbuf
->
Ï¡
, 
	`mbuf_size
(mbuf), "% %s"
CRLF
, 
´Ù¡r
, 
”r¡r
);

351 
mbuf
->
Ï¡
 +ğ
n
;

352 
msg
->
mËn
 = (
ušt32_t
)
n
;

354 
	`log_debug
(
LOG_VVERB
, "g‘ msg %°id %"
PRIu64
"†’ %"
PRIu32
"ƒrror '%s'",

355 
msg
, msg->
id
, msg->
mËn
, 
”r¡r
);

357  
msg
;

358 
	}
}

361 
	$msg_ä“
(
msg
 *msg)

363 
	`ASSERT
(
	`STAILQ_EMPTY
(&
msg
->
mhdr
));

365 
	`log_debug
(
LOG_VVERB
, "ä“ msg %°id %"
PRIu64
"", 
msg
, msg->
id
);

366 
	`nc_ä“
(
msg
);

367 
	}
}

370 
	$msg_put
(
msg
 *msg)

372 
	`log_debug
(
LOG_VVERB
, "puˆmsg %°id %"
PRIu64
"", 
msg
, msg->
id
);

374 !
	`STAILQ_EMPTY
(&
msg
->
mhdr
)) {

375 
mbuf
 *mbuàğ
	`STAILQ_FIRST
(&
msg
->
mhdr
);

376 
	`mbuf_»move
(&
msg
->
mhdr
, 
mbuf
);

377 
	`mbuf_put
(
mbuf
);

380 ià(
msg
->
äag_£q
) {

381 
	`nc_ä“
(
msg
->
äag_£q
);

382 
msg
->
äag_£q
 = 
NULL
;

385 ià(
msg
->
keys
) {

386 
msg
->
keys
->
ÃËm
 = 0;

387 
	`¬¿y_de¡roy
(
msg
->
keys
);

388 
msg
->
keys
 = 
NULL
;

391 
nä“_msgq
++;

392 
	`TAILQ_INSERT_HEAD
(&
ä“_msgq
, 
msg
, 
m_tqe
);

393 
	}
}

396 
	$msg_dump
(
msg
 *msg, 
Ëv–
)

398 
mbuf
 *mbuf;

400 ià(
	`log_loggabË
(
Ëv–
) == 0) {

404 
	`loga
("msg dum°id %"
PRIu64
"„eque¡ %d†’ %"
PRIu32
"ype %d done %d "

405 "”rÜ %d (”¸%d)", 
msg
->
id
, msg->
»que¡
, msg->
mËn
, msg->
ty³
,

406 
msg
->
dÚe
, msg->
”rÜ
, msg->
”r
);

408 
	`STAILQ_FOREACH
(
mbuf
, &
msg
->
mhdr
, 
Ãxt
) {

409 
ušt8_t
 *
p
, *
q
;

410 
Ën
;

412 
p
 = 
mbuf
->
¡¬t
;

413 
q
 = 
mbuf
->
Ï¡
;

414 
Ën
 = 
q
 - 
p
;

416 
	`loga_hexdump
(
p
, 
Ën
, "mbuf [%p] with %ld bytes of data",…,†en);

418 
	}
}

421 
	$msg_š™
()

423 
	`log_debug
(
LOG_DEBUG
, "msg siz%d", (
msg
));

424 
msg_id
 = 0;

425 
äag_id
 = 0;

426 
nä“_msgq
 = 0;

427 
	`TAILQ_INIT
(&
ä“_msgq
);

428 
	`rbŒ“_š™
(&
tmo_rbt
, &
tmo_rbs
);

429 
	}
}

432 
	$msg_deš™
()

434 
msg
 *msg, *
nmsg
;

436 
msg
 = 
	`TAILQ_FIRST
(&
ä“_msgq
); msg !ğ
NULL
;

437 
msg
 = 
nmsg
, 
nä“_msgq
--) {

438 
	`ASSERT
(
nä“_msgq
 > 0);

439 
nmsg
 = 
	`TAILQ_NEXT
(
msg
, 
m_tqe
);

440 
	`msg_ä“
(
msg
);

442 
	`ASSERT
(
nä“_msgq
 == 0);

443 
	}
}

445 
¡ršg
 *

446 
	$msg_ty³_¡ršg
(
msg_ty³_t
 
ty³
)

448  &
msg_ty³_¡ršgs
[
ty³
];

449 
	}
}

451 
boŞ


452 
	$msg_em±y
(
msg
 *msg)

454  
msg
->
mËn
 =ğ0 ? 
Œue
 : 
çl£
;

455 
	}
}

457 
ušt32_t


458 
	$msg_back’d_idx
(
msg
 *msg, 
ušt8_t
 *
key
, 
ušt32_t
 
keyËn
)

460 
cÚn
 *cÚÀğ
msg
->
owÃr
;

461 
£rv”_poŞ
 *
poŞ
 = 
cÚn
->
owÃr
;

463  
	`£rv”_poŞ_idx
(
poŞ
, 
key
, 
keyËn
);

464 
	}
}

466 
mbuf
 *

467 
	$msg_’su»_mbuf
(
msg
 *msg, 
size_t
 
Ën
)

469 
mbuf
 *mbuf;

471 ià(
	`STAILQ_EMPTY
(&
msg
->
mhdr
) ||

472 
	`mbuf_size
(
	`STAILQ_LAST
(&
msg
->
mhdr
, 
mbuf
, 
Ãxt
)è< 
Ën
) {

473 
mbuf
 = 
	`mbuf_g‘
();

474 ià(
mbuf
 =ğ
NULL
) {

475  
NULL
;

477 
	`mbuf_š£¹
(&
msg
->
mhdr
, 
mbuf
);

479 
mbuf
 = 
	`STAILQ_LAST
(&
msg
->
mhdr
, mbuf, 
Ãxt
);

482  
mbuf
;

483 
	}
}

489 
r¡©us_t


490 
	$msg_­³nd
(
msg
 *msg, 
ušt8_t
 *
pos
, 
size_t
 
n
)

492 
mbuf
 *mbuf;

494 
	`ASSERT
(
n
 <ğ
	`mbuf_d©a_size
());

496 
mbuf
 = 
	`msg_’su»_mbuf
(
msg
, 
n
);

497 ià(
mbuf
 =ğ
NULL
) {

498  
NC_ENOMEM
;

501 
	`ASSERT
(
n
 <ğ
	`mbuf_size
(
mbuf
));

503 
	`mbuf_cİy
(
mbuf
, 
pos
, 
n
);

504 
msg
->
mËn
 +ğ(
ušt32_t
)
n
;

506  
NC_OK
;

507 
	}
}

513 
r¡©us_t


514 
	$msg_´•’d
(
msg
 *msg, 
ušt8_t
 *
pos
, 
size_t
 
n
)

516 
mbuf
 *mbuf;

518 
mbuf
 = 
	`mbuf_g‘
();

519 ià(
mbuf
 =ğ
NULL
) {

520  
NC_ENOMEM
;

523 
	`ASSERT
(
n
 <ğ
	`mbuf_size
(
mbuf
));

525 
	`mbuf_cİy
(
mbuf
, 
pos
, 
n
);

526 
msg
->
mËn
 +ğ(
ušt32_t
)
n
;

528 
	`STAILQ_INSERT_HEAD
(&
msg
->
mhdr
, 
mbuf
, 
Ãxt
);

530  
NC_OK
;

531 
	}
}

537 
r¡©us_t


538 
	$msg_´•’d_fÜm©
(
msg
 *msg, cÚ¡ *
fmt
, ...)

540 
mbuf
 *mbuf;

541 
n
;

542 
ušt32_t
 
size
;

543 
va_li¡
 
¬gs
;

545 
mbuf
 = 
	`mbuf_g‘
();

546 ià(
mbuf
 =ğ
NULL
) {

547  
NC_ENOMEM
;

550 
size
 = 
	`mbuf_size
(
mbuf
);

552 
	`va_¡¬t
(
¬gs
, 
fmt
);

553 
n
 = 
	`nc_v¢´štf
(
mbuf
->
Ï¡
, 
size
, 
fmt
, 
¬gs
);

554 
	`va_’d
(
¬gs
);

555 ià(
n
 <ğ0 ||‚ >ğ()
size
) {

556  
NC_ERROR
;

559 
mbuf
->
Ï¡
 +ğ
n
;

560 
msg
->
mËn
 +ğ(
ušt32_t
)
n
;

561 
	`STAILQ_INSERT_HEAD
(&
msg
->
mhdr
, 
mbuf
, 
Ãxt
);

563  
NC_OK
;

564 
	}
}

566 
šlše
 
ušt64_t


567 
	$msg_g’_äag_id
()

569  ++
äag_id
;

570 
	}
}

572 
r¡©us_t


573 
	$msg_·r£d
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

575 
msg
 *
nmsg
;

576 
mbuf
 *mbuf, *
nbuf
;

578 
mbuf
 = 
	`STAILQ_LAST
(&
msg
->
mhdr
, mbuf, 
Ãxt
);

579 ià(
msg
->
pos
 =ğ
mbuf
->
Ï¡
) {

581 
cÚn
->
	`»cv_dÚe
(
ùx
, cÚn, 
msg
, 
NULL
);

582  
NC_OK
;

591 
nbuf
 = 
	`mbuf_¥l™
(&
msg
->
mhdr
, msg->
pos
, 
NULL
, NULL);

592 ià(
nbuf
 =ğ
NULL
) {

593  
NC_ENOMEM
;

596 
nmsg
 = 
	`msg_g‘
(
msg
->
owÃr
, msg->
»que¡
, 
cÚn
->
»dis
);

597 ià(
nmsg
 =ğ
NULL
) {

598 
	`mbuf_put
(
nbuf
);

599  
NC_ENOMEM
;

601 
	`mbuf_š£¹
(&
nmsg
->
mhdr
, 
nbuf
);

602 
nmsg
->
pos
 = 
nbuf
->pos;

605 
nmsg
->
mËn
 = 
	`mbuf_Ëngth
(
nbuf
);

606 
msg
->
mËn
 -ğ
nmsg
->mlen;

608 
cÚn
->
	`»cv_dÚe
(
ùx
, cÚn, 
msg
, 
nmsg
);

610  
NC_OK
;

611 
	}
}

613 
r¡©us_t


614 
	$msg_»·œ
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

616 
mbuf
 *
nbuf
;

618 
nbuf
 = 
	`mbuf_¥l™
(&
msg
->
mhdr
, msg->
pos
, 
NULL
, NULL);

619 ià(
nbuf
 =ğ
NULL
) {

620  
NC_ENOMEM
;

622 
	`mbuf_š£¹
(&
msg
->
mhdr
, 
nbuf
);

623 
msg
->
pos
 = 
nbuf
->pos;

625  
NC_OK
;

626 
	}
}

628 
r¡©us_t


629 
	$msg_·r£
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

631 
r¡©us_t
 
¡©us
;

633 ià(
	`msg_em±y
(
msg
)) {

635 
cÚn
->
	`»cv_dÚe
(
ùx
, cÚn, 
msg
, 
NULL
);

636  
NC_OK
;

639 
msg
->
	`·r£r
(msg);

641 
msg
->
»suÉ
) {

642 
MSG_PARSE_OK
:

643 
¡©us
 = 
	`msg_·r£d
(
ùx
, 
cÚn
, 
msg
);

646 
MSG_PARSE_REPAIR
:

647 
¡©us
 = 
	`msg_»·œ
(
ùx
, 
cÚn
, 
msg
);

650 
MSG_PARSE_AGAIN
:

651 
¡©us
 = 
NC_OK
;

655 
¡©us
 = 
NC_ERROR
;

656 
cÚn
->
”r
 = 
”ºo
;

660  
cÚn
->
”r
 !ğ0 ? 
NC_ERROR
 : 
¡©us
;

661 
	}
}

663 
r¡©us_t


664 
	$msg_»cv_chaš
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

666 
r¡©us_t
 
¡©us
;

667 
msg
 *
nmsg
;

668 
mbuf
 *mbuf;

669 
size_t
 
msize
;

670 
ssize_t
 
n
;

672 
mbuf
 = 
	`STAILQ_LAST
(&
msg
->
mhdr
, mbuf, 
Ãxt
);

673 ià(
mbuf
 =ğ
NULL
 || 
	`mbuf_fuÎ
(mbuf)) {

674 
mbuf
 = 
	`mbuf_g‘
();

675 ià(
mbuf
 =ğ
NULL
) {

676  
NC_ENOMEM
;

678 
	`mbuf_š£¹
(&
msg
->
mhdr
, 
mbuf
);

679 
msg
->
pos
 = 
mbuf
->pos;

681 
	`ASSERT
(
mbuf
->
’d
 - mbuf->
Ï¡
 > 0);

683 
msize
 = 
	`mbuf_size
(
mbuf
);

685 
n
 = 
	`cÚn_»cv
(
cÚn
, 
mbuf
->
Ï¡
, 
msize
);

686 ià(
n
 < 0) {

687 ià(
n
 =ğ
NC_EAGAIN
) {

688  
NC_OK
;

690  
NC_ERROR
;

693 
	`ASSERT
((
mbuf
->
Ï¡
 + 
n
è<ğmbuf->
’d
);

694 
mbuf
->
Ï¡
 +ğ
n
;

695 
msg
->
mËn
 +ğ(
ušt32_t
)
n
;

698 
¡©us
 = 
	`msg_·r£
(
ùx
, 
cÚn
, 
msg
);

699 ià(
¡©us
 !ğ
NC_OK
) {

700  
¡©us
;

704 
nmsg
 = 
cÚn
->
	`»cv_Ãxt
(
ùx
, cÚn, 
çl£
);

705 ià(
nmsg
 =ğ
NULL
 ||‚msg =ğ
msg
) {

710 
msg
 = 
nmsg
;

713  
NC_OK
;

714 
	}
}

716 
r¡©us_t


717 
	$msg_»cv
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

719 
r¡©us_t
 
¡©us
;

720 
msg
 *msg;

722 
	`ASSERT
(
cÚn
->
»cv_aùive
);

724 
cÚn
->
»cv_»ady
 = 1;

726 
msg
 = 
cÚn
->
	`»cv_Ãxt
(
ùx
, cÚn, 
Œue
);

727 ià(
msg
 =ğ
NULL
) {

728  
NC_OK
;

731 
¡©us
 = 
	`msg_»cv_chaš
(
ùx
, 
cÚn
, 
msg
);

732 ià(
¡©us
 !ğ
NC_OK
) {

733  
¡©us
;

735 } 
cÚn
->
»cv_»ady
);

737  
NC_OK
;

738 
	}
}

740 
r¡©us_t


741 
	$msg_£nd_chaš
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

743 
msg_tqh
 
£nd_msgq
;

744 
msg
 *
nmsg
;

745 
mbuf
 *mbuf, *
nbuf
;

746 
size_t
 
mËn
;

747 
iovec
 *
ciov
, 
iov
[
NC_IOV_MAX
];

748 
¬¿y
 
£ndv
;

749 
size_t
 
n£nd
, 
n£Á
;

750 
size_t
 
lim™
;

751 
ssize_t
 
n
;

753 
	`TAILQ_INIT
(&
£nd_msgq
);

755 
	`¬¿y_£t
(&
£ndv
, 
iov
, (iov[0]), 
NC_IOV_MAX
);

759 
n£nd
 = 0;

765 
lim™
 = 
SSIZE_MAX
;

768 
	`ASSERT
(
cÚn
->
smsg
 =ğ
msg
);

770 
	`TAILQ_INSERT_TAIL
(&
£nd_msgq
, 
msg
, 
m_tqe
);

772 
mbuf
 = 
	`STAILQ_FIRST
(&
msg
->
mhdr
);

773 
mbuf
 !ğ
NULL
 && 
	`¬¿y_n
(&
£ndv
è< 
NC_IOV_MAX
 && 
n£nd
 < 
lim™
;

774 
mbuf
 = 
nbuf
) {

775 
nbuf
 = 
	`STAILQ_NEXT
(
mbuf
, 
Ãxt
);

777 ià(
	`mbuf_em±y
(
mbuf
)) {

781 
mËn
 = 
	`mbuf_Ëngth
(
mbuf
);

782 ià((
n£nd
 + 
mËn
è> 
lim™
) {

783 
mËn
 = 
lim™
 - 
n£nd
;

786 
ciov
 = 
	`¬¿y_push
(&
£ndv
);

787 
ciov
->
iov_ba£
 = 
mbuf
->
pos
;

788 
ciov
->
iov_Ën
 = 
mËn
;

790 
n£nd
 +ğ
mËn
;

793 ià(
	`¬¿y_n
(&
£ndv
è>ğ
NC_IOV_MAX
 || 
n£nd
 >ğ
lim™
) {

797 
msg
 = 
cÚn
->
	`£nd_Ãxt
(
ùx
, conn);

798 ià(
msg
 =ğ
NULL
) {

807 
cÚn
->
smsg
 = 
NULL
;

808 ià(!
	`TAILQ_EMPTY
(&
£nd_msgq
è&& 
n£nd
 != 0) {

809 
n
 = 
	`cÚn_£ndv
(
cÚn
, &
£ndv
, 
n£nd
);

811 
n
 = 0;

814 
n£Á
 = 
n
 > 0 ? (
size_t
)n : 0;

818 
msg
 = 
	`TAILQ_FIRST
(&
£nd_msgq
); msg !ğ
NULL
; msg = 
nmsg
) {

819 
nmsg
 = 
	`TAILQ_NEXT
(
msg
, 
m_tqe
);

821 
	`TAILQ_REMOVE
(&
£nd_msgq
, 
msg
, 
m_tqe
);

823 ià(
n£Á
 == 0) {

824 ià(
msg
->
mËn
 == 0) {

825 
cÚn
->
	`£nd_dÚe
(
ùx
, cÚn, 
msg
);

831 
mbuf
 = 
	`STAILQ_FIRST
(&
msg
->
mhdr
); mbuà!ğ
NULL
; mbuàğ
nbuf
) {

832 
nbuf
 = 
	`STAILQ_NEXT
(
mbuf
, 
Ãxt
);

834 ià(
	`mbuf_em±y
(
mbuf
)) {

838 
mËn
 = 
	`mbuf_Ëngth
(
mbuf
);

839 ià(
n£Á
 < 
mËn
) {

841 
mbuf
->
pos
 +ğ
n£Á
;

842 
	`ASSERT
(
mbuf
->
pos
 < mbuf->
Ï¡
);

843 
n£Á
 = 0;

848 
mbuf
->
pos
 = mbuf->
Ï¡
;

849 
n£Á
 -ğ
mËn
;

853 ià(
mbuf
 =ğ
NULL
) {

854 
cÚn
->
	`£nd_dÚe
(
ùx
, cÚn, 
msg
);

858 
	`ASSERT
(
	`TAILQ_EMPTY
(&
£nd_msgq
));

860 ià(
n
 >= 0) {

861  
NC_OK
;

864  (
n
 =ğ
NC_EAGAIN
è? 
NC_OK
 : 
NC_ERROR
;

865 
	}
}

867 
r¡©us_t


868 
	$msg_£nd
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

870 
r¡©us_t
 
¡©us
;

871 
msg
 *msg;

873 
	`ASSERT
(
cÚn
->
£nd_aùive
);

875 
cÚn
->
£nd_»ady
 = 1;

877 
msg
 = 
cÚn
->
	`£nd_Ãxt
(
ùx
, conn);

878 ià(
msg
 =ğ
NULL
) {

880  
NC_OK
;

883 
¡©us
 = 
	`msg_£nd_chaš
(
ùx
, 
cÚn
, 
msg
);

884 ià(
¡©us
 !ğ
NC_OK
) {

885  
¡©us
;

888 } 
cÚn
->
£nd_»ady
);

890  
NC_OK
;

891 
	}
}

	@nc_message.h

18 #iâdeà
_NC_MESSAGE_H_


19 
	#_NC_MESSAGE_H_


	)

21 
	~<nc_cÜe.h
>

23 (*
	tmsg_·r£_t
)(
	tmsg
 *);

24 
	$r¡©us_t
 (*
	tmsg_add_auth_t
)(
	tcÚ‹xt
 *
	tùx
, 
	tcÚn
 *
	tc_cÚn
, cÚÀ*
	ts_cÚn
);

25 
	$r¡©us_t
 (*
	tmsg_äagm’t_t
)(
	tmsg
 *, 
	tušt32_t
, 
	tmsg_tqh
 *);

26 (*
	tmsg_cßËsû_t
)(
	tmsg
 *
	tr
);

27 
	$r¡©us_t
 (*
	tmsg_»¶y_t
)(
	tmsg
 *
	tr
);

28 
	$boŞ
 (*
	tmsg_çu»_t
)(
	tmsg
 *
	tr
);

30 
	emsg_·r£_»suÉ
 {

31 
MSG_PARSE_OK
,

32 
MSG_PARSE_ERROR
,

33 
MSG_PARSE_REPAIR
,

34 
MSG_PARSE_AGAIN
,

35 } 
	tmsg_·r£_»suÉ_t
;

37 
	#MSG_TYPE_CODEC
(
ACTION
) \

38 
	`ACTION
Ğ
UNKNOWN
 ) \

39 
	`ACTION
Ğ
REQ_MC_GET
 ) \

40 
	`ACTION
Ğ
REQ_MC_GETS
 ) \

41 
	`ACTION
Ğ
REQ_MC_DELETE
 ) \

42 
	`ACTION
Ğ
REQ_MC_CAS
 ) \

43 
	`ACTION
Ğ
REQ_MC_SET
 ) \

44 
	`ACTION
Ğ
REQ_MC_ADD
 ) \

45 
	`ACTION
Ğ
REQ_MC_REPLACE
 ) \

46 
	`ACTION
Ğ
REQ_MC_APPEND
 ) \

47 
	`ACTION
Ğ
REQ_MC_PREPEND
 ) \

48 
	`ACTION
Ğ
REQ_MC_INCR
 ) \

49 
	`ACTION
Ğ
REQ_MC_DECR
 ) \

50 
	`ACTION
Ğ
REQ_MC_TOUCH
 ) \

51 
	`ACTION
Ğ
REQ_MC_QUIT
 ) \

52 
	`ACTION
Ğ
RSP_MC_NUM
 ) \

53 
	`ACTION
Ğ
RSP_MC_STORED
 ) \

54 
	`ACTION
Ğ
RSP_MC_NOT_STORED
 ) \

55 
	`ACTION
Ğ
RSP_MC_EXISTS
 ) \

56 
	`ACTION
Ğ
RSP_MC_NOT_FOUND
 ) \

57 
	`ACTION
Ğ
RSP_MC_END
 ) \

58 
	`ACTION
Ğ
RSP_MC_VALUE
 ) \

59 
	`ACTION
Ğ
RSP_MC_DELETED
 ) \

60 
	`ACTION
Ğ
RSP_MC_TOUCHED
 ) \

61 
	`ACTION
Ğ
RSP_MC_ERROR
 ) \

62 
	`ACTION
Ğ
RSP_MC_CLIENT_ERROR
 ) \

63 
	`ACTION
Ğ
RSP_MC_SERVER_ERROR
 ) \

64 
	`ACTION
Ğ
REQ_REDIS_DEL
 ) \

65 
	`ACTION
Ğ
REQ_REDIS_EXISTS
 ) \

66 
	`ACTION
Ğ
REQ_REDIS_EXPIRE
 ) \

67 
	`ACTION
Ğ
REQ_REDIS_EXPIREAT
 ) \

68 
	`ACTION
Ğ
REQ_REDIS_PEXPIRE
 ) \

69 
	`ACTION
Ğ
REQ_REDIS_PEXPIREAT
 ) \

70 
	`ACTION
Ğ
REQ_REDIS_PERSIST
 ) \

71 
	`ACTION
Ğ
REQ_REDIS_PTTL
 ) \

72 
	`ACTION
Ğ
REQ_REDIS_SORT
 ) \

73 
	`ACTION
Ğ
REQ_REDIS_TTL
 ) \

74 
	`ACTION
Ğ
REQ_REDIS_TYPE
 ) \

75 
	`ACTION
Ğ
REQ_REDIS_APPEND
 ) \

76 
	`ACTION
Ğ
REQ_REDIS_BITCOUNT
 ) \

77 
	`ACTION
Ğ
REQ_REDIS_BITPOS
 ) \

78 
	`ACTION
Ğ
REQ_REDIS_DECR
 ) \

79 
	`ACTION
Ğ
REQ_REDIS_DECRBY
 ) \

80 
	`ACTION
Ğ
REQ_REDIS_DUMP
 ) \

81 
	`ACTION
Ğ
REQ_REDIS_GET
 ) \

82 
	`ACTION
Ğ
REQ_REDIS_GETBIT
 ) \

83 
	`ACTION
Ğ
REQ_REDIS_GETRANGE
 ) \

84 
	`ACTION
Ğ
REQ_REDIS_GETSET
 ) \

85 
	`ACTION
Ğ
REQ_REDIS_INCR
 ) \

86 
	`ACTION
Ğ
REQ_REDIS_INCRBY
 ) \

87 
	`ACTION
Ğ
REQ_REDIS_INCRBYFLOAT
 ) \

88 
	`ACTION
Ğ
REQ_REDIS_MGET
 ) \

89 
	`ACTION
Ğ
REQ_REDIS_MSET
 ) \

90 
	`ACTION
Ğ
REQ_REDIS_PSETEX
 ) \

91 
	`ACTION
Ğ
REQ_REDIS_RESTORE
 ) \

92 
	`ACTION
Ğ
REQ_REDIS_SET
 ) \

93 
	`ACTION
Ğ
REQ_REDIS_SETBIT
 ) \

94 
	`ACTION
Ğ
REQ_REDIS_SETEX
 ) \

95 
	`ACTION
Ğ
REQ_REDIS_SETNX
 ) \

96 
	`ACTION
Ğ
REQ_REDIS_SETRANGE
 ) \

97 
	`ACTION
Ğ
REQ_REDIS_STRLEN
 ) \

98 
	`ACTION
Ğ
REQ_REDIS_HDEL
 ) \

99 
	`ACTION
Ğ
REQ_REDIS_HEXISTS
 ) \

100 
	`ACTION
Ğ
REQ_REDIS_HGET
 ) \

101 
	`ACTION
Ğ
REQ_REDIS_HGETALL
 ) \

102 
	`ACTION
Ğ
REQ_REDIS_HINCRBY
 ) \

103 
	`ACTION
Ğ
REQ_REDIS_HINCRBYFLOAT
 ) \

104 
	`ACTION
Ğ
REQ_REDIS_HKEYS
 ) \

105 
	`ACTION
Ğ
REQ_REDIS_HLEN
 ) \

106 
	`ACTION
Ğ
REQ_REDIS_HMGET
 ) \

107 
	`ACTION
Ğ
REQ_REDIS_HMSET
 ) \

108 
	`ACTION
Ğ
REQ_REDIS_HSET
 ) \

109 
	`ACTION
Ğ
REQ_REDIS_HSETNX
 ) \

110 
	`ACTION
Ğ
REQ_REDIS_HSCAN
) \

111 
	`ACTION
Ğ
REQ_REDIS_HVALS
 ) \

112 
	`ACTION
Ğ
REQ_REDIS_LINDEX
 ) \

113 
	`ACTION
Ğ
REQ_REDIS_LINSERT
 ) \

114 
	`ACTION
Ğ
REQ_REDIS_LLEN
 ) \

115 
	`ACTION
Ğ
REQ_REDIS_LPOP
 ) \

116 
	`ACTION
Ğ
REQ_REDIS_LPUSH
 ) \

117 
	`ACTION
Ğ
REQ_REDIS_LPUSHX
 ) \

118 
	`ACTION
Ğ
REQ_REDIS_LRANGE
 ) \

119 
	`ACTION
Ğ
REQ_REDIS_LREM
 ) \

120 
	`ACTION
Ğ
REQ_REDIS_LSET
 ) \

121 
	`ACTION
Ğ
REQ_REDIS_LTRIM
 ) \

122 
	`ACTION
Ğ
REQ_REDIS_PFADD
 ) \

123 
	`ACTION
Ğ
REQ_REDIS_PFCOUNT
 ) \

124 
	`ACTION
Ğ
REQ_REDIS_PFMERGE
 ) \

125 
	`ACTION
Ğ
REQ_REDIS_RPOP
 ) \

126 
	`ACTION
Ğ
REQ_REDIS_RPOPLPUSH
 ) \

127 
	`ACTION
Ğ
REQ_REDIS_RPUSH
 ) \

128 
	`ACTION
Ğ
REQ_REDIS_RPUSHX
 ) \

129 
	`ACTION
Ğ
REQ_REDIS_SADD
 ) \

130 
	`ACTION
Ğ
REQ_REDIS_SCARD
 ) \

131 
	`ACTION
Ğ
REQ_REDIS_SDIFF
 ) \

132 
	`ACTION
Ğ
REQ_REDIS_SDIFFSTORE
 ) \

133 
	`ACTION
Ğ
REQ_REDIS_SINTER
 ) \

134 
	`ACTION
Ğ
REQ_REDIS_SINTERSTORE
 ) \

135 
	`ACTION
Ğ
REQ_REDIS_SISMEMBER
 ) \

136 
	`ACTION
Ğ
REQ_REDIS_SMEMBERS
 ) \

137 
	`ACTION
Ğ
REQ_REDIS_SMOVE
 ) \

138 
	`ACTION
Ğ
REQ_REDIS_SPOP
 ) \

139 
	`ACTION
Ğ
REQ_REDIS_SRANDMEMBER
 ) \

140 
	`ACTION
Ğ
REQ_REDIS_SREM
 ) \

141 
	`ACTION
Ğ
REQ_REDIS_SUNION
 ) \

142 
	`ACTION
Ğ
REQ_REDIS_SUNIONSTORE
 ) \

143 
	`ACTION
Ğ
REQ_REDIS_SSCAN
) \

144 
	`ACTION
Ğ
REQ_REDIS_ZADD
 ) \

145 
	`ACTION
Ğ
REQ_REDIS_ZCARD
 ) \

146 
	`ACTION
Ğ
REQ_REDIS_ZCOUNT
 ) \

147 
	`ACTION
Ğ
REQ_REDIS_ZINCRBY
 ) \

148 
	`ACTION
Ğ
REQ_REDIS_ZINTERSTORE
 ) \

149 
	`ACTION
Ğ
REQ_REDIS_ZLEXCOUNT
 ) \

150 
	`ACTION
Ğ
REQ_REDIS_ZRANGE
 ) \

151 
	`ACTION
Ğ
REQ_REDIS_ZRANGEBYLEX
 ) \

152 
	`ACTION
Ğ
REQ_REDIS_ZRANGEBYSCORE
 ) \

153 
	`ACTION
Ğ
REQ_REDIS_ZRANK
 ) \

154 
	`ACTION
Ğ
REQ_REDIS_ZREM
 ) \

155 
	`ACTION
Ğ
REQ_REDIS_ZREMRANGEBYRANK
 ) \

156 
	`ACTION
Ğ
REQ_REDIS_ZREMRANGEBYLEX
 ) \

157 
	`ACTION
Ğ
REQ_REDIS_ZREMRANGEBYSCORE
 ) \

158 
	`ACTION
Ğ
REQ_REDIS_ZREVRANGE
 ) \

159 
	`ACTION
Ğ
REQ_REDIS_ZREVRANGEBYSCORE
 ) \

160 
	`ACTION
Ğ
REQ_REDIS_ZREVRANK
 ) \

161 
	`ACTION
Ğ
REQ_REDIS_ZSCORE
 ) \

162 
	`ACTION
Ğ
REQ_REDIS_ZUNIONSTORE
 ) \

163 
	`ACTION
Ğ
REQ_REDIS_ZSCAN
) \

164 
	`ACTION
Ğ
REQ_REDIS_EVAL
 ) \

165 
	`ACTION
Ğ
REQ_REDIS_EVALSHA
 ) \

166 
	`ACTION
Ğ
REQ_REDIS_PING
 ) \

167 
	`ACTION
Ğ
REQ_REDIS_QUIT
) \

168 
	`ACTION
Ğ
REQ_REDIS_AUTH
) \

169 
	`ACTION
Ğ
REQ_REDIS_SELECT
) \

170 
	`ACTION
Ğ
RSP_REDIS_STATUS
 ) \

171 
	`ACTION
Ğ
RSP_REDIS_ERROR
 ) \

172 
	`ACTION
Ğ
RSP_REDIS_ERROR_ERR
 ) \

173 
	`ACTION
Ğ
RSP_REDIS_ERROR_OOM
 ) \

174 
	`ACTION
Ğ
RSP_REDIS_ERROR_BUSY
 ) \

175 
	`ACTION
Ğ
RSP_REDIS_ERROR_NOAUTH
 ) \

176 
	`ACTION
Ğ
RSP_REDIS_ERROR_LOADING
 ) \

177 
	`ACTION
Ğ
RSP_REDIS_ERROR_BUSYKEY
 ) \

178 
	`ACTION
Ğ
RSP_REDIS_ERROR_MISCONF
 ) \

179 
	`ACTION
Ğ
RSP_REDIS_ERROR_NOSCRIPT
 ) \

180 
	`ACTION
Ğ
RSP_REDIS_ERROR_READONLY
 ) \

181 
	`ACTION
Ğ
RSP_REDIS_ERROR_WRONGTYPE
 ) \

182 
	`ACTION
Ğ
RSP_REDIS_ERROR_EXECABORT
 ) \

183 
	`ACTION
Ğ
RSP_REDIS_ERROR_MASTERDOWN
 ) \

184 
	`ACTION
Ğ
RSP_REDIS_ERROR_NOREPLICAS
 ) \

185 
	`ACTION
Ğ
RSP_REDIS_INTEGER
 ) \

186 
	`ACTION
Ğ
RSP_REDIS_BULK
 ) \

187 
	`ACTION
Ğ
RSP_REDIS_MULTIBULK
 ) \

188 
	`ACTION
Ğ
SENTINEL
 ) \

189 

	)

191 
	#DEFINE_ACTION
(
_Çme
è
MSG_
##_Çme,

	)

192 
	emsg_ty³
 {

193 
	`MSG_TYPE_CODEC
(
DEFINE_ACTION
)

194 } 
	tmsg_ty³_t
;

195 #undeà
DEFINE_ACTION


197 
	skeypos
 {

198 
ušt8_t
 *
¡¬t
;

199 
ušt8_t
 *
’d
;

202 
	smsg
 {

203 
	`TAILQ_ENTRY
(
msg
è
c_tqe
;

204 
	`TAILQ_ENTRY
(
msg
è
s_tqe
;

205 
	`TAILQ_ENTRY
(
msg
è
m_tqe
;

207 
ušt64_t
 
id
;

208 
msg
 *
³”
;

209 
cÚn
 *
owÃr
;

211 
rbnode
 
tmo_rbe
;

213 
mhdr
 mhdr;

214 
ušt32_t
 
mËn
;

215 
št64_t
 
¡¬t_ts
;

217 
¡©e
;

218 
ušt8_t
 *
pos
;

219 
ušt8_t
 *
tok’
;

221 
msg_·r£_t
 
·r£r
;

222 
msg_·r£_»suÉ_t
 
»suÉ
;

224 
msg_äagm’t_t
 
äagm’t
;

225 
msg_»¶y_t
 
»¶y
;

226 
msg_add_auth_t
 
add_auth
;

227 
msg_çu»_t
 
çu»
;

229 
msg_cßËsû_t
 
´e_cßËsû
;

230 
msg_cßËsû_t
 
po¡_cßËsû
;

232 
msg_ty³_t
 
ty³
;

234 
¬¿y
 *
keys
;

236 
ušt32_t
 
vËn
;

237 
ušt8_t
 *
’d
;

239 
ušt8_t
 *
Çrg_¡¬t
;

240 
ušt8_t
 *
Çrg_’d
;

241 
ušt32_t
 
Çrg
;

242 
ušt32_t
 
º¬g
;

243 
ušt32_t
 
¾’
;

244 
ušt32_t
 
š‹g”
;

246 
msg
 *
äag_owÃr
;

247 
ušt32_t
 
näag
;

248 
ušt32_t
 
näag_dÚe
;

249 
ušt64_t
 
äag_id
;

250 
msg
 **
äag_£q
;

252 
ušt64_t
 
time¡amp
;

254 
”r_t
 
”r
;

255 
”rÜ
:1;

256 
ã¼Ü
:1;

257 
»que¡
:1;

258 
qu™
:1;

259 
nÜ•ly
:1;

260 
nofÜw¬d
:1;

261 
dÚe
:1;

262 
fdÚe
:1;

263 
sw®low
:1;

264 
»dis
:1;

265 
is_wr™e
:1;

268 
	`TAILQ_HEAD
(
msg_tqh
, 
msg
);

270 
msg
 *
	`msg_tmo_mš
();

271 
	`msg_tmo_š£¹
(
msg
 *msg, 
cÚn
 *conn);

272 
	`msg_tmo_d–‘e
(
msg
 *msg);

274 
	`msg_š™
();

275 
	`msg_deš™
();

276 
¡ršg
 *
	`msg_ty³_¡ršg
(
msg_ty³_t
 
ty³
);

277 
msg
 *
	`msg_g‘
(
cÚn
 *cÚn, 
boŞ
 
»que¡
, boŞ 
»dis
);

278 
	`msg_put
(
msg
 *msg);

279 
msg
 *
	`msg_g‘_”rÜ
(
boŞ
 
»dis
, 
”r_t
 
”r
);

280 
	`msg_dump
(
msg
 *msg, 
Ëv–
);

281 
boŞ
 
	`msg_em±y
(
msg
 *msg);

282 
r¡©us_t
 
	`msg_»cv
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn);

283 
r¡©us_t
 
	`msg_£nd
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn);

284 
ušt64_t
 
	`msg_g’_äag_id
();

285 
ušt32_t
 
	`msg_back’d_idx
(
msg
 *msg, 
ušt8_t
 *
key
, ušt32_ˆ
keyËn
);

286 
mbuf
 *
	`msg_’su»_mbuf
(
msg
 *msg, 
size_t
 
Ën
);

287 
r¡©us_t
 
	`msg_­³nd
(
msg
 *msg, 
ušt8_t
 *
pos
, 
size_t
 
n
);

288 
r¡©us_t
 
	`msg_´•’d
(
msg
 *msg, 
ušt8_t
 *
pos
, 
size_t
 
n
);

289 
r¡©us_t
 
	`msg_´•’d_fÜm©
(
msg
 *msg, cÚ¡ *
fmt
, ...);

291 
msg
 *
	`»q_g‘
(
cÚn
 *conn);

292 
	`»q_put
(
msg
 *msg);

293 
boŞ
 
	`»q_dÚe
(
cÚn
 *cÚn, 
msg
 *msg);

294 
boŞ
 
	`»q_”rÜ
(
cÚn
 *cÚn, 
msg
 *msg);

295 
	`»q_£rv”_’queue_imsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg);

296 
	`»q_£rv”_’queue_imsgq_h—d
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg);

297 
	`»q_£rv”_dequeue_imsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg);

298 
	`»q_ş›Á_’queue_omsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg);

299 
	`»q_£rv”_’queue_omsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg);

300 
	`»q_ş›Á_dequeue_omsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg);

301 
	`»q_£rv”_dequeue_omsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg);

302 
msg
 *
	`»q_»cv_Ãxt
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
boŞ
 
®loc
);

303 
	`»q_»cv_dÚe
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg, msg *
nmsg
);

304 
msg
 *
	`»q_£nd_Ãxt
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn);

305 
	`»q_£nd_dÚe
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg);

307 
msg
 *
	`r¥_g‘
(
cÚn
 *conn);

308 
	`r¥_put
(
msg
 *msg);

309 
msg
 *
	`r¥_»cv_Ãxt
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
boŞ
 
®loc
);

310 
	`r¥_»cv_dÚe
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg, msg *
nmsg
);

311 
msg
 *
	`r¥_£nd_Ãxt
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn);

312 
	`r¥_£nd_dÚe
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg);

	@nc_proxy.c

18 
	~<sys/¡©.h
>

19 
	~<sys/un.h
>

21 
	~<nc_cÜe.h
>

22 
	~<nc_£rv”.h
>

23 
	~<nc_´oxy.h
>

26 
	$´oxy_»f
(
cÚn
 *cÚn, *
owÃr
)

28 
£rv”_poŞ
 *
poŞ
 = 
owÃr
;

30 
	`ASSERT
(!
cÚn
->
ş›Á
 && cÚn->
´oxy
);

31 
	`ASSERT
(
cÚn
->
owÃr
 =ğ
NULL
);

33 
cÚn
->
çmy
 = 
poŞ
->
šfo
.family;

34 
cÚn
->
add¾’
 = 
poŞ
->
šfo
.addrlen;

35 
cÚn
->
addr
 = (
sockaddr
 *)&
poŞ
->
šfo
.addr;

37 
poŞ
->
p_cÚn
 = 
cÚn
;

40 
cÚn
->
owÃr
 = owner;

42 
	`log_debug
(
LOG_VVERB
, "»àcÚÀ%°owÃ¸%°štØpoŞ %"
PRIu32
"", 
cÚn
,

43 
poŞ
,…oŞ->
idx
);

44 
	}
}

47 
	$´oxy_uÄef
(
cÚn
 *conn)

49 
£rv”_poŞ
 *
poŞ
;

51 
	`ASSERT
(!
cÚn
->
ş›Á
 && cÚn->
´oxy
);

52 
	`ASSERT
(
cÚn
->
owÃr
 !ğ
NULL
);

54 
poŞ
 = 
cÚn
->
owÃr
;

55 
cÚn
->
owÃr
 = 
NULL
;

57 
poŞ
->
p_cÚn
 = 
NULL
;

59 
	`log_debug
(
LOG_VVERB
, "uÄeàcÚÀ%°owÃ¸%°äom…oŞ %"
PRIu32
"", 
cÚn
,

60 
poŞ
,…oŞ->
idx
);

61 
	}
}

64 
	$´oxy_şo£
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

66 
r¡©us_t
 
¡©us
;

68 
	`ASSERT
(!
cÚn
->
ş›Á
 && cÚn->
´oxy
);

70 ià(
cÚn
->
sd
 < 0) {

71 
cÚn
->
	`uÄef
(conn);

72 
	`cÚn_put
(
cÚn
);

76 
	`ASSERT
(
cÚn
->
rmsg
 =ğ
NULL
);

77 
	`ASSERT
(
cÚn
->
smsg
 =ğ
NULL
);

78 
	`ASSERT
(
	`TAILQ_EMPTY
(&
cÚn
->
imsg_q
));

79 
	`ASSERT
(
	`TAILQ_EMPTY
(&
cÚn
->
omsg_q
));

81 
cÚn
->
	`uÄef
(conn);

83 
¡©us
 = 
	`şo£
(
cÚn
->
sd
);

84 ià(
¡©us
 < 0) {

85 
	`log_”rÜ
("şo£… %d faed, ignÜed: %s", 
cÚn
->
sd
, 
	`¡»¼Ü
(
”ºo
));

87 
cÚn
->
sd
 = -1;

89 
	`cÚn_put
(
cÚn
);

90 
	}
}

92 
r¡©us_t


93 
	$´oxy_»u£
(
cÚn
 *
p
)

95 
r¡©us_t
 
¡©us
;

96 
sockaddr_un
 *
un
;

98 
p
->
çmy
) {

99 
AF_INET
:

100 
AF_INET6
:

101 
¡©us
 = 
	`nc_£t_»u£addr
(
p
->
sd
);

104 
AF_UNIX
:

110 
un
 = (
sockaddr_un
 *è
p
->
addr
;

111 
	`uÆšk
(
un
->
sun_·th
);

112 
¡©us
 = 
NC_OK
;

116 
	`NOT_REACHED
();

117 
¡©us
 = 
NC_ERROR
;

120  
¡©us
;

121 
	}
}

123 
r¡©us_t


124 
	$´oxy_li¡’
(
cÚ‹xt
 *
ùx
, 
cÚn
 *
p
)

126 
r¡©us_t
 
¡©us
;

127 
£rv”_poŞ
 *
poŞ
 = 
p
->
owÃr
;

129 
	`ASSERT
(
p
->
´oxy
);

131 
p
->
sd
 = 
	`sock‘
Õ->
çmy
, 
SOCK_STREAM
, 0);

132 ià(
p
->
sd
 < 0) {

133 
	`log_”rÜ
("sock‘ faed: %s", 
	`¡»¼Ü
(
”ºo
));

134  
NC_ERROR
;

137 
¡©us
 = 
	`´oxy_»u£
(
p
);

138 ià(
¡©us
 < 0) {

139 
	`log_”rÜ
("reuse of‡ddr '%.*s' for†istening on… %d failed: %s",

140 
poŞ
->
addr¡r
.
Ën
,…oŞ->addr¡r.
d©a
, 
p
->
sd
,

141 
	`¡»¼Ü
(
”ºo
));

142  
NC_ERROR
;

145 
¡©us
 = 
	`bšd
(
p
->
sd
,…->
addr
,…->
add¾’
);

146 ià(
¡©us
 < 0) {

147 
	`log_”rÜ
("bšd oÀ°%dØadd¸'%.*s' faed: %s", 
p
->
sd
,

148 
poŞ
->
addr¡r
.
Ën
,…oŞ->addr¡r.
d©a
, 
	`¡»¼Ü
(
”ºo
));

149  
NC_ERROR
;

152 ià(
p
->
çmy
 =ğ
AF_UNIX
 && 
poŞ
->
³rm
) {

153 
sockaddr_un
 *
un
 = (sockaddr_uÀ*)
p
->
addr
;

154 
¡©us
 = 
	`chmod
(
un
->
sun_·th
, 
poŞ
->
³rm
);

155 ià(
¡©us
 < 0) {

156 
	`log_”rÜ
("chmod oÀ°%d oÀadd¸'%.*s' faed: %s", 
p
->
sd
,

157 
poŞ
->
addr¡r
.
Ën
,…oŞ->addr¡r.
d©a
, 
	`¡»¼Ü
(
”ºo
));

158  
NC_ERROR
;

162 
¡©us
 = 
	`li¡’
(
p
->
sd
, 
poŞ
->
backlog
);

163 ià(
¡©us
 < 0) {

164 
	`log_”rÜ
("li¡’ oÀ°%d oÀadd¸'%.*s' faed: %s", 
p
->
sd
,

165 
poŞ
->
addr¡r
.
Ën
,…oŞ->addr¡r.
d©a
, 
	`¡»¼Ü
(
”ºo
));

166  
NC_ERROR
;

169 
¡©us
 = 
	`nc_£t_nÚblockšg
(
p
->
sd
);

170 ià(
¡©us
 < 0) {

171 
	`log_”rÜ
("£ˆnÚblock oÀ°%d oÀadd¸'%.*s' faed: %s", 
p
->
sd
,

172 
poŞ
->
addr¡r
.
Ën
,…oŞ->addr¡r.
d©a
, 
	`¡»¼Ü
(
”ºo
));

173  
NC_ERROR
;

176 
¡©us
 = 
	`ev’t_add_cÚn
(
ùx
->
evb
, 
p
);

177 ià(
¡©us
 < 0) {

178 
	`log_”rÜ
("event‡dd conn… %d on‡ddr '%.*s' failed: %s",

179 
p
->
sd
, 
poŞ
->
addr¡r
.
Ën
,…oŞ->addr¡r.
d©a
,

180 
	`¡»¼Ü
(
”ºo
));

181  
NC_ERROR
;

184 
¡©us
 = 
	`ev’t_d–_out
(
ùx
->
evb
, 
p
);

185 ià(
¡©us
 < 0) {

186 
	`log_”rÜ
("event del out… %d on‡ddr '%.*s' failed: %s",

187 
p
->
sd
, 
poŞ
->
addr¡r
.
Ën
,…oŞ->addr¡r.
d©a
,

188 
	`¡»¼Ü
(
”ºo
));

189  
NC_ERROR
;

192  
NC_OK
;

193 
	}
}

195 
r¡©us_t


196 
	$´oxy_—ch_š™
(*
–em
, *
d©a
)

198 
r¡©us_t
 
¡©us
;

199 
£rv”_poŞ
 *
poŞ
 = 
–em
;

200 
cÚn
 *
p
;

202 
p
 = 
	`cÚn_g‘_´oxy
(
poŞ
);

203 ià(
p
 =ğ
NULL
) {

204  
NC_ENOMEM
;

207 
¡©us
 = 
	`´oxy_li¡’
(
poŞ
->
ùx
, 
p
);

208 ià(
¡©us
 !ğ
NC_OK
) {

209 
p
->
	`şo£
(
poŞ
->
ùx
,…);

210  
¡©us
;

213 
	`log_debug
(
LOG_NOTICE
, "°%d†i¡’šg oÀ'%.*s' iÀ% poŞ %"
PRIu32
" '%.*s'"

214 " w™h %"
PRIu32
" s”v”s", 
p
->
sd
, 
poŞ
->
addr¡r
.
Ën
,

215 
poŞ
->
addr¡r
.
d©a
,…oŞ->
»dis
 ? "redis" : "memcache",

216 
poŞ
->
idx
,…oŞ->
Çme
.
Ën
,…oŞ->Çme.
d©a
,

217 
	`¬¿y_n
(&
poŞ
->
£rv”
));

219  
NC_OK
;

220 
	}
}

222 
r¡©us_t


223 
	$´oxy_š™
(
cÚ‹xt
 *
ùx
)

225 
r¡©us_t
 
¡©us
;

227 
	`ASSERT
(
	`¬¿y_n
(&
ùx
->
poŞ
) != 0);

229 
¡©us
 = 
	`¬¿y_—ch
(&
ùx
->
poŞ
, 
´oxy_—ch_š™
, 
NULL
);

230 ià(
¡©us
 !ğ
NC_OK
) {

231 
	`´oxy_deš™
(
ùx
);

232  
¡©us
;

235 
	`log_debug
(
LOG_VVERB
, "š™…roxy w™h %"
PRIu32
"…ools",

236 
	`¬¿y_n
(&
ùx
->
poŞ
));

238  
NC_OK
;

239 
	}
}

241 
r¡©us_t


242 
	$´oxy_—ch_deš™
(*
–em
, *
d©a
)

244 
£rv”_poŞ
 *
poŞ
 = 
–em
;

245 
cÚn
 *
p
;

247 
p
 = 
poŞ
->
p_cÚn
;

248 ià(
p
 !ğ
NULL
) {

249 
p
->
	`şo£
(
poŞ
->
ùx
,…);

252  
NC_OK
;

253 
	}
}

256 
	$´oxy_deš™
(
cÚ‹xt
 *
ùx
)

258 
r¡©us_t
 
¡©us
;

260 
	`ASSERT
(
	`¬¿y_n
(&
ùx
->
poŞ
) != 0);

262 
¡©us
 = 
	`¬¿y_—ch
(&
ùx
->
poŞ
, 
´oxy_—ch_deš™
, 
NULL
);

263 ià(
¡©us
 !ğ
NC_OK
) {

267 
	`log_debug
(
LOG_VVERB
, "deš™…roxy w™h %"
PRIu32
"…ools",

268 
	`¬¿y_n
(&
ùx
->
poŞ
));

269 
	}
}

271 
r¡©us_t


272 
	$´oxy_acû±
(
cÚ‹xt
 *
ùx
, 
cÚn
 *
p
)

274 
r¡©us_t
 
¡©us
;

275 
cÚn
 *
c
;

276 
sd
;

277 
£rv”_poŞ
 *
poŞ
 = 
p
->
owÃr
;

279 
	`ASSERT
(
p
->
´oxy
 && !p->
ş›Á
);

280 
	`ASSERT
(
p
->
sd
 > 0);

281 
	`ASSERT
(
p
->
»cv_aùive
 &&…->
»cv_»ady
);

284 
sd
 = 
	`acû±
(
p
->sd, 
NULL
, NULL);

285 ià(
sd
 < 0) {

286 ià(
”ºo
 =ğ
EINTR
) {

287 
	`log_debug
(
LOG_VERB
, "acû± oÀ°%d‚Ù„—dy -ƒšŒ", 
p
->
sd
);

291 ià(
”ºo
 =ğ
EAGAIN
 ||ƒ¼nØ=ğ
EWOULDBLOCK
 ||ƒ¼nØ=ğ
ECONNABORTED
) {

292 
	`log_debug
(
LOG_VERB
, "acû± oÀ°%d‚Ù„—dy -ƒagaš", 
p
->
sd
);

293 
p
->
»cv_»ady
 = 0;

294  
NC_OK
;

309 ià(
”ºo
 =ğ
EMFILE
 ||ƒ¼nØ=ğ
ENFILE
) {

310 
	`log_debug
(
LOG_CRIT
, "acû± oÀ°%d w™h max fd %"
PRIu32
" "

311 "u£d cÚÃùiÚ %"
PRIu32
" max client connections %"PRIu32" "

312 "cu¼ cl›Á cÚÃùiÚ %"
PRIu32
" failed: %s",

313 
p
->
sd
, 
ùx
->
max_nfd
, 
	`cÚn_ncu¼_cÚn
(),

314 
ùx
->
max_nccÚn
, 
	`cÚn_ncu¼_ccÚn
(), 
	`¡»¼Ü
(
”ºo
));

316 
p
->
»cv_»ady
 = 0;

318  
NC_OK
;

321 
	`log_”rÜ
("acû± oÀ°%d faed: %s", 
p
->
sd
, 
	`¡»¼Ü
(
”ºo
));

323  
NC_ERROR
;

329 ià(
	`cÚn_ncu¼_ccÚn
(è>ğ
ùx
->
max_nccÚn
) {

330 
	`log_debug
(
LOG_CRIT
, "ş›Á cÚÃùiÚ %"
PRIu32
"ƒxceed†imit %"PRIu32,

331 
	`cÚn_ncu¼_ccÚn
(), 
ùx
->
max_nccÚn
);

332 
¡©us
 = 
	`şo£
(
sd
);

333 ià(
¡©us
 < 0) {

334 
	`log_”rÜ
("şo£ c %d faed, ignÜed: %s", 
sd
, 
	`¡»¼Ü
(
”ºo
));

336  
NC_OK
;

339 
c
 = 
	`cÚn_g‘
(
p
->
owÃr
, 
Œue
,…->
»dis
);

340 ià(
c
 =ğ
NULL
) {

341 
	`log_”rÜ
("g‘ cÚÀfÜ c %d from… %d faed: %s", 
sd
, 
p
->sd,

342 
	`¡»¼Ü
(
”ºo
));

343 
¡©us
 = 
	`şo£
(
sd
);

344 ià(
¡©us
 < 0) {

345 
	`log_”rÜ
("şo£ c %d faed, ignÜed: %s", 
sd
, 
	`¡»¼Ü
(
”ºo
));

347  
NC_ENOMEM
;

349 
c
->
sd
 = sd;

351 
	`¡©s_poŞ_šü
(
ùx
, 
c
->
owÃr
, 
ş›Á_cÚÃùiÚs
);

353 
¡©us
 = 
	`nc_£t_nÚblockšg
(
c
->
sd
);

354 ià(
¡©us
 < 0) {

355 
	`log_”rÜ
("£ˆnÚblock oÀø%d from… %d faed: %s", 
c
->
sd
, 
p
->sd,

356 
	`¡»¼Ü
(
”ºo
));

357 
c
->
	`şo£
(
ùx
, c);

358  
¡©us
;

361 ià(
poŞ
->
tık“·live
) {

362 
¡©us
 = 
	`nc_£t_tık“·live
(
c
->
sd
);

363 ià(
¡©us
 < 0) {

364 
	`log_w¬n
("setcpkeepalive on c %d from… %d failed, ignored: %s",

365 
c
->
sd
, 
p
->sd, 
	`¡»¼Ü
(
”ºo
));

369 ià(
p
->
çmy
 =ğ
AF_INET
 ||…->çmy =ğ
AF_INET6
) {

370 
¡©us
 = 
	`nc_£t_tınod–ay
(
c
->
sd
);

371 ià(
¡©us
 < 0) {

372 
	`log_w¬n
("setcpnodelay on c %d from… %d failed, ignored: %s",

373 
c
->
sd
, 
p
->sd, 
	`¡»¼Ü
(
”ºo
));

377 
¡©us
 = 
	`ev’t_add_cÚn
(
ùx
->
evb
, 
c
);

378 ià(
¡©us
 < 0) {

379 
	`log_”rÜ
("ev’ˆadd cÚÀäom… %d faed: %s", 
p
->
sd
,

380 
	`¡»¼Ü
(
”ºo
));

381 
c
->
	`şo£
(
ùx
, c);

382  
¡©us
;

385 
	`log_debug
(
LOG_NOTICE
, "acû±ed c %d oÀ°%d from '%s'", 
c
->
sd
, 
p
->sd,

386 
	`nc_uÄesŞve_³”_desc
(
c
->
sd
));

388  
NC_OK
;

389 
	}
}

391 
r¡©us_t


392 
	$´oxy_»cv
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

394 
r¡©us_t
 
¡©us
;

396 
	`ASSERT
(
cÚn
->
´oxy
 && !cÚn->
ş›Á
);

397 
	`ASSERT
(
cÚn
->
»cv_aùive
);

399 
cÚn
->
»cv_»ady
 = 1;

401 
¡©us
 = 
	`´oxy_acû±
(
ùx
, 
cÚn
);

402 ià(
¡©us
 !ğ
NC_OK
) {

403  
¡©us
;

405 } 
cÚn
->
»cv_»ady
);

407  
NC_OK
;

408 
	}
}

	@nc_proxy.h

18 #iâdeà
_NC_PROXY_H_


19 
	#_NC_PROXY_H_


	)

21 
	~<nc_cÜe.h
>

23 
´oxy_»f
(
cÚn
 *cÚn, *
owÃr
);

24 
´oxy_uÄef
(
cÚn
 *conn);

25 
´oxy_şo£
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn);

27 
r¡©us_t
 
´oxy_—ch_š™
(*
–em
, *
d©a
);

28 
r¡©us_t
 
´oxy_—ch_deš™
(*
–em
, *
d©a
);

30 
r¡©us_t
 
´oxy_š™
(
cÚ‹xt
 *
ùx
);

31 
´oxy_deš™
(
cÚ‹xt
 *
ùx
);

32 
r¡©us_t
 
´oxy_»cv
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn);

	@nc_queue.h

50 #iâdeà
_NC_QUEUE_H_


51 
	#_NC_QUEUE_H_


	)

53 
	~<nc_log.h
>

55 #iâdeà
__off£tof


56 
	#__off£tof
(
ty³
, 
f›ld
è((
size_t
)(&(Ñy³ *)
NULL
)->f›ld))

	)

130 
	#QUEUE_MACRO_SCRUB
 1

	)

132 #ifdeà
NC_ASSERT_PANIC


133 
	#QUEUE_MACRO_TRACE
 1

	)

134 
	#QUEUE_MACRO_ASSERT
 1

	)

137 #ifdeà
QUEUE_MACRO_SCRUB


139 
	#QMD_SAVELINK
(
Çme
, 
lšk
è**Çmğ(*)&Öšk)

	)

141 
	#TRASHIT
(
x
) do { \

142 (
x
èğ(*è
NULL
; \

143 } 0)

	)

147 
	#QMD_SAVELINK
(
Çme
, 
lšk
)

	)

148 
	#TRASHIT
(
x
)

	)

152 #ifdeà
QUEUE_MACRO_TRACE


155 
	sqm_Œaû
 {

156 *
	mÏ¡fe
;

157 
	mÏ¡lše
;

158 *
	m´evfe
;

159 
	m´evlše
;

162 
	#TRACEBUF
 
qm_Œaû
 
Œaû
;

	)

164 
	#QMD_TRACE_HEAD
(
h—d
) do { \

165 (
h—d
)->
Œaû
.
´evlše
 = (h—d)->Œaû.
Ï¡lše
; \

166 (
h—d
)->
Œaû
.
´evfe
 = (h—d)->Œaû.
Ï¡fe
; \

167 (
h—d
)->
Œaû
.
Ï¡lše
 = 
__LINE__
; \

168 (
h—d
)->
Œaû
.
Ï¡fe
 = 
__FILE__
; \

169 } 0)

	)

171 
	#QMD_TRACE_ELEM
(
–em
) do { \

172 (
–em
)->
Œaû
.
´evlše
 = (–em)->Œaû.
Ï¡lše
; \

173 (
–em
)->
Œaû
.
´evfe
 = (–em)->Œaû.
Ï¡fe
; \

174 (
–em
)->
Œaû
.
Ï¡lše
 = 
__LINE__
; \

175 (
–em
)->
Œaû
.
Ï¡fe
 = 
__FILE__
; \

176 } 0)

	)

180 
	#QMD_TRACE_ELEM
(
–em
)

	)

181 
	#QMD_TRACE_HEAD
(
h—d
)

	)

182 
	#TRACEBUF


	)

189 
	#SLIST_HEAD
(
Çme
, 
ty³
) \

190 
	sÇme
 { \

191 
ty³
 *
¦h_fœ¡
; \

192 }

	)

194 
	#SLIST_HEAD_INITIALIZER
(
h—d
) \

195 { 
NULL
 }

	)

197 
	#SLIST_ENTRY
(
ty³
) \

199 
ty³
 *
¦e_Ãxt
; \

200 }

	)

205 
	#SLIST_EMPTY
(
h—d
è((h—d)->
¦h_fœ¡
 =ğ
NULL
)

	)

207 
	#SLIST_FIRST
(
h—d
è((h—d)->
¦h_fœ¡
)

	)

209 
	#SLIST_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

210 (
v¬
èğ
	`SLIST_FIRST
((
h—d
)); \

211 (
v¬
); \

212 (
v¬
èğ
	`SLIST_NEXT
((v¬), 
f›ld
))

	)

214 
	#SLIST_FOREACH_SAFE
(
v¬
, 
h—d
, 
f›ld
, 
tv¬
) \

215 (
v¬
èğ
	`SLIST_FIRST
((
h—d
)); \

216 (
v¬
è&& ((
tv¬
èğ
	`SLIST_NEXT
((v¬), 
f›ld
), 1); \

217 (
v¬
èğ(
tv¬
))

	)

219 
	#SLIST_FOREACH_PREVPTR
(
v¬
, 
v¬p
, 
h—d
, 
f›ld
) \

220 (
v¬p
èğ&
	`SLIST_FIRST
((
h—d
)); \

221 ((
v¬
èğ*(
v¬p
)è!ğ
NULL
; \

222 (
v¬p
èğ&
	`SLIST_NEXT
((
v¬
), 
f›ld
))

	)

224 
	#SLIST_INIT
(
h—d
) do { \

225 
	`SLIST_FIRST
((
h—d
)èğ
NULL
; \

226 } 0)

	)

228 
	#SLIST_INSERT_AFTER
(
¦i¡–m
, 
–m
, 
f›ld
) do { \

229 
	`SLIST_NEXT
((
–m
), 
f›ld
èğSLIST_NEXT((
¦i¡–m
), field); \

230 
	`SLIST_NEXT
((
¦i¡–m
), 
f›ld
èğ(
–m
); \

231 } 0)

	)

233 
	#SLIST_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

234 
	`SLIST_NEXT
((
–m
), 
f›ld
èğ
	`SLIST_FIRST
((
h—d
)); \

235 
	`SLIST_FIRST
((
h—d
)èğ(
–m
); \

236 } 0)

	)

238 
	#SLIST_NEXT
(
–m
, 
f›ld
è(Ólm)->f›ld.
¦e_Ãxt
)

	)

240 
	#SLIST_REMOVE
(
h—d
, 
–m
, 
ty³
, 
f›ld
) do { \

241 ià(
	`SLIST_FIRST
((
h—d
)è=ğ(
–m
)) { \

242 
	`SLIST_REMOVE_HEAD
((
h—d
), 
f›ld
); \

244 
ty³
 *
cu»lm
 = 
	`SLIST_FIRST
((
h—d
)); \

245 
	`SLIST_NEXT
(
cu»lm
, 
f›ld
è!ğ(
–m
)) { \

246 
cu»lm
 = 
	`SLIST_NEXT
(cu»lm, 
f›ld
); \

248 
	`SLIST_REMOVE_AFTER
(
cu»lm
, 
f›ld
); \

250 } 0)

	)

252 
	#SLIST_REMOVE_AFTER
(
–m
, 
f›ld
) do { \

253 
	`QMD_SAVELINK
(
ŞdÃxt
, 
	`SLIST_NEXT
(SLIST_NEXT(
–m
, 
f›ld
), field)); \

254 
	`SLIST_NEXT
(
–m
, 
f›ld
) = SLIST_NEXT(SLIST_NEXT(elm, field), field); \

255 
	`TRASHIT
(*
ŞdÃxt
); \

256 } 0)

	)

258 
	#SLIST_REMOVE_HEAD
(
h—d
, 
f›ld
) do { \

259 
	`QMD_SAVELINK
(
ŞdÃxt
, 
	`SLIST_NEXT
(
	`SLIST_FIRST
((
h—d
)), 
f›ld
)); \

260 
	`SLIST_FIRST
((
h—d
)èğ
	`SLIST_NEXT
(SLIST_FIRST((h—d)), 
f›ld
); \

261 
	`TRASHIT
(*
ŞdÃxt
); \

262 } 0)

	)

267 
	#STAILQ_HEAD
(
Çme
, 
ty³
) \

268 
	sÇme
 { \

269 
ty³
 *
¡qh_fœ¡
; \

270 
ty³
 **
¡qh_Ï¡
; \

271 }

	)

273 
	#STAILQ_HEAD_INITIALIZER
(
h—d
) \

274 { 
NULL
, &(
h—d
).
¡qh_fœ¡
 }

	)

276 
	#STAILQ_ENTRY
(
ty³
) \

278 
ty³
 *
¡qe_Ãxt
; \

279 }

	)

284 
	#STAILQ_CONCAT
(
h—d1
, 
h—d2
) do { \

285 ià(!
	`STAILQ_EMPTY
((
h—d2
))) { \

286 *(
h—d1
)->
¡qh_Ï¡
 = (
h—d2
)->
¡qh_fœ¡
; \

287 (
h—d1
)->
¡qh_Ï¡
 = (
h—d2
)->stqh_last; \

288 
	`STAILQ_INIT
((
h—d2
)); \

290 } 0)

	)

292 
	#STAILQ_EMPTY
(
h—d
è((h—d)->
¡qh_fœ¡
 =ğ
NULL
)

	)

294 
	#STAILQ_FIRST
(
h—d
è((h—d)->
¡qh_fœ¡
)

	)

296 
	#STAILQ_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

297 (
v¬
èğ
	`STAILQ_FIRST
((
h—d
)); \

298 (
v¬
); \

299 (
v¬
èğ
	`STAILQ_NEXT
((v¬), 
f›ld
))

	)

301 
	#STAILQ_FOREACH_SAFE
(
v¬
, 
h—d
, 
f›ld
, 
tv¬
) \

302 (
v¬
èğ
	`STAILQ_FIRST
((
h—d
)); \

303 (
v¬
è&& ((
tv¬
èğ
	`STAILQ_NEXT
((v¬), 
f›ld
), 1); \

304 (
v¬
èğ(
tv¬
))

	)

306 
	#STAILQ_INIT
(
h—d
) do { \

307 
	`STAILQ_FIRST
((
h—d
)èğ
NULL
; \

308 (
h—d
)->
¡qh_Ï¡
 = &
	`STAILQ_FIRST
((head)); \

309 } 0)

	)

311 
	#STAILQ_INSERT_AFTER
(
h—d
, 
tq–m
, 
–m
, 
f›ld
) do { \

312 ià((
	`STAILQ_NEXT
((
–m
), 
f›ld
èğSTAILQ_NEXT((
tq–m
), f›ld)è=ğ
NULL
)\

313 (
h—d
)->
¡qh_Ï¡
 = &
	`STAILQ_NEXT
((
–m
), 
f›ld
); \

314 
	`STAILQ_NEXT
((
tq–m
), 
f›ld
èğ(
–m
); \

315 } 0)

	)

317 
	#STAILQ_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

318 ià((
	`STAILQ_NEXT
((
–m
), 
f›ld
èğ
	`STAILQ_FIRST
((
h—d
))è=ğ
NULL
) \

319 (
h—d
)->
¡qh_Ï¡
 = &
	`STAILQ_NEXT
((
–m
), 
f›ld
); \

320 
	`STAILQ_FIRST
((
h—d
)èğ(
–m
); \

321 } 0)

	)

323 
	#STAILQ_INSERT_TAIL
(
h—d
, 
–m
, 
f›ld
) do { \

324 
	`STAILQ_NEXT
((
–m
), 
f›ld
èğ
NULL
; \

325 *(
h—d
)->
¡qh_Ï¡
 = (
–m
); \

326 (
h—d
)->
¡qh_Ï¡
 = &
	`STAILQ_NEXT
((
–m
), 
f›ld
); \

327 } 0)

	)

329 
	#STAILQ_LAST
(
h—d
, 
ty³
, 
f›ld
) \

330 (
	`STAILQ_EMPTY
((
h—d
)) ? \

331 
NULL
 : \

332 ((
ty³
 *)(*) \

333 ((*)((
h—d
)->
¡qh_Ï¡
è- 
	`__off£tof
(
ty³
, 
f›ld
))))

	)

335 
	#STAILQ_NEXT
(
–m
, 
f›ld
è(Ólm)->f›ld.
¡qe_Ãxt
)

	)

337 
	#STAILQ_REMOVE
(
h—d
, 
–m
, 
ty³
, 
f›ld
) do { \

338 ià(
	`STAILQ_FIRST
((
h—d
)è=ğ(
–m
)) { \

339 
	`STAILQ_REMOVE_HEAD
((
h—d
), 
f›ld
); \

342 
ty³
 *
cu»lm
 = 
	`STAILQ_FIRST
((
h—d
)); \

343 
	`STAILQ_NEXT
(
cu»lm
, 
f›ld
è!ğ(
–m
)) \

344 
cu»lm
 = 
	`STAILQ_NEXT
(cu»lm, 
f›ld
); \

345 
	`STAILQ_REMOVE_AFTER
(
h—d
, 
cu»lm
, 
f›ld
); \

347 } 0)

	)

349 
	#STAILQ_REMOVE_HEAD
(
h—d
, 
f›ld
) do { \

350 
	`QMD_SAVELINK
(
ŞdÃxt
, 
	`STAILQ_NEXT
(
	`STAILQ_FIRST
((
h—d
)), 
f›ld
)); \

351 ià((
	`STAILQ_FIRST
((
h—d
)) = \

352 
	`STAILQ_NEXT
(
	`STAILQ_FIRST
((
h—d
)), 
f›ld
)è=ğ
NULL
) { \

353 (
h—d
)->
¡qh_Ï¡
 = &
	`STAILQ_FIRST
((head)); \

355 
	`TRASHIT
(*
ŞdÃxt
); \

356 } 0)

	)

358 
	#STAILQ_REMOVE_AFTER
(
h—d
, 
–m
, 
f›ld
) do { \

359 
	`QMD_SAVELINK
(
ŞdÃxt
, 
	`STAILQ_NEXT
(STAILQ_NEXT(
–m
, 
f›ld
), field)); \

360 ià((
	`STAILQ_NEXT
(
–m
, 
f›ld
) = \

361 
	`STAILQ_NEXT
(STAILQ_NEXT(
–m
, 
f›ld
), f›ld)è=ğ
NULL
) { \

362 (
h—d
)->
¡qh_Ï¡
 = &
	`STAILQ_NEXT
((
–m
), 
f›ld
); \

364 
	`TRASHIT
(*
ŞdÃxt
); \

365 } 0)

	)

367 
	#STAILQ_SWAP
(
h—d1
, 
h—d2
, 
ty³
) do { \

368 
ty³
 *
sw­_fœ¡
 = 
	`STAILQ_FIRST
(
h—d1
); \

369 
ty³
 **
sw­_Ï¡
 = (
h—d1
)->
¡qh_Ï¡
; \

370 
	`STAILQ_FIRST
(
h—d1
èğSTAILQ_FIRST(
h—d2
); \

371 (
h—d1
)->
¡qh_Ï¡
 = (
h—d2
)->stqh_last; \

372 
	`STAILQ_FIRST
(
h—d2
èğ
sw­_fœ¡
; \

373 (
h—d2
)->
¡qh_Ï¡
 = 
sw­_Ï¡
; \

374 ià(
	`STAILQ_EMPTY
(
h—d1
)) \

375 (
h—d1
)->
¡qh_Ï¡
 = &
	`STAILQ_FIRST
(head1); \

376 ià(
	`STAILQ_EMPTY
(
h—d2
)) \

377 (
h—d2
)->
¡qh_Ï¡
 = &
	`STAILQ_FIRST
(head2); \

378 } 0)

	)

384 
	#LIST_HEAD
(
Çme
, 
ty³
) \

385 
	sÇme
 { \

386 
ty³
 *
lh_fœ¡
; \

387 }

	)

389 
	#LIST_HEAD_INITIALIZER
(
h—d
) \

390 { 
NULL
 }

	)

392 
	#LIST_ENTRY
(
ty³
) \

394 
ty³
 *
Ë_Ãxt
; \

395 
ty³
 **
Ë_´ev
; \

396 }

	)

402 #ifdeà
QUEUE_MACRO_ASSERT


404 
	#QMD_LIST_CHECK_HEAD
(
h—d
, 
f›ld
) do { \

405 ià(
	`LIST_FIRST
((
h—d
)è!ğ
NULL
 && \

406 
	`LIST_FIRST
((
h—d
))->
f›ld
.
Ë_´ev
 != &LIST_FIRST((head))) { \

407 
	`log_·nic
("Bad†i¡ h—d %°fœ¡->´ev !ğh—d", (*)(
h—d
)); \

409 } 0)

	)

411 
	#QMD_LIST_CHECK_NEXT
(
–m
, 
f›ld
) do { \

412 ià(
	`LIST_NEXT
((
–m
), 
f›ld
è!ğ
NULL
 && \

413 
	`LIST_NEXT
((
–m
), 
f›ld
)->f›ld.
Ë_´ev
 !ğ&(Ólm)->f›ld.
Ë_Ãxt
)) {\

414 
	`log_·nic
("Bad†škƒlm %°Ãxt->´ev !ğ–m",(*)(
–m
)); \

416 } 0)

	)

418 
	#QMD_LIST_CHECK_PREV
(
–m
, 
f›ld
) do { \

419 ià(*(
–m
)->
f›ld
.
Ë_´ev
 != (elm)) { \

420 
	`log_·nic
("Bad†škƒlm %°´ev->Ãxˆ!ğ–m",(*)(
–m
)); \

422 } 0)

	)

426 
	#QMD_LIST_CHECK_HEAD
(
h—d
, 
f›ld
)

	)

427 
	#QMD_LIST_CHECK_NEXT
(
–m
, 
f›ld
)

	)

428 
	#QMD_LIST_CHECK_PREV
(
–m
, 
f›ld
)

	)

432 
	#LIST_EMPTY
(
h—d
è((h—d)->
lh_fœ¡
 =ğ
NULL
)

	)

434 
	#LIST_FIRST
(
h—d
è((h—d)->
lh_fœ¡
)

	)

436 
	#LIST_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

437 (
v¬
èğ
	`LIST_FIRST
((
h—d
)); \

438 (
v¬
); \

439 (
v¬
èğ
	`LIST_NEXT
((v¬), 
f›ld
))

	)

441 
	#LIST_FOREACH_SAFE
(
v¬
, 
h—d
, 
f›ld
, 
tv¬
) \

442 (
v¬
èğ
	`LIST_FIRST
((
h—d
)); \

443 (
v¬
è&& ((
tv¬
èğ
	`LIST_NEXT
((v¬), 
f›ld
), 1); \

444 (
v¬
èğ(
tv¬
))

	)

446 
	#LIST_INIT
(
h—d
) do { \

447 
	`LIST_FIRST
((
h—d
)èğ
NULL
; \

448 } 0)

	)

450 
	#LIST_INSERT_AFTER
(
li¡–m
, 
–m
, 
f›ld
) do { \

451 
	`QMD_LIST_CHECK_NEXT
(
li¡–m
, 
f›ld
); \

452 ià((
	`LIST_NEXT
((
–m
), 
f›ld
èğLIST_NEXT((
li¡–m
), f›ld)è!ğ
NULL
)\

453 
	`LIST_NEXT
((
li¡–m
), 
f›ld
)->f›ld.
Ë_´ev
 = \

454 &
	`LIST_NEXT
((
–m
), 
f›ld
); \

455 
	`LIST_NEXT
((
li¡–m
), 
f›ld
èğ(
–m
); \

456 (
–m
)->
f›ld
.
Ë_´ev
 = &
	`LIST_NEXT
((
li¡–m
), field); \

457 } 0)

	)

459 
	#LIST_INSERT_BEFORE
(
li¡–m
, 
–m
, 
f›ld
) do { \

460 
	`QMD_LIST_CHECK_PREV
(
li¡–m
, 
f›ld
); \

461 (
–m
)->
f›ld
.
Ë_´ev
 = (
li¡–m
)->field.le_prev; \

462 
	`LIST_NEXT
((
–m
), 
f›ld
èğ(
li¡–m
); \

463 *(
li¡–m
)->
f›ld
.
Ë_´ev
 = (
–m
); \

464 (
li¡–m
)->
f›ld
.
Ë_´ev
 = &
	`LIST_NEXT
((
–m
), field); \

465 } 0)

	)

467 
	#LIST_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

468 
	`QMD_LIST_CHECK_HEAD
((
h—d
), 
f›ld
); \

469 ià((
	`LIST_NEXT
((
–m
), 
f›ld
èğ
	`LIST_FIRST
((
h—d
))è!ğ
NULL
) \

470 
	`LIST_FIRST
((
h—d
))->
f›ld
.
Ë_´ev
 = &
	`LIST_NEXT
((
–m
), field); \

471 
	`LIST_FIRST
((
h—d
)èğ(
–m
); \

472 (
–m
)->
f›ld
.
Ë_´ev
 = &
	`LIST_FIRST
((
h—d
)); \

473 } 0)

	)

475 
	#LIST_NEXT
(
–m
, 
f›ld
è(Ólm)->f›ld.
Ë_Ãxt
)

	)

477 
	#LIST_REMOVE
(
–m
, 
f›ld
) do { \

478 
	`QMD_SAVELINK
(
ŞdÃxt
, (
–m
)->
f›ld
.
Ë_Ãxt
); \

479 
	`QMD_SAVELINK
(
Şd´ev
, (
–m
)->
f›ld
.
Ë_´ev
); \

480 
	`QMD_LIST_CHECK_NEXT
(
–m
, 
f›ld
); \

481 
	`QMD_LIST_CHECK_PREV
(
–m
, 
f›ld
); \

482 ià(
	`LIST_NEXT
((
–m
), 
f›ld
è!ğ
NULL
) \

483 
	`LIST_NEXT
((
–m
), 
f›ld
)->f›ld.
Ë_´ev
 = \

484 (
–m
)->
f›ld
.
Ë_´ev
; \

485 *(
–m
)->
f›ld
.
Ë_´ev
 = 
	`LIST_NEXT
((elm), field); \

486 
	`TRASHIT
(*
ŞdÃxt
); \

487 
	`TRASHIT
(*
Şd´ev
); \

488 } 0)

	)

490 
	#LIST_SWAP
(
h—d1
, 
h—d2
, 
ty³
, 
f›ld
) do { \

491 
ty³
 *
sw­_tmp
 = 
	`LIST_FIRST
((
h—d1
)); \

492 
	`LIST_FIRST
((
h—d1
)èğLIST_FIRST((
h—d2
)); \

493 
	`LIST_FIRST
((
h—d2
)èğ
sw­_tmp
; \

494 ià((
sw­_tmp
 = 
	`LIST_FIRST
((
h—d1
))è!ğ
NULL
) \

495 
sw­_tmp
->
f›ld
.
Ë_´ev
 = &
	`LIST_FIRST
((
h—d1
)); \

496 ià((
sw­_tmp
 = 
	`LIST_FIRST
((
h—d2
))è!ğ
NULL
) \

497 
sw­_tmp
->
f›ld
.
Ë_´ev
 = &
	`LIST_FIRST
((
h—d2
)); \

498 } 0)

	)

503 
	#TAILQ_HEAD
(
Çme
, 
ty³
) \

504 
	sÇme
 { \

505 
ty³
 *
tqh_fœ¡
; \

506 
ty³
 **
tqh_Ï¡
; \

507 
TRACEBUF
 \

508 }

	)

510 
	#TAILQ_HEAD_INITIALIZER
(
h—d
) \

511 { 
NULL
, &(
h—d
).
tqh_fœ¡
 }

	)

513 
	#TAILQ_ENTRY
(
ty³
) \

515 
ty³
 *
tqe_Ãxt
; \

516 
ty³
 **
tqe_´ev
; \

517 
TRACEBUF
 \

518 }

	)

523 #ifdeà
QUEUE_MACRO_ASSERT


525 
	#QMD_TAILQ_CHECK_HEAD
(
h—d
, 
f›ld
) do { \

526 ià(!
	`TAILQ_EMPTY
(
h—d
) && \

527 
	`TAILQ_FIRST
((
h—d
))->
f›ld
.
tqe_´ev
 != &TAILQ_FIRST((head))) { \

528 
	`log_·nic
("Badaq h—d %°fœ¡->´ev !ğh—d", (*)(
h—d
)); \

530 } 0)

	)

532 
	#QMD_TAILQ_CHECK_TAIL
(
h—d
, 
f›ld
) do { \

533 ià(*(
h—d
)->
tqh_Ï¡
 !ğ
NULL
) { \

534 
	`log_·nic
("Badaq NEXT(%p->tqh_Ï¡è!ğNULL",(*)(
h—d
)); \

536 } 0)

	)

538 
	#QMD_TAILQ_CHECK_NEXT
(
–m
, 
f›ld
) do { \

539 ià(
	`TAILQ_NEXT
((
–m
), 
f›ld
è!ğ
NULL
 && \

540 
	`TAILQ_NEXT
((
–m
), 
f›ld
)->f›ld.
tqe_´ev
 !ğ&(Ólm)->f›ld.
tqe_Ãxt
)) {\

541 
	`log_·nic
("Bad†škƒlm %°Ãxt->´ev !ğ–m",(*)(
–m
)); \

543 } 0)

	)

545 
	#QMD_TAILQ_CHECK_PREV
(
–m
, 
f›ld
) do { \

546 ià(*(
–m
)->
f›ld
.
tqe_´ev
 != (elm)) { \

547 
	`log_·nic
("Bad†škƒlm %°´ev->Ãxˆ!ğ–m",(*)(
–m
)); \

549 } 0)

	)

553 
	#QMD_TAILQ_CHECK_HEAD
(
h—d
, 
f›ld
)

	)

554 
	#QMD_TAILQ_CHECK_TAIL
(
h—d
, 
h—dÇme
)

	)

555 
	#QMD_TAILQ_CHECK_NEXT
(
–m
, 
f›ld
)

	)

556 
	#QMD_TAILQ_CHECK_PREV
(
–m
, 
f›ld
)

	)

560 
	#TAILQ_CONCAT
(
h—d1
, 
h—d2
, 
f›ld
) do { \

561 ià(!
	`TAILQ_EMPTY
(
h—d2
)) { \

562 *(
h—d1
)->
tqh_Ï¡
 = (
h—d2
)->
tqh_fœ¡
; \

563 (
h—d2
)->
tqh_fœ¡
->
f›ld
.
tqe_´ev
 = (
h—d1
)->
tqh_Ï¡
; \

564 (
h—d1
)->
tqh_Ï¡
 = (
h—d2
)->tqh_last; \

565 
	`TAILQ_INIT
((
h—d2
)); \

566 
	`QMD_TRACE_HEAD
(
h—d1
); \

567 
	`QMD_TRACE_HEAD
(
h—d2
); \

569 } 0)

	)

571 
	#TAILQ_EMPTY
(
h—d
è((h—d)->
tqh_fœ¡
 =ğ
NULL
)

	)

573 
	#TAILQ_FIRST
(
h—d
è((h—d)->
tqh_fœ¡
)

	)

575 
	#TAILQ_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

576 (
v¬
èğ
	`TAILQ_FIRST
((
h—d
)); \

577 (
v¬
); \

578 (
v¬
èğ
	`TAILQ_NEXT
((v¬), 
f›ld
))

	)

580 
	#TAILQ_FOREACH_SAFE
(
v¬
, 
h—d
, 
f›ld
, 
tv¬
) \

581 (
v¬
èğ
	`TAILQ_FIRST
((
h—d
)); \

582 (
v¬
è&& ((
tv¬
èğ
	`TAILQ_NEXT
((v¬), 
f›ld
), 1); \

583 (
v¬
èğ(
tv¬
))

	)

585 
	#TAILQ_FOREACH_REVERSE
(
v¬
, 
h—d
, 
h—dÇme
, 
f›ld
) \

586 (
v¬
èğ
	`TAILQ_LAST
((
h—d
), 
h—dÇme
); \

587 (
v¬
); \

588 (
v¬
èğ
	`TAILQ_PREV
((v¬), 
h—dÇme
, 
f›ld
))

	)

590 
	#TAILQ_FOREACH_REVERSE_SAFE
(
v¬
, 
h—d
, 
h—dÇme
, 
f›ld
, 
tv¬
) \

591 (
v¬
èğ
	`TAILQ_LAST
((
h—d
), 
h—dÇme
); \

592 (
v¬
è&& ((
tv¬
èğ
	`TAILQ_PREV
((v¬), 
h—dÇme
, 
f›ld
), 1); \

593 (
v¬
èğ(
tv¬
))

	)

595 
	#TAILQ_INIT
(
h—d
) do { \

596 
	`TAILQ_FIRST
((
h—d
)èğ
NULL
; \

597 (
h—d
)->
tqh_Ï¡
 = &
	`TAILQ_FIRST
((head)); \

598 
	`QMD_TRACE_HEAD
(
h—d
); \

599 } 0)

	)

601 
	#TAILQ_INSERT_AFTER
(
h—d
, 
li¡–m
, 
–m
, 
f›ld
) do { \

602 
	`QMD_TAILQ_CHECK_NEXT
(
li¡–m
, 
f›ld
); \

603 ià((
	`TAILQ_NEXT
((
–m
), 
f›ld
èğTAILQ_NEXT((
li¡–m
), f›ld)è!ğ
NULL
) { \

604 
	`TAILQ_NEXT
((
–m
), 
f›ld
)->f›ld.
tqe_´ev
 = &TAILQ_NEXT((elm), field);\

606 (
h—d
)->
tqh_Ï¡
 = &
	`TAILQ_NEXT
((
–m
), 
f›ld
); \

607 
	`QMD_TRACE_HEAD
(
h—d
); \

609 
	`TAILQ_NEXT
((
li¡–m
), 
f›ld
èğ(
–m
); \

610 (
–m
)->
f›ld
.
tqe_´ev
 = &
	`TAILQ_NEXT
((
li¡–m
), field); \

611 
	`QMD_TRACE_ELEM
(&(
–m
)->
f›ld
); \

612 
	`QMD_TRACE_ELEM
(&
li¡–m
->
f›ld
); \

613 } 0)

	)

615 
	#TAILQ_INSERT_BEFORE
(
li¡–m
, 
–m
, 
f›ld
) do { \

616 
	`QMD_TAILQ_CHECK_PREV
(
li¡–m
, 
f›ld
); \

617 (
–m
)->
f›ld
.
tqe_´ev
 = (
li¡–m
)->field.tqe_prev; \

618 
	`TAILQ_NEXT
((
–m
), 
f›ld
èğ(
li¡–m
); \

619 *(
li¡–m
)->
f›ld
.
tqe_´ev
 = (
–m
); \

620 (
li¡–m
)->
f›ld
.
tqe_´ev
 = &
	`TAILQ_NEXT
((
–m
), field); \

621 
	`QMD_TRACE_ELEM
(&(
–m
)->
f›ld
); \

622 
	`QMD_TRACE_ELEM
(&
li¡–m
->
f›ld
); \

623 } 0)

	)

625 
	#TAILQ_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

626 
	`QMD_TAILQ_CHECK_HEAD
(
h—d
, 
f›ld
); \

627 ià((
	`TAILQ_NEXT
((
–m
), 
f›ld
èğ
	`TAILQ_FIRST
((
h—d
))è!ğ
NULL
) \

628 
	`TAILQ_FIRST
((
h—d
))->
f›ld
.
tqe_´ev
 = \

629 &
	`TAILQ_NEXT
((
–m
), 
f›ld
); \

631 (
h—d
)->
tqh_Ï¡
 = &
	`TAILQ_NEXT
((
–m
), 
f›ld
); \

632 
	`TAILQ_FIRST
((
h—d
)èğ(
–m
); \

633 (
–m
)->
f›ld
.
tqe_´ev
 = &
	`TAILQ_FIRST
((
h—d
)); \

634 
	`QMD_TRACE_HEAD
(
h—d
); \

635 
	`QMD_TRACE_ELEM
(&(
–m
)->
f›ld
); \

636 } 0)

	)

638 
	#TAILQ_INSERT_TAIL
(
h—d
, 
–m
, 
f›ld
) do { \

639 
	`QMD_TAILQ_CHECK_TAIL
(
h—d
, 
f›ld
); \

640 
	`TAILQ_NEXT
((
–m
), 
f›ld
èğ
NULL
; \

641 (
–m
)->
f›ld
.
tqe_´ev
 = (
h—d
)->
tqh_Ï¡
; \

642 *(
h—d
)->
tqh_Ï¡
 = (
–m
); \

643 (
h—d
)->
tqh_Ï¡
 = &
	`TAILQ_NEXT
((
–m
), 
f›ld
); \

644 
	`QMD_TRACE_HEAD
(
h—d
); \

645 
	`QMD_TRACE_ELEM
(&(
–m
)->
f›ld
); \

646 } 0)

	)

648 
	#TAILQ_LAST
(
h—d
, 
h—dÇme
) \

649 (*(((
h—dÇme
 *)((
h—d
)->
tqh_Ï¡
))->tqh_Ï¡))

	)

651 
	#TAILQ_NEXT
(
–m
, 
f›ld
è(Ólm)->f›ld.
tqe_Ãxt
)

	)

653 
	#TAILQ_PREV
(
–m
, 
h—dÇme
, 
f›ld
) \

654 (*(((
h—dÇme
 *)((
–m
)->
f›ld
.
tqe_´ev
))->
tqh_Ï¡
))

	)

656 
	#TAILQ_REMOVE
(
h—d
, 
–m
, 
f›ld
) do { \

657 
	`QMD_SAVELINK
(
ŞdÃxt
, (
–m
)->
f›ld
.
tqe_Ãxt
); \

658 
	`QMD_SAVELINK
(
Şd´ev
, (
–m
)->
f›ld
.
tqe_´ev
); \

659 
	`QMD_TAILQ_CHECK_NEXT
(
–m
, 
f›ld
); \

660 
	`QMD_TAILQ_CHECK_PREV
(
–m
, 
f›ld
); \

661 ià((
	`TAILQ_NEXT
((
–m
), 
f›ld
)è!ğ
NULL
) { \

662 
	`TAILQ_NEXT
((
–m
), 
f›ld
)->f›ld.
tqe_´ev
 = \

663 (
–m
)->
f›ld
.
tqe_´ev
; \

665 (
h—d
)->
tqh_Ï¡
 = (
–m
)->
f›ld
.
tqe_´ev
; \

666 
	`QMD_TRACE_HEAD
(
h—d
); \

668 *(
–m
)->
f›ld
.
tqe_´ev
 = 
	`TAILQ_NEXT
((elm), field); \

669 
	`TRASHIT
(*
ŞdÃxt
); \

670 
	`TRASHIT
(*
Şd´ev
); \

671 
	`QMD_TRACE_ELEM
(&(
–m
)->
f›ld
); \

672 } 0)

	)

674 
	#TAILQ_SWAP
(
h—d1
, 
h—d2
, 
ty³
, 
f›ld
) do { \

675 
ty³
 *
sw­_fœ¡
 = (
h—d1
)->
tqh_fœ¡
; \

676 
ty³
 **
sw­_Ï¡
 = (
h—d1
)->
tqh_Ï¡
; \

677 (
h—d1
)->
tqh_fœ¡
 = (
h—d2
)->tqh_first; \

678 (
h—d1
)->
tqh_Ï¡
 = (
h—d2
)->tqh_last; \

679 (
h—d2
)->
tqh_fœ¡
 = 
sw­_fœ¡
; \

680 (
h—d2
)->
tqh_Ï¡
 = 
sw­_Ï¡
; \

681 ià((
sw­_fœ¡
 = (
h—d1
)->
tqh_fœ¡
è!ğ
NULL
) \

682 
sw­_fœ¡
->
f›ld
.
tqe_´ev
 = &(
h—d1
)->
tqh_fœ¡
; \

684 (
h—d1
)->
tqh_Ï¡
 = &(h—d1)->
tqh_fœ¡
; \

685 ià((
sw­_fœ¡
 = (
h—d2
)->
tqh_fœ¡
è!ğ
NULL
) \

686 
sw­_fœ¡
->
f›ld
.
tqe_´ev
 = &(
h—d2
)->
tqh_fœ¡
; \

688 (
h—d2
)->
tqh_Ï¡
 = &(h—d2)->
tqh_fœ¡
; \

689 } 0)

	)

694 
	#CIRCLEQ_HEAD
(
Çme
, 
ty³
) \

695 
	sÇme
 { \

696 
ty³
 *
cqh_fœ¡
; \

697 
ty³
 *
cqh_Ï¡
; \

698 }

	)

700 
	#CIRCLEQ_HEAD_INITIALIZER
(
h—d
) \

701 { (*)&(
h—d
), (*)&(h—dè}

	)

703 
	#CIRCLEQ_ENTRY
(
ty³
) \

705 
ty³
 *
cqe_Ãxt
; \

706 
ty³
 *
cqe_´ev
; \

707 }

	)

712 
	#CIRCLEQ_EMPTY
(
h—d
è((h—d)->
cqh_fœ¡
 =ğ(*)(h—d))

	)

714 
	#CIRCLEQ_FIRST
(
h—d
è((h—d)->
cqh_fœ¡
)

	)

716 
	#CIRCLEQ_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

717 (
v¬
èğ
	`CIRCLEQ_FIRST
((
h—d
)); \

718 (
v¬
è!ğ(*)(
h—d
è|| ((v¬èğ
NULL
); \

719 (
v¬
èğ
	`CIRCLEQ_NEXT
((v¬), 
f›ld
))

	)

721 
	#CIRCLEQ_FOREACH_REVERSE
(
v¬
, 
h—d
, 
f›ld
) \

722 (
v¬
èğ
	`CIRCLEQ_LAST
((
h—d
)); \

723 (
v¬
è!ğ(*)(
h—d
è|| ((v¬èğ
NULL
); \

724 (
v¬
èğ
	`CIRCLEQ_PREV
((v¬), 
f›ld
))

	)

726 
	#CIRCLEQ_INIT
(
h—d
) do { \

727 
	`CIRCLEQ_FIRST
((
h—d
)) = (*)(head); \

728 
	`CIRCLEQ_LAST
((
h—d
)) = (*)(head); \

729 } 0)

	)

731 
	#CIRCLEQ_INSERT_AFTER
(
h—d
, 
li¡–m
, 
–m
, 
f›ld
) do { \

732 
	`CIRCLEQ_NEXT
((
–m
), 
f›ld
èğCIRCLEQ_NEXT((
li¡–m
), field); \

733 
	`CIRCLEQ_PREV
((
–m
), 
f›ld
èğ(
li¡–m
); \

734 ià(
	`CIRCLEQ_NEXT
((
li¡–m
), 
f›ld
è=ğ(*)(
h—d
)) \

735 
	`CIRCLEQ_LAST
((
h—d
)èğ(
–m
); \

737 
	`CIRCLEQ_PREV
(
	`CIRCLEQ_NEXT
((
li¡–m
), 
f›ld
), f›ldèğ(
–m
); \

738 
	`CIRCLEQ_NEXT
((
li¡–m
), 
f›ld
èğ(
–m
); \

739 } 0)

	)

741 
	#CIRCLEQ_INSERT_BEFORE
(
h—d
, 
li¡–m
, 
–m
, 
f›ld
) do { \

742 
	`CIRCLEQ_NEXT
((
–m
), 
f›ld
èğ(
li¡–m
); \

743 
	`CIRCLEQ_PREV
((
–m
), 
f›ld
èğCIRCLEQ_PREV((
li¡–m
), field); \

744 ià(
	`CIRCLEQ_PREV
((
li¡–m
), 
f›ld
è=ğ(*)(
h—d
)) \

745 
	`CIRCLEQ_FIRST
((
h—d
)èğ(
–m
); \

747 
	`CIRCLEQ_NEXT
(
	`CIRCLEQ_PREV
((
li¡–m
), 
f›ld
), f›ldèğ(
–m
); \

748 
	`CIRCLEQ_PREV
((
li¡–m
), 
f›ld
èğ(
–m
); \

749 } 0)

	)

751 
	#CIRCLEQ_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

752 
	`CIRCLEQ_NEXT
((
–m
), 
f›ld
èğ
	`CIRCLEQ_FIRST
((
h—d
)); \

753 
	`CIRCLEQ_PREV
((
–m
), 
f›ld
èğ(*)(
h—d
); \

754 ià(
	`CIRCLEQ_LAST
((
h—d
)) == (*)(head)) \

755 
	`CIRCLEQ_LAST
((
h—d
)èğ(
–m
); \

757 
	`CIRCLEQ_PREV
(
	`CIRCLEQ_FIRST
((
h—d
)), 
f›ld
èğ(
–m
); \

758 
	`CIRCLEQ_FIRST
((
h—d
)èğ(
–m
); \

759 } 0)

	)

761 
	#CIRCLEQ_INSERT_TAIL
(
h—d
, 
–m
, 
f›ld
) do { \

762 
	`CIRCLEQ_NEXT
((
–m
), 
f›ld
èğ(*)(
h—d
); \

763 
	`CIRCLEQ_PREV
((
–m
), 
f›ld
èğ
	`CIRCLEQ_LAST
((
h—d
)); \

764 ià(
	`CIRCLEQ_FIRST
((
h—d
)) == (*)(head)) \

765 
	`CIRCLEQ_FIRST
((
h—d
)èğ(
–m
); \

767 
	`CIRCLEQ_NEXT
(
	`CIRCLEQ_LAST
((
h—d
)), 
f›ld
èğ(
–m
); \

768 
	`CIRCLEQ_LAST
((
h—d
)èğ(
–m
); \

769 } 0)

	)

771 
	#CIRCLEQ_LAST
(
h—d
è((h—d)->
cqh_Ï¡
)

	)

773 
	#CIRCLEQ_NEXT
(
–m
,
f›ld
è(Ólm)->f›ld.
cqe_Ãxt
)

	)

775 
	#CIRCLEQ_PREV
(
–m
,
f›ld
è(Ólm)->f›ld.
cqe_´ev
)

	)

777 
	#CIRCLEQ_REMOVE
(
h—d
, 
–m
, 
f›ld
) do { \

778 ià(
	`CIRCLEQ_NEXT
((
–m
), 
f›ld
è=ğ(*)(
h—d
)) \

779 
	`CIRCLEQ_LAST
((
h—d
)èğ
	`CIRCLEQ_PREV
((
–m
), 
f›ld
); \

781 
	`CIRCLEQ_PREV
(
	`CIRCLEQ_NEXT
((
–m
), 
f›ld
), field) = \

782 
	`CIRCLEQ_PREV
((
–m
), 
f›ld
); \

783 ià(
	`CIRCLEQ_PREV
((
–m
), 
f›ld
è=ğ(*)(
h—d
)) \

784 
	`CIRCLEQ_FIRST
((
h—d
)èğ
	`CIRCLEQ_NEXT
((
–m
), 
f›ld
); \

786 
	`CIRCLEQ_NEXT
(
	`CIRCLEQ_PREV
((
–m
), 
f›ld
), field) = \

787 
	`CIRCLEQ_NEXT
((
–m
), 
f›ld
); \

788 } 0)

	)

	@nc_rbtree.c

18 
	~<nc_cÜe.h
>

21 
	$rbŒ“_node_š™
(
rbnode
 *
node
)

23 
node
->
Ëá
 = 
NULL
;

24 
node
->
right
 = 
NULL
;

25 
node
->
·»Á
 = 
NULL
;

26 
node
->
key
 = 0ULL;

27 
node
->
d©a
 = 
NULL
;

29 
	}
}

32 
	$rbŒ“_š™
(
rbŒ“
 *
Œ“
, 
rbnode
 *
node
)

34 
	`rbŒ“_node_š™
(
node
);

35 
	`rbŒ“_bÏck
(
node
);

36 
Œ“
->
roÙ
 = 
node
;

37 
Œ“
->
£Áš–
 = 
node
;

38 
	}
}

40 
rbnode
 *

41 
	$rbŒ“_node_mš
(
rbnode
 *
node
, rbnod*
£Áš–
)

45 
node
->
Ëá
 !ğ
£Áš–
) {

46 
node
 =‚ode->
Ëá
;

49  
node
;

50 
	}
}

52 
rbnode
 *

53 
	$rbŒ“_mš
(
rbŒ“
 *
Œ“
)

55 
rbnode
 *
node
 = 
Œ“
->
roÙ
;

56 
rbnode
 *
£Áš–
 = 
Œ“
->sentinel;

60 ià(
node
 =ğ
£Áš–
) {

61  
NULL
;

64  
	`rbŒ“_node_mš
(
node
, 
£Áš–
);

65 
	}
}

68 
	$rbŒ“_Ëá_rÙ©e
(
rbnode
 **
roÙ
, rbnod*
£Áš–
,

69 
rbnode
 *
node
)

71 
rbnode
 *
‹mp
;

73 
‹mp
 = 
node
->
right
;

74 
node
->
right
 = 
‹mp
->
Ëá
;

76 ià(
‹mp
->
Ëá
 !ğ
£Áš–
) {

77 
‹mp
->
Ëá
->
·»Á
 = 
node
;

80 
‹mp
->
·»Á
 = 
node
->parent;

82 ià(
node
 =ğ*
roÙ
) {

83 *
roÙ
 = 
‹mp
;

84 } ià(
node
 =ğnode->
·»Á
->
Ëá
) {

85 
node
->
·»Á
->
Ëá
 = 
‹mp
;

87 
node
->
·»Á
->
right
 = 
‹mp
;

90 
‹mp
->
Ëá
 = 
node
;

91 
node
->
·»Á
 = 
‹mp
;

92 
	}
}

95 
	$rbŒ“_right_rÙ©e
(
rbnode
 **
roÙ
, rbnod*
£Áš–
,

96 
rbnode
 *
node
)

98 
rbnode
 *
‹mp
;

100 
‹mp
 = 
node
->
Ëá
;

101 
node
->
Ëá
 = 
‹mp
->
right
;

103 ià(
‹mp
->
right
 !ğ
£Áš–
) {

104 
‹mp
->
right
->
·»Á
 = 
node
;

107 
‹mp
->
·»Á
 = 
node
->parent;

109 ià(
node
 =ğ*
roÙ
) {

110 *
roÙ
 = 
‹mp
;

111 } ià(
node
 =ğnode->
·»Á
->
right
) {

112 
node
->
·»Á
->
right
 = 
‹mp
;

114 
node
->
·»Á
->
Ëá
 = 
‹mp
;

117 
‹mp
->
right
 = 
node
;

118 
node
->
·»Á
 = 
‹mp
;

119 
	}
}

122 
	$rbŒ“_š£¹
(
rbŒ“
 *
Œ“
, 
rbnode
 *
node
)

124 
rbnode
 **
roÙ
 = &
Œ“
->root;

125 
rbnode
 *
£Áš–
 = 
Œ“
->sentinel;

126 
rbnode
 *
‹mp
, **
p
;

130 ià(*
roÙ
 =ğ
£Áš–
) {

131 
node
->
·»Á
 = 
NULL
;

132 
node
->
Ëá
 = 
£Áš–
;

133 
node
->
right
 = 
£Áš–
;

134 
	`rbŒ“_bÏck
(
node
);

135 *
roÙ
 = 
node
;

141 
‹mp
 = *
roÙ
;

144 
p
 = (
node
->
key
 < 
‹mp
->keyè? &‹mp->
Ëá
 : &‹mp->
right
;

145 ià(*
p
 =ğ
£Áš–
) {

148 
‹mp
 = *
p
;

151 *
p
 = 
node
;

152 
node
->
·»Á
 = 
‹mp
;

153 
node
->
Ëá
 = 
£Áš–
;

154 
node
->
right
 = 
£Áš–
;

155 
	`rbŒ“_»d
(
node
);

159 
node
 !ğ*
roÙ
 && 
	`rbŒ“_is_»d
Òode->
·»Á
)) {

161 ià(
node
->
·»Á
 =ğnode->·»Á->·»Á->
Ëá
) {

162 
‹mp
 = 
node
->
·»Á
->·»Á->
right
;

164 ià(
	`rbŒ“_is_»d
(
‹mp
)) {

165 
	`rbŒ“_bÏck
(
node
->
·»Á
);

166 
	`rbŒ“_bÏck
(
‹mp
);

167 
	`rbŒ“_»d
(
node
->
·»Á
->parent);

168 
node
 =‚ode->
·»Á
->parent;

170 ià(
node
 =ğnode->
·»Á
->
right
) {

171 
node
 =‚ode->
·»Á
;

172 
	`rbŒ“_Ëá_rÙ©e
(
roÙ
, 
£Áš–
, 
node
);

175 
	`rbŒ“_bÏck
(
node
->
·»Á
);

176 
	`rbŒ“_»d
(
node
->
·»Á
->parent);

177 
	`rbŒ“_right_rÙ©e
(
roÙ
, 
£Áš–
, 
node
->
·»Á
->parent);

180 
‹mp
 = 
node
->
·»Á
->·»Á->
Ëá
;

182 ià(
	`rbŒ“_is_»d
(
‹mp
)) {

183 
	`rbŒ“_bÏck
(
node
->
·»Á
);

184 
	`rbŒ“_bÏck
(
‹mp
);

185 
	`rbŒ“_»d
(
node
->
·»Á
->parent);

186 
node
 =‚ode->
·»Á
->parent;

188 ià(
node
 =ğnode->
·»Á
->
Ëá
) {

189 
node
 =‚ode->
·»Á
;

190 
	`rbŒ“_right_rÙ©e
(
roÙ
, 
£Áš–
, 
node
);

193 
	`rbŒ“_bÏck
(
node
->
·»Á
);

194 
	`rbŒ“_»d
(
node
->
·»Á
->parent);

195 
	`rbŒ“_Ëá_rÙ©e
(
roÙ
, 
£Áš–
, 
node
->
·»Á
->parent);

200 
	`rbŒ“_bÏck
(*
roÙ
);

201 
	}
}

204 
	$rbŒ“_d–‘e
(
rbŒ“
 *
Œ“
, 
rbnode
 *
node
)

206 
rbnode
 **
roÙ
 = &
Œ“
->root;

207 
rbnode
 *
£Áš–
 = 
Œ“
->sentinel;

208 
rbnode
 *
sub¡
, *
‹mp
, *
w
;

209 
ušt8_t
 
»d
;

213 ià(
node
->
Ëá
 =ğ
£Áš–
) {

214 
‹mp
 = 
node
->
right
;

215 
sub¡
 = 
node
;

216 } ià(
node
->
right
 =ğ
£Áš–
) {

217 
‹mp
 = 
node
->
Ëá
;

218 
sub¡
 = 
node
;

220 
sub¡
 = 
	`rbŒ“_node_mš
(
node
->
right
, 
£Áš–
);

221 
‹mp
 = 
sub¡
->
right
;

224 ià(
sub¡
 =ğ*
roÙ
) {

225 *
roÙ
 = 
‹mp
;

226 
	`rbŒ“_bÏck
(
‹mp
);

228 
	`rbŒ“_node_š™
(
node
);

233 
»d
 = 
	`rbŒ“_is_»d
(
sub¡
);

235 ià(
sub¡
 =ğsub¡->
·»Á
->
Ëá
) {

236 
sub¡
->
·»Á
->
Ëá
 = 
‹mp
;

238 
sub¡
->
·»Á
->
right
 = 
‹mp
;

241 ià(
sub¡
 =ğ
node
) {

242 
‹mp
->
·»Á
 = 
sub¡
->parent;

245 ià(
sub¡
->
·»Á
 =ğ
node
) {

246 
‹mp
->
·»Á
 = 
sub¡
;

248 
‹mp
->
·»Á
 = 
sub¡
->parent;

251 
sub¡
->
Ëá
 = 
node
->left;

252 
sub¡
->
right
 = 
node
->right;

253 
sub¡
->
·»Á
 = 
node
->parent;

254 
	`rbŒ“_cİy_cŞÜ
(
sub¡
, 
node
);

256 ià(
node
 =ğ*
roÙ
) {

257 *
roÙ
 = 
sub¡
;

259 ià(
node
 =ğnode->
·»Á
->
Ëá
) {

260 
node
->
·»Á
->
Ëá
 = 
sub¡
;

262 
node
->
·»Á
->
right
 = 
sub¡
;

266 ià(
sub¡
->
Ëá
 !ğ
£Áš–
) {

267 
sub¡
->
Ëá
->
·»Á
 = subst;

270 ià(
sub¡
->
right
 !ğ
£Áš–
) {

271 
sub¡
->
right
->
·»Á
 = subst;

275 
	`rbŒ“_node_š™
(
node
);

277 ià(
»d
) {

283 
‹mp
 !ğ*
roÙ
 && 
	`rbŒ“_is_bÏck
(temp)) {

285 ià(
‹mp
 =ğ‹mp->
·»Á
->
Ëá
) {

286 
w
 = 
‹mp
->
·»Á
->
right
;

288 ià(
	`rbŒ“_is_»d
(
w
)) {

289 
	`rbŒ“_bÏck
(
w
);

290 
	`rbŒ“_»d
(
‹mp
->
·»Á
);

291 
	`rbŒ“_Ëá_rÙ©e
(
roÙ
, 
£Áš–
, 
‹mp
->
·»Á
);

292 
w
 = 
‹mp
->
·»Á
->
right
;

295 ià(
	`rbŒ“_is_bÏck
(
w
->
Ëá
è&&„bŒ“_is_bÏck(w->
right
)) {

296 
	`rbŒ“_»d
(
w
);

297 
‹mp
 =emp->
·»Á
;

299 ià(
	`rbŒ“_is_bÏck
(
w
->
right
)) {

300 
	`rbŒ“_bÏck
(
w
->
Ëá
);

301 
	`rbŒ“_»d
(
w
);

302 
	`rbŒ“_right_rÙ©e
(
roÙ
, 
£Áš–
, 
w
);

303 
w
 = 
‹mp
->
·»Á
->
right
;

306 
	`rbŒ“_cİy_cŞÜ
(
w
, 
‹mp
->
·»Á
);

307 
	`rbŒ“_bÏck
(
‹mp
->
·»Á
);

308 
	`rbŒ“_bÏck
(
w
->
right
);

309 
	`rbŒ“_Ëá_rÙ©e
(
roÙ
, 
£Áš–
, 
‹mp
->
·»Á
);

310 
‹mp
 = *
roÙ
;

314 
w
 = 
‹mp
->
·»Á
->
Ëá
;

316 ià(
	`rbŒ“_is_»d
(
w
)) {

317 
	`rbŒ“_bÏck
(
w
);

318 
	`rbŒ“_»d
(
‹mp
->
·»Á
);

319 
	`rbŒ“_right_rÙ©e
(
roÙ
, 
£Áš–
, 
‹mp
->
·»Á
);

320 
w
 = 
‹mp
->
·»Á
->
Ëá
;

323 ià(
	`rbŒ“_is_bÏck
(
w
->
Ëá
è&&„bŒ“_is_bÏck(w->
right
)) {

324 
	`rbŒ“_»d
(
w
);

325 
‹mp
 =emp->
·»Á
;

327 ià(
	`rbŒ“_is_bÏck
(
w
->
Ëá
)) {

328 
	`rbŒ“_bÏck
(
w
->
right
);

329 
	`rbŒ“_»d
(
w
);

330 
	`rbŒ“_Ëá_rÙ©e
(
roÙ
, 
£Áš–
, 
w
);

331 
w
 = 
‹mp
->
·»Á
->
Ëá
;

334 
	`rbŒ“_cİy_cŞÜ
(
w
, 
‹mp
->
·»Á
);

335 
	`rbŒ“_bÏck
(
‹mp
->
·»Á
);

336 
	`rbŒ“_bÏck
(
w
->
Ëá
);

337 
	`rbŒ“_right_rÙ©e
(
roÙ
, 
£Áš–
, 
‹mp
->
·»Á
);

338 
‹mp
 = *
roÙ
;

343 
	`rbŒ“_bÏck
(
‹mp
);

344 
	}
}

	@nc_rbtree.h

18 #iâdeà
_NC_RBTREE_


19 
	#_NC_RBTREE_


	)

21 
	#rbŒ“_»d
(
_node
è((_node)->
cŞÜ
 = 1)

	)

22 
	#rbŒ“_bÏck
(
_node
è((_node)->
cŞÜ
 = 0)

	)

23 
	#rbŒ“_is_»d
(
_node
è((_node)->
cŞÜ
)

	)

24 
	#rbŒ“_is_bÏck
(
_node
è(!
	`rbŒ“_is_»d
(_node))

	)

25 
	#rbŒ“_cİy_cŞÜ
(
_n1
, 
_n2
è((_n1)->
cŞÜ
 = (_n2)->cŞÜ)

	)

27 
	srbnode
 {

28 
rbnode
 *
	mËá
;

29 
rbnode
 *
	mright
;

30 
rbnode
 *
	m·»Á
;

31 
št64_t
 
	mkey
;

32 *
	md©a
;

33 
ušt8_t
 
	mcŞÜ
;

36 
	srbŒ“
 {

37 
rbnode
 *
	mroÙ
;

38 
rbnode
 *
	m£Áš–
;

41 
rbŒ“_node_š™
(
rbnode
 *
node
);

42 
rbŒ“_š™
(
rbŒ“
 *
Œ“
, 
rbnode
 *
node
);

43 
rbnode
 *
rbŒ“_mš
(
rbŒ“
 *
Œ“
);

44 
rbŒ“_š£¹
(
rbŒ“
 *
Œ“
, 
rbnode
 *
node
);

45 
rbŒ“_d–‘e
(
rbŒ“
 *
Œ“
, 
rbnode
 *
node
);

	@nc_request.c

18 
	~<nc_cÜe.h
>

19 
	~<nc_£rv”.h
>

21 
msg
 *

22 
	$»q_g‘
(
cÚn
 *conn)

24 
msg
 *msg;

26 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

28 
msg
 = 
	`msg_g‘
(
cÚn
, 
Œue
, cÚn->
»dis
);

29 ià(
msg
 =ğ
NULL
) {

30 
cÚn
->
”r
 = 
”ºo
;

34 
msg
->
time¡amp
 = 
	`nc_now_us
();

35  
msg
;

36 
	}
}

39 
	$»q_log
(
msg
 *
»q
)

41 
msg
 *
r¥
;

42 
št64_t
 
»q_time
;

43 *
³”_¡r
;

44 
ušt32_t
 
»q_Ën
, 
r¥_Ën
;

45 
¡ršg
 *
»q_ty³
;

46 
keypos
 *
kpos
;

48 ià(
	`log_loggabË
(
LOG_NOTICE
) == 0) {

53 ià(
»q
->
äag_id
 !ğ0 &&„eq->
äag_owÃr
 !=„eq) {

58 ià(
»q
->
mËn
 == 0) {

66 ià(
»q
->
¡¬t_ts
 == 0) {

70 
»q_time
 = 
	`nc_u£c_now
(è- 
»q
->
¡¬t_ts
;

72 
r¥
 = 
»q
->
³”
;

73 
»q_Ën
 = 
»q
->
mËn
;

74 
r¥_Ën
 = (
r¥
 !ğ
NULL
è?„¥->
mËn
 : 0;

76 ià(
	`¬¿y_n
(
»q
->
keys
) < 1) {

80 
kpos
 = 
	`¬¿y_g‘
(
»q
->
keys
, 0);

81 ià(
kpos
->
’d
 !ğ
NULL
) {

82 *(
kpos
->
’d
) = '\0';

90 
³”_¡r
 = 
	`nc_uÄesŞve_³”_desc
(
»q
->
owÃr
->
sd
);

92 
»q_ty³
 = 
	`msg_ty³_¡ršg
(
»q
->
ty³
);

94 
	`log_debug
(
LOG_NOTICE
, "»q %"
PRIu64
" dÚÚ c %d„eq_tim%"
PRIi64
".%03"PRIi64

95 " m£øty³ %.* Çrg %"
PRIu32
"„eq_len %"PRIu32"„sp_len %"PRIu32

97 
»q
->
id
,„eq->
owÃr
->
sd
, 
»q_time
 / 1000,„eq_time % 1000,

98 
»q_ty³
->
Ën
,„eq_ty³->
d©a
, 
»q
->
Çrg
, 
»q_Ën
, 
r¥_Ën
,

99 
kpos
->
¡¬t
, 
³”_¡r
, 
»q
->
dÚe
,„eq->
”rÜ
);

100 
	}
}

103 
	$»q_put
(
msg
 *msg)

105 
msg
 *
pmsg
;

107 
	`ASSERT
(
msg
->
»que¡
);

109 
	`»q_log
(
msg
);

112 ià(
msg
->
¡¬t_ts
 > 0) {

113 
cÚn
 *
c_cÚn
 = (cÚn*)
msg
->
owÃr
;

114 
£rv”_poŞ
 *
¥
 = (£rv”_poŞ*)
c_cÚn
->
owÃr
;

115 
cÚ‹xt
 *
ùx
 = 
¥
->ctx;

116 
št64_t
 
Ït_us
 = 
	`nc_u£c_now
(è- 
msg
->
¡¬t_ts
;

117 
	`±h»ad_mu‹x_lock
(&
ùx
->
hi¡o_lock
);

118 
	`hdr_»cÜd_v®ue
(
ùx
->
hi¡og¿m
, 
Ït_us
);

119 
	`±h»ad_mu‹x_uÆock
(&
ùx
->
hi¡o_lock
);

122 
pmsg
 = 
msg
->
³”
;

123 ià(
pmsg
 !ğ
NULL
) {

124 
	`ASSERT
(!
pmsg
->
»que¡
 &&…msg->
³”
 =ğ
msg
);

125 
msg
->
³”
 = 
NULL
;

126 
pmsg
->
³”
 = 
NULL
;

127 
	`r¥_put
(
pmsg
);

130 
	`msg_tmo_d–‘e
(
msg
);

132 
	`msg_put
(
msg
);

133 
	}
}

142 
boŞ


143 
	$»q_dÚe
(
cÚn
 *cÚn, 
msg
 *msg)

145 
msg
 *
cmsg
, *
pmsg
;

146 
ušt64_t
 
id
;

147 
ušt32_t
 
näagm’t
;

149 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

150 
	`ASSERT
(
msg
->
»que¡
);

152 ià(!
msg
->
dÚe
) {

153  
çl£
;

156 
id
 = 
msg
->
äag_id
;

157 ià(
id
 == 0) {

158  
Œue
;

161 ià(
msg
->
fdÚe
) {

163  
Œue
;

166 ià(
msg
->
näag_dÚe
 < msg->
näag
) {

167  
çl£
;

172 
pmsg
 = 
msg
, 
cmsg
 = 
	`TAILQ_PREV
(msg, 
msg_tqh
, 
c_tqe
);

173 
cmsg
 !ğ
NULL
 && cmsg->
äag_id
 =ğ
id
;

174 
pmsg
 = 
cmsg
, cmsg = 
	`TAILQ_PREV
(cmsg, 
msg_tqh
, 
c_tqe
)) {

176 ià(!
cmsg
->
dÚe
) {

177  
çl£
;

181 
pmsg
 = 
msg
, 
cmsg
 = 
	`TAILQ_NEXT
(msg, 
c_tqe
);

182 
cmsg
 !ğ
NULL
 && cmsg->
äag_id
 =ğ
id
;

183 
pmsg
 = 
cmsg
, cmsg = 
	`TAILQ_NEXT
(cmsg, 
c_tqe
)) {

185 ià(!
cmsg
->
dÚe
) {

186  
çl£
;

198 
msg
->
fdÚe
 = 1;

199 
näagm’t
 = 0;

201 
pmsg
 = 
msg
, 
cmsg
 = 
	`TAILQ_PREV
(msg, 
msg_tqh
, 
c_tqe
);

202 
cmsg
 !ğ
NULL
 && cmsg->
äag_id
 =ğ
id
;

203 
pmsg
 = 
cmsg
, cmsg = 
	`TAILQ_PREV
(cmsg, 
msg_tqh
, 
c_tqe
)) {

204 
cmsg
->
fdÚe
 = 1;

205 
näagm’t
++;

208 
pmsg
 = 
msg
, 
cmsg
 = 
	`TAILQ_NEXT
(msg, 
c_tqe
);

209 
cmsg
 !ğ
NULL
 && cmsg->
äag_id
 =ğ
id
;

210 
pmsg
 = 
cmsg
, cmsg = 
	`TAILQ_NEXT
(cmsg, 
c_tqe
)) {

211 
cmsg
->
fdÚe
 = 1;

212 
näagm’t
++;

215 
	`ASSERT
(
msg
->
äag_owÃr
->
näag
 =ğ
näagm’t
);

217 
msg
->
	`po¡_cßËsû
(msg->
äag_owÃr
);

219 
	`log_debug
(
LOG_DEBUG
, "»q from c %d w™h fid %"
PRIu64
"‡nd %"
PRIu32
" "

220 "äagm’t i dÚe", 
cÚn
->
sd
, 
id
, 
näagm’t
);

222  
Œue
;

223 
	}
}

233 
boŞ


234 
	$»q_”rÜ
(
cÚn
 *cÚn, 
msg
 *msg)

236 
msg
 *
cmsg
;

237 
ušt64_t
 
id
;

238 
ušt32_t
 
näagm’t
;

240 
	`ASSERT
(
msg
->
»que¡
 && 
	`»q_dÚe
(
cÚn
, msg));

242 ià(
msg
->
”rÜ
) {

243  
Œue
;

246 
id
 = 
msg
->
äag_id
;

247 ià(
id
 == 0) {

248  
çl£
;

251 ià(
msg
->
ã¼Ü
) {

253  
Œue
;

258 
cmsg
 = 
	`TAILQ_PREV
(
msg
, 
msg_tqh
, 
c_tqe
);

259 
cmsg
 !ğ
NULL
 && cmsg->
äag_id
 =ğ
id
;

260 
cmsg
 = 
	`TAILQ_PREV
(cmsg, 
msg_tqh
, 
c_tqe
)) {

262 ià(
cmsg
->
”rÜ
) {

263 
ã¼Ü
;

267 
cmsg
 = 
	`TAILQ_NEXT
(
msg
, 
c_tqe
);

268 
cmsg
 !ğ
NULL
 && cmsg->
äag_id
 =ğ
id
;

269 
cmsg
 = 
	`TAILQ_NEXT
(cmsg, 
c_tqe
)) {

271 ià(
cmsg
->
”rÜ
) {

272 
ã¼Ü
;

276  
çl£
;

278 
ã¼Ü
:

285 
msg
->
ã¼Ü
 = 1;

286 
näagm’t
 = 1;

288 
cmsg
 = 
	`TAILQ_PREV
(
msg
, 
msg_tqh
, 
c_tqe
);

289 
cmsg
 !ğ
NULL
 && cmsg->
äag_id
 =ğ
id
;

290 
cmsg
 = 
	`TAILQ_PREV
(cmsg, 
msg_tqh
, 
c_tqe
)) {

291 
cmsg
->
ã¼Ü
 = 1;

292 
näagm’t
++;

295 
cmsg
 = 
	`TAILQ_NEXT
(
msg
, 
c_tqe
);

296 
cmsg
 !ğ
NULL
 && cmsg->
äag_id
 =ğ
id
;

297 
cmsg
 = 
	`TAILQ_NEXT
(cmsg, 
c_tqe
)) {

298 
cmsg
->
ã¼Ü
 = 1;

299 
näagm’t
++;

302 
	`log_debug
(
LOG_DEBUG
, "»q from c %d w™h fid %"
PRIu64
"‡nd %"
PRIu32
" "

303 "äagm’t i šƒ¼Ü", 
cÚn
->
sd
, 
id
, 
näagm’t
);

305  
Œue
;

306 
	}
}

309 
	$»q_£rv”_’queue_imsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

311 
	`ASSERT
(
msg
->
»que¡
);

312 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

322 ià(!
msg
->
nÜ•ly
) {

323 
	`msg_tmo_š£¹
(
msg
, 
cÚn
);

326 
	`TAILQ_INSERT_TAIL
(&
cÚn
->
imsg_q
, 
msg
, 
s_tqe
);

328 
	`¡©s_£rv”_šü
(
ùx
, 
cÚn
->
owÃr
, 
š_queue
);

329 
	`¡©s_£rv”_šü_by
(
ùx
, 
cÚn
->
owÃr
, 
š_queue_by‹s
, 
msg
->
mËn
);

330 
	}
}

333 
	$»q_£rv”_’queue_imsgq_h—d
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

335 
	`ASSERT
(
msg
->
»que¡
);

336 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

346 ià(!
msg
->
nÜ•ly
) {

347 
	`msg_tmo_š£¹
(
msg
, 
cÚn
);

350 
	`TAILQ_INSERT_HEAD
(&
cÚn
->
imsg_q
, 
msg
, 
s_tqe
);

352 
	`¡©s_£rv”_šü
(
ùx
, 
cÚn
->
owÃr
, 
š_queue
);

353 
	`¡©s_£rv”_šü_by
(
ùx
, 
cÚn
->
owÃr
, 
š_queue_by‹s
, 
msg
->
mËn
);

354 
	}
}

357 
	$»q_£rv”_dequeue_imsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

359 
	`ASSERT
(
msg
->
»que¡
);

360 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

362 
	`TAILQ_REMOVE
(&
cÚn
->
imsg_q
, 
msg
, 
s_tqe
);

364 
	`¡©s_£rv”_deü
(
ùx
, 
cÚn
->
owÃr
, 
š_queue
);

365 
	`¡©s_£rv”_deü_by
(
ùx
, 
cÚn
->
owÃr
, 
š_queue_by‹s
, 
msg
->
mËn
);

366 
	}
}

369 
	$»q_ş›Á_’queue_omsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

371 
	`ASSERT
(
msg
->
»que¡
);

372 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

374 
	`TAILQ_INSERT_TAIL
(&
cÚn
->
omsg_q
, 
msg
, 
c_tqe
);

375 
	}
}

378 
	$»q_£rv”_’queue_omsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

380 
	`ASSERT
(
msg
->
»que¡
);

381 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

383 
	`TAILQ_INSERT_TAIL
(&
cÚn
->
omsg_q
, 
msg
, 
s_tqe
);

385 
	`¡©s_£rv”_šü
(
ùx
, 
cÚn
->
owÃr
, 
out_queue
);

386 
	`¡©s_£rv”_šü_by
(
ùx
, 
cÚn
->
owÃr
, 
out_queue_by‹s
, 
msg
->
mËn
);

387 
	}
}

390 
	$»q_ş›Á_dequeue_omsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

392 
	`ASSERT
(
msg
->
»que¡
);

393 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

395 
	`TAILQ_REMOVE
(&
cÚn
->
omsg_q
, 
msg
, 
c_tqe
);

396 
	}
}

399 
	$»q_£rv”_dequeue_omsgq
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

401 
	`ASSERT
(
msg
->
»que¡
);

402 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

404 
	`msg_tmo_d–‘e
(
msg
);

406 
	`TAILQ_REMOVE
(&
cÚn
->
omsg_q
, 
msg
, 
s_tqe
);

408 
	`¡©s_£rv”_deü
(
ùx
, 
cÚn
->
owÃr
, 
out_queue
);

409 
	`¡©s_£rv”_deü_by
(
ùx
, 
cÚn
->
owÃr
, 
out_queue_by‹s
, 
msg
->
mËn
);

410 
	}
}

412 
msg
 *

413 
	$»q_»cv_Ãxt
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
boŞ
 
®loc
)

415 
msg
 *msg;

417 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

419 ià(
cÚn
->
eof
) {

420 
msg
 = 
cÚn
->
rmsg
;

423 ià(
msg
 !ğ
NULL
) {

424 
cÚn
->
rmsg
 = 
NULL
;

426 
	`ASSERT
(
msg
->
³”
 =ğ
NULL
);

427 
	`ASSERT
(
msg
->
»que¡
 && !msg->
dÚe
);

429 
	`log_”rÜ
("eoàø%d disÿrdšg incom¶‘»q %"
PRIu64
"†en "

430 "%"
PRIu32
"", 
cÚn
->
sd
, 
msg
->
id
, msg->
mËn
);

432 
	`»q_put
(
msg
);

442 ià(!
cÚn
->
	`aùive
(conn)) {

443 
cÚn
->
dÚe
 = 1;

444 
	`log_debug
(
LOG_INFO
, "ø%d i dÚe", 
cÚn
->
sd
);

446  
NULL
;

449 
msg
 = 
cÚn
->
rmsg
;

450 ià(
msg
 !ğ
NULL
) {

451 
	`ASSERT
(
msg
->
»que¡
);

452  
msg
;

455 ià(!
®loc
) {

456  
NULL
;

459 
msg
 = 
	`»q_g‘
(
cÚn
);

460 ià(
msg
 !ğ
NULL
) {

461 
cÚn
->
rmsg
 = 
msg
;

464  
msg
;

465 
	}
}

467 
r¡©us_t


468 
	$»q_make_»¶y
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *
»q
)

470 
msg
 *
r¥
;

472 
r¥
 = 
	`msg_g‘
(
cÚn
, 
çl£
, cÚn->
»dis
);

473 ià(
r¥
 =ğ
NULL
) {

474 
cÚn
->
”r
 = 
”ºo
;

475  
NC_ENOMEM
;

478 
»q
->
³”
 = 
r¥
;

479 
r¥
->
³”
 = 
»q
;

480 
r¥
->
»que¡
 = 0;

482 
»q
->
dÚe
 = 1;

483 
cÚn
->
	`’queue_outq
(
ùx
, cÚn, 
»q
);

485  
NC_OK
;

486 
	}
}

488 
boŞ


489 
	$»q_f‹r
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

491 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

493 ià(
	`msg_em±y
(
msg
)) {

494 
	`ASSERT
(
cÚn
->
rmsg
 =ğ
NULL
);

495 
	`log_debug
(
LOG_VERB
, "f‹¸em±y„eq %"
PRIu64
" from c %d", 
msg
->
id
,

496 
cÚn
->
sd
);

497 
	`»q_put
(
msg
);

498  
Œue
;

506 ià(
msg
->
qu™
) {

507 
	`log_debug
(
LOG_INFO
, "f‹¸qu™„eq %"
PRIu64
" from c %d", 
msg
->
id
,

508 
cÚn
->
sd
);

509 ià(
cÚn
->
rmsg
 !ğ
NULL
) {

510 
	`log_debug
(
LOG_INFO
, "disÿrd inv®id„eq %"
PRIu64
"†’ %"
PRIu32
" "

511 "äom c %d s’ˆaá” qu™„eq", 
cÚn
->
rmsg
->
id
,

512 
cÚn
->
rmsg
->
mËn
, cÚn->
sd
);

514 
cÚn
->
eof
 = 1;

515 
cÚn
->
»cv_»ady
 = 0;

516 
	`»q_put
(
msg
);

517  
Œue
;

524 ià(!
	`cÚn_auth’tiÿ‹d
(
cÚn
)) {

525 
msg
->
nofÜw¬d
 = 1;

528  
çl£
;

529 
	}
}

532 
	$»q_fÜw¬d_”rÜ
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

534 
r¡©us_t
 
¡©us
;

536 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

538 
	`log_debug
(
LOG_INFO
, "fÜw¬d„eq %"
PRIu64
"†’ %"
PRIu32
"ype %d from "

539 "ø%d faed: %s", 
msg
->
id
, msg->
mËn
, msg->
ty³
, 
cÚn
->
sd
,

540 
	`¡»¼Ü
(
”ºo
));

542 
msg
->
dÚe
 = 1;

543 
msg
->
”rÜ
 = 1;

544 
msg
->
”r
 = 
”ºo
;

547 
	`¡©s_poŞ_šü
(
ùx
, 
cÚn
->
owÃr
, 
fÜw¬d_”rÜ
);

550 ià(
msg
->
nÜ•ly
) {

551 
	`»q_put
(
msg
);

555 ià(
	`»q_dÚe
(
cÚn
, 
	`TAILQ_FIRST
(&cÚn->
omsg_q
))) {

556 
¡©us
 = 
	`ev’t_add_out
(
ùx
->
evb
, 
cÚn
);

557 ià(
¡©us
 !ğ
NC_OK
) {

558 
cÚn
->
”r
 = 
”ºo
;

561 
	}
}

564 
	$»q_fÜw¬d_¡©s
(
cÚ‹xt
 *
ùx
, 
£rv”
 *£rv”, 
msg
 *msg)

566 
	`ASSERT
(
msg
->
»que¡
);

569 
ušt32_t
 
i
 = 0; i < 
	`¬¿y_n
(
msg
->
keys
); i++) {

570 
	`¡©s_£rv”_šü
(
ùx
, 
£rv”
, 
»que¡s
);

572 
	`¡©s_£rv”_šü_by
(
ùx
, 
£rv”
, 
»que¡_by‹s
, 
msg
->
mËn
);

573 
	}
}

575 
boŞ


576 
	$is_£rv”_cÚn_wr™abË
(
cÚn
* 
s_cÚn
)

578 
£rv”
* 
¤v
 = 
s_cÚn
->
owÃr
;

579 
sh¬d
* 
sd
 = 
¤v
->
owÃr_sh¬d
;

580  
sd
->
ÿn_wr™e
;

581 
	}
}

584 
	$»q_fÜw¬d
(
cÚ‹xt
 *
ùx
, 
cÚn
 *
c_cÚn
, 
msg
 *msg)

586 
r¡©us_t
 
¡©us
;

587 
cÚn
 *
s_cÚn
;

588 
£rv”_poŞ
 *
poŞ
;

589 
ušt8_t
 *
key
;

590 
ušt32_t
 
keyËn
;

591 
keypos
 *
kpos
;

593 
	`ASSERT
(
c_cÚn
->
ş›Á
 && !c_cÚn->
´oxy
);

596 ià(!
msg
->
nÜ•ly
) {

597 
c_cÚn
->
	`’queue_outq
(
ùx
, c_cÚn, 
msg
);

600 
poŞ
 = 
c_cÚn
->
owÃr
;

602 
	`ASSERT
(
	`¬¿y_n
(
msg
->
keys
) > 0);

603 
kpos
 = 
	`¬¿y_g‘
(
msg
->
keys
, 0);

604 
key
 = 
kpos
->
¡¬t
;

605 
keyËn
 = (
ušt32_t
)(
kpos
->
’d
 - kpos->
¡¬t
);

607 
	`±h»ad_mu‹x_lock
(&
poŞ
->
lock
);

608 
s_cÚn
 = 
	`£rv”_poŞ_cÚn
(
ùx
, 
c_cÚn
->
owÃr
, 
key
, 
keyËn
);

609 
	`±h»ad_mu‹x_uÆock
(&
poŞ
->
lock
);

610 ià(
s_cÚn
 =ğ
NULL
) {

611 
	`»q_fÜw¬d_”rÜ
(
ùx
, 
c_cÚn
, 
msg
);

615 
	`ASSERT
(!
s_cÚn
->
ş›Á
 && !s_cÚn->
´oxy
);

618 ià(
msg
->
is_wr™e
 && !
	`is_£rv”_cÚn_wr™abË
(
s_cÚn
)) {

619 
	`log_debug
(
LOG_NOTICE
, "fail‡ write„eqo‚on-writable shard.");

620 
	`»q_fÜw¬d_”rÜ
(
ùx
, 
c_cÚn
, 
msg
);

625 ià(
	`TAILQ_EMPTY
(&
s_cÚn
->
imsg_q
)) {

626 
¡©us
 = 
	`ev’t_add_out
(
ùx
->
evb
, 
s_cÚn
);

627 ià(
¡©us
 !ğ
NC_OK
) {

628 
	`»q_fÜw¬d_”rÜ
(
ùx
, 
c_cÚn
, 
msg
);

629 
s_cÚn
->
”r
 = 
”ºo
;

634 ià(!
	`cÚn_auth’tiÿ‹d
(
s_cÚn
)) {

635 
¡©us
 = 
msg
->
	`add_auth
(
ùx
, 
c_cÚn
, 
s_cÚn
);

636 ià(
¡©us
 !ğ
NC_OK
) {

637 
	`»q_fÜw¬d_”rÜ
(
ùx
, 
c_cÚn
, 
msg
);

638 
s_cÚn
->
”r
 = 
”ºo
;

643 
s_cÚn
->
	`’queue_šq
(
ùx
, s_cÚn, 
msg
);

645 
	`»q_fÜw¬d_¡©s
(
ùx
, 
s_cÚn
->
owÃr
, 
msg
);

647 
	`log_debug
(
LOG_VERB
, "fÜw¬d from c %dØ %d„eq %"
PRIu64
"†’ %"
PRIu32


648 "y³ %d w™h key '%.*s'", 
c_cÚn
->
sd
, 
s_cÚn
->sd, 
msg
->
id
,

649 
msg
->
mËn
, msg->
ty³
, 
keyËn
, 
key
);

650 
	}
}

653 
	$»q_»cv_dÚe
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg,

654 
msg
 *
nmsg
)

656 
r¡©us_t
 
¡©us
;

657 
£rv”_poŞ
 *
poŞ
;

658 
msg_tqh
 
äag_msgq
;

659 
msg
 *
sub_msg
;

660 
msg
 *
tmsg
;

662 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

663 
	`ASSERT
(
msg
->
»que¡
);

664 
	`ASSERT
(
msg
->
owÃr
 =ğ
cÚn
);

665 
	`ASSERT
(
cÚn
->
rmsg
 =ğ
msg
);

666 
	`ASSERT
(
nmsg
 =ğ
NULL
 ||‚msg->
»que¡
);

669 
cÚn
->
rmsg
 = 
nmsg
;

671 ià(
	`»q_f‹r
(
ùx
, 
cÚn
, 
msg
)) {

675 ià(
msg
->
nofÜw¬d
) {

676 
¡©us
 = 
	`»q_make_»¶y
(
ùx
, 
cÚn
, 
msg
);

677 ià(
¡©us
 !ğ
NC_OK
) {

678 
cÚn
->
”r
 = 
”ºo
;

682 
¡©us
 = 
msg
->
	`»¶y
(msg);

683 ià(
¡©us
 !ğ
NC_OK
) {

684 
cÚn
->
”r
 = 
”ºo
;

688 
¡©us
 = 
	`ev’t_add_out
(
ùx
->
evb
, 
cÚn
);

689 ià(
¡©us
 !ğ
NC_OK
) {

690 
cÚn
->
”r
 = 
”ºo
;

697 
poŞ
 = 
cÚn
->
owÃr
;

698 
	`TAILQ_INIT
(&
äag_msgq
);

699 
¡©us
 = 
msg
->
	`äagm’t
(msg, 
poŞ
->
ncÚtšuum
, &
äag_msgq
);

700 ià(
¡©us
 !ğ
NC_OK
) {

701 ià(!
msg
->
nÜ•ly
) {

702 
cÚn
->
	`’queue_outq
(
ùx
, cÚn, 
msg
);

704 
	`»q_fÜw¬d_”rÜ
(
ùx
, 
cÚn
, 
msg
);

708 ià(
	`TAILQ_EMPTY
(&
äag_msgq
)) {

709 
	`»q_fÜw¬d
(
ùx
, 
cÚn
, 
msg
);

713 
¡©us
 = 
	`»q_make_»¶y
(
ùx
, 
cÚn
, 
msg
);

714 ià(
¡©us
 !ğ
NC_OK
) {

715 ià(!
msg
->
nÜ•ly
) {

716 
cÚn
->
	`’queue_outq
(
ùx
, cÚn, 
msg
);

718 
	`»q_fÜw¬d_”rÜ
(
ùx
, 
cÚn
, 
msg
);

721 
sub_msg
 = 
	`TAILQ_FIRST
(&
äag_msgq
); sub_msg !ğ
NULL
; sub_msg = 
tmsg
) {

722 
tmsg
 = 
	`TAILQ_NEXT
(
sub_msg
, 
m_tqe
);

724 
	`TAILQ_REMOVE
(&
äag_msgq
, 
sub_msg
, 
m_tqe
);

725 
	`»q_fÜw¬d
(
ùx
, 
cÚn
, 
sub_msg
);

728 
	`ASSERT
(
	`TAILQ_EMPTY
(&
äag_msgq
));

730 
	}
}

732 
msg
 *

733 
	$»q_£nd_Ãxt
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

735 
r¡©us_t
 
¡©us
;

736 
msg
 *msg, *
nmsg
;

738 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

740 ià(
cÚn
->
cÚÃùšg
) {

741 
	`£rv”_cÚÃùed
(
ùx
, 
cÚn
);

744 
nmsg
 = 
	`TAILQ_FIRST
(&
cÚn
->
imsg_q
);

745 ià(
nmsg
 =ğ
NULL
) {

747 
¡©us
 = 
	`ev’t_d–_out
(
ùx
->
evb
, 
cÚn
);

748 ià(
¡©us
 !ğ
NC_OK
) {

749 
cÚn
->
”r
 = 
”ºo
;

752  
NULL
;

755 
msg
 = 
cÚn
->
smsg
;

756 ià(
msg
 !ğ
NULL
) {

757 
	`ASSERT
(
msg
->
»que¡
 && !msg->
dÚe
);

758 
nmsg
 = 
	`TAILQ_NEXT
(
msg
, 
s_tqe
);

761 
cÚn
->
smsg
 = 
nmsg
;

763 ià(
nmsg
 =ğ
NULL
) {

764  
NULL
;

767 
	`ASSERT
(
nmsg
->
»que¡
 && !nmsg->
dÚe
);

769 
	`log_debug
(
LOG_VVERB
, "£nd‚exˆ»q %"
PRIu64
"†’ %"
PRIu32
"ype %d on "

770 " %d", 
nmsg
->
id
,‚msg->
mËn
,‚msg->
ty³
, 
cÚn
->
sd
);

772  
nmsg
;

773 
	}
}

776 
	$»q_£nd_dÚe
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

778 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

779 
	`ASSERT
(
msg
 !ğ
NULL
 && 
cÚn
->
smsg
 == NULL);

780 
	`ASSERT
(
msg
->
»que¡
 && !msg->
dÚe
);

781 
	`ASSERT
(
msg
->
owÃr
 !ğ
cÚn
);

783 
	`log_debug
(
LOG_VVERB
, "£nd dÚ»q %"
PRIu64
"†’ %"
PRIu32
"ype %d on "

784 " %d", 
msg
->
id
, msg->
mËn
, msg->
ty³
, 
cÚn
->
sd
);

787 
cÚn
->
	`dequeue_šq
(
ùx
, cÚn, 
msg
);

794 ià(!
msg
->
nÜ•ly
) {

795 
cÚn
->
	`’queue_outq
(
ùx
, cÚn, 
msg
);

797 
	`»q_put
(
msg
);

799 
	}
}

	@nc_response.c

18 
	~<nc_cÜe.h
>

19 
	~<nc_£rv”.h
>

21 
msg
 *

22 
	$r¥_g‘
(
cÚn
 *conn)

24 
msg
 *msg;

26 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

28 
msg
 = 
	`msg_g‘
(
cÚn
, 
çl£
, cÚn->
»dis
);

29 ià(
msg
 =ğ
NULL
) {

30 
cÚn
->
”r
 = 
”ºo
;

34 
msg
->
time¡amp
 = 
	`nc_now_us
();

35  
msg
;

36 
	}
}

39 
	$r¥_put
(
msg
 *msg)

41 
	`ASSERT
(!
msg
->
»que¡
);

42 
	`ASSERT
(
msg
->
³”
 =ğ
NULL
);

43 
	`msg_put
(
msg
);

44 
	}
}

46 
msg
 *

47 
	$r¥_make_”rÜ
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

49 
msg
 *
pmsg
;

50 
msg
 *
cmsg
, *
nmsg
;

51 
ušt64_t
 
id
;

52 
”r_t
 
”r
;

54 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

55 
	`ASSERT
(
msg
->
»que¡
 && 
	`»q_”rÜ
(
cÚn
, msg));

56 
	`ASSERT
(
msg
->
owÃr
 =ğ
cÚn
);

58 
id
 = 
msg
->
äag_id
;

59 ià(
id
 != 0) {

60 
”r
 = 0, 
cmsg
 = 
	`TAILQ_NEXT
(
msg
, 
c_tqe
);

61 
cmsg
 !ğ
NULL
 && cmsg->
äag_id
 =ğ
id
;

62 
cmsg
 = 
nmsg
) {

63 
nmsg
 = 
	`TAILQ_NEXT
(
cmsg
, 
c_tqe
);

66 
cÚn
->
	`dequeue_outq
(
ùx
, cÚn, 
cmsg
);

67 ià(
”r
 =ğ0 && 
cmsg
->err != 0) {

68 
”r
 = 
cmsg
->err;

71 
	`»q_put
(
cmsg
);

74 
”r
 = 
msg
->err;

77 
pmsg
 = 
msg
->
³”
;

78 ià(
pmsg
 !ğ
NULL
) {

79 
	`ASSERT
(!
pmsg
->
»que¡
 &&…msg->
³”
 =ğ
msg
);

80 
msg
->
³”
 = 
NULL
;

81 
pmsg
->
³”
 = 
NULL
;

82 
	`r¥_put
(
pmsg
);

85  
	`msg_g‘_”rÜ
(
cÚn
->
»dis
, 
”r
);

86 
	}
}

88 
msg
 *

89 
	$r¥_»cv_Ãxt
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
boŞ
 
®loc
)

91 
msg
 *msg;

93 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

95 ià(
cÚn
->
eof
) {

96 
msg
 = 
cÚn
->
rmsg
;

99 ià(
msg
 !ğ
NULL
) {

100 
cÚn
->
rmsg
 = 
NULL
;

102 
	`ASSERT
(
msg
->
³”
 =ğ
NULL
);

103 
	`ASSERT
(!
msg
->
»que¡
);

105 
	`log_”rÜ
("eoà %d disÿrdšg incom¶‘r¥ %"
PRIu64
"†en "

106 "%"
PRIu32
"", 
cÚn
->
sd
, 
msg
->
id
, msg->
mËn
);

108 
	`r¥_put
(
msg
);

119 
cÚn
->
dÚe
 = 1;

120 
	`log_”rÜ
(" %d‡ùiv%d i dÚe", 
cÚn
->
sd
, cÚn->
	`aùive
(conn));

122  
NULL
;

125 
msg
 = 
cÚn
->
rmsg
;

126 ià(
msg
 !ğ
NULL
) {

127 
	`ASSERT
(!
msg
->
»que¡
);

128  
msg
;

131 ià(!
®loc
) {

132  
NULL
;

135 
msg
 = 
	`r¥_g‘
(
cÚn
);

136 ià(
msg
 !ğ
NULL
) {

137 
cÚn
->
rmsg
 = 
msg
;

140  
msg
;

141 
	}
}

143 
boŞ


144 
	$r¥_f‹r
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

146 
msg
 *
pmsg
;

148 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

150 ià(
	`msg_em±y
(
msg
)) {

151 
	`ASSERT
(
cÚn
->
rmsg
 =ğ
NULL
);

152 
	`log_debug
(
LOG_VERB
, "f‹¸em±y„¥ %"
PRIu64
" oÀ %d", 
msg
->
id
,

153 
cÚn
->
sd
);

154 
	`r¥_put
(
msg
);

155  
Œue
;

158 
pmsg
 = 
	`TAILQ_FIRST
(&
cÚn
->
omsg_q
);

159 ià(
pmsg
 =ğ
NULL
) {

160 
	`log_debug
(
LOG_ERR
, "f‹¸¡¿y„¥ %"
PRIu64
"†’ %"
PRIu32
" on s %d",

161 
msg
->
id
, msg->
mËn
, 
cÚn
->
sd
);

162 
	`r¥_put
(
msg
);

182 
cÚn
->
”r
 = 
EINVAL
;

183 
cÚn
->
dÚe
 = 1;

184  
Œue
;

186 
	`ASSERT
(
pmsg
->
³”
 =ğ
NULL
);

187 
	`ASSERT
(
pmsg
->
»que¡
 && !pmsg->
dÚe
);

197 ià(
msg
->
	`çu»
(msg)) {

198 
	`log_debug
(
LOG_INFO
, "£rv” fau»„¥ %"
PRIu64
"†’ %"
PRIu32
" "

199 "ty³ %d oÀ %d", 
msg
->
id
, msg->
mËn
, msg->
ty³
, 
cÚn
->
sd
);

200 
	`r¥_put
(
msg
);

202 
cÚn
->
”r
 = 
EINVAL
;

203 
cÚn
->
dÚe
 = 1;

205  
Œue
;

208 ià(
pmsg
->
sw®low
) {

209 
cÚn
->
	`sw®low_msg
(cÚn, 
pmsg
, 
msg
);

211 
cÚn
->
	`dequeue_outq
(
ùx
, cÚn, 
pmsg
);

212 
pmsg
->
dÚe
 = 1;

214 
	`log_debug
(
LOG_INFO
, "sw®low„¥ %"
PRIu64
"†’ %"
PRIu32
" of„eq "

215 "%"
PRIu64
" oÀ %d", 
msg
->
id
, msg->
mËn
, 
pmsg
->id,

216 
cÚn
->
sd
);

218 
	`r¥_put
(
msg
);

219 
	`»q_put
(
pmsg
);

220  
Œue
;

223  
çl£
;

224 
	}
}

227 
	$r¥_fÜw¬d_¡©s
(
cÚ‹xt
 *
ùx
, 
£rv”
 *£rv”, 
msg
 *msg, 
ušt32_t
 
msgsize
)

229 
	`ASSERT
(!
msg
->
»que¡
);

231 
	`¡©s_£rv”_šü
(
ùx
, 
£rv”
, 
»¥Ú£s
);

232 
	`¡©s_£rv”_šü_by
(
ùx
, 
£rv”
, 
»¥Ú£_by‹s
, 
msgsize
);

233 
	}
}

236 
	$r¥_fÜw¬d
(
cÚ‹xt
 *
ùx
, 
cÚn
 *
s_cÚn
, 
msg
 *msg)

238 
r¡©us_t
 
¡©us
;

239 
msg
 *
pmsg
;

240 
cÚn
 *
c_cÚn
;

241 
ušt32_t
 
msgsize
;

243 
	`ASSERT
(!
s_cÚn
->
ş›Á
 && !s_cÚn->
´oxy
);

244 
msgsize
 = 
msg
->
mËn
;

247 
	`£rv”_ok
(
ùx
, 
s_cÚn
);

250 
pmsg
 = 
	`TAILQ_FIRST
(&
s_cÚn
->
omsg_q
);

251 
	`ASSERT
(
pmsg
 !ğ
NULL
 &&…msg->
³”
 == NULL);

252 
	`ASSERT
(
pmsg
->
»que¡
 && !pmsg->
dÚe
);

254 
s_cÚn
->
	`dequeue_outq
(
ùx
, s_cÚn, 
pmsg
);

255 
pmsg
->
dÚe
 = 1;

258 
pmsg
->
³”
 = 
msg
;

259 
msg
->
³”
 = 
pmsg
;

261 
msg
->
	`´e_cßËsû
(msg);

263 
c_cÚn
 = 
pmsg
->
owÃr
;

264 
	`ASSERT
(
c_cÚn
->
ş›Á
 && !c_cÚn->
´oxy
);

266 ià(
	`»q_dÚe
(
c_cÚn
, 
	`TAILQ_FIRST
(&c_cÚn->
omsg_q
))) {

267 
¡©us
 = 
	`ev’t_add_out
(
ùx
->
evb
, 
c_cÚn
);

268 ià(
¡©us
 !ğ
NC_OK
) {

269 
c_cÚn
->
”r
 = 
”ºo
;

273 
	`r¥_fÜw¬d_¡©s
(
ùx
, 
s_cÚn
->
owÃr
, 
msg
, 
msgsize
);

274 
	}
}

277 
	$r¥_»cv_dÚe
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg,

278 
msg
 *
nmsg
)

280 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

281 
	`ASSERT
(
msg
 !ğ
NULL
 && 
cÚn
->
rmsg
 == msg);

282 
	`ASSERT
(!
msg
->
»que¡
);

283 
	`ASSERT
(
msg
->
owÃr
 =ğ
cÚn
);

284 
	`ASSERT
(
nmsg
 =ğ
NULL
 || !nmsg->
»que¡
);

287 
cÚn
->
rmsg
 = 
nmsg
;

289 ià(
	`r¥_f‹r
(
ùx
, 
cÚn
, 
msg
)) {

293 
	`r¥_fÜw¬d
(
ùx
, 
cÚn
, 
msg
);

294 
	}
}

296 
msg
 *

297 
	$r¥_£nd_Ãxt
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

299 
r¡©us_t
 
¡©us
;

300 
msg
 *msg, *
pmsg
;

302 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

304 
pmsg
 = 
	`TAILQ_FIRST
(&
cÚn
->
omsg_q
);

305 ià(
pmsg
 =ğ
NULL
 || !
	`»q_dÚe
(
cÚn
,…msg)) {

307 ià(
pmsg
 =ğ
NULL
 && 
cÚn
->
eof
) {

308 
cÚn
->
dÚe
 = 1;

309 
	`log_debug
(
LOG_INFO
, "ø%d i dÚe", 
cÚn
->
sd
);

312 
¡©us
 = 
	`ev’t_d–_out
(
ùx
->
evb
, 
cÚn
);

313 ià(
¡©us
 !ğ
NC_OK
) {

314 
cÚn
->
”r
 = 
”ºo
;

317  
NULL
;

320 
msg
 = 
cÚn
->
smsg
;

321 ià(
msg
 !ğ
NULL
) {

322 
	`ASSERT
(!
msg
->
»que¡
 && msg->
³”
 !ğ
NULL
);

323 
	`ASSERT
(
	`»q_dÚe
(
cÚn
, 
msg
->
³”
));

324 
pmsg
 = 
	`TAILQ_NEXT
(
msg
->
³”
, 
c_tqe
);

327 ià(
pmsg
 =ğ
NULL
 || !
	`»q_dÚe
(
cÚn
,…msg)) {

328 
cÚn
->
smsg
 = 
NULL
;

329  
NULL
;

331 
	`ASSERT
(
pmsg
->
»que¡
 && !pmsg->
sw®low
);

333 ià(
	`»q_”rÜ
(
cÚn
, 
pmsg
)) {

334 
msg
 = 
	`r¥_make_”rÜ
(
ùx
, 
cÚn
, 
pmsg
);

335 ià(
msg
 =ğ
NULL
) {

336 
cÚn
->
”r
 = 
”ºo
;

337  
NULL
;

339 
msg
->
³”
 = 
pmsg
;

340 
pmsg
->
³”
 = 
msg
;

341 
	`¡©s_poŞ_šü
(
ùx
, 
cÚn
->
owÃr
, 
fÜw¬d_”rÜ
);

343 
msg
 = 
pmsg
->
³”
;

345 
	`ASSERT
(!
msg
->
»que¡
);

347 
cÚn
->
smsg
 = 
msg
;

349 
	`log_debug
(
LOG_VVERB
, "£nd‚exˆr¥ %"
PRIu64
" oÀø%d", 
msg
->
id
, 
cÚn
->
sd
);

351  
msg
;

352 
	}
}

355 
	$r¥_£nd_dÚe
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
msg
 *msg)

357 
msg
 *
pmsg
;

359 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

360 
	`ASSERT
(
cÚn
->
smsg
 =ğ
NULL
);

362 
	`log_debug
(
LOG_VVERB
, "£nd dÚr¥ %"
PRIu64
" oÀø%d", 
msg
->
id
, 
cÚn
->
sd
);

364 
pmsg
 = 
msg
->
³”
;

366 
	`ASSERT
(!
msg
->
»que¡
 && 
pmsg
->request);

367 
	`ASSERT
(
pmsg
->
³”
 =ğ
msg
);

368 
	`ASSERT
(
pmsg
->
dÚe
 && !pmsg->
sw®low
);

371 
cÚn
->
	`dequeue_outq
(
ùx
, cÚn, 
pmsg
);

373 
	`»q_put
(
pmsg
);

374 
	}
}

	@nc_server.c

18 
	~<¡dlib.h
>

19 
	~<uni¡d.h
>

21 
	~<nc_cÜe.h
>

22 
	~<nc_£rv”.h
>

23 
	~<nc_cÚf.h
>

25 
sh¬d
*

26 
g‘_sh¬d_äom_key
(
£rv”_poŞ
 *
poŞ
, 
ušt8_t
 *
key
, 
ušt32_t
 
keyËn
);

29 
	$£rv”_»sŞve
(
£rv”
 *£rv”, 
cÚn
 *conn)

31 
r¡©us_t
 
¡©us
;

33 
¡©us
 = 
	`nc_»sŞve
(&
£rv”
->
addr¡r
, s”v”->
pÜt
, &£rv”->
šfo
);

34 ià(
¡©us
 !ğ
NC_OK
) {

35 
cÚn
->
”r
 = 
EHOSTDOWN
;

36 
cÚn
->
dÚe
 = 1;

40 
cÚn
->
çmy
 = 
£rv”
->
šfo
.family;

41 
cÚn
->
add¾’
 = 
£rv”
->
šfo
.addrlen;

42 
cÚn
->
addr
 = (
sockaddr
 *)&
£rv”
->
šfo
.addr;

43 
	}
}

46 
	$£rv”_»f
(
cÚn
 *cÚn, *
owÃr
)

48 
£rv”
 *£rv” = 
owÃr
;

50 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

51 
	`ASSERT
(
cÚn
->
owÃr
 =ğ
NULL
);

53 
	`£rv”_»sŞve
(
£rv”
, 
cÚn
);

55 
£rv”
->
ns_cÚn_q
++;

56 
	`TAILQ_INSERT_TAIL
(&
£rv”
->
s_cÚn_q
, 
cÚn
, 
cÚn_tqe
);

58 
cÚn
->
owÃr
 = owner;

60 
	`log_debug
(
LOG_VVERB
, "»àcÚÀ%°owÃ¸%°štØ'%.*s", 
cÚn
, 
£rv”
,

61 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
);

62 
	}
}

65 
	$£rv”_uÄef
(
cÚn
 *conn)

67 
£rv”
 *server;

69 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

70 
	`ASSERT
(
cÚn
->
owÃr
 !ğ
NULL
);

72 
£rv”
 = 
cÚn
->
owÃr
;

73 
cÚn
->
owÃr
 = 
NULL
;

75 
	`ASSERT
(
£rv”
->
ns_cÚn_q
 != 0);

76 
£rv”
->
ns_cÚn_q
--;

77 
	`TAILQ_REMOVE
(&
£rv”
->
s_cÚn_q
, 
cÚn
, 
cÚn_tqe
);

79 
	`log_debug
(
LOG_VVERB
, "uÄeàcÚÀ%°owÃ¸%°äom '%.*s'", 
cÚn
, 
£rv”
,

80 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
);

81 
	}
}

84 
	$£rv”_timeout
(
cÚn
 *conn)

86 
£rv”
 *server;

87 
£rv”_poŞ
 *
poŞ
;

89 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

91 
£rv”
 = 
cÚn
->
owÃr
;

92 
poŞ
 = 
£rv”
->
owÃr
;

94  
poŞ
->
timeout
;

95 
	}
}

97 
boŞ


98 
	$£rv”_aùive
(
cÚn
 *conn)

100 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

102 ià(!
	`TAILQ_EMPTY
(&
cÚn
->
imsg_q
)) {

103 
	`log_debug
(
LOG_VVERB
, " %d i aùive", 
cÚn
->
sd
);

104  
Œue
;

107 ià(!
	`TAILQ_EMPTY
(&
cÚn
->
omsg_q
)) {

108 
	`log_debug
(
LOG_VVERB
, " %d i aùive", 
cÚn
->
sd
);

109  
Œue
;

112 ià(
cÚn
->
rmsg
 !ğ
NULL
) {

113 
	`log_debug
(
LOG_VVERB
, " %d i aùive", 
cÚn
->
sd
);

114  
Œue
;

117 ià(
cÚn
->
smsg
 !ğ
NULL
) {

118 
	`log_debug
(
LOG_VVERB
, " %d i aùive", 
cÚn
->
sd
);

119  
Œue
;

122 
	`log_debug
(
LOG_VVERB
, " %d i šaùive", 
cÚn
->
sd
);

124  
çl£
;

125 
	}
}

127 
r¡©us_t


128 
	$£rv”_—ch_£t_owÃr
(*
–em
, *
d©a
)

130 
£rv”
 *
s
 = 
–em
;

131 
£rv”_poŞ
 *
¥
 = 
d©a
;

133 
s
->
owÃr
 = 
¥
;

135  
NC_OK
;

136 
	}
}

138 
r¡©us_t


139 
	$£rv”_š™
(
¬¿y
 *
£rv”
, ¬¿y *
cÚf_£rv”
,

140 
£rv”_poŞ
 *
¥
)

142 
r¡©us_t
 
¡©us
;

143 
ušt32_t
 
n£rv”
;

145 
n£rv”
 = 
	`¬¿y_n
(
cÚf_£rv”
);

146 
	`ASSERT
(
n£rv”
 != 0);

147 
	`ASSERT
(
	`¬¿y_n
(
£rv”
) == 0);

149 
¡©us
 = 
	`¬¿y_š™
(
£rv”
, 
n£rv”
, (server));

150 ià(
¡©us
 !ğ
NC_OK
) {

151  
¡©us
;

155 
¡©us
 = 
	`¬¿y_—ch
(
cÚf_£rv”
, 
cÚf_£rv”_—ch_ŒªsfÜm
, 
£rv”
);

156 ià(
¡©us
 !ğ
NC_OK
) {

157 
	`£rv”_deš™
(
£rv”
);

158  
¡©us
;

160 
	`ASSERT
(
	`¬¿y_n
(
£rv”
è=ğ
n£rv”
);

163 
¡©us
 = 
	`¬¿y_—ch
(
£rv”
, 
£rv”_—ch_£t_owÃr
, 
¥
);

164 ià(
¡©us
 !ğ
NC_OK
) {

165 
	`£rv”_deš™
(
£rv”
);

166  
¡©us
;

169 
	`log_debug
(
LOG_DEBUG
, "š™ %"
PRIu32
" servers in…ool %"PRIu32" '%.*s'",

170 
n£rv”
, 
¥
->
idx
, sp->
Çme
.
Ën
, sp->Çme.
d©a
);

172  
NC_OK
;

173 
	}
}

176 
	$£rv”_deš™
(
¬¿y
 *
£rv”
)

178 
ušt32_t
 
i
, 
n£rv”
;

180 
i
 = 0, 
n£rv”
 = 
	`¬¿y_n
(
£rv”
); i <‚server; i++) {

181 
£rv”
 *
s
;

183 
s
 = 
	`¬¿y_pİ
(
£rv”
);

184 
	`ASSERT
(
	`TAILQ_EMPTY
(&
s
->
s_cÚn_q
è&& s->
ns_cÚn_q
 == 0);

186 
	`¬¿y_deš™
(
£rv”
);

187 
	}
}

189 
cÚn
 *

190 
	$£rv”_cÚn
(
£rv”
 *server)

192 
£rv”_poŞ
 *
poŞ
;

193 
cÚn
 *conn;

195 
poŞ
 = 
£rv”
->
owÃr
;

203 ià(
£rv”
->
ns_cÚn_q
 < 
poŞ
->
£rv”_cÚÃùiÚs
) {

204  
	`cÚn_g‘
(
£rv”
, 
çl£
, 
poŞ
->
»dis
);

206 
	`ASSERT
(
£rv”
->
ns_cÚn_q
 =ğ
poŞ
->
£rv”_cÚÃùiÚs
);

212 
cÚn
 = 
	`TAILQ_FIRST
(&
£rv”
->
s_cÚn_q
);

213 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

215 
	`TAILQ_REMOVE
(&
£rv”
->
s_cÚn_q
, 
cÚn
, 
cÚn_tqe
);

216 
	`TAILQ_INSERT_TAIL
(&
£rv”
->
s_cÚn_q
, 
cÚn
, 
cÚn_tqe
);

218  
cÚn
;

219 
	}
}

221 
r¡©us_t


222 
	$£rv”_—ch_´ecÚÃù
(*
–em
, *
d©a
)

224 
r¡©us_t
 
¡©us
;

225 
£rv”
 *server;

226 
£rv”_poŞ
 *
poŞ
;

227 
cÚn
 *conn;

229 
£rv”
 = 
–em
;

230 
poŞ
 = 
£rv”
->
owÃr
;

232 
cÚn
 = 
	`£rv”_cÚn
(
£rv”
);

233 ià(
cÚn
 =ğ
NULL
) {

234  
NC_ENOMEM
;

237 
¡©us
 = 
	`£rv”_cÚÃù
(
poŞ
->
ùx
, 
£rv”
, 
cÚn
);

238 ià(
¡©us
 !ğ
NC_OK
) {

239 
	`log_w¬n
("connecto server '%.*s' failed, ignored: %s",

240 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
, 
	`¡»¼Ü
(
”ºo
));

241 
	`£rv”_şo£
(
poŞ
->
ùx
, 
cÚn
);

244  
NC_OK
;

245 
	}
}

247 
r¡©us_t


248 
	$£rv”_—ch_discÚÃù
(*
–em
, *
d©a
)

250 
£rv”
 *server;

251 
£rv”_poŞ
 *
poŞ
;

253 
£rv”
 = 
–em
;

254 
poŞ
 = 
£rv”
->
owÃr
;

256 !
	`TAILQ_EMPTY
(&
£rv”
->
s_cÚn_q
)) {

257 
cÚn
 *conn;

259 
	`ASSERT
(
£rv”
->
ns_cÚn_q
 > 0);

261 
cÚn
 = 
	`TAILQ_FIRST
(&
£rv”
->
s_cÚn_q
);

262 
cÚn
->
	`şo£
(
poŞ
->
ùx
, conn);

265  
NC_OK
;

266 
	}
}

269 
	$£rv”_çu»
(
cÚ‹xt
 *
ùx
, 
£rv”
 *server)

271 
£rv”_poŞ
 *
poŞ
 = 
£rv”
->
owÃr
;

272 
št64_t
 
now
, 
Ãxt
;

273 
r¡©us_t
 
¡©us
;

275 ià(!
poŞ
->
auto_ejeù_ho¡s
) {

279 
£rv”
->
çu»_couÁ
++;

281 
	`log_debug
(
LOG_VERB
, "£rv” '%.*s' fau» couÁ %"
PRIu32
"†imit %"PRIu32,

282 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
, s”v”->
çu»_couÁ
,

283 
poŞ
->
£rv”_çu»_lim™
);

285 ià(
£rv”
->
çu»_couÁ
 < 
poŞ
->
£rv”_çu»_lim™
) {

289 
now
 = 
	`nc_u£c_now
();

290 ià(
now
 < 0) {

294 
	`¡©s_£rv”_£t_ts
(
ùx
, 
£rv”
, 
£rv”_ejeùed_©
, 
now
);

296 
Ãxt
 = 
now
 + 
poŞ
->
£rv”_»Œy_timeout
;

298 
	`log_debug
(
LOG_INFO
, "upd©poŞ %"
PRIu32
" '%.*s'o delete server '%.*s' "

299 "fÜ‚exˆ%"
PRIu32
" secs", 
poŞ
->
idx
,…oŞ->
Çme
.
Ën
,

300 
poŞ
->
Çme
.
d©a
, 
£rv”
->
²ame
.
Ën
, server->pname.data,

301 
poŞ
->
£rv”_»Œy_timeout
 / 1000 / 1000);

303 
	`¡©s_poŞ_šü
(
ùx
, 
poŞ
, 
£rv”_ejeùs
);

305 
£rv”
->
çu»_couÁ
 = 0;

306 
£rv”
->
Ãxt_»Œy
 = 
Ãxt
;

308 
¡©us
 = 
	`£rv”_poŞ_run
(
poŞ
);

309 ià(
¡©us
 !ğ
NC_OK
) {

310 
	`log_”rÜ
("upd©šg…oŞ %"
PRIu32
" '%.*s' faed: %s", 
poŞ
->
idx
,

311 
poŞ
->
Çme
.
Ën
,…oŞ->Çme.
d©a
, 
	`¡»¼Ü
(
”ºo
));

313 
	}
}

316 
	$£rv”_şo£_¡©s
(
cÚ‹xt
 *
ùx
, 
£rv”
 *£rv”, 
”r_t
 
”r
,

317 
eof
, 
cÚÃùed
)

319 ià(
cÚÃùed
) {

320 
	`¡©s_£rv”_deü
(
ùx
, 
£rv”
, 
£rv”_cÚÃùiÚs
);

323 ià(
eof
) {

324 
	`¡©s_£rv”_šü
(
ùx
, 
£rv”
, 
£rv”_eof
);

328 
”r
) {

329 
ETIMEDOUT
:

330 
	`¡©s_£rv”_šü
(
ùx
, 
£rv”
, 
£rv”_timedout
);

332 
EPIPE
:

333 
ECONNRESET
:

334 
ECONNABORTED
:

335 
ECONNREFUSED
:

336 
ENOTCONN
:

337 
ENETDOWN
:

338 
ENETUNREACH
:

339 
EHOSTDOWN
:

340 
EHOSTUNREACH
:

342 
	`¡©s_£rv”_šü
(
ùx
, 
£rv”
, 
£rv”_”r
);

345 
	}
}

348 
	$£rv”_şo£
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

350 
r¡©us_t
 
¡©us
;

351 
msg
 *msg, *
nmsg
;

352 
cÚn
 *
c_cÚn
;

354 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

356 
	`£rv”_şo£_¡©s
(
ùx
, 
cÚn
->
owÃr
, cÚn->
”r
, cÚn->
eof
,

357 
cÚn
->
cÚÃùed
);

359 
cÚn
->
cÚÃùed
 = 
çl£
;

361 ià(
cÚn
->
sd
 < 0) {

362 
	`£rv”_çu»
(
ùx
, 
cÚn
->
owÃr
);

363 
cÚn
->
	`uÄef
(conn);

364 
	`cÚn_put
(
cÚn
);

368 
msg
 = 
	`TAILQ_FIRST
(&
cÚn
->
imsg_q
); msg !ğ
NULL
; msg = 
nmsg
) {

369 
nmsg
 = 
	`TAILQ_NEXT
(
msg
, 
s_tqe
);

372 
cÚn
->
	`dequeue_šq
(
ùx
, cÚn, 
msg
);

379 ià(
msg
->
sw®low
 || msg->
nÜ•ly
) {

380 
	`log_debug
(
LOG_INFO
, "şo£ s %d sw®low„eq %"
PRIu64
"†’ %"
PRIu32


381 "y³ %d", 
cÚn
->
sd
, 
msg
->
id
, msg->
mËn
, msg->
ty³
);

382 
	`»q_put
(
msg
);

384 
c_cÚn
 = 
msg
->
owÃr
;

385 
	`ASSERT
(
c_cÚn
->
ş›Á
 && !c_cÚn->
´oxy
);

387 
msg
->
dÚe
 = 1;

388 
msg
->
”rÜ
 = 1;

389 
msg
->
”r
 = 
cÚn
->err;

391 ià(
msg
->
äag_owÃr
 !ğ
NULL
) {

392 
msg
->
äag_owÃr
->
näag_dÚe
++;

395 ià(
	`»q_dÚe
(
c_cÚn
, 
	`TAILQ_FIRST
(&c_cÚn->
omsg_q
))) {

396 
	`ev’t_add_out
(
ùx
->
evb
, 
msg
->
owÃr
);

399 
	`log_debug
(
LOG_INFO
, "şo£ s %d scheduËƒ¼Ü fÜ„eq %"
PRIu64
" "

400 "ËÀ%"
PRIu32
"y³ %d from c %d%ø%s", 
cÚn
->
sd
, 
msg
->
id
,

401 
msg
->
mËn
, msg->
ty³
, 
c_cÚn
->
sd
, 
cÚn
->
”r
 ? ':' : ' ',

402 
cÚn
->
”r
 ? 
	`¡»¼Ü
(conn->err): " ");

405 
	`ASSERT
(
	`TAILQ_EMPTY
(&
cÚn
->
imsg_q
));

407 
msg
 = 
	`TAILQ_FIRST
(&
cÚn
->
omsg_q
); msg !ğ
NULL
; msg = 
nmsg
) {

408 
nmsg
 = 
	`TAILQ_NEXT
(
msg
, 
s_tqe
);

411 
cÚn
->
	`dequeue_outq
(
ùx
, cÚn, 
msg
);

413 ià(
msg
->
sw®low
) {

414 
	`log_debug
(
LOG_INFO
, "şo£ s %d sw®low„eq %"
PRIu64
"†’ %"
PRIu32


415 "y³ %d", 
cÚn
->
sd
, 
msg
->
id
, msg->
mËn
, msg->
ty³
);

416 
	`»q_put
(
msg
);

418 
c_cÚn
 = 
msg
->
owÃr
;

419 
	`ASSERT
(
c_cÚn
->
ş›Á
 && !c_cÚn->
´oxy
);

421 
msg
->
dÚe
 = 1;

422 
msg
->
”rÜ
 = 1;

423 
msg
->
”r
 = 
cÚn
->err;

424 ià(
msg
->
äag_owÃr
 !ğ
NULL
) {

425 
msg
->
äag_owÃr
->
näag_dÚe
++;

428 ià(
	`»q_dÚe
(
c_cÚn
, 
	`TAILQ_FIRST
(&c_cÚn->
omsg_q
))) {

429 
	`ev’t_add_out
(
ùx
->
evb
, 
msg
->
owÃr
);

432 
	`log_debug
(
LOG_INFO
, "şo£ s %d scheduËƒ¼Ü fÜ„eq %"
PRIu64
" "

433 "ËÀ%"
PRIu32
"y³ %d from c %d%ø%s", 
cÚn
->
sd
, 
msg
->
id
,

434 
msg
->
mËn
, msg->
ty³
, 
c_cÚn
->
sd
, 
cÚn
->
”r
 ? ':' : ' ',

435 
cÚn
->
”r
 ? 
	`¡»¼Ü
(conn->err): " ");

438 
	`ASSERT
(
	`TAILQ_EMPTY
(&
cÚn
->
omsg_q
));

440 
msg
 = 
cÚn
->
rmsg
;

441 ià(
msg
 !ğ
NULL
) {

442 
cÚn
->
rmsg
 = 
NULL
;

444 
	`ASSERT
(!
msg
->
»que¡
);

445 
	`ASSERT
(
msg
->
³”
 =ğ
NULL
);

447 
	`r¥_put
(
msg
);

449 
	`log_debug
(
LOG_INFO
, "şo£ s %d disÿrdšg„¥ %"
PRIu64
"†’ %"
PRIu32
" "

450 "šƒ¼Ü", 
cÚn
->
sd
, 
msg
->
id
, msg->
mËn
);

453 
	`ASSERT
(
cÚn
->
smsg
 =ğ
NULL
);

455 
	`£rv”_çu»
(
ùx
, 
cÚn
->
owÃr
);

457 
cÚn
->
	`uÄef
(conn);

459 
¡©us
 = 
	`şo£
(
cÚn
->
sd
);

460 ià(
¡©us
 < 0) {

461 
	`log_”rÜ
("şo£ s %d faed, ignÜed: %s", 
cÚn
->
sd
, 
	`¡»¼Ü
(
”ºo
));

463 
cÚn
->
sd
 = -1;

465 
	`cÚn_put
(
cÚn
);

466 
	}
}

468 
r¡©us_t


469 
	$£rv”_cÚÃù
(
cÚ‹xt
 *
ùx
, 
£rv”
 *£rv”, 
cÚn
 *conn)

471 
r¡©us_t
 
¡©us
;

473 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

475 ià(
cÚn
->
”r
) {

476 
	`ASSERT
(
cÚn
->
dÚe
 && cÚn->
sd
 < 0);

477 
”ºo
 = 
cÚn
->
”r
;

478  
NC_ERROR
;

481 ià(
cÚn
->
sd
 > 0) {

483  
NC_OK
;

486 
	`log_debug
(
LOG_VVERB
, "cÚÃùØ£rv” '%.*s'", 
£rv”
->
²ame
.
Ën
,

487 
£rv”
->
²ame
.
d©a
);

489 
cÚn
->
sd
 = 
	`sock‘
(cÚn->
çmy
, 
SOCK_STREAM
, 0);

490 ià(
cÚn
->
sd
 < 0) {

491 
	`log_”rÜ
("sock‘ fÜ s”v” '%.*s' faed: %s", 
£rv”
->
²ame
.
Ën
,

492 
£rv”
->
²ame
.
d©a
, 
	`¡»¼Ü
(
”ºo
));

493 
¡©us
 = 
NC_ERROR
;

494 
”rÜ
;

497 
¡©us
 = 
	`nc_£t_nÚblockšg
(
cÚn
->
sd
);

498 ià(
¡©us
 !ğ
NC_OK
) {

499 
	`log_”rÜ
("set‚onblock on s %d for server '%.*s' failed: %s",

500 
cÚn
->
sd
, 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
,

501 
	`¡»¼Ü
(
”ºo
));

502 
”rÜ
;

505 ià(
£rv”
->
²ame
.
d©a
[0] != '/') {

506 
¡©us
 = 
	`nc_£t_tınod–ay
(
cÚn
->
sd
);

507 ià(
¡©us
 !ğ
NC_OK
) {

508 
	`log_w¬n
("setcpnodelay on s %d for server '%.*s' failed, ignored: %s",

509 
cÚn
->
sd
, 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
,

510 
	`¡»¼Ü
(
”ºo
));

514 
¡©us
 = 
	`ev’t_add_cÚn
(
ùx
->
evb
, 
cÚn
);

515 ià(
¡©us
 !ğ
NC_OK
) {

516 
	`log_”rÜ
("event‡dd conn s %d for server '%.*s' failed: %s",

517 
cÚn
->
sd
, 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
,

518 
	`¡»¼Ü
(
”ºo
));

519 
”rÜ
;

522 
	`ASSERT
(!
cÚn
->
cÚÃùšg
 && !cÚn->
cÚÃùed
);

524 
¡©us
 = 
	`cÚÃù
(
cÚn
->
sd
, cÚn->
addr
, cÚn->
add¾’
);

525 ià(
¡©us
 !ğ
NC_OK
) {

526 ià(
”ºo
 =ğ
EINPROGRESS
) {

527 
cÚn
->
cÚÃùšg
 = 1;

528 
	`log_debug
(
LOG_DEBUG
, "connecting on s %do server '%.*s'",

529 
cÚn
->
sd
, 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
);

530  
NC_OK
;

533 
	`log_”rÜ
("cÚÃù oÀ %dØ£rv” '%.*s' faed: %s", 
cÚn
->
sd
,

534 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
, 
	`¡»¼Ü
(
”ºo
));

536 
”rÜ
;

539 
	`ASSERT
(!
cÚn
->
cÚÃùšg
);

540 
cÚn
->
cÚÃùed
 = 1;

541 
	`log_debug
(
LOG_INFO
, "cÚÃùed oÀ %dØ£rv” '%.*s'", 
cÚn
->
sd
,

542 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
);

544  
NC_OK
;

546 
”rÜ
:

547 
cÚn
->
”r
 = 
”ºo
;

548  
¡©us
;

549 
	}
}

552 
	$£rv”_cÚÃùed
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

554 
£rv”
 *£rv” = 
cÚn
->
owÃr
;

556 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

557 
	`ASSERT
(
cÚn
->
cÚÃùšg
 && !cÚn->
cÚÃùed
);

559 
	`¡©s_£rv”_šü
(
ùx
, 
£rv”
, 
£rv”_cÚÃùiÚs
);

561 
cÚn
->
cÚÃùšg
 = 0;

562 
cÚn
->
cÚÃùed
 = 1;

564 
cÚn
->
	`po¡_cÚÃù
(
ùx
, cÚn, 
£rv”
);

566 
	`log_debug
(
LOG_INFO
, "cÚÃùed oÀ %dØ£rv” '%.*s'", 
cÚn
->
sd
,

567 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
);

568 
	}
}

571 
	$£rv”_ok
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn)

573 
£rv”
 *£rv” = 
cÚn
->
owÃr
;

575 
	`ASSERT
(!
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

576 
	`ASSERT
(
cÚn
->
cÚÃùed
);

578 ià(
£rv”
->
çu»_couÁ
 != 0) {

579 
	`log_debug
(
LOG_VERB
, "»£ˆ£rv” '%.*s' fau» couÁ from %"
PRIu32


580 "Ø0", 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
,

581 
£rv”
->
çu»_couÁ
);

582 
£rv”
->
çu»_couÁ
 = 0;

583 
£rv”
->
Ãxt_»Œy
 = 0LL;

585 
	}
}

587 
r¡©us_t


588 
	$£rv”_poŞ_upd©e
(
£rv”_poŞ
 *
poŞ
)

590 
r¡©us_t
 
¡©us
;

591 
št64_t
 
now
;

592 
ušt32_t
 
²live_£rv”
;

594 ià(!
poŞ
->
auto_ejeù_ho¡s
) {

595  
NC_OK
;

598 ià(
poŞ
->
Ãxt_»bud
 == 0LL) {

599  
NC_OK
;

602 
now
 = 
	`nc_u£c_now
();

603 ià(
now
 < 0) {

604  
NC_ERROR
;

607 ià(
now
 <ğ
poŞ
->
Ãxt_»bud
) {

608 ià(
poŞ
->
Æive_£rv”
 == 0) {

609 
”ºo
 = 
ECONNREFUSED
;

610  
NC_ERROR
;

612  
NC_OK
;

615 
²live_£rv”
 = 
poŞ
->
Æive_£rv”
;

617 
¡©us
 = 
	`£rv”_poŞ_run
(
poŞ
);

618 ià(
¡©us
 !ğ
NC_OK
) {

619 
	`log_”rÜ
("upd©šg…oŞ %"
PRIu32
" w™h di¡ %d faed: %s", 
poŞ
->
idx
,

620 
poŞ
->
di¡_ty³
, 
	`¡»¼Ü
(
”ºo
));

621  
¡©us
;

624 
	`log_debug
(
LOG_INFO
, "upd©poŞ %"
PRIu32
" '%.*s'o‡dd %"PRIu32" servers",

625 
poŞ
->
idx
,…oŞ->
Çme
.
Ën
,…oŞ->Çme.
d©a
,

626 
poŞ
->
Æive_£rv”
 - 
²live_£rv”
);

629  
NC_OK
;

630 
	}
}

632 
ušt32_t


633 
	$£rv”_poŞ_hash
(
£rv”_poŞ
 *
poŞ
, 
ušt8_t
 *
key
, 
ušt32_t
 
keyËn
)

635 
	`ASSERT
(
	`¬¿y_n
(&
poŞ
->
£rv”
) != 0);

636 
	`ASSERT
(
key
 !ğ
NULL
);

638 ià(
	`¬¿y_n
(&
poŞ
->
£rv”
) == 1) {

642 ià(
keyËn
 == 0) {

646  
poŞ
->
	`key_hash
((*)
key
, 
keyËn
);

647 
	}
}

649 
ušt32_t


650 
	$£rv”_poŞ_idx
(
£rv”_poŞ
 *
poŞ
, 
ušt8_t
 *
key
, 
ušt32_t
 
keyËn
)

652 
ušt32_t
 
hash
, 
idx
;

659 
	`ASSERT
(
key
 !ğ
NULL
);

666 ià(!
	`¡ršg_em±y
(&
poŞ
->
hash_g
)) {

667 
¡ršg
 *
g
 = &
poŞ
->
hash_g
;

668 
ušt8_t
 *
g_¡¬t
, *
g_’d
;

670 
g_¡¬t
 = 
	`nc_¡rchr
(
key
, key + 
keyËn
, 
g
->
d©a
[0]);

671 ià(
g_¡¬t
 !ğ
NULL
) {

672 
g_’d
 = 
	`nc_¡rchr
(
g_¡¬t
 + 1, 
key
 + 
keyËn
, 
g
->
d©a
[1]);

673 ià((
g_’d
 !ğ
NULL
è&& (g_’d - 
g_¡¬t
 > 1)) {

674 
key
 = 
g_¡¬t
 + 1;

675 
keyËn
 = (
ušt32_t
)(
g_’d
 - 
key
);

681 
sh¬d
* 
sd
 = 
	`g‘_sh¬d_äom_key
(
poŞ
, 
key
, 
keyËn
);

682 
	`ASSERT
(
sd
 !ğ
NULL
);

685  
sd
->
idx
;

689 
poŞ
->
di¡_ty³
) {

690 
DIST_KETAMA
:

691 
hash
 = 
	`£rv”_poŞ_hash
(
poŞ
, 
key
, 
keyËn
);

692 
idx
 = 
	`k‘ama_di¥©ch
(
poŞ
->
cÚtšuum
,…oŞ->
ncÚtšuum
, 
hash
);

695 
DIST_MODULA
:

696 
hash
 = 
	`£rv”_poŞ_hash
(
poŞ
, 
key
, 
keyËn
);

697 
idx
 = 
	`moduÏ_di¥©ch
(
poŞ
->
cÚtšuum
,…oŞ->
ncÚtšuum
, 
hash
);

700 
DIST_RANDOM
:

701 
idx
 = 
	`¿ndom_di¥©ch
(
poŞ
->
cÚtšuum
,…oŞ->
ncÚtšuum
, 0);

705 
	`NOT_REACHED
();

708 
	`ASSERT
(
idx
 < 
	`¬¿y_n
(&
poŞ
->
£rv”
));

709  
idx
;

710 
	}
}

712 
£rv”
 *

713 
	$£rv”_poŞ_£rv”
(
£rv”_poŞ
 *
poŞ
, 
ušt8_t
 *
key
, 
ušt32_t
 
keyËn
)

715 
£rv”
 *server;

716 
ušt32_t
 
idx
;

718 
idx
 = 
	`£rv”_poŞ_idx
(
poŞ
, 
key
, 
keyËn
);

719 
£rv”
 = 
	`¬¿y_g‘
(&
poŞ
->£rv”, 
idx
);

721 
	`log_debug
(
LOG_VERB
, "key '%.*s' oÀdi¡ %d m­ tØ£rv” '%.*s'", 
keyËn
,

722 
key
, 
poŞ
->
di¡_ty³
, 
£rv”
->
²ame
.
Ën
, s”v”->²ame.
d©a
);

724  
£rv”
;

725 
	}
}

728 
sh¬d
*

729 
	$g‘_sh¬d_äom_key
(
£rv”_poŞ
 *
poŞ
, 
ušt8_t
 *
key
, 
ušt32_t
 
keyËn
)

731 
ušt32_t
 
nsh¬ds
 = 
	`¬¿y_n
(&
poŞ
->
sh¬ds
);

733 ià(
nsh¬ds
 == 0) {

734  
NULL
;

737 ià(
nsh¬ds
 =ğ1 || 
keyËn
 == 0) {

738 
	`log_debug
(
LOG_NOTICE
, "ÿ£ 1: key % => sh¬d %d", (*)
key
, 0);

739  (
sh¬d
*)
	`¬¿y_g‘
(&
poŞ
->
sh¬ds
, 0);;

743 
ušt32_t
 
hv
 = 
	`hash_murmur
((*)
key
, 
keyËn
);

750 
hv
 = hv % 
poŞ
->
sh¬d_¿nge_max
;

751 ià(
hv
 < 
poŞ
->
sh¬d_¿nge_mš
) {

752 
hv
 = 
poŞ
->
sh¬d_¿nge_mš
;

757 
ušt32_t
 
i
 = 0; i < 
nsh¬ds
; i++) {

758 
sh¬d
* 
sd
 = (sh¬d*)
	`¬¿y_g‘
(&
poŞ
->
sh¬ds
, 
i
);

759 ià(
sd
->
¿nge_begš
 <ğ
hv
 && hv <ğsd->
¿nge_’d
) {

760 
	`log_debug
(
LOG_NOTICE
, "shard-search: key %s, hv %d, "

762 (*)
key
, 
hv
, 
nsh¬ds
, 
i
, 
sd
->
idx
);

763  
sd
;

766  
NULL
;

767 
	}
}

769 
cÚn
 *

770 
	$£rv”_poŞ_cÚn
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
, 
ušt8_t
 *
key
,

771 
ušt32_t
 
keyËn
)

773 
r¡©us_t
 
¡©us
;

774 
£rv”
 *server;

775 
cÚn
 *conn;

792 
sh¬d
* 
sd
 = 
	`g‘_sh¬d_äom_key
(
poŞ
, 
key
, 
keyËn
);

793 
	`ASSERT
(
sd
 !ğ
NULL
);

795 
£rv”
 = 
sd
->
ma¡”
;

796 ià(!
£rv”
) {

797  
NULL
;

802 
cÚn
 = 
	`£rv”_cÚn
(
£rv”
);

803 ià(
cÚn
 =ğ
NULL
) {

804  
NULL
;

807 
¡©us
 = 
	`£rv”_cÚÃù
(
ùx
, 
£rv”
, 
cÚn
);

808 ià(
¡©us
 !ğ
NC_OK
) {

809 
	`£rv”_şo£
(
ùx
, 
cÚn
);

810  
NULL
;

813  
cÚn
;

814 
	}
}

816 
r¡©us_t


817 
	$£rv”_poŞ_—ch_´ecÚÃù
(*
–em
, *
d©a
)

819 
r¡©us_t
 
¡©us
;

820 
£rv”_poŞ
 *
¥
 = 
–em
;

822 ià(!
¥
->
´ecÚÃù
) {

823  
NC_OK
;

828 ià(
	`¬¿y_n
(&
¥
->
£rv”
) == 0) {

829  
NC_OK
;

832 
¡©us
 = 
	`¬¿y_—ch
(&
¥
->
£rv”
, 
£rv”_—ch_´ecÚÃù
, 
NULL
);

833 ià(
¡©us
 !ğ
NC_OK
) {

834  
¡©us
;

837  
NC_OK
;

838 
	}
}

840 
r¡©us_t


841 
	$£rv”_poŞ_´ecÚÃù
(
cÚ‹xt
 *
ùx
)

843 
r¡©us_t
 
¡©us
;

845 
¡©us
 = 
	`¬¿y_—ch
(&
ùx
->
poŞ
, 
£rv”_poŞ_—ch_´ecÚÃù
, 
NULL
);

846 ià(
¡©us
 !ğ
NC_OK
) {

847  
¡©us
;

850  
NC_OK
;

851 
	}
}

853 
r¡©us_t


854 
	$£rv”_poŞ_—ch_discÚÃù
(*
–em
, *
d©a
)

856 
r¡©us_t
 
¡©us
;

857 
£rv”_poŞ
 *
¥
 = 
–em
;

859 
¡©us
 = 
	`¬¿y_—ch
(&
¥
->
£rv”
, 
£rv”_—ch_discÚÃù
, 
NULL
);

860 ià(
¡©us
 !ğ
NC_OK
) {

861  
¡©us
;

864  
NC_OK
;

865 
	}
}

868 
	$£rv”_poŞ_discÚÃù
(
cÚ‹xt
 *
ùx
)

870 
	`¬¿y_—ch
(&
ùx
->
poŞ
, 
£rv”_poŞ_—ch_discÚÃù
, 
NULL
);

871 
	}
}

873 
r¡©us_t


874 
	$£rv”_poŞ_—ch_£t_owÃr
(*
–em
, *
d©a
)

876 
£rv”_poŞ
 *
¥
 = 
–em
;

877 
cÚ‹xt
 *
ùx
 = 
d©a
;

879 
¥
->
ùx
 = ctx;

881  
NC_OK
;

882 
	}
}

884 
r¡©us_t


885 
	$£rv”_poŞ_—ch_ÿlc_cÚÃùiÚs
(*
–em
, *
d©a
)

887 
£rv”_poŞ
 *
¥
 = 
–em
;

888 
cÚ‹xt
 *
ùx
 = 
d©a
;

890 
ùx
->
max_nscÚn
 +ğ
¥
->
£rv”_cÚÃùiÚs
 * 
	`¬¿y_n
(&¥->
£rv”
);

891 
ùx
->
max_nscÚn
 += 1;

893  
NC_OK
;

894 
	}
}

896 
r¡©us_t


897 
	$£rv”_poŞ_run
(
£rv”_poŞ
 *
poŞ
)

900  
NC_OK
;

901 
	`ASSERT
(
	`¬¿y_n
(&
poŞ
->
sh¬ds
) > 0 &&

902 
	`¬¿y_n
(&
poŞ
->
£rv”
) > 0);

903  
NC_OK
;

906 
	`ASSERT
(
	`¬¿y_n
(&
poŞ
->
£rv”
) != 0);

908 
poŞ
->
di¡_ty³
) {

909 
DIST_KETAMA
:

910  
	`k‘ama_upd©e
(
poŞ
);

912 
DIST_MODULA
:

913  
	`moduÏ_upd©e
(
poŞ
);

915 
DIST_RANDOM
:

916  
	`¿ndom_upd©e
(
poŞ
);

919 
	`NOT_REACHED
();

920  
NC_ERROR
;

923  
NC_OK
;

924 
	}
}

926 
r¡©us_t


927 
	$£rv”_poŞ_—ch_run
(*
–em
, *
d©a
)

929  
	`£rv”_poŞ_run
(
–em
);

930 
	}
}

935 
£rv”
*

936 
	$AddS”v”FromAdd»ssSŒšg
(
sh¬d
 *
sd
, *
§ddr
)

939 
ušt32_t
 
Ën
 = (ušt32_t)
	`¡¾’
(
§ddr
);

940 
ušt8_t
 *
s_Çme
, *
s_pÜt
;

942 
ušt8_t
 *
d–im
 = 
	`nc_¡rchr
((ušt8_t*)
§ddr
,

943 (
ušt8_t
*)(
§ddr
 + 
Ën
),

945 
	`ASSERT
(
d–im
 !ğ
NULL
);

946 
s_Çme
 = (
ušt8_t
*)
§ddr
;

947 
s_pÜt
 = 
d–im
 + 1;

950 
£rv”_poŞ
 *
¥
 = 
sd
->
owÃr
;

951 
£rv”
 *
¤v
 = 
	`¬¿y_push
(&
¥
->server);

953 
	`ASSERT
(
¤v
 !ğ
NULL
);

954 
	`mem£t
(
¤v
, 0, (*srv));

957 
¤v
->
idx
 = 
	`¬¿y_idx
(&
¥
->
£rv”
, srv);

958 
¤v
->
owÃr
 = 
¥
;

959 
¤v
->
owÃr_sh¬d
 = 
sd
;

961 
	`¡ršg_cİy
(&
¤v
->
²ame
, (cÚ¡ 
ušt8_t
*)
§ddr
, 
Ën
);

962 
	`¡ršg_cİy
(&
¤v
->
Çme
, (cÚ¡ 
ušt8_t
*)
§ddr
, 
Ën
);

963 
	`¡ršg_cİy
(&
¤v
->
addr¡r
,

964 (cÚ¡ 
ušt8_t
*)
§ddr
,

965 (
ušt32_t
)(
d–im
 - 
s_Çme
));

966 
¤v
->
pÜt
 = (
ušt16_t
)
	`nc_©oi
(
s_pÜt
, (
ušt32_t
)(
Ën
 - (
d–im
 + 1 - 
s_Çme
)));

967 
¤v
->
weight
 = 0;

969 
r¡©us_t
 
¡©us
 = 
	`nc_»sŞve
(&
¤v
->
addr¡r
, srv->
pÜt
, &¤v->
šfo
);

970 ià(
¡©us
 !ğ
NC_OK
) {

971 
	`¡ršg_deš™
(&
¤v
->
²ame
);

972 
	`¡ršg_deš™
(&
¤v
->
Çme
);

973 
	`¡ršg_deš™
(&
¤v
->
addr¡r
);

974 
	`¬¿y_pİ
(&
¥
->
£rv”
);

975  
NULL
;

978 
¤v
->
ns_cÚn_q
 = 0;

979 
	`TAILQ_INIT
(&
¤v
->
s_cÚn_q
);

981 
¤v
->
Ãxt_»Œy
 = 0LL;

982 
¤v
->
çu»_couÁ
 = 0;

984  
¤v
;

985 
	}
}

991 
	$add_£rv”_to_¡©s
(
£rv”
 *
¤v
, 
£rv”_poŞ
 *
poŞ
)

993 
cÚ‹xt
 *
ùx
 = 
poŞ
->ctx;

995 
¡©s_poŞ
 *
¡p
;

996 
¡©s
 *
¡
 = 
ùx
->stats;

998 ià(
¡
->
cu¼_£rv”s
 >ğ¡->
max_®lowed_£rv”s
) {

999 
	`log_”rÜ
("stats curr servers %d >= max_allowed servers %d, cannot‡dd more",

1000 
¡
->
cu¼_£rv”s
, st->
max_®lowed_£rv”s
);

1004 
	`¡©s_lock
(
¡
);

1005 
¡
->
cu¼_£rv”s
++;

1007 
¡p
 = 
	`¬¿y_g‘
(&
¡
->
cu¼’t
, 
poŞ
->
idx
);

1008 
	`add_£rv”_to_¡©s_poŞ
(
¡p
, 
¤v
);

1009 
¡p
 = 
	`¬¿y_g‘
(&
¡
->
shadow
, 
poŞ
->
idx
);

1010 
	`add_£rv”_to_¡©s_poŞ
(
¡p
, 
¤v
);

1011 
¡p
 = 
	`¬¿y_g‘
(&
¡
->
sum
, 
poŞ
->
idx
);

1012 
	`add_£rv”_to_¡©s_poŞ
(
¡p
, 
¤v
);

1014 
	`¡©s_uÆock
(
¡
);

1015 
	}
}

1019 
	$Ma¡”Add»ssW©ch”
(
zhªdË_t
 *
zkh
,

1020 
ty³
,

1021 
¡©e
,

1022 cÚ¡ *
·th
,

1023 *
ùx
)

1025 
sh¬d
 *
¤v_sd
 = (sh¬d *)
ùx
;

1026 
	`ASSERT
(
¤v_sd
 !ğ
NULL
);

1027 
£rv”_poŞ
 *
poŞ
 = 
¤v_sd
->
owÃr
;

1028 
cÚ‹xt
 *
poŞ_ùx
 = 
poŞ
->
ùx
;

1029 
ušt32_t
 
poŞ_idx
 = 
	`¬¿y_idx
(&
poŞ_ùx
->
poŞ
,…ool);

1030 
	`ASSERT
(
poŞ_idx
 =ğ
poŞ
->
idx
);

1032 
buæ’
 = 1000;

1033 
buf
[
buæ’
];

1034 
rc
;

1036 
	`log_”rÜ
("Master Address Watcher gotƒvent %s, state %s‡t…ath %s",

1037 
	`Ty³2SŒšg
(
ty³
), 
	`S‹2SŒšg
(
¡©e
), 
·th
);

1039 ià(
ty³
 =ğ
ZOO_CREATED_EVENT
 ||

1040 
ty³
 =ğ
ZOO_CHANGED_EVENT
) {

1041 
	`mem£t
(
buf
, 0, (
size_t
)
buæ’
);

1042 
rc
 = 
	`ZKG‘
(
zkh
, 
·th
, 
buf
, 
buæ’
, 0, 1);

1043 ià(
rc
 < 0) {

1044 
	`log_”rÜ
("»ad % çed!", 
·th
);

1046 
£rv”
 *
cu¼¤v
 = 
¤v_sd
->
ma¡”
;

1047 ià(
	`¡¾’
(
buf
è!ğ(
size_t
)
cu¼¤v
->
Çme
.
Ën
 ||

1048 
	`¡ºcmp
(
buf
, (*)
cu¼¤v
->
Çme
.
d©a
, 
	`¡¾’
(buf)) != 0) {

1051 
£rv”
 *
¤v
 = 
	`AddS”v”FromAdd»ssSŒšg
(
¤v_sd
, 
buf
);

1052 
	`add_£rv”_to_¡©s
(
¤v
, 
poŞ
);

1070 
¤v_sd
->
ma¡”
 = 
¤v
;

1071 ià(!
¤v_sd
->
ÿn_wr™e
) {

1072 
¤v_sd
->
ÿn_wr™e
 = 1;

1075 
	`log_”rÜ
("Use‡‚ew master %s for shard %s",

1076 
¤v
->
²ame
.
d©a
, 
·th
);

1079 } ià(
ty³
 =ğ
ZOO_DELETED_EVENT
) {

1083 
	`ZKS‘Exi¡sW©ch
(
zkh
, (*)
·th
, 
Ma¡”Add»ssW©ch”
, 
ùx
);

1084 
	}
}

1089 
	$Ma¡”StusW©ch”
(
zhªdË_t
 *
zkh
,

1090 
ty³
,

1091 
¡©e
,

1092 cÚ¡ *
·th
,

1093 *
ùx
)

1095 
sh¬d
 *
¤v_sd
 = (sh¬d *)
ùx
;

1096 
	`ASSERT
(
¤v_sd
 !ğ
NULL
);

1098 
buæ’
 = 1000;

1099 
buf
[
buæ’
];

1100 
rc
;

1102 
	`log_”rÜ
("Status Watcher gotƒvent %s, state %s‡t…ath %s",

1103 
	`Ty³2SŒšg
(
ty³
), 
	`S‹2SŒšg
(
¡©e
), 
·th
);

1104 ià(
ty³
 =ğ
ZOO_CREATED_EVENT
 ||

1105 
ty³
 =ğ
ZOO_CHANGED_EVENT
) {

1106 
rc
 = 
	`ZKG‘
(
zkh
, 
·th
, 
buf
, 
buæ’
, 0, 1);

1107 ià(
rc
 < 0) {

1108 
	`log_”rÜ
("»ad % çed!", 
·th
);

1110 ià(
	`¡ºcmp
(
buf
, "draining", 8) == 0) {

1112 
¤v_sd
->
ÿn_wr™e
 = 0;

1113 
	`log_”rÜ
("Tuº sh¬d % tØ»ad-Úly.", 
·th
);

1114 } ià(
	`¡ºcmp
(
buf
, "running", 7) == 0) {

1115 
¤v_sd
->
ÿn_wr™e
 = 1;

1116 
	`log_”rÜ
("Tuº sh¬d % tØ»ad-wr™e.", 
·th
);

1119 } ià(
ty³
 =ğ
ZOO_DELETED_EVENT
) {

1123 
	`ZKS‘Exi¡sW©ch
(
zkh
, (*)
·th
, 
Ma¡”StusW©ch”
, 
ùx
);

1124 
	}
}

1133 
	$£t_w©ch_Ú_ma¡”_¡©us
(
¬¿y
 *
£rv”_poŞ
, 
cÚ‹xt
 *
ùx
)

1135 
buæ’
 = 5000;

1136 
zk·th
[
buæ’
];

1137 
buf
[
buæ’
];

1138 
rc
;

1140 
ušt32_t
 
i
 = 0; i < 
	`¬¿y_n
(
£rv”_poŞ
); i++ ) {

1141 
£rv”_poŞ
 *
¥
 =

1142 (
£rv”_poŞ
*)
	`¬¿y_g‘
(£rv”_poŞ, 
i
);

1144 
ušt32_t
 
j
 = 0; j < 
	`¬¿y_n
(&
¥
->
sh¬ds
); j++ ) {

1145 
sh¬d
 *
¤v_sd
 = (sh¬d*)
	`¬¿y_g‘
(&
¥
->
sh¬ds
, 
j
);

1146 
£rv”
 *
¤v
 = 
¤v_sd
->
ma¡”
;

1147 
	`ASSERT
(
¤v
->
owÃr_sh¬d
 =ğ
¤v_sd
);

1154 
	`¥rštf
(
zk·th
, "%s/hosts/%s/status",

1155 
ZK_BASE
,

1156 
¤v
->
Çme
.
d©a
);

1158 
	`mem£t
(
buf
, 0, (
size_t
)
buæ’
);

1159 
rc
 = 
	`ZKG‘
(
ùx
->
zkh
, 
zk·th
, 
buf
, 
buæ’
, 0, 1);

1160 ià(
rc
 <= 0) {

1161 
	`log_”rÜ
("master %s status‚on-exist: %s",

1162 
¤v
->
Çme
.
d©a
, 
zk·th
);

1164 
	`log_debug
(
LOG_NOTICE
, "master %s status znode %s: %s",

1165 
¤v
->
Çme
.
d©a
, 
zk·th
, 
buf
);

1168 
rc
 = 
	`ZKS‘Exi¡sW©ch
(
ùx
->
zkh
, 
zk·th
, 
Ma¡”StusW©ch”
, 
¤v_sd
);

1169 
	`log_debug
(
LOG_NOTICE
, "set watch on master %s status: %s",

1170 
¤v
->
Çme
.
d©a
, 
zk·th
);

1173 
	`¥rštf
(
zk·th
, "%s/pools/%s/shards/%d:%d/master/addr",

1174 
ZK_BASE
,

1175 
¥
->
Çme
.
d©a
,

1176 
¤v_sd
->
¿nge_begš
,

1177 
¤v_sd
->
¿nge_’d
);

1178 
rc
 = 
	`ZKS‘Exi¡sW©ch
(
ùx
->
zkh
, 
zk·th
, 
Ma¡”Add»ssW©ch”
, 
¤v_sd
);

1179 
	`log_debug
(
LOG_NOTICE
, "set watch on master %s‡ddress: %s",

1180 
¤v
->
Çme
.
d©a
, 
zk·th
);

1183 
	`¥rštf
(
zk·th
, "%s/pools/%s/proxies/%s",

1184 
ZK_BASE
, 
¥
->
Çme
.
d©a
, sp->
addr¡r
.data);

1185 
rc
 = 
	`ZKC»©e
(
ùx
->
zkh
, 
zk·th
, 
NULL
, -1, 
ZOO_EPHEMERAL
);

1186 
	`log_debug
(
LOG_NOTICE
, "created…roxy marker znode %s,„et %d",

1187 
zk·th
, 
rc
);

1189 
	}
}

1191 
r¡©us_t


1192 
	$£rv”_poŞ_š™
(
¬¿y
 *
£rv”_poŞ
, ¬¿y *
cÚf_poŞ
,

1193 
cÚ‹xt
 *
ùx
)

1195 
r¡©us_t
 
¡©us
;

1196 
ušt32_t
 
ÅoŞ
;

1198 
ÅoŞ
 = 
	`¬¿y_n
(
cÚf_poŞ
);

1199 
	`ASSERT
(
ÅoŞ
 != 0);

1200 
	`ASSERT
(
	`¬¿y_n
(
£rv”_poŞ
) == 0);

1202 
¡©us
 = 
	`¬¿y_š™
(
£rv”_poŞ
, 
ÅoŞ
, (server_pool));

1203 ià(
¡©us
 !ğ
NC_OK
) {

1204  
¡©us
;

1208 
¡©us
 = 
	`¬¿y_—ch
(
cÚf_poŞ
, 
cÚf_poŞ_—ch_ŒªsfÜm
, 
£rv”_poŞ
);

1209 ià(
¡©us
 !ğ
NC_OK
) {

1210 
	`£rv”_poŞ_deš™
(
£rv”_poŞ
);

1211  
¡©us
;

1213 
	`ASSERT
(
	`¬¿y_n
(
£rv”_poŞ
è=ğ
ÅoŞ
);

1216 
¡©us
 = 
	`¬¿y_—ch
(
£rv”_poŞ
, 
£rv”_poŞ_—ch_£t_owÃr
, 
ùx
);

1217 ià(
¡©us
 !ğ
NC_OK
) {

1218 
	`£rv”_poŞ_deš™
(
£rv”_poŞ
);

1219  
¡©us
;

1223 
ùx
->
max_nscÚn
 = 0;

1224 
¡©us
 = 
	`¬¿y_—ch
(
£rv”_poŞ
, 
£rv”_poŞ_—ch_ÿlc_cÚÃùiÚs
, 
ùx
);

1225 ià(
¡©us
 !ğ
NC_OK
) {

1226 
	`£rv”_poŞ_deš™
(
£rv”_poŞ
);

1227  
¡©us
;

1231 
¡©us
 = 
	`¬¿y_—ch
(
£rv”_poŞ
, 
£rv”_poŞ_—ch_run
, 
NULL
);

1232 ià(
¡©us
 !ğ
NC_OK
) {

1233 
	`£rv”_poŞ_deš™
(
£rv”_poŞ
);

1234  
¡©us
;

1239 
	`add_w©ch”_Ú_cÚf_poŞ
(
ùx
);

1241 
	`log_debug
(
LOG_DEBUG
, "š™ %"
PRIu32
"…oŞs", 
ÅoŞ
);

1243  
NC_OK
;

1244 
	}
}

1247 
	$£rv”_poŞ_deš™
(
¬¿y
 *
£rv”_poŞ
)

1249 
ušt32_t
 
i
, 
ÅoŞ
;

1251 
i
 = 0, 
ÅoŞ
 = 
	`¬¿y_n
(
£rv”_poŞ
); i <‚pool; i++) {

1252 
£rv”_poŞ
 *
¥
;

1254 
¥
 = 
	`¬¿y_pİ
(
£rv”_poŞ
);

1255 
	`ASSERT
(
¥
->
p_cÚn
 =ğ
NULL
);

1256 
	`ASSERT
(
	`TAILQ_EMPTY
(&
¥
->
c_cÚn_q
è&& sp->
nc_cÚn_q
 == 0);

1258 ià(
¥
->
cÚtšuum
 !ğ
NULL
) {

1259 
	`nc_ä“
(
¥
->
cÚtšuum
);

1260 
¥
->
ncÚtšuum
 = 0;

1261 
¥
->
n£rv”_cÚtšuum
 = 0;

1262 
¥
->
Æive_£rv”
 = 0;

1265 
	`£rv”_deš™
(&
¥
->
£rv”
);

1267 
	`log_debug
(
LOG_DEBUG
, "deš™…oŞ %"
PRIu32
" '%.*s'", 
¥
->
idx
,

1268 
¥
->
Çme
.
Ën
, sp->Çme.
d©a
);

1271 
	`¬¿y_deš™
(
£rv”_poŞ
);

1273 
	`log_debug
(
LOG_DEBUG
, "deš™ %"
PRIu32
"…oŞs", 
ÅoŞ
);

1274 
	}
}

1277 
	$dump_£rv”
(
£rv”
 *
¤v
)

1279 
	`log_w¬n
("server %s (idx %d)",

1280 (*)
¤v
->
Çme
.
d©a
, srv->
idx
);

1281 
	}
}

1284 
	$dump_£rv”_sh¬d
(
sh¬d
 *
sd
)

1286 
£rv”
 *
ma¡”
 = 
sd
->master;

1287 
	`log_w¬n
("shard %d [%d : %d]: have %d master, %d slaves, "

1289 
sd
->
idx
, sd->
¿nge_begš
, sd->
¿nge_’d
,

1290 
ma¡”
 ? 1 : 0,

1291 
	`¬¿y_n
(&
sd
->
¦aves
),

1292 
sd
->
ÿn_»ad
,

1293 
sd
->
ÿn_wr™e
);

1294 ià(
ma¡”
) {

1295 
	`log_w¬n
("master :");

1296 
	`dump_£rv”
(
ma¡”
);

1299 
ušt32_t
 
i
 = 0; i < 
	`¬¿y_n
(&
sd
->
¦aves
); i++) {

1300 
	`log_w¬n
("¦av%d:", 
i
);

1301 
	`dump_£rv”
(*(
£rv”
**)
	`¬¿y_g‘
(&
sd
->
¦aves
, 
i
));

1303 
	}
}

1306 
	$dump_£rv”_poŞ
(
£rv”_poŞ
 *
¥
)

1308 
	`log_w¬n
("");

1309 
	`log_w¬n
("pool %s (idx %d), have %d shards, %d servers",

1310 (*)
¥
->
Çme
.
d©a
, sp->
idx
,

1311 
	`¬¿y_n
(&
¥
->
sh¬ds
),‡¼ay_n(&¥->
£rv”
));

1312 
	`log_w¬n
("proxy‡ddr %s, shard„ange [%d : %d]",

1313 (*)
¥
->
addr¡r
.
d©a
,

1314 
¥
->
sh¬d_¿nge_mš
,

1315 
¥
->
sh¬d_¿nge_max
);

1317 
ušt32_t
 
i
 = 0; i < 
	`¬¿y_n
(&
¥
->
sh¬ds
); i++) {

1318 
	`log_w¬n
("poŞ \"%s\" sh¬d %d ::", (*)
¥
->
Çme
.
d©a
, 
i
);

1319 
	`dump_£rv”_sh¬d
((
sh¬d
*)
	`¬¿y_g‘
(&
¥
->
sh¬ds
, 
i
));

1322 
	`log_w¬n
("");

1324 
	}
}

	@nc_server.h

18 #iâdeà
_NC_SERVER_H_


19 
	#_NC_SERVER_H_


	)

21 
	~<nc_cÜe.h
>

62 
	$ušt32_t
 (*
	thash_t
)(cÚ¡ *, 
	tsize_t
);

64 
	scÚtšuum
 {

65 
ušt32_t
 
šdex
;

66 
ušt32_t
 
v®ue
;

69 
sh¬d
;

71 
	s£rv”
 {

72 
ušt32_t
 
idx
;

73 
£rv”_poŞ
 *
owÃr
;

75 
¡ršg
 
²ame
;

76 
¡ršg
 
Çme
;

77 
¡ršg
 
addr¡r
;

78 
ušt16_t
 
pÜt
;

79 
ušt32_t
 
weight
;

80 
sockšfo
 
šfo
;

82 
ušt32_t
 
ns_cÚn_q
;

83 
cÚn_tqh
 
s_cÚn_q
;

85 
št64_t
 
Ãxt_»Œy
;

86 
ušt32_t
 
çu»_couÁ
;

88 
sh¬d
 *
owÃr_sh¬d
;

93 
	ssh¬d
 {

94 
ušt32_t
 
idx
;

95 
£rv”_poŞ
 *
owÃr
;

97 
ušt32_t
 
¿nge_begš
;

98 
ušt32_t
 
¿nge_’d
;

100 
£rv”
 *
ma¡”
;

101 
¬¿y
 
¦aves
;

103 
ÿn_»ad
;

104 
ÿn_wr™e
;

107 
	s£rv”_poŞ
 {

108 
ušt32_t
 
idx
;

109 
cÚ‹xt
 *
ùx
;

111 
cÚn
 *
p_cÚn
;

112 
ušt32_t
 
nc_cÚn_q
;

113 
cÚn_tqh
 
c_cÚn_q
;

115 
¬¿y
 
£rv”
;

116 
ušt32_t
 
ncÚtšuum
;

117 
ušt32_t
 
n£rv”_cÚtšuum
;

118 
cÚtšuum
 *continuum;

119 
ušt32_t
 
Æive_£rv”
;

120 
št64_t
 
Ãxt_»bud
;

122 
¡ršg
 
Çme
;

123 
¡ršg
 
addr¡r
;

124 
ušt16_t
 
pÜt
;

125 
sockšfo
 
šfo
;

126 
mode_t
 
³rm
;

127 
di¡_ty³
;

128 
key_hash_ty³
;

129 
hash_t
 
key_hash
;

130 
¡ršg
 
hash_g
;

131 
timeout
;

132 
backlog
;

133 
»dis_db
;

134 
ušt32_t
 
ş›Á_cÚÃùiÚs
;

135 
ušt32_t
 
£rv”_cÚÃùiÚs
;

136 
št64_t
 
£rv”_»Œy_timeout
;

137 
ušt32_t
 
£rv”_çu»_lim™
;

138 
¡ršg
 
»dis_auth
;

139 
»quœe_auth
;

140 
auto_ejeù_ho¡s
:1;

141 
´ecÚÃù
:1;

142 
»dis
:1;

143 
tık“·live
:1;

145 
ušt32_t
 
sh¬d_¿nge_mš
;

146 
ušt32_t
 
sh¬d_¿nge_max
;

147 
¬¿y
 
sh¬ds
;

149 
±h»ad_mu‹x_t
 
lock
;

152 
	`£rv”_»f
(
cÚn
 *cÚn, *
owÃr
);

153 
	`£rv”_uÄef
(
cÚn
 *conn);

154 
	`£rv”_timeout
(
cÚn
 *conn);

155 
boŞ
 
	`£rv”_aùive
(
cÚn
 *conn);

156 
r¡©us_t
 
	`£rv”_š™
(
¬¿y
 *
£rv”
, ¬¿y *
cÚf_£rv”
, 
£rv”_poŞ
 *
¥
);

157 
	`£rv”_deš™
(
¬¿y
 *
£rv”
);

158 
cÚn
 *
	`£rv”_cÚn
(
£rv”
 *server);

159 
r¡©us_t
 
	`£rv”_cÚÃù
(
cÚ‹xt
 *
ùx
, 
£rv”
 *£rv”, 
cÚn
 *conn);

160 
	`£rv”_şo£
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn);

161 
	`£rv”_cÚÃùed
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn);

162 
	`£rv”_ok
(
cÚ‹xt
 *
ùx
, 
cÚn
 *conn);

164 
ušt32_t
 
	`£rv”_poŞ_idx
(
£rv”_poŞ
 *
poŞ
, 
ušt8_t
 *
key
, ušt32_ˆ
keyËn
);

165 
cÚn
 *
	`£rv”_poŞ_cÚn
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
, 
ušt8_t
 *
key
, 
ušt32_t
 
keyËn
);

166 
r¡©us_t
 
	`£rv”_poŞ_run
(
£rv”_poŞ
 *
poŞ
);

167 
r¡©us_t
 
	`£rv”_poŞ_´ecÚÃù
(
cÚ‹xt
 *
ùx
);

168 
	`£rv”_poŞ_discÚÃù
(
cÚ‹xt
 *
ùx
);

169 
r¡©us_t
 
	`£rv”_poŞ_š™
(
¬¿y
 *
£rv”_poŞ
, ¬¿y *
cÚf_poŞ
, 
cÚ‹xt
 *
ùx
);

170 
	`£rv”_poŞ_deš™
(
¬¿y
 *
£rv”_poŞ
);

171 
£rv”
 *
	`AddS”v”FromAdd»ssSŒšg
(
sh¬d
 *
sd
, *
§ddr
);

172 
	`add_£rv”_to_¡©s
(
£rv”
 *
¤v
, 
£rv”_poŞ
 *
poŞ
);

173 
	`dump_£rv”_poŞ
(
£rv”_poŞ
 *
¥
);

174 
	`dump_sh¬d
(
sh¬d
 *
sd
);

175 
	`dump_£rv”
(
£rv”
 *
¤v
);

	@nc_signal.c

18 
	~<¡dlib.h
>

19 
	~<sigÇl.h
>

21 
	~<nc_cÜe.h
>

22 
	~<nc_sigÇl.h
>

24 
sigÇl
 
	gsigÇls
[] = {

25 { 
SIGUSR1
, "SIGUSR1", 0, 
sigÇl_hªdËr
 },

26 { 
SIGUSR2
, "SIGUSR2", 0, 
sigÇl_hªdËr
 },

27 { 
SIGTTIN
, "SIGTTIN", 0, 
sigÇl_hªdËr
 },

28 { 
SIGTTOU
, "SIGTTOU", 0, 
sigÇl_hªdËr
 },

29 { 
SIGHUP
, "SIGHUP", 0, 
sigÇl_hªdËr
 },

30 { 
SIGINT
, "SIGINT", 0, 
sigÇl_hªdËr
 },

31 { 
SIGSEGV
, "SIGSEGV", ()
SA_RESETHAND
, 
sigÇl_hªdËr
 },

32 { 
SIGPIPE
, "SIGPIPE", 0, 
SIG_IGN
 },

33 { 0, 
NULL
, 0, NULL }

36 
r¡©us_t


37 
	$sigÇl_š™
()

39 
sigÇl
 *
sig
;

41 
sig
 = 
sigÇls
; sig->
signo
 != 0; sig++) {

42 
r¡©us_t
 
¡©us
;

43 
sigaùiÚ
 
§
;

45 
	`mem£t
(&
§
, 0, (sa));

46 
§
.
§_hªdËr
 = 
sig
->
hªdËr
;

47 
§
.
§_æags
 = 
sig
->
æags
;

48 
	`sigem±y£t
(&
§
.
§_mask
);

50 
¡©us
 = 
	`sigaùiÚ
(
sig
->
signo
, &
§
, 
NULL
);

51 ià(
¡©us
 < 0) {

52 
	`log_”rÜ
("sigaùiÚ(%sèçed: %s", 
sig
->
sigÇme
,

53 
	`¡»¼Ü
(
”ºo
));

54  
NC_ERROR
;

58  
NC_OK
;

59 
	}
}

62 
	$sigÇl_deš™
()

64 
	}
}

67 
	$sigÇl_hªdËr
(
signo
)

69 
sigÇl
 *
sig
;

70 (*
aùiÚ
)();

71 *
aùiÚ¡r
;

72 
boŞ
 
dÚe
;

74 
sig
 = 
sigÇls
; sig->
signo
 != 0; sig++) {

75 ià(
sig
->
signo
 == signo) {

79 
	`ASSERT
(
sig
->
signo
 != 0);

81 
aùiÚ¡r
 = "";

82 
aùiÚ
 = 
NULL
;

83 
dÚe
 = 
çl£
;

85 
signo
) {

86 
SIGUSR1
:

89 
SIGUSR2
:

92 
SIGTTIN
:

93 
aùiÚ¡r
 = ", up†ogging†evel";

94 
aùiÚ
 = 
log_Ëv–_up
;

97 
SIGTTOU
:

98 
aùiÚ¡r
 = ", down†ogging†evel";

99 
aùiÚ
 = 
log_Ëv–_down
;

102 
SIGHUP
:

103 
aùiÚ¡r
 = ",„eopening†og file";

104 
aùiÚ
 = 
log_»İ’
;

107 
SIGINT
:

108 
dÚe
 = 
Œue
;

109 
aùiÚ¡r
 = ",ƒxiting";

112 
SIGSEGV
:

113 
	`log_¡ackŒaû
();

114 
aùiÚ¡r
 = ", core dumping";

115 
	`¿i£
(
SIGSEGV
);

119 
	`NOT_REACHED
();

122 
	`log_§ã
("sigÇÈ%d (%sè»ûived%s", 
signo
, 
sig
->
sigÇme
, 
aùiÚ¡r
);

124 ià(
aùiÚ
 !ğ
NULL
) {

125 
	`aùiÚ
();

128 ià(
dÚe
) {

129 
	`ex™
(1);

131 
	}
}

	@nc_signal.h

18 #iâdeà
_NC_SIGNAL_H_


19 
	#_NC_SIGNAL_H_


	)

21 
	~<nc_cÜe.h
>

23 
	ssigÇl
 {

24 
	msigno
;

25 *
	msigÇme
;

26 
	mæags
;

27 (*
	mhªdËr
)(
	msigno
);

30 
r¡©us_t
 
sigÇl_š™
();

31 
sigÇl_deš™
();

32 
sigÇl_hªdËr
(
signo
);

	@nc_stats.c

18 
	~<¡dio.h
>

19 
	~<¡dlib.h
>

20 
	~<uni¡d.h
>

22 
	~<sys/ty³s.h
>

23 
	~<sys/sock‘.h
>

24 
	~<Ãtš‘/š.h
>

26 
	~<nc_cÜe.h
>

27 
	~<nc_£rv”.h
>

29 
	s¡©s_desc
 {

30 *
	mÇme
;

31 *
	mdesc
;

34 
	#DEFINE_ACTION
(
_Çme
, 
_ty³
, 
_desc
è{ .
ty³
 = _ty³, .
Çme
 = 
	`¡ršg
(#_Çmeè},

	)

35 
¡©s_m‘ric
 
	g¡©s_poŞ_codec
[] = {

36 
STATS_POOL_CODEC
Ğ
DEFINE_ACTION
 )

39 
¡©s_m‘ric
 
	g¡©s_£rv”_codec
[] = {

40 
STATS_SERVER_CODEC
Ğ
DEFINE_ACTION
 )

42 #undeà
DEFINE_ACTION


44 
	#DEFINE_ACTION
(
_Çme
, 
_ty³
, 
_desc
è{ .
Çme
 = #_Çme, .
desc
 = _desø},

	)

45 
¡©s_desc
 
	g¡©s_poŞ_desc
[] = {

46 
STATS_POOL_CODEC
Ğ
DEFINE_ACTION
 )

49 
¡©s_desc
 
	g¡©s_£rv”_desc
[] = {

50 
STATS_SERVER_CODEC
Ğ
DEFINE_ACTION
 )

52 #undeà
DEFINE_ACTION


55 
	$¡©s_desüibe
()

57 
ušt32_t
 
i
;

59 
	`log_¡d”r
("pool stats:");

60 
i
 = 0; i < 
	`NELEMS
(
¡©s_poŞ_desc
); i++) {

61 
	`log_¡d”r
(" %-20s\"%s\"", 
¡©s_poŞ_desc
[
i
].
Çme
,

62 
¡©s_poŞ_desc
[
i
].
desc
);

65 
	`log_¡d”r
("");

67 
	`log_¡d”r
("server stats:");

68 
i
 = 0; i < 
	`NELEMS
(
¡©s_£rv”_desc
); i++) {

69 
	`log_¡d”r
(" %-20s\"%s\"", 
¡©s_£rv”_desc
[
i
].
Çme
,

70 
¡©s_£rv”_desc
[
i
].
desc
);

72 
	}
}

75 
	$¡©s_m‘ric_š™
(
¡©s_m‘ric
 *
¡m
)

77 
¡m
->
ty³
) {

78 
STATS_COUNTER
:

79 
¡m
->
v®ue
.
couÁ”
 = 0LL;

82 
STATS_GAUGE
:

83 
¡m
->
v®ue
.
couÁ”
 = 0LL;

86 
STATS_TIMESTAMP
:

87 
¡m
->
v®ue
.
time¡amp
 = 0LL;

91 
	`NOT_REACHED
();

93 
	}
}

96 
	$¡©s_m‘ric_»£t
(
¬¿y
 *
¡©s_m‘ric
)

98 
ušt32_t
 
i
, 
nm‘ric
;

100 
nm‘ric
 = 
	`¬¿y_n
(
¡©s_m‘ric
);

101 
	`ASSERT
(
nm‘ric
 =ğ
STATS_POOL_NFIELD
 ||‚m‘riø=ğ
STATS_SERVER_NFIELD
);

103 
i
 = 0; i < 
nm‘ric
; i++) {

104 
¡©s_m‘ric
 *
¡m
 = 
	`¬¿y_g‘
(¡©s_m‘ric, 
i
);

106 
	`¡©s_m‘ric_š™
(
¡m
);

108 
	}
}

110 
r¡©us_t


111 
	$¡©s_poŞ_m‘ric_š™
(
¬¿y
 *
¡©s_m‘ric
)

113 
r¡©us_t
 
¡©us
;

114 
ušt32_t
 
i
, 
nf›ld
 = 
STATS_POOL_NFIELD
;

116 
¡©us
 = 
	`¬¿y_š™
(
¡©s_m‘ric
, 
nf›ld
, (stats_metric));

117 ià(
¡©us
 !ğ
NC_OK
) {

118  
¡©us
;

121 
i
 = 0; i < 
nf›ld
; i++) {

122 
¡©s_m‘ric
 *
¡m
 = 
	`¬¿y_push
(stats_metric);

125 *
¡m
 = 
¡©s_poŞ_codec
[
i
];

128 
	`¡©s_m‘ric_š™
(
¡m
);

131  
NC_OK
;

132 
	}
}

134 
r¡©us_t


135 
	$¡©s_£rv”_m‘ric_š™
(
¡©s_£rv”
 *
¡s
)

137 
r¡©us_t
 
¡©us
;

138 
ušt32_t
 
i
, 
nf›ld
 = 
STATS_SERVER_NFIELD
;

140 
¡©us
 = 
	`¬¿y_š™
(&
¡s
->
m‘ric
, 
nf›ld
, (
¡©s_m‘ric
));

141 ià(
¡©us
 !ğ
NC_OK
) {

142  
¡©us
;

145 
i
 = 0; i < 
nf›ld
; i++) {

146 
¡©s_m‘ric
 *
¡m
 = 
	`¬¿y_push
(&
¡s
->
m‘ric
);

149 *
¡m
 = 
¡©s_£rv”_codec
[
i
];

152 
	`¡©s_m‘ric_š™
(
¡m
);

155  
NC_OK
;

156 
	}
}

159 
	$¡©s_m‘ric_deš™
(
¬¿y
 *
m‘ric
)

161 
ušt32_t
 
i
, 
nm‘ric
;

163 
nm‘ric
 = 
	`¬¿y_n
(
m‘ric
);

164 
i
 = 0; i < 
nm‘ric
; i++) {

165 
	`¬¿y_pİ
(
m‘ric
);

167 
	`¬¿y_deš™
(
m‘ric
);

168 
	}
}

170 
r¡©us_t


171 
	$¡©s_£rv”_š™
(
¡©s_£rv”
 *
¡s
, 
£rv”
 *
s
)

173 
r¡©us_t
 
¡©us
;

175 
¡s
->
Çme
 = 
s
->name;

176 
	`¬¿y_nuÎ
(&
¡s
->
m‘ric
);

178 
¡©us
 = 
	`¡©s_£rv”_m‘ric_š™
(
¡s
);

179 ià(
¡©us
 !ğ
NC_OK
) {

180  
¡©us
;

183 
	`log_debug
(
LOG_VVVERB
, "š™ st £rv” '%.*s' w™h %"
PRIu32
" metric",

184 
¡s
->
Çme
.
Ën
, sts->Çme.
d©a
, 
	`¬¿y_n
(&¡s->
m‘ric
));

186  
NC_OK
;

188 
	}
}

190 
r¡©us_t


191 
	$add_£rv”_to_¡©s_poŞ
(
¡©s_poŞ
 *
¡p
, 
£rv”
 *
¤v
)

193 
r¡©us_t
 
¡©us
;

194 
¡©s_£rv”
 *
¡s
 = 
	`¬¿y_push
(&
¡p
->
£rv”
);

196 
¡©us
 = 
	`¡©s_£rv”_š™
(
¡s
, 
¤v
);

197 ià(
¡©us
 !ğ
NC_OK
) {

198  
¡©us
;

201  
¡©us
;

202 
	}
}

204 
r¡©us_t


205 
	$¡©s_£rv”_m­
(
¬¿y
 *
¡©s_£rv”
, ¬¿y *
£rv”
)

207 
r¡©us_t
 
¡©us
;

208 
ušt32_t
 
i
, 
n£rv”
;

210 
n£rv”
 = 
	`¬¿y_n
(
£rv”
);

213 
¡©us
 = 
	`¬¿y_š™
(
¡©s_£rv”
, 
n£rv”
 + 4, (stats_server));

214 ià(
¡©us
 !ğ
NC_OK
) {

215  
¡©us
;

218 
i
 = 0; i < 
n£rv”
; i++) {

219 
£rv”
 *
s
 = 
	`¬¿y_g‘
(£rv”, 
i
);

220 
¡©s_£rv”
 *
¡s
 = 
	`¬¿y_push
(stats_server);

222 
¡©us
 = 
	`¡©s_£rv”_š™
(
¡s
, 
s
);

223 ià(
¡©us
 !ğ
NC_OK
) {

224  
¡©us
;

228 
	`log_debug
(
LOG_VVVERB
, "m­ %"
PRIu32
" st £rv”s", 
n£rv”
);

230  
NC_OK
;

231 
	}
}

234 
	$¡©s_£rv”_unm­
(
¬¿y
 *
¡©s_£rv”
)

236 
ušt32_t
 
i
, 
n£rv”
;

238 
n£rv”
 = 
	`¬¿y_n
(
¡©s_£rv”
);

240 
i
 = 0; i < 
n£rv”
; i++) {

241 
¡©s_£rv”
 *
¡s
 = 
	`¬¿y_pİ
(stats_server);

242 
	`¡©s_m‘ric_deš™
(&
¡s
->
m‘ric
);

244 
	`¬¿y_deš™
(
¡©s_£rv”
);

246 
	`log_debug
(
LOG_VVVERB
, "unm­ %"
PRIu32
" st £rv”s", 
n£rv”
);

247 
	}
}

249 
r¡©us_t


250 
	$¡©s_poŞ_š™
(
¡©s_poŞ
 *
¡p
, 
£rv”_poŞ
 *
¥
)

252 
r¡©us_t
 
¡©us
;

254 
¡p
->
Çme
 = 
¥
->name;

255 
	`¬¿y_nuÎ
(&
¡p
->
m‘ric
);

256 
	`¬¿y_nuÎ
(&
¡p
->
£rv”
);

258 
¡©us
 = 
	`¡©s_poŞ_m‘ric_š™
(&
¡p
->
m‘ric
);

259 ià(
¡©us
 !ğ
NC_OK
) {

260  
¡©us
;

263 
¡©us
 = 
	`¡©s_£rv”_m­
(&
¡p
->
£rv”
, &
¥
->server);

264 ià(
¡©us
 !ğ
NC_OK
) {

265 
	`¡©s_m‘ric_deš™
(&
¡p
->
m‘ric
);

266  
¡©us
;

269 
	`log_debug
(
LOG_VVVERB
, "š™ st poŞ '%.*s' w™h %"
PRIu32
" metric‡nd "

270 "%"
PRIu32
" s”v”", 
¡p
->
Çme
.
Ën
, s->Çme.
d©a
,

271 
	`¬¿y_n
(&
¡p
->
m‘ric
),‡rray_n(&stp->metric));

273  
NC_OK
;

274 
	}
}

277 
	$¡©s_poŞ_»£t
(
¬¿y
 *
¡©s_poŞ
)

279 
ušt32_t
 
i
, 
ÅoŞ
;

281 
ÅoŞ
 = 
	`¬¿y_n
(
¡©s_poŞ
);

283 
i
 = 0; i < 
ÅoŞ
; i++) {

284 
¡©s_poŞ
 *
¡p
 = 
	`¬¿y_g‘
(¡©s_poŞ, 
i
);

285 
ušt32_t
 
j
, 
n£rv”
;

287 
	`¡©s_m‘ric_»£t
(&
¡p
->
m‘ric
);

289 
n£rv”
 = 
	`¬¿y_n
(&
¡p
->
£rv”
);

290 
j
 = 0; j < 
n£rv”
; j++) {

291 
¡©s_£rv”
 *
¡s
 = 
	`¬¿y_g‘
(&
¡p
->
£rv”
, 
j
);

292 
	`¡©s_m‘ric_»£t
(&
¡s
->
m‘ric
);

295 
	}
}

297 
r¡©us_t


298 
	$¡©s_poŞ_m­
(
¬¿y
 *
¡©s_poŞ
, ¬¿y *
£rv”_poŞ
)

300 
r¡©us_t
 
¡©us
;

301 
ušt32_t
 
i
, 
ÅoŞ
;

303 
ÅoŞ
 = 
	`¬¿y_n
(
£rv”_poŞ
);

304 
	`ASSERT
(
ÅoŞ
 != 0);

306 
¡©us
 = 
	`¬¿y_š™
(
¡©s_poŞ
, 
ÅoŞ
, (stats_pool));

307 ià(
¡©us
 !ğ
NC_OK
) {

308  
¡©us
;

311 
i
 = 0; i < 
ÅoŞ
; i++) {

312 
£rv”_poŞ
 *
¥
 = 
	`¬¿y_g‘
(£rv”_poŞ, 
i
);

313 
¡©s_poŞ
 *
¡p
 = 
	`¬¿y_push
(stats_pool);

315 
¡©us
 = 
	`¡©s_poŞ_š™
(
¡p
, 
¥
);

316 ià(
¡©us
 !ğ
NC_OK
) {

317  
¡©us
;

321 
	`log_debug
(
LOG_VVVERB
, "m­ %"
PRIu32
" st poŞs", 
ÅoŞ
);

323  
NC_OK
;

324 
	}
}

327 
	$¡©s_poŞ_unm­
(
¬¿y
 *
¡©s_poŞ
)

329 
ušt32_t
 
i
, 
ÅoŞ
;

331 
ÅoŞ
 = 
	`¬¿y_n
(
¡©s_poŞ
);

333 
i
 = 0; i < 
ÅoŞ
; i++) {

334 
¡©s_poŞ
 *
¡p
 = 
	`¬¿y_pİ
(stats_pool);

335 
	`¡©s_m‘ric_deš™
(&
¡p
->
m‘ric
);

336 
	`¡©s_£rv”_unm­
(&
¡p
->
£rv”
);

338 
	`¬¿y_deš™
(
¡©s_poŞ
);

340 
	`log_debug
(
LOG_VVVERB
, "unm­ %"
PRIu32
" st poŞ", 
ÅoŞ
);

341 
	}
}

343 
r¡©us_t


344 
	$¡©s_ü—‹_buf
(
¡©s
 *
¡
)

346 
ušt32_t
 
št64_max_dig™s
 = 20;

347 
ušt32_t
 
key_v®ue_exŒa
 = 8;

348 
ušt32_t
 
poŞ_exŒa
 = 8;

349 
ušt32_t
 
£rv”_exŒa
 = 8;

350 
size_t
 
size
 = 0;

351 
ušt32_t
 
i
;

356 
size
 += 1;

358 
size
 +ğ
¡
->
£rviû_¡r
.
Ën
;

359 
size
 +ğ
¡
->
£rviû
.
Ën
;

360 
size
 +ğ
key_v®ue_exŒa
;

362 
size
 +ğ
¡
->
sourû_¡r
.
Ën
;

363 
size
 +ğ
¡
->
sourû
.
Ën
;

364 
size
 +ğ
key_v®ue_exŒa
;

366 
size
 +ğ
¡
->
v”siÚ_¡r
.
Ën
;

367 
size
 +ğ
¡
->
v”siÚ
.
Ën
;

368 
size
 +ğ
key_v®ue_exŒa
;

370 
size
 +ğ
¡
->
u±ime_¡r
.
Ën
;

371 
size
 +ğ
št64_max_dig™s
;

372 
size
 +ğ
key_v®ue_exŒa
;

374 
size
 +ğ
¡
->
time¡amp_¡r
.
Ën
;

375 
size
 +ğ
št64_max_dig™s
;

376 
size
 +ğ
key_v®ue_exŒa
;

378 
size
 +ğ
¡
->
ÁÙ®_cÚn_¡r
.
Ën
;

379 
size
 +ğ
št64_max_dig™s
;

380 
size
 +ğ
key_v®ue_exŒa
;

382 
size
 +ğ
¡
->
ncu¼_cÚn_¡r
.
Ën
;

383 
size
 +ğ
št64_max_dig™s
;

384 
size
 +ğ
key_v®ue_exŒa
;

387 
i
 = 0; i < 
	`¬¿y_n
(&
¡
->
sum
); i++) {

388 
¡©s_poŞ
 *
¡p
 = 
	`¬¿y_g‘
(&
¡
->
sum
, 
i
);

389 
ušt32_t
 
j
;

391 
size
 +ğ
¡p
->
Çme
.
Ën
;

392 
size
 +ğ
poŞ_exŒa
;

394 
j
 = 0; j < 
	`¬¿y_n
(&
¡p
->
m‘ric
); j++) {

395 
¡©s_m‘ric
 *
¡m
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 
j
);

397 
size
 +ğ
¡m
->
Çme
.
Ën
;

398 
size
 +ğ
št64_max_dig™s
;

399 
size
 +ğ
key_v®ue_exŒa
;

403 
j
 = 0; j < 
	`¬¿y_n
(&
¡p
->
£rv”
); j++) {

404 
¡©s_£rv”
 *
¡s
 = 
	`¬¿y_g‘
(&
¡p
->
£rv”
, 
j
);

405 
ušt32_t
 
k
;

407 
size
 +ğ
¡s
->
Çme
.
Ën
;

408 
size
 +ğ
£rv”_exŒa
;

410 
k
 = 0; k < 
	`¬¿y_n
(&
¡s
->
m‘ric
); k++) {

411 
¡©s_m‘ric
 *
¡m
 = 
	`¬¿y_g‘
(&
¡s
->
m‘ric
, 
k
);

413 
size
 +ğ
¡m
->
Çme
.
Ën
;

414 
size
 +ğ
št64_max_dig™s
;

415 
size
 +ğ
key_v®ue_exŒa
;

418 
¡
->
cu¼_£rv”s
 +ğ
	`¬¿y_n
(&
¡p
->
£rv”
);;

426 
size
 +ğ
¡
->
max_®lowed_£rv”s
 * (40 + 
št64_max_dig™s
 + 
key_v®ue_exŒa
);

429 
size
 += 2;

431 
size
 = 
	`NC_ALIGN
(size, 
NC_ALIGNMENT
);

433 
¡
->
buf
.
d©a
 = 
	`nc_®loc
(
size
);

434 ià(
¡
->
buf
.
d©a
 =ğ
NULL
) {

435 
	`log_”rÜ
("ü—‹ st bufã¸oàsiz%zu faed: %s", 
size
,

436 
	`¡»¼Ü
(
”ºo
));

437  
NC_ENOMEM
;

439 
¡
->
buf
.
size
 = size;

441 
	`log_debug
(
LOG_DEBUG
, "¡© bufã¸siz%zu", 
size
);

443  
NC_OK
;

444 
	}
}

447 
	$¡©s_de¡roy_buf
(
¡©s
 *
¡
)

449 ià(
¡
->
buf
.
size
 != 0) {

450 
	`ASSERT
(
¡
->
buf
.
d©a
 !ğ
NULL
);

451 
	`nc_ä“
(
¡
->
buf
.
d©a
);

452 
¡
->
buf
.
size
 = 0;

454 
	}
}

456 
r¡©us_t


457 
	$¡©s_add_¡ršg
(
¡©s
 *
¡
, 
¡ršg
 *
key
, ¡ršg *
v®
)

459 
¡©s_bufãr
 *
buf
;

460 
ušt8_t
 *
pos
;

461 
size_t
 
room
;

462 
n
;

464 
buf
 = &
¡
->buf;

465 
pos
 = 
buf
->
d©a
 + buf->
Ën
;

466 
room
 = 
buf
->
size
 - buf->
Ën
 - 1;

468 
n
 = 
	`nc_¢´štf
(
pos
, 
room
, "\"%.*s\":\"%.*s\", ", 
key
->
Ën
, key->
d©a
,

469 
v®
->
Ën
, v®->
d©a
);

470 ià(
n
 < 0 ||‚ >ğ()
room
) {

471  
NC_ERROR
;

474 
buf
->
Ën
 +ğ(
size_t
)
n
;

476  
NC_OK
;

477 
	}
}

479 
r¡©us_t


480 
	$¡©s_add_num
(
¡©s
 *
¡
, 
¡ršg
 *
key
, 
št64_t
 
v®
)

482 
¡©s_bufãr
 *
buf
;

483 
ušt8_t
 *
pos
;

484 
size_t
 
room
;

485 
n
;

487 
buf
 = &
¡
->buf;

488 
pos
 = 
buf
->
d©a
 + buf->
Ën
;

489 
room
 = 
buf
->
size
 - buf->
Ën
 - 1;

491 
n
 = 
	`nc_¢´štf
(
pos
, 
room
, "\"%.*s\":%"
PRId64
", ", 
key
->
Ën
, key->
d©a
,

492 
v®
);

493 ià(
n
 < 0 ||‚ >ğ()
room
) {

494  
NC_ERROR
;

497 
buf
->
Ën
 +ğ(
size_t
)
n
;

499  
NC_OK
;

500 
	}
}

502 
r¡©us_t


503 
	$¡©s_add_h—d”
(
¡©s
 *
¡
)

505 
r¡©us_t
 
¡©us
;

506 
¡©s_bufãr
 *
buf
;

507 
št64_t
 
cur_ts
, 
u±ime
;

509 
buf
 = &
¡
->buf;

510 
buf
->
d©a
[buf->
Ën
] = '{';

511 
buf
->
Ën
 += 1;

513 
cur_ts
 = (
št64_t
)
	`time
(
NULL
);

514 
u±ime
 = 
cur_ts
 - 
¡
->
¡¬t_ts
;

517 
¡©us
 = 
	`¡©s_add_¡ršg
(
¡
, &¡->
´oxy_addr_¡r
, &¡->
´oxy_addr
);

518 ià(
¡©us
 !ğ
NC_OK
) {

519  
¡©us
;

522 
¡©us
 = 
	`¡©s_add_¡ršg
(
¡
, &¡->
£rviû_¡r
, &¡->
£rviû
);

523 ià(
¡©us
 !ğ
NC_OK
) {

524  
¡©us
;

527 
¡©us
 = 
	`¡©s_add_¡ršg
(
¡
, &¡->
sourû_¡r
, &¡->
sourû
);

528 ià(
¡©us
 !ğ
NC_OK
) {

529  
¡©us
;

532 
¡©us
 = 
	`¡©s_add_¡ršg
(
¡
, &¡->
v”siÚ_¡r
, &¡->
v”siÚ
);

533 ià(
¡©us
 !ğ
NC_OK
) {

534  
¡©us
;

537 
¡©us
 = 
	`¡©s_add_num
(
¡
, &¡->
u±ime_¡r
, 
u±ime
);

538 ià(
¡©us
 !ğ
NC_OK
) {

539  
¡©us
;

542 
¡©us
 = 
	`¡©s_add_num
(
¡
, &¡->
time¡amp_¡r
, 
cur_ts
);

543 ià(
¡©us
 !ğ
NC_OK
) {

544  
¡©us
;

547 
¡©us
 = 
	`¡©s_add_num
(
¡
, &¡->
ÁÙ®_cÚn_¡r
, 
	`cÚn_ÁÙ®_cÚn
());

548 ià(
¡©us
 !ğ
NC_OK
) {

549  
¡©us
;

552 
¡©us
 = 
	`¡©s_add_num
(
¡
, &¡->
ncu¼_cÚn_¡r
, 
	`cÚn_ncu¼_cÚn
());

553 ià(
¡©us
 !ğ
NC_OK
) {

554  
¡©us
;

557  
NC_OK
;

558 
	}
}

560 
r¡©us_t


561 
	$¡©s_add_foÙ”
(
¡©s
 *
¡
)

563 
¡©s_bufãr
 *
buf
;

564 
ušt8_t
 *
pos
;

566 
buf
 = &
¡
->buf;

568 ià(
buf
->
Ën
 =ğbuf->
size
) {

569  
NC_ERROR
;

573 
pos
 = 
buf
->
d©a
 + buf->
Ën
 - 1;

574 
pos
[0] = '}';

575 
pos
[1] = '\n';

576 
buf
->
Ën
 += 1;

578  
NC_OK
;

579 
	}
}

581 
r¡©us_t


582 
	$¡©s_begš_Ã¡šg
(
¡©s
 *
¡
, 
¡ršg
 *
key
)

584 
¡©s_bufãr
 *
buf
;

585 
ušt8_t
 *
pos
;

586 
size_t
 
room
;

587 
n
;

589 
buf
 = &
¡
->buf;

590 
pos
 = 
buf
->
d©a
 + buf->
Ën
;

591 
room
 = 
buf
->
size
 - buf->
Ën
 - 1;

593 
n
 = 
	`nc_¢´štf
(
pos
, 
room
, "\"%.*s\": {", 
key
->
Ën
, key->
d©a
);

594 ià(
n
 < 0 ||‚ >ğ()
room
) {

595  
NC_ERROR
;

598 
buf
->
Ën
 +ğ(
size_t
)
n
;

600  
NC_OK
;

601 
	}
}

603 
r¡©us_t


604 
	$¡©s_’d_Ã¡šg
(
¡©s
 *
¡
)

606 
¡©s_bufãr
 *
buf
;

607 
ušt8_t
 *
pos
;

609 
buf
 = &
¡
->buf;

610 
pos
 = 
buf
->
d©a
 + buf->
Ën
;

612 
pos
 -= 2;

614 
pos
[0]) {

617 
	`ASSERT
(
pos
[1] == ' ');

618 
pos
[0] = '}';

619 
pos
[1] = ',';

623 ià(
buf
->
Ën
 =ğbuf->
size
) {

624  
NC_ERROR
;

627 
	`ASSERT
(
pos
[1] == ',');

628 
pos
[1] = '}';

629 
pos
[2] = ',';

630 
buf
->
Ën
 += 1;

634 
	`NOT_REACHED
();

637  
NC_OK
;

638 
	}
}

640 
r¡©us_t


641 
	$¡©s_cİy_m‘ric
(
¡©s
 *
¡
, 
¬¿y
 *
m‘ric
)

643 
r¡©us_t
 
¡©us
;

644 
ušt32_t
 
i
;

646 
i
 = 0; i < 
	`¬¿y_n
(
m‘ric
); i++) {

647 
¡©s_m‘ric
 *
¡m
 = 
	`¬¿y_g‘
(
m‘ric
, 
i
);

649 
¡©us
 = 
	`¡©s_add_num
(
¡
, &
¡m
->
Çme
, stm->
v®ue
.
couÁ”
);

650 ià(
¡©us
 !ğ
NC_OK
) {

651  
¡©us
;

655  
NC_OK
;

656 
	}
}

659 
	$¡©s_agg»g©e_m‘ric
(
¬¿y
 *
d¡
, ¬¿y *
¤c
)

661 
ušt32_t
 
i
;

663 
i
 = 0; i < 
	`¬¿y_n
(
¤c
); i++) {

664 
¡©s_m‘ric
 *
¡m1
, *
¡m2
;

666 
¡m1
 = 
	`¬¿y_g‘
(
¤c
, 
i
);

667 
¡m2
 = 
	`¬¿y_g‘
(
d¡
, 
i
);

669 
	`ASSERT
(
¡m1
->
ty³
 =ğ
¡m2
->type);

671 
¡m1
->
ty³
) {

672 
STATS_COUNTER
:

673 
¡m2
->
v®ue
.
couÁ”
 +ğ
¡m1
->value.counter;

676 
STATS_GAUGE
:

677 
¡m2
->
v®ue
.
couÁ”
 +ğ
¡m1
->value.counter;

680 
STATS_TIMESTAMP
:

681 ià(
¡m1
->
v®ue
.
time¡amp
) {

682 
¡m2
->
v®ue
.
time¡amp
 = 
¡m1
->value.timestamp;

687 
	`NOT_REACHED
();

690 
	}
}

693 
	$¡©s_summ¬ize_£rv”s_to_poŞ
(
¡©s
 *
¡
)

695 
ušt32_t
 
i
, 
j
;

696 
i
 = 0; i < 
	`¬¿y_n
(&
¡
->
sum
); i++) {

697 
¡©s_poŞ
 *
¡p
 = 
	`¬¿y_g‘
(&
¡
->
sum
, 
i
);

699 
	`log_debug
(
LOG_PVERB
, "aggregate %d serverso…ool: %s\n",

700 
	`¬¿y_n
(&
¡p
->
£rv”
), s->
Çme
.
d©a
);

702 
¡©s_m‘ric
 *
tÙ®_rq¡s
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 6);

703 
¡©s_m‘ric
 *
tÙ®_rq¡s_by‹s
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 7);

704 
¡©s_m‘ric
 *
tÙ®_»¥s
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 8);

705 
¡©s_m‘ric
 *
tÙ®_»¥s_by‹s
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 9);

706 
tÙ®_rq¡s
->
v®ue
.
couÁ”
 = 0;

707 
tÙ®_rq¡s_by‹s
->
v®ue
.
couÁ”
 = 0;

708 
tÙ®_»¥s
->
v®ue
.
couÁ”
 = 0;

709 
tÙ®_»¥s_by‹s
->
v®ue
.
couÁ”
 = 0;

711 
j
 = 0; j < 
	`¬¿y_n
(&
¡p
->
£rv”
); j++) {

712 
¡©s_£rv”
 *
¡s
 = 
	`¬¿y_g‘
(&
¡p
->
£rv”
, 
j
);

713 
¡©s_m‘ric
 *
sm
;

715 
sm
 = 
	`¬¿y_g‘
(&
¡s
->
m‘ric
, 5);

716 
tÙ®_rq¡s
->
v®ue
.
couÁ”
 +ğ
sm
->value.counter;

718 
sm
 = 
	`¬¿y_g‘
(&
¡s
->
m‘ric
, 6);

719 
tÙ®_rq¡s_by‹s
->
v®ue
.
couÁ”
 +ğ
sm
->value.counter;

721 
sm
 = 
	`¬¿y_g‘
(&
¡s
->
m‘ric
, 7);

722 
tÙ®_»¥s
->
v®ue
.
couÁ”
 +ğ
sm
->value.counter;

724 
sm
 = 
	`¬¿y_g‘
(&
¡s
->
m‘ric
, 8);

725 
tÙ®_»¥s_by‹s
->
v®ue
.
couÁ”
 +ğ
sm
->value.counter;

728 
	}
}

731 
	$¡©s_summ¬ize_Ï‹ncy
(
¡©s
 *
¡
)

733 
cÚ‹xt
 *
ùx
 = 
¡
->context;

734 
	`as£¹
(
	`¬¿y_n
(&
¡
->
sum
) == 1);

735 
i
 = 0; i < 
	`¬¿y_n
(&
¡
->
sum
); i++) {

736 
¡©s_poŞ
 *
¡p
 = 
	`¬¿y_g‘
(&
¡
->
sum
, 
i
);

739 
¡©s_m‘ric
 *
Ït_mš
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 10);

740 
¡©s_m‘ric
 *
Ït_max
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 11);

741 
¡©s_m‘ric
 *
Ït_p50
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 12);

742 
¡©s_m‘ric
 *
Ït_p90
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 13);

743 
¡©s_m‘ric
 *
Ït_p95
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 14);

744 
¡©s_m‘ric
 *
Ït_p99
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 15);

746 
Ït_mš
->
v®ue
.
couÁ”
 = 
	`hdr_v®ue_©_³rûÁe
(
ùx
->
hi¡og¿m
, 0);

747 
Ït_max
->
v®ue
.
couÁ”
 = 
	`hdr_max
(
ùx
->
hi¡og¿m
);

748 
Ït_p50
->
v®ue
.
couÁ”
 = 
	`hdr_v®ue_©_³rûÁe
(
ùx
->
hi¡og¿m
, 50);

749 
Ït_p90
->
v®ue
.
couÁ”
 = 
	`hdr_v®ue_©_³rûÁe
(
ùx
->
hi¡og¿m
, 90);

750 
Ït_p95
->
v®ue
.
couÁ”
 = 
	`hdr_v®ue_©_³rûÁe
(
ùx
->
hi¡og¿m
, 95);

751 
Ït_p99
->
v®ue
.
couÁ”
 = 
	`hdr_v®ue_©_³rûÁe
(
ùx
->
hi¡og¿m
, 99);

756 
	`±h»ad_mu‹x_lock
(&
ùx
->
hi¡o_lock
);

757 
	`hdr_»£t
(
ùx
->
hi¡og¿m
);

758 
	`±h»ad_mu‹x_uÆock
(&
ùx
->
hi¡o_lock
);

759 
	}
}

765 
	$¡©s_lock
(
¡©s
 *
¡
)

767 
	`±h»ad_mu‹x_lock
(&
¡
->
lock
);

768 
	}
}

771 
	$¡©s_uÆock
(
¡©s
 *
¡
)

773 
	`±h»ad_mu‹x_uÆock
(&
¡
->
lock
);

774 
	}
}

781 
	$»size_¡©s_bufãr
(
¡©s
 *
¡
)

786 
	}
}

789 
	$¡©s_agg»g©e
(
¡©s
 *
¡
)

791 
ušt32_t
 
i
;

793 ià(
¡
->
agg»g©e
 == 0) {

794 
	`log_debug
(
LOG_PVERB
, "skip‡ggregate of shadow %po sum %p‡s "

795 "g’”©Ü i ¦ow", 
¡
->
shadow
.
–em
, st->
sum
.elem);

799 
	`log_debug
(
LOG_PVERB
, "agg»g©¡© shadow %°tØsum %p", 
¡
->
shadow
.
–em
,

800 
¡
->
sum
.
–em
);

804 
	`¡©s_lock
(
¡
);

806 
i
 = 0; i < 
	`¬¿y_n
(&
¡
->
shadow
); i++) {

807 
¡©s_poŞ
 *
¡p1
, *
¡p2
;

808 
ušt32_t
 
j
;

810 
¡p1
 = 
	`¬¿y_g‘
(&
¡
->
shadow
, 
i
);

811 
¡p2
 = 
	`¬¿y_g‘
(&
¡
->
sum
, 
i
);

812 
	`¡©s_agg»g©e_m‘ric
(&
¡p2
->
m‘ric
, &
¡p1
->metric);

814 
j
 = 0; j < 
	`¬¿y_n
(&
¡p1
->
£rv”
); j++) {

815 
¡©s_£rv”
 *
¡s1
, *
¡s2
;

817 
¡s1
 = 
	`¬¿y_g‘
(&
¡p1
->
£rv”
, 
j
);

818 
¡s2
 = 
	`¬¿y_g‘
(&
¡p2
->
£rv”
, 
j
);

819 
	`¡©s_agg»g©e_m‘ric
(&
¡s2
->
m‘ric
, &
¡s1
->metric);

824 
	`¡©s_summ¬ize_£rv”s_to_poŞ
(
¡
);

826 
	`¡©s_uÆock
(
¡
);

828 
¡
->
agg»g©e
 = 0;

829 
	}
}

831 
r¡©us_t


832 
	$¡©s_make_r¥
(
¡©s
 *
¡
)

834 
r¡©us_t
 
¡©us
;

835 
ušt32_t
 
i
;

837 
¡©us
 = 
	`¡©s_add_h—d”
(
¡
);

838 ià(
¡©us
 !ğ
NC_OK
) {

839  
¡©us
;

842 
i
 = 0; i < 
	`¬¿y_n
(&
¡
->
sum
); i++) {

843 
¡©s_poŞ
 *
¡p
 = 
	`¬¿y_g‘
(&
¡
->
sum
, 
i
);

844 
ušt32_t
 
j
;

846 
¡©us
 = 
	`¡©s_begš_Ã¡šg
(
¡
, &
¡p
->
Çme
);

847 ià(
¡©us
 !ğ
NC_OK
) {

848  
¡©us
;

852 
¡©us
 = 
	`¡©s_cİy_m‘ric
(
¡
, &
¡p
->
m‘ric
);

853 ià(
¡©us
 !ğ
NC_OK
) {

854  
¡©us
;

857 
j
 = 0; j < 
	`¬¿y_n
(&
¡p
->
£rv”
); j++) {

858 
¡©s_£rv”
 *
¡s
 = 
	`¬¿y_g‘
(&
¡p
->
£rv”
, 
j
);

860 
¡©us
 = 
	`¡©s_begš_Ã¡šg
(
¡
, &
¡s
->
Çme
);

861 ià(
¡©us
 !ğ
NC_OK
) {

862  
¡©us
;

866 
¡©us
 = 
	`¡©s_cİy_m‘ric
(
¡
, &
¡s
->
m‘ric
);

867 ià(
¡©us
 !ğ
NC_OK
) {

868  
¡©us
;

871 
¡©us
 = 
	`¡©s_’d_Ã¡šg
(
¡
);

872 ià(
¡©us
 !ğ
NC_OK
) {

873  
¡©us
;

877 
¡©us
 = 
	`¡©s_’d_Ã¡šg
(
¡
);

878 ià(
¡©us
 !ğ
NC_OK
) {

879  
¡©us
;

883 
¡©us
 = 
	`¡©s_add_foÙ”
(
¡
);

884 ià(
¡©us
 !ğ
NC_OK
) {

885  
¡©us
;

888  
NC_OK
;

889 
	}
}

891 
r¡©us_t


892 
	$¡©s_£nd_r¥
(
¡©s
 *
¡
)

894 
r¡©us_t
 
¡©us
;

895 
ssize_t
 
n
;

896 
sd
;

898 
¡
->
buf
.
Ën
 = 0;

899 
¡©us
 = 
	`¡©s_make_r¥
(
¡
);

900 ià(
¡©us
 !ğ
NC_OK
) {

901  
¡©us
;

904 
sd
 = 
	`acû±
(
¡
->sd, 
NULL
, NULL);

905 ià(
sd
 < 0) {

906 
	`log_”rÜ
("acû± oÀm %d faed: %s", 
¡
->
sd
, 
	`¡»¼Ü
(
”ºo
));

907  
NC_ERROR
;

910 
	`log_debug
(
LOG_VERB
, "£nd st Ú sd %d %d by‹s", 
sd
, 
¡
->
buf
.
Ën
);

912 
n
 = 
	`nc_£ndn
(
sd
, 
¡
->
buf
.
d©a
, st->buf.
Ën
);

913 ià(
n
 < 0) {

914 
	`log_”rÜ
("£nd st Ú sd %d faed: %s", 
sd
, 
	`¡»¼Ü
(
”ºo
));

915 
	`şo£
(
sd
);

916  
NC_ERROR
;

919 
	`şo£
(
sd
);

920 
	}
}

922 
r¡©us_t


923 
	$¡©s_£nd_»q
(
¡©s
 *
¡
)

925 
r¡©us_t
 
¡©us
;

926 
sockšfo
 
si
;

927 
ssize_t
 
n
;

928 
sd
;

929 *
¡©s_
 = "localhost";

930 
¡ršg
 
addr
;

931 
	`¡ršg_£t_¿w
(&
addr
, 
¡©s_
);

933 
	`¡rıy
(
¡
->
buf
.
d©a
, "agent_w");

934 
¡
->
buf
.
Ën
 = 7;

935 
¡©us
 = 
	`¡©s_make_r¥
(
¡
);

936 ià(
¡©us
 !ğ
NC_OK
) {

937  
¡©us
;

940 
¡©us
 = 
	`nc_»sŞve
(&
addr
, 9997, &
si
);

941 ià(
¡©us
 < 0) {

942  
¡©us
;

946 
sd
 = 
	`sock‘
(
si
.
çmy
, 
SOCK_STREAM
, 0);

947 ià(
sd
 < 0) {

948 
	`log_debug
(
LOG_NOTICE
, "sock‘ faed: %s", 
	`¡»¼Ü
(
”ºo
));

949  
NC_ERROR
;

953 ià(
	`cÚÃù
(
sd
, (
sockaddr
 *è&
si
.
addr
.
š
, si.
add¾’
) < 0) {

954 
	`log_”rÜ
("ERROR connecting");

958 
n
 = 
	`nc_£ndn
(
sd
, 
¡
->
buf
.
d©a
, st->buf.
Ën
);

959 ià(
n
 < 0) {

960 
	`log_”rÜ
("£nd st Ú sd %d faed: %s", 
sd
, 
	`¡»¼Ü
(
”ºo
));

961 
	`şo£
(
sd
);

962  
NC_ERROR
;

966 
	`şo£
(
sd
);

968  
NC_OK
;

969 
	}
}

972 
	$¡©s_loİ_ÿÎback
(*
¬g1
, *
¬g2
)

974 
¡©s
 *
¡
 = 
¬g1
;

975 
n
 = *((*)
¬g2
);

978 
	`¡©s_agg»g©e
(
¡
);

981 
	`¡©s_summ¬ize_Ï‹ncy
(
¡
);

984 ià(
n
 == 0) {

985 
	`¡©s_£nd_»q
(
¡
);

988 
	`¡©s_£nd_r¥
(
¡
);

990 
	}
}

993 
	$¡©s_loİ
(*
¬g
)

995 
	`ev’t_loİ_¡©s
(
¡©s_loİ_ÿÎback
, 
¬g
);

996  
NULL
;

997 
	}
}

999 
r¡©us_t


1000 
	$¡©s_li¡’
(
¡©s
 *
¡
)

1002 
r¡©us_t
 
¡©us
;

1003 
sockšfo
 
si
;

1005 
¡©us
 = 
	`nc_»sŞve
(&
¡
->
addr
, st->
pÜt
, &
si
);

1006 ià(
¡©us
 < 0) {

1007  
¡©us
;

1010 
¡
->
sd
 = 
	`sock‘
(
si
.
çmy
, 
SOCK_STREAM
, 0);

1011 ià(
¡
->
sd
 < 0) {

1012 
	`log_”rÜ
("sock‘ faed: %s", 
	`¡»¼Ü
(
”ºo
));

1013  
NC_ERROR
;

1016 
¡©us
 = 
	`nc_£t_»u£addr
(
¡
->
sd
);

1017 ià(
¡©us
 < 0) {

1018 
	`log_”rÜ
("£ˆ»u£add¸Ú m %d faed: %s", 
¡
->
sd
, 
	`¡»¼Ü
(
”ºo
));

1019  
NC_ERROR
;

1022 
¡©us
 = 
	`bšd
(
¡
->
sd
, (
sockaddr
 *)&
si
.
addr
, si.
add¾’
);

1023 ià(
¡©us
 < 0) {

1024 
	`log_”rÜ
("bšd oÀm %dØadd¸'%.*s:%u' faed: %s", 
¡
->
sd
,

1025 
¡
->
addr
.
Ën
, st->addr.
d©a
, st->
pÜt
, 
	`¡»¼Ü
(
”ºo
));

1026  
NC_ERROR
;

1029 
¡©us
 = 
	`li¡’
(
¡
->
sd
, 
SOMAXCONN
);

1030 ià(
¡©us
 < 0) {

1031 
	`log_”rÜ
("li¡’ oÀm %d faed: %s", 
¡
->
sd
, 
	`¡»¼Ü
(
”ºo
));

1032  
NC_ERROR
;

1035 
	`log_debug
(
LOG_NOTICE
, "m %d†i¡’šg oÀ'%.*s:%u'", 
¡
->
sd
,

1036 
¡
->
addr
.
Ën
, st->addr.
d©a
, st->
pÜt
);

1038  
NC_OK
;

1039 
	}
}

1041 
r¡©us_t


1042 
	$¡©s_¡¬t_agg»g©Ü
(
¡©s
 *
¡
)

1044 
r¡©us_t
 
¡©us
;

1046 ià(!
¡©s_’abËd
) {

1047  
NC_OK
;

1050 
¡©us
 = 
	`¡©s_li¡’
(
¡
);

1051 ià(
¡©us
 !ğ
NC_OK
) {

1052  
¡©us
;

1055 
¡©us
 = 
	`±h»ad_ü—‹
(&
¡
->
tid
, 
NULL
, 
¡©s_loİ
, st);

1056 ià(
¡©us
 < 0) {

1057 
	`log_”rÜ
("¡© agg»g©Ü c»©çed: %s", 
	`¡»¼Ü
(
¡©us
));

1058  
NC_ERROR
;

1061  
NC_OK
;

1062 
	}
}

1065 
	$¡©s_¡İ_agg»g©Ü
(
¡©s
 *
¡
)

1067 ià(!
¡©s_’abËd
) {

1071 
	`şo£
(
¡
->
sd
);

1072 
	}
}

1074 
¡©s
 *

1075 
	$¡©s_ü—‹
(
š¡ªû
 *
nci
, 
¬¿y
 *
£rv”_poŞ
)

1077 
r¡©us_t
 
¡©us
;

1078 
¡©s
 *
¡
;

1080 
¡
 = 
	`nc_®loc
((*st));

1081 ià(
¡
 =ğ
NULL
) {

1082  
NULL
;

1085 
¡
->
pÜt
 = 
nci
->
¡©s_pÜt
;

1086 
¡
->
š‹rv®
 = 
nci
->
¡©s_š‹rv®
;

1087 
	`¡ršg_£t_¿w
(&
¡
->
addr
, 
nci
->
¡©s_addr
);

1089 
¡
->
¡¬t_ts
 = (
št64_t
)
	`time
(
NULL
);

1091 
¡
->
buf
.
Ën
 = 0;

1092 
¡
->
buf
.
d©a
 = 
NULL
;

1093 
¡
->
buf
.
size
 = 0;

1095 
	`¬¿y_nuÎ
(&
¡
->
cu¼’t
);

1096 
	`¬¿y_nuÎ
(&
¡
->
shadow
);

1097 
	`¬¿y_nuÎ
(&
¡
->
sum
);

1099 
¡
->
tid
 = (
±h»ad_t
) -1;

1100 
¡
->
sd
 = -1;

1102 
	`¡ršg_£t_‹xt
(&
¡
->
£rviû_¡r
, "service");

1103 
	`¡ršg_£t_‹xt
(&
¡
->
£rviû
, "nutcracker");

1105 
	`¡ršg_£t_‹xt
(&
¡
->
sourû_¡r
, "source");

1106 
	`¡ršg_£t_¿w
(&
¡
->
sourû
, 
nci
->
ho¡Çme
);

1108 
	`¡ršg_£t_‹xt
(&
¡
->
v”siÚ_¡r
, "version");

1109 
	`¡ršg_£t_‹xt
(&
¡
->
v”siÚ
, 
NC_VERSION_STRING
);

1111 
	`¡ršg_£t_‹xt
(&
¡
->
u±ime_¡r
, "uptime");

1112 
	`¡ršg_£t_‹xt
(&
¡
->
time¡amp_¡r
, "timestamp");

1114 
	`¡ršg_£t_‹xt
(&
¡
->
ÁÙ®_cÚn_¡r
, "total_connections");

1115 
	`¡ršg_£t_‹xt
(&
¡
->
ncu¼_cÚn_¡r
, "curr_connections");

1117 
	`¡ršg_£t_‹xt
(&
¡
->
´oxy_addr_¡r
, "proxy_instance");

1118 
	`¥rštf
(
nci
->
´oxy_šs
, "%s:%d",‚ci->
´oxy_
,‚ci->
´oxy_pÜt
);

1119 
	`¡ršg_£t_‹xt
(&
¡
->
´oxy_addr
, 
nci
->
´oxy_šs
);

1121 
¡
->
upd©ed
 = 0;

1122 
¡
->
agg»g©e
 = 0;

1124 
	`±h»ad_mu‹x_š™
(&
¡
->
lock
, 
NULL
);

1125 
¡
->
max_®lowed_£rv”s
 = 10000;

1126 
¡
->
cu¼_£rv”s
 = 0;

1130 
¡©us
 = 
	`¡©s_poŞ_m­
(&
¡
->
cu¼’t
, 
£rv”_poŞ
);

1131 ià(
¡©us
 !ğ
NC_OK
) {

1132 
”rÜ
;

1135 
¡©us
 = 
	`¡©s_poŞ_m­
(&
¡
->
shadow
, 
£rv”_poŞ
);

1136 ià(
¡©us
 !ğ
NC_OK
) {

1137 
”rÜ
;

1140 
¡©us
 = 
	`¡©s_poŞ_m­
(&
¡
->
sum
, 
£rv”_poŞ
);

1141 ià(
¡©us
 !ğ
NC_OK
) {

1142 
”rÜ
;

1145 
¡©us
 = 
	`¡©s_ü—‹_buf
(
¡
);

1146 ià(
¡©us
 !ğ
NC_OK
) {

1147 
”rÜ
;

1150 
¡©us
 = 
	`¡©s_¡¬t_agg»g©Ü
(
¡
);

1151 ià(
¡©us
 !ğ
NC_OK
) {

1152 
”rÜ
;

1155  
¡
;

1157 
”rÜ
:

1158 
	`¡©s_de¡roy
(
¡
);

1159  
NULL
;

1160 
	}
}

1163 
	$¡©s_de¡roy
(
¡©s
 *
¡
)

1165 
	`¡©s_¡İ_agg»g©Ü
(
¡
);

1166 
	`¡©s_poŞ_unm­
(&
¡
->
sum
);

1167 
	`¡©s_poŞ_unm­
(&
¡
->
shadow
);

1168 
	`¡©s_poŞ_unm­
(&
¡
->
cu¼’t
);

1169 
	`¡©s_de¡roy_buf
(
¡
);

1170 
	`nc_ä“
(
¡
);

1171 
	}
}

1174 
	$¡©s_sw­
(
¡©s
 *
¡
)

1176 ià(!
¡©s_’abËd
) {

1180 ià(
¡
->
agg»g©e
 == 1) {

1181 
	`log_debug
(
LOG_PVERB
, "skip swap of current %p shadow %p‡s‡ggregator "

1182 "i busy", 
¡
->
cu¼’t
.
–em
, st->
shadow
.elem);

1186 ià(
¡
->
upd©ed
 == 0) {

1187 
	`log_debug
(
LOG_PVERB
, "skip swap of current %p shadow %p‡shere is "

1188 "nÙhšg‚ew", 
¡
->
cu¼’t
.
–em
, st->
shadow
.elem);

1192 
	`log_debug
(
LOG_PVERB
, "sw­ st cu¼’ˆ%°shadow %p", 
¡
->
cu¼’t
.
–em
,

1193 
¡
->
shadow
.
–em
);

1195 
	`¡©s_lock
(
¡
);

1196 
	`¬¿y_sw­
(&
¡
->
cu¼’t
, &¡->
shadow
);

1202 
	`¡©s_poŞ_»£t
(&
¡
->
cu¼’t
);

1203 
	`¡©s_uÆock
(
¡
);

1205 
¡
->
upd©ed
 = 0;

1207 
¡
->
agg»g©e
 = 1;

1208 
	}
}

1210 
¡©s_m‘ric
 *

1211 
	$¡©s_poŞ_to_m‘ric
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
,

1212 
¡©s_poŞ_f›ld_t
 
fidx
)

1214 
¡©s
 *
¡
;

1215 
¡©s_poŞ
 *
¡p
;

1216 
¡©s_m‘ric
 *
¡m
;

1217 
ušt32_t
 
pidx
;

1219 
pidx
 = 
poŞ
->
idx
;

1221 
¡
 = 
ùx
->
¡©s
;

1222 
¡p
 = 
	`¬¿y_g‘
(&
¡
->
cu¼’t
, 
pidx
);

1223 
¡m
 = 
	`¬¿y_g‘
(&
¡p
->
m‘ric
, 
fidx
);

1225 
¡
->
upd©ed
 = 1;

1227 
	`log_debug
(
LOG_VVVERB
, "m‘riø'%.*s' iÀpoŞ %"
PRIu32
"", 
¡m
->
Çme
.
Ën
,

1228 
¡m
->
Çme
.
d©a
, 
pidx
);

1230  
¡m
;

1231 
	}
}

1234 
	$_¡©s_poŞ_šü
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
,

1235 
¡©s_poŞ_f›ld_t
 
fidx
)

1237 
¡©s_m‘ric
 *
¡m
;

1239 
¡m
 = 
	`¡©s_poŞ_to_m‘ric
(
ùx
, 
poŞ
, 
fidx
);

1241 
	`ASSERT
(
¡m
->
ty³
 =ğ
STATS_COUNTER
 || stm->ty³ =ğ
STATS_GAUGE
);

1242 
¡m
->
v®ue
.
couÁ”
++;

1244 
	`log_debug
(
LOG_VVVERB
, "šü f›ld '%.*s'Ø%"
PRId64
"", 
¡m
->
Çme
.
Ën
,

1245 
¡m
->
Çme
.
d©a
, stm->
v®ue
.
couÁ”
);

1246 
	}
}

1249 
	$_¡©s_poŞ_deü
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
,

1250 
¡©s_poŞ_f›ld_t
 
fidx
)

1252 
¡©s_m‘ric
 *
¡m
;

1254 
¡m
 = 
	`¡©s_poŞ_to_m‘ric
(
ùx
, 
poŞ
, 
fidx
);

1256 
	`ASSERT
(
¡m
->
ty³
 =ğ
STATS_GAUGE
);

1257 
¡m
->
v®ue
.
couÁ”
--;

1259 
	`log_debug
(
LOG_VVVERB
, "deü f›ld '%.*s'Ø%"
PRId64
"", 
¡m
->
Çme
.
Ën
,

1260 
¡m
->
Çme
.
d©a
, stm->
v®ue
.
couÁ”
);

1261 
	}
}

1264 
	$_¡©s_poŞ_šü_by
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
,

1265 
¡©s_poŞ_f›ld_t
 
fidx
, 
št64_t
 
v®
)

1267 
¡©s_m‘ric
 *
¡m
;

1269 
¡m
 = 
	`¡©s_poŞ_to_m‘ric
(
ùx
, 
poŞ
, 
fidx
);

1271 
	`ASSERT
(
¡m
->
ty³
 =ğ
STATS_COUNTER
 || stm->ty³ =ğ
STATS_GAUGE
);

1272 
¡m
->
v®ue
.
couÁ”
 +ğ
v®
;

1274 
	`log_debug
(
LOG_VVVERB
, "šü by f›ld '%.*s'Ø%"
PRId64
"", 
¡m
->
Çme
.
Ën
,

1275 
¡m
->
Çme
.
d©a
, stm->
v®ue
.
couÁ”
);

1276 
	}
}

1279 
	$_¡©s_poŞ_deü_by
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
,

1280 
¡©s_poŞ_f›ld_t
 
fidx
, 
št64_t
 
v®
)

1282 
¡©s_m‘ric
 *
¡m
;

1284 
¡m
 = 
	`¡©s_poŞ_to_m‘ric
(
ùx
, 
poŞ
, 
fidx
);

1286 
	`ASSERT
(
¡m
->
ty³
 =ğ
STATS_GAUGE
);

1287 
¡m
->
v®ue
.
couÁ”
 -ğ
v®
;

1289 
	`log_debug
(
LOG_VVVERB
, "deü by f›ld '%.*s'Ø%"
PRId64
"", 
¡m
->
Çme
.
Ën
,

1290 
¡m
->
Çme
.
d©a
, stm->
v®ue
.
couÁ”
);

1291 
	}
}

1294 
	$_¡©s_poŞ_£t_ts
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
,

1295 
¡©s_poŞ_f›ld_t
 
fidx
, 
št64_t
 
v®
)

1297 
¡©s_m‘ric
 *
¡m
;

1299 
¡m
 = 
	`¡©s_poŞ_to_m‘ric
(
ùx
, 
poŞ
, 
fidx
);

1301 
	`ASSERT
(
¡m
->
ty³
 =ğ
STATS_TIMESTAMP
);

1302 
¡m
->
v®ue
.
time¡amp
 = 
v®
;

1304 
	`log_debug
(
LOG_VVVERB
, "£ˆt f›ld '%.*s'Ø%"
PRId64
"", 
¡m
->
Çme
.
Ën
,

1305 
¡m
->
Çme
.
d©a
, stm->
v®ue
.
time¡amp
);

1306 
	}
}

1308 
¡©s_m‘ric
 *

1309 
	$¡©s_£rv”_to_m‘ric
(
cÚ‹xt
 *
ùx
, 
£rv”
 *server,

1310 
¡©s_£rv”_f›ld_t
 
fidx
)

1312 
¡©s
 *
¡
;

1313 
¡©s_poŞ
 *
¡p
;

1314 
¡©s_£rv”
 *
¡s
;

1315 
¡©s_m‘ric
 *
¡m
;

1316 
ušt32_t
 
pidx
, 
sidx
;

1318 
sidx
 = 
£rv”
->
idx
;

1319 
pidx
 = 
£rv”
->
owÃr
->
idx
;

1321 
¡
 = 
ùx
->
¡©s
;

1322 
¡p
 = 
	`¬¿y_g‘
(&
¡
->
cu¼’t
, 
pidx
);

1323 
¡s
 = 
	`¬¿y_g‘
(&
¡p
->
£rv”
, 
sidx
);

1324 
¡m
 = 
	`¬¿y_g‘
(&
¡s
->
m‘ric
, 
fidx
);

1326 
¡
->
upd©ed
 = 1;

1328 
	`log_debug
(
LOG_VVVERB
, "m‘riø'%.*s' iÀpoŞ %"
PRIu32
" server %"PRIu32"",

1329 
¡m
->
Çme
.
Ën
, stm->Çme.
d©a
, 
pidx
, 
sidx
);

1331  
¡m
;

1332 
	}
}

1335 
	$_¡©s_£rv”_šü
(
cÚ‹xt
 *
ùx
, 
£rv”
 *server,

1336 
¡©s_£rv”_f›ld_t
 
fidx
)

1338 
¡©s_m‘ric
 *
¡m
;

1340 
¡m
 = 
	`¡©s_£rv”_to_m‘ric
(
ùx
, 
£rv”
, 
fidx
);

1342 
	`ASSERT
(
¡m
->
ty³
 =ğ
STATS_COUNTER
 || stm->ty³ =ğ
STATS_GAUGE
);

1343 
¡m
->
v®ue
.
couÁ”
++;

1345 
	`log_debug
(
LOG_VVVERB
, "šü f›ld '%.*s'Ø%"
PRId64
"", 
¡m
->
Çme
.
Ën
,

1346 
¡m
->
Çme
.
d©a
, stm->
v®ue
.
couÁ”
);

1347 
	}
}

1350 
	$_¡©s_£rv”_deü
(
cÚ‹xt
 *
ùx
, 
£rv”
 *server,

1351 
¡©s_£rv”_f›ld_t
 
fidx
)

1353 
¡©s_m‘ric
 *
¡m
;

1355 
¡m
 = 
	`¡©s_£rv”_to_m‘ric
(
ùx
, 
£rv”
, 
fidx
);

1357 
	`ASSERT
(
¡m
->
ty³
 =ğ
STATS_GAUGE
);

1358 
¡m
->
v®ue
.
couÁ”
--;

1360 
	`log_debug
(
LOG_VVVERB
, "deü f›ld '%.*s'Ø%"
PRId64
"", 
¡m
->
Çme
.
Ën
,

1361 
¡m
->
Çme
.
d©a
, stm->
v®ue
.
couÁ”
);

1362 
	}
}

1365 
	$_¡©s_£rv”_šü_by
(
cÚ‹xt
 *
ùx
, 
£rv”
 *server,

1366 
¡©s_£rv”_f›ld_t
 
fidx
, 
št64_t
 
v®
)

1368 
¡©s_m‘ric
 *
¡m
;

1370 
¡m
 = 
	`¡©s_£rv”_to_m‘ric
(
ùx
, 
£rv”
, 
fidx
);

1372 
	`ASSERT
(
¡m
->
ty³
 =ğ
STATS_COUNTER
 || stm->ty³ =ğ
STATS_GAUGE
);

1373 
¡m
->
v®ue
.
couÁ”
 +ğ
v®
;

1375 
	`log_debug
(
LOG_VVVERB
, "šü by f›ld '%.*s'Ø%"
PRId64
"", 
¡m
->
Çme
.
Ën
,

1376 
¡m
->
Çme
.
d©a
, stm->
v®ue
.
couÁ”
);

1377 
	}
}

1380 
	$_¡©s_£rv”_deü_by
(
cÚ‹xt
 *
ùx
, 
£rv”
 *server,

1381 
¡©s_£rv”_f›ld_t
 
fidx
, 
št64_t
 
v®
)

1383 
¡©s_m‘ric
 *
¡m
;

1385 
¡m
 = 
	`¡©s_£rv”_to_m‘ric
(
ùx
, 
£rv”
, 
fidx
);

1387 
	`ASSERT
(
¡m
->
ty³
 =ğ
STATS_GAUGE
);

1388 
¡m
->
v®ue
.
couÁ”
 -ğ
v®
;

1390 
	`log_debug
(
LOG_VVVERB
, "deü by f›ld '%.*s'Ø%"
PRId64
"", 
¡m
->
Çme
.
Ën
,

1391 
¡m
->
Çme
.
d©a
, stm->
v®ue
.
couÁ”
);

1392 
	}
}

1395 
	$_¡©s_£rv”_£t_ts
(
cÚ‹xt
 *
ùx
, 
£rv”
 *server,

1396 
¡©s_£rv”_f›ld_t
 
fidx
, 
št64_t
 
v®
)

1398 
¡©s_m‘ric
 *
¡m
;

1400 
¡m
 = 
	`¡©s_£rv”_to_m‘ric
(
ùx
, 
£rv”
, 
fidx
);

1402 
	`ASSERT
(
¡m
->
ty³
 =ğ
STATS_TIMESTAMP
);

1403 
¡m
->
v®ue
.
time¡amp
 = 
v®
;

1405 
	`log_debug
(
LOG_VVVERB
, "£ˆt f›ld '%.*s'Ø%"
PRId64
"", 
¡m
->
Çme
.
Ën
,

1406 
¡m
->
Çme
.
d©a
, stm->
v®ue
.
time¡amp
);

1407 
	}
}

	@nc_stats.h

18 #iâdeà
_NC_STATS_H_


19 
	#_NC_STATS_H_


	)

21 
	~<nc_cÜe.h
>

23 
	#STATS_POOL_CODEC
(
ACTION
) \

25 
	`ACTION
Ğ
ş›Á_eof
, 
STATS_COUNTER
, "#ƒof on client connections") \

26 
	`ACTION
Ğ
ş›Á_”r
, 
STATS_COUNTER
, "#ƒrrors on client connections") \

27 
	`ACTION
Ğ
ş›Á_cÚÃùiÚs
, 
STATS_GAUGE
, "#‡ctive client connections") \

29 
	`ACTION
Ğ
£rv”_ejeùs
, 
STATS_COUNTER
, "#imes backend server wasƒjected") \

31 
	`ACTION
Ğ
fÜw¬d_”rÜ
, 
STATS_COUNTER
, "#imes weƒncountered‡ forwardingƒrror") \

32 
	`ACTION
Ğ
äagm’ts
, 
STATS_COUNTER
, "# fragments created from‡ multi-vector„equest") \

33 
	`ACTION
Ğ
tÙ®_»que¡s
, 
STATS_COUNTER
, "#otal„equests of‡ll servers") \

34 
	`ACTION
Ğ
tÙ®_»que¡s_by‹s
, 
STATS_COUNTER
, "#otal„equests bytes of‡ll servers") \

35 
	`ACTION
Ğ
tÙ®_»¥Ú£s
, 
STATS_COUNTER
, "#otal„esponses of‡ll servers") \

36 
	`ACTION
Ğ
tÙ®_»¥Ú£s_by‹s
, 
STATS_COUNTER
, "#otal„esponses bytes of‡ll servers") \

37 
	`ACTION
Ğ
Ï‹ncy_mš
, 
STATS_COUNTER
, "min†atency (us) of‡ll„equests") \

38 
	`ACTION
Ğ
Ï‹ncy_max
, 
STATS_COUNTER
, "max†atency (us) of‡ll„equests") \

39 
	`ACTION
Ğ
Ï‹ncy_p50
, 
STATS_COUNTER
, "50\%†atency (us) of‡ll„equests") \

40 
	`ACTION
Ğ
Ï‹ncy_p90
, 
STATS_COUNTER
, "90\%†atency (us) of‡ll„equests") \

41 
	`ACTION
Ğ
Ï‹ncy_p95
, 
STATS_COUNTER
, "95\%†atency (us) of‡ll„equests") \

42 
	`ACTION
Ğ
Ï‹ncy_p99
, 
STATS_COUNTER
, "99\%†atency (us) of‡ll„equests") \

43 

	)

44 
	#STATS_SERVER_CODEC
(
ACTION
) \

46 
	`ACTION
Ğ
£rv”_eof
, 
STATS_COUNTER
, "#ƒof on server connections") \

47 
	`ACTION
Ğ
£rv”_”r
, 
STATS_COUNTER
, "#ƒrrors on server connections") \

48 
	`ACTION
Ğ
£rv”_timedout
, 
STATS_COUNTER
, "#imeouts on server connections") \

49 
	`ACTION
Ğ
£rv”_cÚÃùiÚs
, 
STATS_GAUGE
, "#‡ctive server connections") \

50 
	`ACTION
Ğ
£rv”_ejeùed_©
, 
STATS_TIMESTAMP
, "timestamp when server wasƒjected in usec sinceƒpoch") \

52 
	`ACTION
Ğ
»que¡s
, 
STATS_COUNTER
, "#„equests") \

53 
	`ACTION
Ğ
»que¡_by‹s
, 
STATS_COUNTER
, "total„equest bytes") \

54 
	`ACTION
Ğ
»¥Ú£s
, 
STATS_COUNTER
, "#„esponses") \

55 
	`ACTION
Ğ
»¥Ú£_by‹s
, 
STATS_COUNTER
, "total„esponse bytes") \

56 
	`ACTION
Ğ
š_queue
, 
STATS_GAUGE
, "#„equests in incoming queue") \

57 
	`ACTION
Ğ
š_queue_by‹s
, 
STATS_GAUGE
, "current„equest bytes in incoming queue") \

58 
	`ACTION
Ğ
out_queue
, 
STATS_GAUGE
, "#„equests in outgoing queue") \

59 
	`ACTION
Ğ
out_queue_by‹s
, 
STATS_GAUGE
, "current„equest bytes in outgoing queue") \

60 

	)

61 
	#STATS_ADDR
 "0.0.0.0"

	)

62 
	#STATS_PORT
 22222

	)

63 
	#STATS_INTERVAL
 (10 * 1000è

	)

65 
	e¡©s_ty³
 {

66 
	mSTATS_INVALID
,

67 
	mSTATS_COUNTER
,

68 
	mSTATS_GAUGE
,

69 
	mSTATS_TIMESTAMP
,

70 
	mSTATS_SENTINEL


71 } 
	t¡©s_ty³_t
;

73 
	s¡©s_m‘ric
 {

74 
¡©s_ty³_t
 
	mty³
;

75 
¡ršg
 
	mÇme
;

77 
št64_t
 
	mcouÁ”
;

78 
št64_t
 
	mtime¡amp
;

79 } 
	mv®ue
;

82 
	s¡©s_£rv”
 {

83 
¡ršg
 
	mÇme
;

84 
¬¿y
 
	mm‘ric
;

87 
	s¡©s_poŞ
 {

88 
¡ršg
 
	mÇme
;

89 
¬¿y
 
	mm‘ric
;

90 
¬¿y
 
	m£rv”
;

93 
	s¡©s_bufãr
 {

94 
size_t
 
	mËn
;

95 
ušt8_t
 *
	md©a
;

96 
size_t
 
	msize
;

99 
	s¡©s
 {

102 
ušt16_t
 
	mpÜt
;

103 
	mš‹rv®
;

104 
¡ršg
 
	maddr
;

106 
št64_t
 
	m¡¬t_ts
;

107 
¡©s_bufãr
 
	mbuf
;

109 
¬¿y
 
	mcu¼’t
;

110 
¬¿y
 
	mshadow
;

111 
¬¿y
 
	msum
;

113 
±h»ad_t
 
	mtid
;

114 
	msd
;

116 
¡ršg
 
	m£rviû_¡r
;

117 
¡ršg
 
	m£rviû
;

118 
¡ršg
 
	msourû_¡r
;

119 
¡ršg
 
	msourû
;

120 
¡ršg
 
	mv”siÚ_¡r
;

121 
¡ršg
 
	mv”siÚ
;

122 
¡ršg
 
	mu±ime_¡r
;

123 
¡ršg
 
	mtime¡amp_¡r
;

124 
¡ršg
 
	mÁÙ®_cÚn_¡r
;

125 
¡ršg
 
	mncu¼_cÚn_¡r
;

126 
¡ršg
 
	m´oxy_addr_¡r
;

127 
¡ršg
 
	m´oxy_addr
;

129 vŞ©
	magg»g©e
;

130 vŞ©
	mupd©ed
;

132 
cÚ‹xt
 *
	mcÚ‹xt
;

133 
±h»ad_mu‹x_t
 
	mlock
;

137 
	mmax_®lowed_£rv”s
;

138 
	mcu¼_£rv”s
;

141 
	#DEFINE_ACTION
(
_Çme
, 
_ty³
, 
_desc
è
STATS_POOL_
##_Çme,

	)

142 
	e¡©s_poŞ_f›ld
 {

143 
STATS_POOL_CODEC
(
DEFINE_ACTION
)

144 
	mSTATS_POOL_NFIELD


145 } 
	t¡©s_poŞ_f›ld_t
;

146 #undeà
DEFINE_ACTION


148 
	#DEFINE_ACTION
(
_Çme
, 
_ty³
, 
_desc
è
STATS_SERVER_
##_Çme,

	)

149 
	e¡©s_£rv”_f›ld
 {

150 
STATS_SERVER_CODEC
(
DEFINE_ACTION
)

151 
	mSTATS_SERVER_NFIELD


152 } 
	t¡©s_£rv”_f›ld_t
;

153 #undeà
DEFINE_ACTION


155 #ià
defšed
 
NC_STATS
 && NC_STATS == 1

157 
	#¡©s_poŞ_šü
(
_ùx
, 
_poŞ
, 
_Çme
) do { \

158 
	`_¡©s_poŞ_šü
(
_ùx
, 
_poŞ
, 
STATS_POOL_
##
_Çme
); \

159 } 0)

	)

161 
	#¡©s_poŞ_deü
(
_ùx
, 
_poŞ
, 
_Çme
) do { \

162 
	`_¡©s_poŞ_deü
(
_ùx
, 
_poŞ
, 
STATS_POOL_
##
_Çme
); \

163 } 0)

	)

165 
	#¡©s_poŞ_šü_by
(
_ùx
, 
_poŞ
, 
_Çme
, 
_v®
) do { \

166 
	`_¡©s_poŞ_šü_by
(
_ùx
, 
_poŞ
, 
STATS_POOL_
##
_Çme
, 
_v®
); \

167 } 0)

	)

169 
	#¡©s_poŞ_deü_by
(
_ùx
, 
_poŞ
, 
_Çme
, 
_v®
) do { \

170 
	`_¡©s_poŞ_deü_by
(
_ùx
, 
_poŞ
, 
STATS_POOL_
##
_Çme
, 
_v®
); \

171 } 0)

	)

173 
	#¡©s_poŞ_£t_ts
(
_ùx
, 
_poŞ
, 
_Çme
, 
_v®
) do { \

174 
	`_¡©s_poŞ_£t_ts
(
_ùx
, 
_poŞ
, 
STATS_POOL_
##
_Çme
, 
_v®
); \

175 } 0)

	)

177 
	#¡©s_£rv”_šü
(
_ùx
, 
_£rv”
, 
_Çme
) do { \

178 
	`_¡©s_£rv”_šü
(
_ùx
, 
_£rv”
, 
STATS_SERVER_
##
_Çme
); \

179 } 0)

	)

181 
	#¡©s_£rv”_deü
(
_ùx
, 
_£rv”
, 
_Çme
) do { \

182 
	`_¡©s_£rv”_deü
(
_ùx
, 
_£rv”
, 
STATS_SERVER_
##
_Çme
); \

183 } 0)

	)

185 
	#¡©s_£rv”_šü_by
(
_ùx
, 
_£rv”
, 
_Çme
, 
_v®
) do { \

186 
	`_¡©s_£rv”_šü_by
(
_ùx
, 
_£rv”
, 
STATS_SERVER_
##
_Çme
, 
_v®
); \

187 } 0)

	)

189 
	#¡©s_£rv”_deü_by
(
_ùx
, 
_£rv”
, 
_Çme
, 
_v®
) do { \

190 
	`_¡©s_£rv”_deü_by
(
_ùx
, 
_£rv”
, 
STATS_SERVER_
##
_Çme
, 
_v®
); \

191 } 0)

	)

193 
	#¡©s_£rv”_£t_ts
(
_ùx
, 
_£rv”
, 
_Çme
, 
_v®
) do { \

194 
	`_¡©s_£rv”_£t_ts
(
_ùx
, 
_£rv”
, 
STATS_SERVER_
##
_Çme
, 
_v®
); \

195 } 0)

	)

199 
	#¡©s_poŞ_šü
(
_ùx
, 
_poŞ
, 
_Çme
)

	)

201 
	#¡©s_poŞ_deü
(
_ùx
, 
_poŞ
, 
_Çme
)

	)

203 
	#¡©s_poŞ_šü_by
(
_ùx
, 
_poŞ
, 
_Çme
, 
_v®
)

	)

205 
	#¡©s_poŞ_deü_by
(
_ùx
, 
_poŞ
, 
_Çme
, 
_v®
)

	)

207 
	#¡©s_£rv”_šü
(
_ùx
, 
_£rv”
, 
_Çme
)

	)

209 
	#¡©s_£rv”_deü
(
_ùx
, 
_£rv”
, 
_Çme
)

	)

211 
	#¡©s_£rv”_šü_by
(
_ùx
, 
_£rv”
, 
_Çme
, 
_v®
)

	)

213 
	#¡©s_£rv”_deü_by
(
_ùx
, 
_£rv”
, 
_Çme
, 
_v®
)

	)

217 
	#¡©s_’abËd
 
NC_STATS


	)

219 
¡©s_desüibe
();

221 
_¡©s_poŞ_šü
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
, 
¡©s_poŞ_f›ld_t
 
fidx
);

222 
_¡©s_poŞ_deü
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
, 
¡©s_poŞ_f›ld_t
 
fidx
);

223 
_¡©s_poŞ_šü_by
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
, 
¡©s_poŞ_f›ld_t
 
fidx
, 
št64_t
 
v®
);

224 
_¡©s_poŞ_deü_by
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
, 
¡©s_poŞ_f›ld_t
 
fidx
, 
št64_t
 
v®
);

225 
_¡©s_poŞ_£t_ts
(
cÚ‹xt
 *
ùx
, 
£rv”_poŞ
 *
poŞ
, 
¡©s_poŞ_f›ld_t
 
fidx
, 
št64_t
 
v®
);

227 
_¡©s_£rv”_šü
(
cÚ‹xt
 *
ùx
, 
£rv”
 *£rv”, 
¡©s_£rv”_f›ld_t
 
fidx
);

228 
_¡©s_£rv”_deü
(
cÚ‹xt
 *
ùx
, 
£rv”
 *£rv”, 
¡©s_£rv”_f›ld_t
 
fidx
);

229 
_¡©s_£rv”_šü_by
(
cÚ‹xt
 *
ùx
, 
£rv”
 *£rv”, 
¡©s_£rv”_f›ld_t
 
fidx
, 
št64_t
 
v®
);

230 
_¡©s_£rv”_deü_by
(
cÚ‹xt
 *
ùx
, 
£rv”
 *£rv”, 
¡©s_£rv”_f›ld_t
 
fidx
, 
št64_t
 
v®
);

231 
_¡©s_£rv”_£t_ts
(
cÚ‹xt
 *
ùx
, 
£rv”
 *£rv”, 
¡©s_£rv”_f›ld_t
 
fidx
, 
št64_t
 
v®
);

233 
¡©s
 *
¡©s_ü—‹
(
š¡ªû
 *
nci
, 
¬¿y
 *
£rv”_poŞ
);

234 
¡©s_de¡roy
(
¡©s
 *stats);

235 
¡©s_sw­
(
¡©s
 *stats);

237 
r¡©us_t
 
add_£rv”_to_¡©s_poŞ
(
¡©s_poŞ
 *
¡p
, 
£rv”
 *
¤v
);

238 
¡©s_lock
(
¡©s
 *
¡
);

239 
¡©s_uÆock
(
¡©s
 *
¡
);

	@nc_string.c

18 
	~<¡dlib.h
>

19 
	~<¡ršg.h
>

21 
	~<nc_cÜe.h
>

41 
	$¡ršg_š™
(
¡ršg
 *
¡r
)

43 
¡r
->
Ën
 = 0;

44 
¡r
->
d©a
 = 
NULL
;

45 
	}
}

48 
	$¡ršg_deš™
(
¡ršg
 *
¡r
)

50 
	`ASSERT
((
¡r
->
Ën
 =ğ0 && sŒ->
d©a
 =ğ
NULL
) ||

51 (
¡r
->
Ën
 !ğ0 && sŒ->
d©a
 !ğ
NULL
));

53 ià(
¡r
->
d©a
 !ğ
NULL
) {

54 
	`nc_ä“
(
¡r
->
d©a
);

55 
	`¡ršg_š™
(
¡r
);

57 
	}
}

59 
boŞ


60 
	$¡ršg_em±y
(cÚ¡ 
¡ršg
 *
¡r
)

62 
	`ASSERT
((
¡r
->
Ën
 =ğ0 && sŒ->
d©a
 =ğ
NULL
) ||

63 (
¡r
->
Ën
 !ğ0 && sŒ->
d©a
 !ğ
NULL
));

64  
¡r
->
Ën
 =ğ0 ? 
Œue
 : 
çl£
;

65 
	}
}

67 
r¡©us_t


68 
	$¡ršg_du¶iÿ‹
(
¡ršg
 *
d¡
, cÚ¡ ¡ršg *
¤c
)

70 
	`ASSERT
(
d¡
->
Ën
 =ğ0 && d¡->
d©a
 =ğ
NULL
);

71 
	`ASSERT
(
¤c
->
Ën
 !ğ0 && src->
d©a
 !ğ
NULL
);

73 
d¡
->
d©a
 = 
	`nc_¡ºdup
(
¤c
->d©a, src->
Ën
 + 1);

74 ià(
d¡
->
d©a
 =ğ
NULL
) {

75  
NC_ENOMEM
;

78 
d¡
->
Ën
 = 
¤c
->len;

79 
d¡
->
d©a
[d¡->
Ën
] = '\0';

81  
NC_OK
;

82 
	}
}

84 
r¡©us_t


85 
	$¡ršg_cİy
(
¡ršg
 *
d¡
, cÚ¡ 
ušt8_t
 *
¤c
, 
ušt32_t
 
¤ş’
)

87 
	`ASSERT
(
d¡
->
Ën
 =ğ0 && d¡->
d©a
 =ğ
NULL
);

88 
	`ASSERT
(
¤c
 !ğ
NULL
 && 
¤ş’
 != 0);

90 
d¡
->
d©a
 = 
	`nc_¡ºdup
(
¤c
, 
¤ş’
 + 1);

91 ià(
d¡
->
d©a
 =ğ
NULL
) {

92  
NC_ENOMEM
;

95 
d¡
->
Ën
 = 
¤ş’
;

96 
d¡
->
d©a
[d¡->
Ën
] = '\0';

98  
NC_OK
;

99 
	}
}

102 
	$¡ršg_com·»
(cÚ¡ 
¡ršg
 *
s1
, cÚ¡ ¡ršg *
s2
)

104 ià(
s1
->
Ën
 !ğ
s2
->len) {

105  
s1
->
Ën
 > 
s2
->len ? 1 : -1;

108  
	`nc_¡ºcmp
(
s1
->
d©a
, 
s2
->d©a, s1->
Ën
);

109 
	}
}

112 
	$_§ã_utß
(
_ba£
, 
ušt64_t
 
v®
, *
buf
)

114 
hex
[] = "0123456789abcdef";

115 
ušt32_t
 
ba£
 = (ušt32_tè
_ba£
;

116 *
buf
-- = 0;

118 *
buf
-- = 
hex
[
v®
 % 
ba£
];

119 } (
v®
 /ğ
ba£
) != 0);

120  
buf
 + 1;

121 
	}
}

124 
	$_§ã_™ß
(
ba£
, 
št64_t
 
v®
, *
buf
)

126 
hex
[] = "0123456789abcdef";

127 *
Üig_buf
 = 
buf
;

128 cÚ¡ 
št32_t
 
is_Ãg
 = (
v®
 < 0);

129 *
buf
-- = 0;

131 ià(
is_Ãg
) {

132 
v®
 = -val;

134 ià(
is_Ãg
 && 
ba£
 == 16) {

135 
ix
;

136 
v®
 -= 1;

137 
ix
 = 0; ix < 16; ++ix)

138 
buf
[-
ix
] = '0';

142 *
buf
-- = 
hex
[
v®
 % 
ba£
];

143 } (
v®
 /ğ
ba£
) != 0);

145 ià(
is_Ãg
 && 
ba£
 == 10) {

146 *
buf
-- = '-';

149 ià(
is_Ãg
 && 
ba£
 == 16) {

150 
ix
;

151 
buf
 = 
Üig_buf
 - 1;

152 
ix
 = 0; ix < 16; ++ix, --
buf
) {

154 *
buf
) {

155 '0': *
buf
 = 'f'; ;

156 '1': *
buf
 = 'e'; ;

157 '2': *
buf
 = 'd'; ;

158 '3': *
buf
 = 'c'; ;

159 '4': *
buf
 = 'b'; ;

160 '5': *
buf
 = 'a'; ;

161 '6': *
buf
 = '9'; ;

162 '7': *
buf
 = '8'; ;

163 '8': *
buf
 = '7'; ;

164 '9': *
buf
 = '6'; ;

165 'a': *
buf
 = '5'; ;

166 'b': *
buf
 = '4'; ;

167 'c': *
buf
 = '3'; ;

168 'd': *
buf
 = '2'; ;

169 'e': *
buf
 = '1'; ;

170 'f': *
buf
 = '0'; ;

175  
buf
 + 1;

176 
	}
}

179 
	$_§ã_check_lÚglÚg
(cÚ¡ *
fmt
, 
št32_t
 * 
have_lÚglÚg
)

181 *
have_lÚglÚg
 = 
çl£
;

182 ià(*
fmt
 == 'l') {

183 
fmt
++;

184 ià(*
fmt
 != 'l') {

185 *
have_lÚglÚg
 = ((è=ğ(
št64_t
));

187 
fmt
++;

188 *
have_lÚglÚg
 = 
Œue
;

191  
fmt
;

192 
	}
}

195 
	$_§ã_v¢´štf
(*
to
, 
size_t
 
size
, cÚ¡ *
fÜm©
, 
va_li¡
 
­
)

197 *
¡¬t
 = 
to
;

198 *
’d
 = 
¡¬t
 + 
size
 - 1;

199 ; *
fÜm©
; ++format) {

200 
št32_t
 
have_lÚglÚg
 = 
çl£
;

201 ià(*
fÜm©
 != '%') {

202 ià(
to
 =ğ
’d
) {

205 *
to
++ = *
fÜm©
;

208 ++
fÜm©
;

210 
fÜm©
 = 
	`_§ã_check_lÚglÚg
(fÜm©, &
have_lÚglÚg
);

212 *
fÜm©
) {

219 
št64_t
 
iv®
 = 0;

220 
ušt64_t
 
uv®
 = 0;

221 ià(*
fÜm©
 == 'p')

222 
have_lÚglÚg
 = ((*è=ğ(
ušt64_t
));

223 ià(
have_lÚglÚg
) {

224 ià(*
fÜm©
 == 'u') {

225 
uv®
 = 
	`va_¬g
(
­
, 
ušt64_t
);

227 
iv®
 = 
	`va_¬g
(
­
, 
št64_t
);

230 ià(*
fÜm©
 == 'u') {

231 
uv®
 = 
	`va_¬g
(
­
, 
ušt32_t
);

233 
iv®
 = 
	`va_¬g
(
­
, 
št32_t
);

238 
buff
[22];

239 cÚ¡ 
ba£
 = (*
fÜm©
 == 'x' || *format == 'p') ? 16 : 10;

242 *
v®_as_¡r
 = (*
fÜm©
 == 'u') ?

243 
	`_§ã_utß
(
ba£
, 
uv®
, &
buff
[(buff) - 1]) :

244 
	`_§ã_™ß
(
ba£
, 
iv®
, &
buff
[(buff) - 1]);

248 ià(*
fÜm©
 =ğ'x' && !
have_lÚglÚg
 && 
iv®
 < 0) {

249 
v®_as_¡r
 += 8;

252 *
v®_as_¡r
 && 
to
 < 
’d
) {

253 *
to
++ = *
v®_as_¡r
++;

260 cÚ¡ *
v®
 = 
	`va_¬g
(
­
, *);

261 ià(!
v®
) {

262 
v®
 = "(null)";

264 *
v®
 && 
to
 < 
’d
) {

265 *
to
++ = *
v®
++;

271 *
to
 = 0;

272  ()(
to
 - 
¡¬t
);

273 
	}
}

276 
	$_§ã_¢´štf
(*
to
, 
size_t
 
n
, cÚ¡ *
fmt
, ...)

278 
»suÉ
;

279 
va_li¡
 
¬gs
;

280 
	`va_¡¬t
(
¬gs
, 
fmt
);

281 
»suÉ
 = 
	`_§ã_v¢´štf
(
to
, 
n
, 
fmt
, 
¬gs
);

282 
	`va_’d
(
¬gs
);

283  
»suÉ
;

284 
	}
}

	@nc_string.h

18 #iâdeà
_NC_STRING_H_


19 
	#_NC_STRING_H_


	)

21 
	~<¡ršg.h
>

22 
	~<sys/ty³s.h
>

23 
	~<¡d¬g.h
>

25 
	~<nc_cÜe.h
>

27 
	s¡ršg
 {

28 
ušt32_t
 
	mËn
;

29 
ušt8_t
 *
	md©a
;

32 
	#¡ršg
(
_¡r
è{ (_¡rè- 1, (
ušt8_t
 *)(_¡rè}

	)

33 
	#nuÎ_¡ršg
 { 0, 
NULL
 }

	)

35 
	#¡ršg_£t_‹xt
(
_¡r
, 
_‹xt
) do { \

36 (
_¡r
)->
Ën
 = (
ušt32_t
)((
_‹xt
) - 1);\

37 (
_¡r
)->
d©a
 = (
ušt8_t
 *)(
_‹xt
); \

38 } 0);

	)

40 
	#¡ršg_£t_¿w
(
_¡r
, 
_¿w
) do { \

41 (
_¡r
)->
Ën
 = (
ušt32_t
)(
	`nc_¡¾’
(
_¿w
)); \

42 (
_¡r
)->
d©a
 = (
ušt8_t
 *)(
_¿w
); \

43 } 0);

	)

45 
¡ršg_š™
(
¡ršg
 *
¡r
);

46 
¡ršg_deš™
(
¡ršg
 *
¡r
);

47 
boŞ
 
¡ršg_em±y
(cÚ¡ 
¡ršg
 *
¡r
);

48 
r¡©us_t
 
¡ršg_du¶iÿ‹
(
¡ršg
 *
d¡
, cÚ¡ ¡ršg *
¤c
);

49 
r¡©us_t
 
¡ršg_cİy
(
¡ršg
 *
d¡
, cÚ¡ 
ušt8_t
 *
¤c
, 
ušt32_t
 
¤ş’
);

50 
¡ršg_com·»
(cÚ¡ 
¡ršg
 *
s1
, cÚ¡ ¡ršg *
s2
);

56 
	#nc_memıy
(
_d
, 
_c
, 
_n
) \

57 
	`memıy
(
_d
, 
_c
, (
size_t
)(
_n
))

	)

59 
	#nc_memmove
(
_d
, 
_c
, 
_n
) \

60 
	`memmove
(
_d
, 
_c
, (
size_t
)(
_n
))

	)

62 
	#nc_memchr
(
_d
, 
_c
, 
_n
) \

63 
	`memchr
(
_d
, 
_c
, (
size_t
)(
_n
))

	)

65 
	#nc_¡¾’
(
_s
) \

66 
	`¡¾’
((*)(
_s
))

	)

68 
	#nc_¡ºcmp
(
_s1
, 
_s2
, 
_n
) \

69 
	`¡ºcmp
((*)(
_s1
), (*)(
_s2
), (
size_t
)(
_n
))

	)

71 
	#nc_¡rchr
(
_p
, 
_l
, 
_c
) \

72 
	`_nc_¡rchr
((
ušt8_t
 *)(
_p
), (ušt8_ˆ*)(
_l
), (ušt8_t)(
_c
))

	)

74 
	#nc_¡¼chr
(
_p
, 
_s
, 
_c
) \

75 
	`_nc_¡¼chr
((
ušt8_t
 *)(
_p
),(ušt8_ˆ*)(
_s
), (ušt8_t)(
_c
))

	)

77 
	#nc_¡ºdup
(
_s
, 
_n
) \

78 (
ušt8_t
 *)
	`¡ºdup
((*)(
_s
), (
size_t
)(
_n
));

	)

94 
	#nc_¢´štf
(
_s
, 
_n
, ...) \

95 
	`¢´štf
((*)(
_s
), (
size_t
)(
_n
), 
__VA_ARGS__
)

	)

97 
	#nc_sú´štf
(
_s
, 
_n
, ...) \

98 
	`_sú´štf
((*)(
_s
), (
size_t
)(
_n
), 
__VA_ARGS__
)

	)

100 
	#nc_v¢´štf
(
_s
, 
_n
, 
_f
, 
_a
) \

101 
	`v¢´štf
((*)(
_s
), (
size_t
)(
_n
), 
_f
, 
_a
)

	)

103 
	#nc_vsú´štf
(
_s
, 
_n
, 
_f
, 
_a
) \

104 
	`_vsú´štf
((*)(
_s
), (
size_t
)(
_n
), 
_f
, 
_a
)

	)

106 
	#nc_¡ráime
(
_s
, 
_n
, 
fmt
, 
tm
) \

107 ()
	`¡ráime
((*)(
_s
), (
size_t
)(
_n
), 
fmt
, 
tm
)

	)

120 
_§ã_v¢´štf
(*
to
, 
size_t
 
size
, cÚ¡ *
fÜm©
, 
va_li¡
 
­
);

121 
_§ã_¢´štf
(*
to
, 
size_t
 
n
, cÚ¡ *
fmt
, ...);

123 
	#nc_§ã_¢´štf
(
_s
, 
_n
, ...) \

124 
	`_§ã_¢´štf
((*)(
_s
), (
size_t
)(
_n
), 
__VA_ARGS__
)

	)

126 
	#nc_§ã_v¢´štf
(
_s
, 
_n
, 
_f
, 
_a
) \

127 
	`_§ã_v¢´štf
((*)(
_s
), (
size_t
)(
_n
), 
_f
, 
_a
)

	)

129 
šlše
 
ušt8_t
 *

130 
	$_nc_¡rchr
(
ušt8_t
 *
p
, ušt8_ˆ*
Ï¡
, ušt8_ˆ
c
)

132 
p
 < 
Ï¡
) {

133 ià(*
p
 =ğ
c
) {

134  
p
;

136 
p
++;

139  
NULL
;

140 
	}
}

142 
šlše
 
ušt8_t
 *

143 
	$_nc_¡¼chr
(
ušt8_t
 *
p
, ušt8_ˆ*
¡¬t
, ušt8_ˆ
c
)

145 
p
 >ğ
¡¬t
) {

146 ià(*
p
 =ğ
c
) {

147  
p
;

149 
p
--;

152  
NULL
;

153 
	}
}

	@nc_util.c

18 
	~<¡dio.h
>

19 
	~<¡dlib.h
>

20 
	~<¡d¬g.h
>

21 
	~<¡ršg.h
>

22 
	~<time.h
>

23 
	~<uni¡d.h
>

24 
	~<fú.h
>

25 
	~<Ãtdb.h
>

27 
	~<sys/time.h
>

28 
	~<sys/ty³s.h
>

29 
	~<sys/sock‘.h
>

30 
	~<sys/ioùl.h
>

32 
	~<Ãtš‘/š.h
>

33 
	~<Ãtš‘/tı.h
>

35 
	~<nc_cÜe.h
>

37 #ifdeà
NC_HAVE_BACKTRACE


38 
	~<execšfo.h
>

42 
	$nc_£t_blockšg
(
sd
)

44 
æags
;

46 
æags
 = 
	`fú
(
sd
, 
F_GETFL
, 0);

47 ià(
æags
 < 0) {

48  
æags
;

51  
	`fú
(
sd
, 
F_SETFL
, 
æags
 & ~
O_NONBLOCK
);

52 
	}
}

55 
	$nc_£t_nÚblockšg
(
sd
)

57 
æags
;

59 
æags
 = 
	`fú
(
sd
, 
F_GETFL
, 0);

60 ià(
æags
 < 0) {

61  
æags
;

64  
	`fú
(
sd
, 
F_SETFL
, 
æags
 | 
O_NONBLOCK
);

65 
	}
}

68 
	$nc_£t_»u£addr
(
sd
)

70 
»u£
;

71 
sockËn_t
 
Ën
;

73 
»u£
 = 1;

74 
Ën
 = (
»u£
);

76  
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
»u£
, 
Ën
);

77 
	}
}

88 
	$nc_£t_tınod–ay
(
sd
)

90 
nod–ay
;

91 
sockËn_t
 
Ën
;

93 
nod–ay
 = 1;

94 
Ën
 = (
nod–ay
);

96  
	`£tsockİt
(
sd
, 
IPPROTO_TCP
, 
TCP_NODELAY
, &
nod–ay
, 
Ën
);

97 
	}
}

100 
	$nc_£t_lšg”
(
sd
, 
timeout
)

102 
lšg”
†inger;

103 
sockËn_t
 
Ën
;

105 
lšg”
.
l_Úoff
 = 1;

106 
lšg”
.
l_lšg”
 = 
timeout
;

108 
Ën
 = (
lšg”
);

110  
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_LINGER
, &
lšg”
, 
Ën
);

111 
	}
}

114 
	$nc_£t_tık“·live
(
sd
)

116 
v®
 = 1;

117  
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_KEEPALIVE
, &
v®
, (val));

118 
	}
}

121 
	$nc_£t_¢dbuf
(
sd
, 
size
)

123 
sockËn_t
 
Ën
;

125 
Ën
 = (
size
);

127  
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
size
, 
Ën
);

128 
	}
}

131 
	$nc_£t_rcvbuf
(
sd
, 
size
)

133 
sockËn_t
 
Ën
;

135 
Ën
 = (
size
);

137  
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
size
, 
Ën
);

138 
	}
}

141 
	$nc_g‘_sÛ¼Ü
(
sd
)

143 
¡©us
, 
”r
;

144 
sockËn_t
 
Ën
;

146 
”r
 = 0;

147 
Ën
 = (
”r
);

149 
¡©us
 = 
	`g‘sockİt
(
sd
, 
SOL_SOCKET
, 
SO_ERROR
, &
”r
, &
Ën
);

150 ià(
¡©us
 == 0) {

151 
”ºo
 = 
”r
;

154  
¡©us
;

155 
	}
}

158 
	$nc_g‘_¢dbuf
(
sd
)

160 
¡©us
, 
size
;

161 
sockËn_t
 
Ën
;

163 
size
 = 0;

164 
Ën
 = (
size
);

166 
¡©us
 = 
	`g‘sockİt
(
sd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
size
, &
Ën
);

167 ià(
¡©us
 < 0) {

168  
¡©us
;

171  
size
;

172 
	}
}

175 
	$nc_g‘_rcvbuf
(
sd
)

177 
¡©us
, 
size
;

178 
sockËn_t
 
Ën
;

180 
size
 = 0;

181 
Ën
 = (
size
);

183 
¡©us
 = 
	`g‘sockİt
(
sd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
size
, &
Ën
);

184 ià(
¡©us
 < 0) {

185  
¡©us
;

188  
size
;

189 
	}
}

192 
	$_nc_©oi
(
ušt8_t
 *
lše
, 
size_t
 
n
)

194 
v®ue
;

196 ià(
n
 == 0) {

200 
v®ue
 = 0; 
n
--; 
lše
++) {

201 ià(*
lše
 < '0' || *line > '9') {

205 
v®ue
 = v®u* 10 + (*
lše
 - '0');

208 ià(
v®ue
 < 0) {

212  
v®ue
;

213 
	}
}

215 
boŞ


216 
	$nc_v®id_pÜt
(
n
)

218 ià(
n
 < 1 ||‚ > 
UINT16_MAX
) {

219  
çl£
;

222  
Œue
;

223 
	}
}

226 
	$_nc_®loc
(
size_t
 
size
, cÚ¡ *
Çme
, 
lše
)

228 *
p
;

230 
	`ASSERT
(
size
 != 0);

232 
p
 = 
	`m®loc
(
size
);

233 ià(
p
 =ğ
NULL
) {

234 
	`log_”rÜ
("m®loc(%zuèçed @ %s:%d", 
size
, 
Çme
, 
lše
);

236 
	`log_debug
(
LOG_VVERB
, "m®loc(%zuè© %°@ %s:%d", 
size
, 
p
, 
Çme
, 
lše
);

239  
p
;

240 
	}
}

243 
	$_nc_z®loc
(
size_t
 
size
, cÚ¡ *
Çme
, 
lše
)

245 *
p
;

247 
p
 = 
	`_nc_®loc
(
size
, 
Çme
, 
lše
);

248 ià(
p
 !ğ
NULL
) {

249 
	`mem£t
(
p
, 0, 
size
);

252  
p
;

253 
	}
}

256 
	$_nc_ÿÎoc
(
size_t
 
nmemb
, size_ˆ
size
, cÚ¡ *
Çme
, 
lše
)

258  
	`_nc_z®loc
(
nmemb
 * 
size
, 
Çme
, 
lše
);

259 
	}
}

262 
	$_nc_»®loc
(*
±r
, 
size_t
 
size
, cÚ¡ *
Çme
, 
lše
)

264 *
p
;

266 
	`ASSERT
(
size
 != 0);

268 
p
 = 
	`»®loc
(
±r
, 
size
);

269 ià(
p
 =ğ
NULL
) {

270 
	`log_”rÜ
("»®loc(%zuèçed @ %s:%d", 
size
, 
Çme
, 
lše
);

272 
	`log_debug
(
LOG_VVERB
, "»®loc(%zuè© %°@ %s:%d", 
size
, 
p
, 
Çme
, 
lše
);

275  
p
;

276 
	}
}

279 
	$_nc_ä“
(*
±r
, cÚ¡ *
Çme
, 
lše
)

281 
	`ASSERT
(
±r
 !ğ
NULL
);

282 
	`log_debug
(
LOG_VVERB
, "ä“(%pè@ %s:%d", 
±r
, 
Çme
, 
lše
);

283 
	`ä“
(
±r
);

284 
	}
}

287 
	$nc_¡ackŒaû
(
sk_couÁ
)

289 #ifdeà
NC_HAVE_BACKTRACE


290 *
¡ack
[64];

291 **
symbŞs
;

292 
size
, 
i
, 
j
;

294 
size
 = 
	`backŒaû
(
¡ack
, 64);

295 
symbŞs
 = 
	`backŒaû_symbŞs
(
¡ack
, 
size
);

296 ià(
symbŞs
 =ğ
NULL
) {

300 
sk_couÁ
++;

302 
i
 = 
sk_couÁ
, 
j
 = 0; i < 
size
; i++, j++) {

303 
	`loga
("[%d] %s", 
j
, 
symbŞs
[
i
]);

306 
	`ä“
(
symbŞs
);

308 
	}
}

311 
	$nc_¡ackŒaû_fd
(
fd
)

313 #ifdeà
NC_HAVE_BACKTRACE


314 *
¡ack
[64];

315 
size
;

317 
size
 = 
	`backŒaû
(
¡ack
, 64);

318 
	`backŒaû_symbŞs_fd
(
¡ack
, 
size
, 
fd
);

320 
	}
}

323 
	$nc_as£¹
(cÚ¡ *
cÚd
, cÚ¡ *
fe
, 
lše
, 
·nic
)

325 
	`log_”rÜ
("as£¹ '%s' faed @ (%s, %d)", 
cÚd
, 
fe
, 
lše
);

326 ià(
·nic
) {

327 
	`nc_¡ackŒaû
(1);

328 
	`abÜt
();

330 
	}
}

333 
	$_vsú´štf
(*
buf
, 
size_t
 
size
, cÚ¡ *
fmt
, 
va_li¡
 
¬gs
)

335 
n
;

337 
n
 = 
	`v¢´štf
(
buf
, 
size
, 
fmt
, 
¬gs
);

349 ià(
n
 <= 0) {

353 ià(
n
 < (è
size
) {

354  
n
;

357  ()(
size
 - 1);

358 
	}
}

361 
	$_sú´štf
(*
buf
, 
size_t
 
size
, cÚ¡ *
fmt
, ...)

363 
va_li¡
 
¬gs
;

364 
n
;

366 
	`va_¡¬t
(
¬gs
, 
fmt
);

367 
n
 = 
	`_vsú´štf
(
buf
, 
size
, 
fmt
, 
¬gs
);

368 
	`va_’d
(
¬gs
);

370  
n
;

371 
	}
}

376 
ssize_t


377 
	$_nc_£ndn
(
sd
, cÚ¡ *
v±r
, 
size_t
 
n
)

379 
size_t
 
Æeá
;

380 
ssize_t
 
n£nd
;

381 cÚ¡ *
±r
;

383 
±r
 = 
v±r
;

384 
Æeá
 = 
n
;

385 
Æeá
 > 0) {

386 
n£nd
 = 
	`£nd
(
sd
, 
±r
, 
Æeá
, 0);

387 ià(
n£nd
 < 0) {

388 ià(
”ºo
 =ğ
EINTR
) {

391  
n£nd
;

393 ià(
n£nd
 == 0) {

397 
Æeá
 -ğ(
size_t
)
n£nd
;

398 
±r
 +ğ
n£nd
;

401  (
ssize_t
)
n
;

402 
	}
}

407 
ssize_t


408 
	$_nc_»cvn
(
sd
, *
v±r
, 
size_t
 
n
)

410 
size_t
 
Æeá
;

411 
ssize_t
 
Äecv
;

412 *
±r
;

414 
±r
 = 
v±r
;

415 
Æeá
 = 
n
;

416 
Æeá
 > 0) {

417 
Äecv
 = 
	`»cv
(
sd
, 
±r
, 
Æeá
, 0);

418 ià(
Äecv
 < 0) {

419 ià(
”ºo
 =ğ
EINTR
) {

422  
Äecv
;

424 ià(
Äecv
 == 0) {

428 
Æeá
 -ğ(
size_t
)
Äecv
;

429 
±r
 +ğ
Äecv
;

432  (
ssize_t
)(
n
 - 
Æeá
);

433 
	}
}

438 
št64_t


439 
	$nc_u£c_now
()

441 
timev®
 
now
;

442 
št64_t
 
u£c
;

443 
¡©us
;

445 
¡©us
 = 
	`g‘timeofday
(&
now
, 
NULL
);

446 ià(
¡©us
 < 0) {

447 
	`log_”rÜ
("g‘timeofday faed: %s", 
	`¡»¼Ü
(
”ºo
));

451 
u£c
 = (
št64_t
)
now
.
tv_£c
 * 1000000LL + (št64_têow.
tv_u£c
;

453  
u£c
;

454 
	}
}

459 
št64_t


460 
	$nc_m£c_now
()

462  
	`nc_u£c_now
() / 1000LL;

463 
	}
}

466 
	$nc_»sŞve_š‘
(
¡ršg
 *
Çme
, 
pÜt
, 
sockšfo
 *
si
)

468 
¡©us
;

469 
addršfo
 *
ai
, *
ÿi
;

470 
addršfo
 
hšts
;

471 *
node
, 
£rviû
[
NC_UINTMAX_MAXLEN
];

472 
boŞ
 
found
;

474 
	`ASSERT
(
	`nc_v®id_pÜt
(
pÜt
));

476 
	`mem£t
(&
hšts
, 0, (hints));

477 
hšts
.
ai_æags
 = 
AI_NUMERICSERV
;

478 
hšts
.
ai_çmy
 = 
AF_UNSPEC
;

479 
hšts
.
ai_sockty³
 = 
SOCK_STREAM
;

480 
hšts
.
ai_´ÙocŞ
 = 0;

481 
hšts
.
ai_add¾’
 = 0;

482 
hšts
.
ai_addr
 = 
NULL
;

483 
hšts
.
ai_ÿnÚÇme
 = 
NULL
;

485 ià(
Çme
 !ğ
NULL
) {

486 
node
 = (*)
Çme
->
d©a
;

494 
node
 = 
NULL
;

495 
hšts
.
ai_æags
 |ğ
AI_PASSIVE
;

498 
	`nc_¢´štf
(
£rviû
, 
NC_UINTMAX_MAXLEN
, "%d", 
pÜt
);

504 
¡©us
 = 
	`g‘addršfo
(
node
, 
£rviû
, &
hšts
, &
ai
);

505 ià(
¡©us
 != 0) {

506 
	`log_”rÜ
("address„esolution of‚ode '%s' service '%s' failed: %s",

507 
node
, 
£rviû
, 
	`gai_¡»¼Ü
(
¡©us
));

522 
ÿi
 = 
ai
, 
found
 = 
çl£
; ca˜!ğ
NULL
; ca˜ğÿi->
ai_Ãxt
) {

523 
si
->
çmy
 = 
ÿi
->
ai_çmy
;

524 
si
->
add¾’
 = 
ÿi
->
ai_add¾’
;

525 
	`nc_memıy
(&
si
->
addr
, 
ÿi
->
ai_addr
, si->
add¾’
);

526 
found
 = 
Œue
;

530 
	`ä“addršfo
(
ai
);

532  !
found
 ? -1 : 0;

533 
	}
}

536 
	$nc_»sŞve_unix
(
¡ršg
 *
Çme
, 
sockšfo
 *
si
)

538 
sockaddr_un
 *
un
;

540 ià(
Çme
->
Ën
 >ğ
NC_UNIX_ADDRSTRLEN
) {

544 
un
 = &
si
->
addr
.un;

546 
un
->
sun_çmy
 = 
AF_UNIX
;

547 
	`nc_memıy
(
un
->
sun_·th
, 
Çme
->
d©a
,‚ame->
Ën
);

548 
un
->
sun_·th
[
Çme
->
Ën
] = '\0';

550 
si
->
çmy
 = 
AF_UNIX
;

551 
si
->
add¾’
 = (*
un
);

555 
	}
}

564 
	$nc_»sŞve
(
¡ršg
 *
Çme
, 
pÜt
, 
sockšfo
 *
si
)

566 ià(
Çme
 !ğ
NULL
 &&‚ame->
d©a
[0] == '/') {

567  
	`nc_»sŞve_unix
(
Çme
, 
si
);

570  
	`nc_»sŞve_š‘
(
Çme
, 
pÜt
, 
si
);

571 
	}
}

580 
	$nc_uÄesŞve_addr
(
sockaddr
 *
addr
, 
sockËn_t
 
add¾’
)

582 
uÄesŞve
[
NI_MAXHOST
 + 
NI_MAXSERV
];

583 
ho¡
[
NI_MAXHOST
], 
£rviû
[
NI_MAXSERV
];

584 
¡©us
;

586 
¡©us
 = 
	`g‘Çmešfo
(
addr
, 
add¾’
, 
ho¡
, (host),

587 
£rviû
, (service),

588 
NI_NUMERICHOST
 | 
NI_NUMERICSERV
);

589 ià(
¡©us
 < 0) {

593 
	`nc_¢´štf
(
uÄesŞve
, (uÄesŞve), "%s:%s", 
ho¡
, 
£rviû
);

595  
uÄesŞve
;

596 
	}
}

605 
	$nc_uÄesŞve_³”_desc
(
sd
)

607 
sockšfo
 
si
;

608 
sockaddr
 *
addr
;

609 
sockËn_t
 
add¾’
;

610 
¡©us
;

612 
	`mem£t
(&
si
, 0, (si));

613 
addr
 = (
sockaddr
 *)&
si
.addr;

614 
add¾’
 = (
si
.
addr
);

616 
¡©us
 = 
	`g‘³”Çme
(
sd
, 
addr
, &
add¾’
);

617 ià(
¡©us
 < 0) {

621  
	`nc_uÄesŞve_addr
(
addr
, 
add¾’
);

622 
	}
}

631 
	$nc_uÄesŞve_desc
(
sd
)

633 
sockšfo
 
si
;

634 
sockaddr
 *
addr
;

635 
sockËn_t
 
add¾’
;

636 
¡©us
;

638 
	`mem£t
(&
si
, 0, (si));

639 
addr
 = (
sockaddr
 *)&
si
.addr;

640 
add¾’
 = (
si
.
addr
);

642 
¡©us
 = 
	`g‘sockÇme
(
sd
, 
addr
, &
add¾’
);

643 ià(
¡©us
 < 0) {

647  
	`nc_uÄesŞve_addr
(
addr
, 
add¾’
);

648 
	}
}

651 
ušt64_t


652 
	$nc_now_us
()

654 
time¥ec
 
ts
;

655 
	`şock_g‘time
(
CLOCK_MONOTONIC
, &
ts
);

656  (
ts
.
tv_£c
 * 1000000 + (
ušt64_t
és.
tv_n£c
 / 1000);

657 
	}
}

660 
	$nc_wr™e_fe
(*
f•©h
, *
buf
, 
buf_Ën
)

662 
FILE
 *
fh
 = 
	`fİ’
(
f•©h
, "w");

663 ià(!
fh
) {

664 
	`log_”rÜ
("çedØİ’ ffÜ wr™e: %s\n", 
f•©h
);

667 
»t
 = ()
	`fwr™e
(
buf
, 1, 
buf_Ën
, 
fh
);

668 
	`fşo£
(
fh
);

669  
»t
;

670 
	}
}

	@nc_util.h

18 #iâdeà
_NC_UTIL_H_


19 
	#_NC_UTIL_H_


	)

21 
	~<¡d¬g.h
>

23 
	#LF
 (
ušt8_t
è10

	)

24 
	#CR
 (
ušt8_t
è13

	)

25 
	#CRLF
 "\x0d\x0a"

	)

26 
	#CRLF_LEN
 (("\x0d\x0a"è- 1)

	)

28 
	#NELEMS
(
a
è((×)è/ (×)[0]))

	)

30 
	#MIN
(
a
, 
b
è(×è< (bè? (aè: (b))

	)

31 
	#MAX
(
a
, 
b
è(×è> (bè? (aè: (b))

	)

33 
	#SQUARE
(
d
è((dè* (d))

	)

34 
	#VAR
(
s
, 
s2
, 
n
è((Òè< 2è? 0.0 : ((s2è- 
	`SQUARE
(s)/Ò)è/ (Òè- 1))

	)

35 
	#STDDEV
(
s
, 
s2
, 
n
è((Òè< 2è? 0.0 : 
	`sq¹
(
	`VAR
((s), (s2), (n))))

	)

37 
	#NC_INET4_ADDRSTRLEN
 (("255.255.255.255"è- 1)

	)

38 
	#NC_INET6_ADDRSTRLEN
 \

39 (("ffff:ffff:ffff:ffff:ffff:ffff:255.255.255.255"è- 1)

	)

40 
	#NC_INET_ADDRSTRLEN
 
	`MAX
(
NC_INET4_ADDRSTRLEN
, 
NC_INET6_ADDRSTRLEN
)

	)

41 
	#NC_UNIX_ADDRSTRLEN
 \

42 ((
sockaddr_un
è- 
	`off£tof
(sockaddr_un, 
sun_·th
))

	)

44 
	#NC_MAXHOSTNAMELEN
 256

	)

56 
	#NC_UINT8_MAXLEN
 (3 + 1)

	)

57 
	#NC_UINT16_MAXLEN
 (5 + 1)

	)

58 
	#NC_UINT32_MAXLEN
 (10 + 1)

	)

59 
	#NC_UINT64_MAXLEN
 (20 + 1)

	)

60 
	#NC_UINTMAX_MAXLEN
 
NC_UINT64_MAXLEN


	)

66 
	#NC_ALIGNMENT
 (è

	)

67 
	#NC_ALIGN
(
d
, 
n
è(((dè+ (À- 1)è& ~Ò - 1))

	)

68 
	#NC_ALIGN_PTR
(
p
, 
n
) \

69 (*è(((
ušŒ_t
è(
p
è+ ((ušŒ_tè
n
 - 1)è& ~((ušŒ_tèÀ- 1))

	)

75 
	#nc_g‘ho¡Çme
(
_Çme
, 
_Ën
) \

76 
	`g‘ho¡Çme
((*)
_Çme
, (
size_t
)
_Ën
)

	)

78 
	#nc_©oi
(
_lše
, 
_n
) \

79 
	`_nc_©oi
((
ušt8_t
 *)
_lše
, (
size_t
)
_n
)

	)

81 
nc_£t_blockšg
(
sd
);

82 
nc_£t_nÚblockšg
(
sd
);

83 
nc_£t_»u£addr
(
sd
);

84 
nc_£t_tınod–ay
(
sd
);

85 
nc_£t_lšg”
(
sd
, 
timeout
);

86 
nc_£t_¢dbuf
(
sd
, 
size
);

87 
nc_£t_rcvbuf
(
sd
, 
size
);

88 
nc_£t_tık“·live
(
sd
);

89 
nc_g‘_sÛ¼Ü
(
sd
);

90 
nc_g‘_¢dbuf
(
sd
);

91 
nc_g‘_rcvbuf
(
sd
);

93 
_nc_©oi
(
ušt8_t
 *
lše
, 
size_t
 
n
);

94 
boŞ
 
nc_v®id_pÜt
(
n
);

102 
	#nc_®loc
(
_s
) \

103 
	`_nc_®loc
((
size_t
)(
_s
), 
__FILE__
, 
__LINE__
)

	)

105 
	#nc_z®loc
(
_s
) \

106 
	`_nc_z®loc
((
size_t
)(
_s
), 
__FILE__
, 
__LINE__
)

	)

108 
	#nc_ÿÎoc
(
_n
, 
_s
) \

109 
	`_nc_ÿÎoc
((
size_t
)(
_n
), (size_t)(
_s
), 
__FILE__
, 
__LINE__
)

	)

111 
	#nc_»®loc
(
_p
, 
_s
) \

112 
	`_nc_»®loc
(
_p
, (
size_t
)(
_s
), 
__FILE__
, 
__LINE__
)

	)

114 
	#nc_ä“
(
_p
) do { \

115 
	`_nc_ä“
(
_p
, 
__FILE__
, 
__LINE__
); \

116 (
_p
èğ
NULL
; \

117 } 0)

	)

119 *
_nc_®loc
(
size_t
 
size
, cÚ¡ *
Çme
, 
lše
);

120 *
_nc_z®loc
(
size_t
 
size
, cÚ¡ *
Çme
, 
lše
);

121 *
_nc_ÿÎoc
(
size_t
 
nmemb
, size_ˆ
size
, cÚ¡ *
Çme
, 
lše
);

122 *
_nc_»®loc
(*
±r
, 
size_t
 
size
, cÚ¡ *
Çme
, 
lše
);

123 
_nc_ä“
(*
±r
, cÚ¡ *
Çme
, 
lše
);

129 
	#nc_£ndn
(
_s
, 
_b
, 
_n
) \

130 
	`_nc_£ndn
(
_s
, 
_b
, (
size_t
)(
_n
))

	)

132 
	#nc_»cvn
(
_s
, 
_b
, 
_n
) \

133 
	`_nc_»cvn
(
_s
, 
_b
, (
size_t
)(
_n
))

	)

139 
	#nc_»ad
(
_d
, 
_b
, 
_n
) \

140 
	`»ad
(
_d
, 
_b
, (
size_t
)(
_n
))

	)

142 
	#nc_»adv
(
_d
, 
_b
, 
_n
) \

143 
	`»adv
(
_d
, 
_b
, ()(
_n
))

	)

145 
	#nc_wr™e
(
_d
, 
_b
, 
_n
) \

146 
	`wr™e
(
_d
, 
_b
, (
size_t
)(
_n
))

	)

148 
	#nc_wr™ev
(
_d
, 
_b
, 
_n
) \

149 
	`wr™ev
(
_d
, 
_b
, ()(
_n
))

	)

151 
ssize_t
 
_nc_£ndn
(
sd
, cÚ¡ *
v±r
, 
size_t
 
n
);

152 
ssize_t
 
_nc_»cvn
(
sd
, *
v±r
, 
size_t
 
n
);

159 #ifdeà
NC_ASSERT_PANIC


161 
	#ASSERT
(
_x
) do { \

162 ià(!(
_x
)) { \

163 
	`nc_as£¹
(#_x, 
__FILE__
, 
__LINE__
, 1); \

165 } 0)

	)

167 
	#NOT_REACHED
(è
	`ASSERT
(0)

	)

169 #–ià
NC_ASSERT_LOG


171 
	#ASSERT
(
_x
) do { \

172 ià(!(
_x
)) { \

173 
	`nc_as£¹
(#_x, 
__FILE__
, 
__LINE__
, 0); \

175 } 0)

	)

177 
	#NOT_REACHED
(è
	`ASSERT
(0)

	)

181 
	#ASSERT
(
_x
)

	)

183 
	#NOT_REACHED
()

	)

187 
nc_as£¹
(cÚ¡ *
cÚd
, cÚ¡ *
fe
, 
lše
, 
·nic
);

188 
nc_¡ackŒaû
(
sk_couÁ
);

189 
nc_¡ackŒaû_fd
(
fd
);

191 
_sú´štf
(*
buf
, 
size_t
 
size
, cÚ¡ *
fmt
, ...);

192 
_vsú´štf
(*
buf
, 
size_t
 
size
, cÚ¡ *
fmt
, 
va_li¡
 
¬gs
);

193 
št64_t
 
nc_u£c_now
();

194 
št64_t
 
nc_m£c_now
();

201 
	ssockšfo
 {

202 
	mçmy
;

203 
sockËn_t
 
	madd¾’
;

205 
sockaddr_š
 
	mš
;

206 
sockaddr_š6
 
	mš6
;

207 
sockaddr_un
 
	mun
;

208 } 
	maddr
;

211 
nc_»sŞve
(
¡ršg
 *
Çme
, 
pÜt
, 
sockšfo
 *
si
);

212 *
nc_uÄesŞve_addr
(
sockaddr
 *
addr
, 
sockËn_t
 
add¾’
);

213 *
nc_uÄesŞve_³”_desc
(
sd
);

214 *
nc_uÄesŞve_desc
(
sd
);

216 
ušt64_t
 
nc_now_us
();

217 
nc_wr™e_fe
(*
f•©h
, *
buf
, 
buf_Ën
);

	@parson/parson.c

23 #ifdeà
_MSC_VER


24 
	#_CRT_SECURE_NO_WARNINGS


	)

27 
	~"·rsÚ.h
"

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

32 
	~<ùy³.h
>

33 
	~<m©h.h
>

35 
	#STARTING_CAPACITY
 15

	)

36 
	#ARRAY_MAX_CAPACITY
 122880

	)

37 
	#OBJECT_MAX_CAPACITY
 960

	)

38 
	#MAX_NESTING
 19

	)

39 
	#DOUBLE_SERIALIZATION_FORMAT
 "%f"

	)

41 
	#SIZEOF_TOKEN
(
a
è(×è- 1)

	)

42 
	#SKIP_CHAR
(
¡r
è((*¡r)++)

	)

43 
	#SKIP_WHITESPACES
(
¡r
è
	`is¥aû
(**¡r)è{ 
	`SKIP_CHAR
(¡r); }

	)

44 
	#MAX
(
a
, 
b
è(×è> (bè? (aè: (b))

	)

46 #undeà
m®loc


47 #undeà
ä“


49 
JSON_M®loc_FunùiÚ
 
	g·rsÚ_m®loc
 = 
m®loc
;

50 
JSON_F»e_FunùiÚ
 
	g·rsÚ_ä“
 = 
ä“
;

52 
	#IS_CONT
(
b
è((()(bè& 0xC0è=ğ0x80è

	)

55 
	ujsÚ_v®ue_v®ue
 {

56 *
	m¡ršg
;

57 
	mnumb”
;

58 
JSON_Objeù
 *
	mobjeù
;

59 
JSON_A¼ay
 *
	m¬¿y
;

60 
	mboŞ—n
;

61 
	mnuÎ
;

62 } 
	tJSON_V®ue_V®ue
;

64 
	sjsÚ_v®ue_t
 {

65 
JSON_V®ue_Ty³
 
	mty³
;

66 
JSON_V®ue_V®ue
 
	mv®ue
;

69 
	sjsÚ_objeù_t
 {

70 **
	mÇmes
;

71 
JSON_V®ue
 **
	mv®ues
;

72 
size_t
 
	mcouÁ
;

73 
size_t
 
	mÿ·c™y
;

76 
	sjsÚ_¬¿y_t
 {

77 
JSON_V®ue
 **
	m™ems
;

78 
size_t
 
	mcouÁ
;

79 
size_t
 
	mÿ·c™y
;

83 * 
»ad_fe
(cÚ¡ *
f’ame
);

84 
»move_comm’ts
(*
¡ršg
, cÚ¡ *
¡¬t_tok’
, cÚ¡ *
’d_tok’
);

85 * 
·rsÚ_¡ºdup
(cÚ¡ *
¡ršg
, 
size_t
 
n
);

86 * 
·rsÚ_¡rdup
(cÚ¡ *
¡ršg
);

87 
is_utf16_hex
(cÚ¡ *
¡ršg
);

88 
num_by‹s_š_utf8_£qu’û
(
c
);

89 
v”ify_utf8_£qu’û
(cÚ¡ *
¡ršg
, *
Ën
);

90 
is_v®id_utf8
(cÚ¡ *
¡ršg
, 
size_t
 
¡ršg_Ën
);

91 
is_decim®
(cÚ¡ *
¡ršg
, 
size_t
 
Ëngth
);

94 
JSON_Objeù
 * 
jsÚ_objeù_š™
();

95 
JSON_Stus
 
jsÚ_objeù_add
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
JSON_V®ue
 *
v®ue
);

96 
JSON_Stus
 
jsÚ_objeù_»size
(
JSON_Objeù
 *
objeù
, 
size_t
 
Ãw_ÿ·c™y
);

97 
JSON_V®ue
 * 
jsÚ_objeù_ng‘_v®ue
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
size_t
 
n
);

98 
jsÚ_objeù_ä“
(
JSON_Objeù
 *
objeù
);

101 
JSON_A¼ay
 * 
jsÚ_¬¿y_š™
();

102 
JSON_Stus
 
jsÚ_¬¿y_add
(
JSON_A¼ay
 *
¬¿y
, 
JSON_V®ue
 *
v®ue
);

103 
JSON_Stus
 
jsÚ_¬¿y_»size
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
Ãw_ÿ·c™y
);

104 
jsÚ_¬¿y_ä“
(
JSON_A¼ay
 *
¬¿y
);

107 
JSON_V®ue
 * 
jsÚ_v®ue_š™_¡ršg_no_cİy
(*
¡ršg
);

110 
sk_quÙes
(cÚ¡ **
¡ršg
);

111 
·r£_utf_16
(cÚ¡ **
uÅroûs£d
, **
´oûs£d
);

112 * 
´oûss_¡ršg
(cÚ¡ *
šput
, 
size_t
 
Ën
);

113 * 
g‘_quÙed_¡ršg
(cÚ¡ **
¡ršg
);

114 
JSON_V®ue
 * 
·r£_objeù_v®ue
(cÚ¡ **
¡ršg
, 
size_t
 
Ã¡šg
);

115 
JSON_V®ue
 * 
·r£_¬¿y_v®ue
(cÚ¡ **
¡ršg
, 
size_t
 
Ã¡šg
);

116 
JSON_V®ue
 * 
·r£_¡ršg_v®ue
(cÚ¡ **
¡ršg
);

117 
JSON_V®ue
 * 
·r£_boŞ—n_v®ue
(cÚ¡ **
¡ršg
);

118 
JSON_V®ue
 * 
·r£_numb”_v®ue
(cÚ¡ **
¡ršg
);

119 
JSON_V®ue
 * 
·r£_nuÎ_v®ue
(cÚ¡ **
¡ršg
);

120 
JSON_V®ue
 * 
·r£_v®ue
(cÚ¡ **
¡ršg
, 
size_t
 
Ã¡šg
);

123 
jsÚ_£rŸlize_to_bufãr_r
(cÚ¡ 
JSON_V®ue
 *
v®ue
, *
buf
, 
Ëv–
, 
is_´‘ty
, *
num_buf
);

124 
jsÚ_£rŸlize_¡ršg
(cÚ¡ *
¡ršg
, *
buf
);

125 
­³nd_šd’t
(*
buf
, 
Ëv–
);

126 
­³nd_¡ršg
(*
buf
, cÚ¡ *
¡ršg
);

129 * 
	$·rsÚ_¡ºdup
(cÚ¡ *
¡ršg
, 
size_t
 
n
) {

130 *
ouut_¡ršg
 = (*)
	`·rsÚ_m®loc
(
n
 + 1);

131 ià(!
ouut_¡ršg
)

132  
NULL
;

133 
ouut_¡ršg
[
n
] = '\0';

134 
	`¡ºıy
(
ouut_¡ršg
, 
¡ršg
, 
n
);

135  
ouut_¡ršg
;

136 
	}
}

138 * 
	$·rsÚ_¡rdup
(cÚ¡ *
¡ršg
) {

139  
	`·rsÚ_¡ºdup
(
¡ršg
, 
	`¡¾’
(string));

140 
	}
}

142 
	$is_utf16_hex
(cÚ¡ *
s
) {

143  
	`isxdig™
(
s
[0]) && isxdigit(s[1]) && isxdigit(s[2]) && isxdigit(s[3]);

144 
	}
}

146 
	$num_by‹s_š_utf8_£qu’û
(
c
) {

147 ià(
c
 =ğ0xC0 || c =ğ0xC1 || c > 0xF4 || 
	`IS_CONT
(c)) {

149 } ià((
c
 & 0x80) == 0) {

151 } ià((
c
 & 0xE0) == 0xC0) {

153 } ià((
c
 & 0xF0) == 0xE0) {

155 } ià((
c
 & 0xF8) == 0xF0) {

159 
	}
}

161 
	$v”ify_utf8_£qu’û
(cÚ¡ *
¡ršg
, *
Ën
) {

162 
ı
 = 0;

163 *
Ën
 = 
	`num_by‹s_š_utf8_£qu’û
(
¡ršg
[0]);

165 ià(*
Ën
 == 1) {

166 
ı
 = 
¡ršg
[0];

167 } ià(*
Ën
 =ğ2 && 
	`IS_CONT
(
¡ršg
[1])) {

168 
ı
 = 
¡ršg
[0] & 0x1F;

169 
ı
 = (ı << 6è| (
¡ršg
[1] & 0x3F);

170 } ià(*
Ën
 =ğ3 && 
	`IS_CONT
(
¡ršg
[1]) && IS_CONT(string[2])) {

171 
ı
 = (()
¡ršg
[0]) & 0xF;

172 
ı
 = (ı << 6è| (
¡ršg
[1] & 0x3F);

173 
ı
 = (ı << 6è| (
¡ršg
[2] & 0x3F);

174 } ià(*
Ën
 =ğ4 && 
	`IS_CONT
(
¡ršg
[1]) && IS_CONT(string[2]) && IS_CONT(string[3])) {

175 
ı
 = 
¡ršg
[0] & 0x7;

176 
ı
 = (ı << 6è| (
¡ršg
[1] & 0x3F);

177 
ı
 = (ı << 6è| (
¡ršg
[2] & 0x3F);

178 
ı
 = (ı << 6è| (
¡ršg
[3] & 0x3F);

184 ià((
ı
 < 0x80 && *
Ën
 > 1) ||

185 (
ı
 < 0x800 && *
Ën
 > 2) ||

186 (
ı
 < 0x10000 && *
Ën
 > 3)) {

191 ià(
ı
 > 0x10FFFF) {

196 ià(
ı
 >= 0xD800 && cp <= 0xDFFF) {

201 
	}
}

203 
	$is_v®id_utf8
(cÚ¡ *
¡ršg
, 
size_t
 
¡ršg_Ën
) {

204 
Ën
 = 0;

205 cÚ¡ *
¡ršg_’d
 = 
¡ršg
 + 
¡ršg_Ën
;

206 
¡ršg
 < 
¡ršg_’d
) {

207 ià(!
	`v”ify_utf8_£qu’û
((cÚ¡ *)
¡ršg
, &
Ën
)) {

210 
¡ršg
 +ğ
Ën
;

213 
	}
}

215 
	$is_decim®
(cÚ¡ *
¡ršg
, 
size_t
 
Ëngth
) {

216 ià(
Ëngth
 > 1 && 
¡ršg
[0] == '0' && string[1] != '.')

218 ià(
Ëngth
 > 2 && !
	`¡ºcmp
(
¡ršg
, "-0", 2) && string[2] != '.')

220 
Ëngth
--)

221 ià(
	`¡rchr
("xX", 
¡ršg
[
Ëngth
]))

224 
	}
}

226 * 
	$»ad_fe
(cÚ¡ * 
f’ame
) {

227 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "r");

228 
size_t
 
fe_size
;

229 
pos
;

230 *
fe_cÚ‹Ás
;

231 ià(!
å
)

232  
NULL
;

233 
	`f£ek
(
å
, 0L, 
SEEK_END
);

234 
pos
 = 
	`á–l
(
å
);

235 ià(
pos
 < 0) {

236 
	`fşo£
(
å
);

237  
NULL
;

239 
fe_size
 = 
pos
;

240 
	`»wšd
(
å
);

241 
fe_cÚ‹Ás
 = (*)
	`·rsÚ_m®loc
((è* (
fe_size
 + 1));

242 ià(!
fe_cÚ‹Ás
) {

243 
	`fşo£
(
å
);

244  
NULL
;

246 ià(
	`ä—d
(
fe_cÚ‹Ás
, 
fe_size
, 1, 
å
) < 1) {

247 ià(
	`ã¼Ü
(
å
)) {

248 
	`fşo£
(
å
);

249 
	`·rsÚ_ä“
(
fe_cÚ‹Ás
);

250  
NULL
;

253 
	`fşo£
(
å
);

254 
fe_cÚ‹Ás
[
fe_size
] = '\0';

255  
fe_cÚ‹Ás
;

256 
	}
}

258 
	$»move_comm’ts
(*
¡ršg
, cÚ¡ *
¡¬t_tok’
, cÚ¡ *
’d_tok’
) {

259 
š_¡ršg
 = 0, 
esÿ³d
 = 0;

260 
size_t
 
i
;

261 *
±r
 = 
NULL
, 
cu¼’t_ch¬
;

262 
size_t
 
¡¬t_tok’_Ën
 = 
	`¡¾’
(
¡¬t_tok’
);

263 
size_t
 
’d_tok’_Ën
 = 
	`¡¾’
(
’d_tok’
);

264 ià(
¡¬t_tok’_Ën
 =ğ0 || 
’d_tok’_Ën
 == 0)

266 (
cu¼’t_ch¬
 = *
¡ršg
) != '\0') {

267 ià(
cu¼’t_ch¬
 =ğ'\\' && !
esÿ³d
) {

268 
esÿ³d
 = 1;

269 
¡ršg
++;

271 } ià(
cu¼’t_ch¬
 =ğ'\"' && !
esÿ³d
) {

272 
š_¡ršg
 = !in_string;

273 } ià(!
š_¡ršg
 && 
	`¡ºcmp
(
¡ršg
, 
¡¬t_tok’
, 
¡¬t_tok’_Ën
) == 0) {

274 
i
 = 0; i < 
¡¬t_tok’_Ën
; i++)

275 
¡ršg
[
i
] = ' ';

276 
¡ršg
 = sŒšg + 
¡¬t_tok’_Ën
;

277 
±r
 = 
	`¡r¡r
(
¡ršg
, 
’d_tok’
);

278 ià(!
±r
)

280 
i
 = 0; i < (
±r
 - 
¡ršg
è+ 
’d_tok’_Ën
; i++)

281 
¡ršg
[
i
] = ' ';

282 
¡ršg
 = 
±r
 + 
’d_tok’_Ën
 - 1;

284 
esÿ³d
 = 0;

285 
¡ršg
++;

287 
	}
}

290 
JSON_Objeù
 * 
	$jsÚ_objeù_š™
() {

291 
JSON_Objeù
 *
Ãw_obj
 = (JSON_Objeù*)
	`·rsÚ_m®loc
((JSON_Object));

292 ià(!
Ãw_obj
)

293  
NULL
;

294 
Ãw_obj
->
Çmes
 = (**)
NULL
;

295 
Ãw_obj
->
v®ues
 = (
JSON_V®ue
**)
NULL
;

296 
Ãw_obj
->
ÿ·c™y
 = 0;

297 
Ãw_obj
->
couÁ
 = 0;

298  
Ãw_obj
;

299 
	}
}

301 
JSON_Stus
 
	$jsÚ_objeù_add
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
JSON_V®ue
 *
v®ue
) {

302 
size_t
 
šdex
 = 0;

303 ià(
objeù
 =ğ
NULL
 || 
Çme
 =ğNULL || 
v®ue
 == NULL) {

304  
JSONFau»
;

306 ià(
objeù
->
couÁ
 >ğobjeù->
ÿ·c™y
) {

307 
size_t
 
Ãw_ÿ·c™y
 = 
	`MAX
(
objeù
->
ÿ·c™y
 * 2, 
STARTING_CAPACITY
);

308 ià(
Ãw_ÿ·c™y
 > 
OBJECT_MAX_CAPACITY
)

309  
JSONFau»
;

310 ià(
	`jsÚ_objeù_»size
(
objeù
, 
Ãw_ÿ·c™y
è=ğ
JSONFau»
)

311  
JSONFau»
;

313 ià(
	`jsÚ_objeù_g‘_v®ue
(
objeù
, 
Çme
è!ğ
NULL
)

314  
JSONFau»
;

315 
šdex
 = 
objeù
->
couÁ
;

316 
objeù
->
Çmes
[
šdex
] = 
	`·rsÚ_¡rdup
(
Çme
);

317 ià(
objeù
->
Çmes
[
šdex
] =ğ
NULL
)

318  
JSONFau»
;

319 
objeù
->
v®ues
[
šdex
] = 
v®ue
;

320 
objeù
->
couÁ
++;

321  
JSONSucûss
;

322 
	}
}

324 
JSON_Stus
 
	$jsÚ_objeù_»size
(
JSON_Objeù
 *
objeù
, 
size_t
 
Ãw_ÿ·c™y
) {

325 **
‹mp_Çmes
 = 
NULL
;

326 
JSON_V®ue
 **
‹mp_v®ues
 = 
NULL
;

328 ià((
objeù
->
Çmes
 =ğ
NULL
 && objeù->
v®ues
 != NULL) ||

329 (
objeù
->
Çmes
 !ğ
NULL
 && objeù->
v®ues
 == NULL) ||

330 
Ãw_ÿ·c™y
 == 0) {

331  
JSONFau»
;

334 
‹mp_Çmes
 = (**)
	`·rsÚ_m®loc
(
Ãw_ÿ·c™y
 * (*));

335 ià(
‹mp_Çmes
 =ğ
NULL
)

336  
JSONFau»
;

338 
‹mp_v®ues
 = (
JSON_V®ue
**)
	`·rsÚ_m®loc
(
Ãw_ÿ·c™y
 * (JSON_Value*));

339 ià(
‹mp_Çmes
 =ğ
NULL
) {

340 
	`·rsÚ_ä“
(
‹mp_Çmes
);

341  
JSONFau»
;

344 ià(
objeù
->
Çmes
 !ğ
NULL
 && objeù->
v®ues
 !ğNULL && objeù->
couÁ
 > 0) {

345 
	`memıy
(
‹mp_Çmes
, 
objeù
->
Çmes
, objeù->
couÁ
 * (*));

346 
	`memıy
(
‹mp_v®ues
, 
objeù
->
v®ues
, objeù->
couÁ
 * (
JSON_V®ue
*));

348 
	`·rsÚ_ä“
(
objeù
->
Çmes
);

349 
	`·rsÚ_ä“
(
objeù
->
v®ues
);

350 
objeù
->
Çmes
 = 
‹mp_Çmes
;

351 
objeù
->
v®ues
 = 
‹mp_v®ues
;

352 
objeù
->
ÿ·c™y
 = 
Ãw_ÿ·c™y
;

353  
JSONSucûss
;

354 
	}
}

356 
JSON_V®ue
 * 
	$jsÚ_objeù_ng‘_v®ue
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
size_t
 
n
) {

357 
size_t
 
i
, 
Çme_Ëngth
;

358 
i
 = 0; i < 
	`jsÚ_objeù_g‘_couÁ
(
objeù
); i++) {

359 
Çme_Ëngth
 = 
	`¡¾’
(
objeù
->
Çmes
[
i
]);

360 ià(
Çme_Ëngth
 !ğ
n
)

362 ià(
	`¡ºcmp
(
objeù
->
Çmes
[
i
], 
Çme
, 
n
) == 0)

363  
objeù
->
v®ues
[
i
];

365  
NULL
;

366 
	}
}

368 
	$jsÚ_objeù_ä“
(
JSON_Objeù
 *
objeù
) {

369 
objeù
->
couÁ
--) {

370 
	`·rsÚ_ä“
(
objeù
->
Çmes
[objeù->
couÁ
]);

371 
	`jsÚ_v®ue_ä“
(
objeù
->
v®ues
[objeù->
couÁ
]);

373 
	`·rsÚ_ä“
(
objeù
->
Çmes
);

374 
	`·rsÚ_ä“
(
objeù
->
v®ues
);

375 
	`·rsÚ_ä“
(
objeù
);

376 
	}
}

379 
JSON_A¼ay
 * 
	$jsÚ_¬¿y_š™
() {

380 
JSON_A¼ay
 *
Ãw_¬¿y
 = (JSON_A¼ay*)
	`·rsÚ_m®loc
((JSON_Array));

381 ià(!
Ãw_¬¿y
)

382  
NULL
;

383 
Ãw_¬¿y
->
™ems
 = (
JSON_V®ue
**)
NULL
;

384 
Ãw_¬¿y
->
ÿ·c™y
 = 0;

385 
Ãw_¬¿y
->
couÁ
 = 0;

386  
Ãw_¬¿y
;

387 
	}
}

389 
JSON_Stus
 
	$jsÚ_¬¿y_add
(
JSON_A¼ay
 *
¬¿y
, 
JSON_V®ue
 *
v®ue
) {

390 ià(
¬¿y
->
couÁ
 >ğ¬¿y->
ÿ·c™y
) {

391 
size_t
 
Ãw_ÿ·c™y
 = 
	`MAX
(
¬¿y
->
ÿ·c™y
 * 2, 
STARTING_CAPACITY
);

392 ià(
Ãw_ÿ·c™y
 > 
ARRAY_MAX_CAPACITY
)

393  
JSONFau»
;

394 ià(
	`jsÚ_¬¿y_»size
(
¬¿y
, 
Ãw_ÿ·c™y
è=ğ
JSONFau»
)

395  
JSONFau»
;

397 
¬¿y
->
™ems
[¬¿y->
couÁ
] = 
v®ue
;

398 
¬¿y
->
couÁ
++;

399  
JSONSucûss
;

400 
	}
}

402 
JSON_Stus
 
	$jsÚ_¬¿y_»size
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
Ãw_ÿ·c™y
) {

403 
JSON_V®ue
 **
Ãw_™ems
 = 
NULL
;

404 ià(
Ãw_ÿ·c™y
 == 0) {

405  
JSONFau»
;

407 
Ãw_™ems
 = (
JSON_V®ue
**)
	`·rsÚ_m®loc
(
Ãw_ÿ·c™y
 * (JSON_Value*));

408 ià(
Ãw_™ems
 =ğ
NULL
) {

409  
JSONFau»
;

411 ià(
¬¿y
->
™ems
 !ğ
NULL
 &&‡¼ay->
couÁ
 > 0) {

412 
	`memıy
(
Ãw_™ems
, 
¬¿y
->
™ems
,‡¼ay->
couÁ
 * (
JSON_V®ue
*));

414 
	`·rsÚ_ä“
(
¬¿y
->
™ems
);

415 
¬¿y
->
™ems
 = 
Ãw_™ems
;

416 
¬¿y
->
ÿ·c™y
 = 
Ãw_ÿ·c™y
;

417  
JSONSucûss
;

418 
	}
}

420 
	$jsÚ_¬¿y_ä“
(
JSON_A¼ay
 *
¬¿y
) {

421 
¬¿y
->
couÁ
--)

422 
	`jsÚ_v®ue_ä“
(
¬¿y
->
™ems
[¬¿y->
couÁ
]);

423 
	`·rsÚ_ä“
(
¬¿y
->
™ems
);

424 
	`·rsÚ_ä“
(
¬¿y
);

425 
	}
}

428 
JSON_V®ue
 * 
	$jsÚ_v®ue_š™_¡ršg_no_cİy
(*
¡ršg
) {

429 
JSON_V®ue
 *
Ãw_v®ue
 = (JSON_V®ue*)
	`·rsÚ_m®loc
((JSON_Value));

430 ià(!
Ãw_v®ue
)

431  
NULL
;

432 
Ãw_v®ue
->
ty³
 = 
JSONSŒšg
;

433 
Ãw_v®ue
->
v®ue
.
¡ršg
 = string;

434  
Ãw_v®ue
;

435 
	}
}

438 
	$sk_quÙes
(cÚ¡ **
¡ršg
) {

439 
	`SKIP_CHAR
(
¡ršg
);

440 **
¡ršg
 != '\"') {

441 ià(**
¡ršg
 == '\0')

443 ià(**
¡ršg
 == '\\') {

444 
	`SKIP_CHAR
(
¡ršg
);

445 ià(**
¡ršg
 == '\0')

448 
	`SKIP_CHAR
(
¡ršg
);

450 
	`SKIP_CHAR
(
¡ršg
);

451 
	}
}

453 
	$·r£_utf_16
(cÚ¡ **
uÅroûs£d
, **
´oûs£d
) {

454 
ı
, 
Ëad
, 
Œa
;

455 *
´oûs£d_±r
 = *
´oûs£d
;

456 cÚ¡ *
uÅroûs£d_±r
 = *
uÅroûs£d
;

457 
uÅroûs£d_±r
++;

458 ià(!
	`is_utf16_hex
((cÚ¡ *)
uÅroûs£d_±r
è|| 
	`ssÿnf
(uÅroûs£d_±r, "%4x", &
ı
è=ğ
EOF
)

459  
JSONFau»
;

460 ià(
ı
 < 0x80) {

461 *
´oûs£d_±r
 = 
ı
;

462 } ià(
ı
 < 0x800) {

463 *
´oûs£d_±r
++ = ((
ı
 >> 6) & 0x1F) | 0xC0;

464 *
´oûs£d_±r
 = ((
ı
 ) & 0x3F) | 0x80;

465 } ià(
ı
 < 0xD800 || cp > 0xDFFF) {

466 *
´oûs£d_±r
++ = ((
ı
 >> 12) & 0x0F) | 0xE0;

467 *
´oûs£d_±r
++ = ((
ı
 >> 6) & 0x3F) | 0x80;

468 *
´oûs£d_±r
 = ((
ı
 ) & 0x3F) | 0x80;

469 } ià(
ı
 >= 0xD800 && cp <= 0xDBFF) {

470 
Ëad
 = 
ı
;

471 
uÅroûs£d_±r
 += 4;

472 ià(*
uÅroûs£d_±r
++ != '\\' || *unprocessed_ptr++ != 'u' ||

473 !
	`is_utf16_hex
((cÚ¡ *)
uÅroûs£d_±r
) ||

474 
	`ssÿnf
(
uÅroûs£d_±r
, "%4x", &
Œa
è=ğ
EOF
 ||

475 
Œa
 < 0xDC00 ||rail > 0xDFFF) {

476  
JSONFau»
;

478 
ı
 = ((((
Ëad
-0xD800)&0x3FF)<<10)|((
Œa
-0xDC00)&0x3FF))+0x010000;

479 *
´oûs£d_±r
++ = (((
ı
 >> 18) & 0x07) | 0xF0);

480 *
´oûs£d_±r
++ = (((
ı
 >> 12) & 0x3F) | 0x80);

481 *
´oûs£d_±r
++ = (((
ı
 >> 6) & 0x3F) | 0x80);

482 *
´oûs£d_±r
 = (((
ı
 ) & 0x3F) | 0x80);

484  
JSONFau»
;

486 
uÅroûs£d_±r
 += 3;

487 *
´oûs£d
 = 
´oûs£d_±r
;

488 *
uÅroûs£d
 = 
uÅroûs£d_±r
;

489  
JSONSucûss
;

490 
	}
}

495 * 
	$´oûss_¡ršg
(cÚ¡ *
šput
, 
size_t
 
Ën
) {

496 cÚ¡ *
šput_±r
 = 
šput
;

497 
size_t
 
š™Ÿl_size
 = (
Ën
 + 1) * ();

498 
size_t
 
fš®_size
 = 0;

499 *
ouut
 = (*)
	`·rsÚ_m®loc
(
š™Ÿl_size
);

500 *
ouut_±r
 = 
ouut
;

501 *
»sized_ouut
 = 
NULL
;

502 (*
šput_±r
 !ğ'\0'è&& (
size_t
)(šput_±¸- 
šput
è< 
Ën
) {

503 ià(*
šput_±r
 == '\\') {

504 
šput_±r
++;

505 *
šput_±r
) {

506 '\"': *
ouut_±r
 = '\"'; ;

507 '\\': *
ouut_±r
 = '\\'; ;

508 '/': *
ouut_±r
 = '/'; ;

509 'b': *
ouut_±r
 = '\b'; ;

510 'f': *
ouut_±r
 = '\f'; ;

511 'n': *
ouut_±r
 = '\n'; ;

512 'r': *
ouut_±r
 = '\r'; ;

513 't': *
ouut_±r
 = '\t'; ;

515 ià(
	`·r£_utf_16
(&
šput_±r
, &
ouut_±r
è=ğ
JSONFau»
)

516 
”rÜ
;

519 
”rÜ
;

521 } ià(()*
šput_±r
 < 0x20) {

522 
”rÜ
;

524 *
ouut_±r
 = *
šput_±r
;

526 
ouut_±r
++;

527 
šput_±r
++;

529 *
ouut_±r
 = '\0';

531 
fš®_size
 = (
size_t
)(
ouut_±r
-
ouut
) + 1;

532 
»sized_ouut
 = (*)
	`·rsÚ_m®loc
(
fš®_size
);

533 ià(
»sized_ouut
 =ğ
NULL
)

534 
”rÜ
;

535 
	`memıy
(
»sized_ouut
, 
ouut
, 
fš®_size
);

536 
	`·rsÚ_ä“
(
ouut
);

537  
»sized_ouut
;

538 
”rÜ
:

539 
	`·rsÚ_ä“
(
ouut
);

540  
NULL
;

541 
	}
}

545 * 
	$g‘_quÙed_¡ršg
(cÚ¡ **
¡ršg
) {

546 cÚ¡ *
¡ršg_¡¬t
 = *
¡ršg
;

547 
size_t
 
¡ršg_Ën
 = 0;

548 
	`sk_quÙes
(
¡ršg
);

549 ià(**
¡ršg
 == '\0')

550  
NULL
;

551 
¡ršg_Ën
 = *
¡ršg
 - 
¡ršg_¡¬t
 - 2;

552  
	`´oûss_¡ršg
(
¡ršg_¡¬t
 + 1, 
¡ršg_Ën
);

553 
	}
}

555 
JSON_V®ue
 * 
	$·r£_v®ue
(cÚ¡ **
¡ršg
, 
size_t
 
Ã¡šg
) {

556 ià(
Ã¡šg
 > 
MAX_NESTING
)

557  
NULL
;

558 
	`SKIP_WHITESPACES
(
¡ršg
);

559 **
¡ršg
) {

561  
	`·r£_objeù_v®ue
(
¡ršg
, 
Ã¡šg
 + 1);

563  
	`·r£_¬¿y_v®ue
(
¡ršg
, 
Ã¡šg
 + 1);

565  
	`·r£_¡ršg_v®ue
(
¡ršg
);

567  
	`·r£_boŞ—n_v®ue
(
¡ršg
);

571  
	`·r£_numb”_v®ue
(
¡ršg
);

573  
	`·r£_nuÎ_v®ue
(
¡ršg
);

575  
NULL
;

577 
	}
}

579 
JSON_V®ue
 * 
	$·r£_objeù_v®ue
(cÚ¡ **
¡ršg
, 
size_t
 
Ã¡šg
) {

580 
JSON_V®ue
 *
ouut_v®ue
 = 
	`jsÚ_v®ue_š™_objeù
(), *
Ãw_v®ue
 = 
NULL
;

581 
JSON_Objeù
 *
ouut_objeù
 = 
	`jsÚ_v®ue_g‘_objeù
(
ouut_v®ue
);

582 *
Ãw_key
 = 
NULL
;

583 ià(
ouut_v®ue
 =ğ
NULL
)

584  
NULL
;

585 
	`SKIP_CHAR
(
¡ršg
);

586 
	`SKIP_WHITESPACES
(
¡ršg
);

587 ià(**
¡ršg
 == '}') {

588 
	`SKIP_CHAR
(
¡ršg
);

589  
ouut_v®ue
;

591 **
¡ršg
 != '\0') {

592 
Ãw_key
 = 
	`g‘_quÙed_¡ršg
(
¡ršg
);

593 
	`SKIP_WHITESPACES
(
¡ršg
);

594 ià(
Ãw_key
 =ğ
NULL
 || **
¡ršg
 != ':') {

595 
	`jsÚ_v®ue_ä“
(
ouut_v®ue
);

596  
NULL
;

598 
	`SKIP_CHAR
(
¡ršg
);

599 
Ãw_v®ue
 = 
	`·r£_v®ue
(
¡ršg
, 
Ã¡šg
);

600 ià(
Ãw_v®ue
 =ğ
NULL
) {

601 
	`·rsÚ_ä“
(
Ãw_key
);

602 
	`jsÚ_v®ue_ä“
(
ouut_v®ue
);

603  
NULL
;

605 if(
	`jsÚ_objeù_add
(
ouut_objeù
, 
Ãw_key
, 
Ãw_v®ue
è=ğ
JSONFau»
) {

606 
	`·rsÚ_ä“
(
Ãw_key
);

607 
	`·rsÚ_ä“
(
Ãw_v®ue
);

608 
	`jsÚ_v®ue_ä“
(
ouut_v®ue
);

609  
NULL
;

611 
	`·rsÚ_ä“
(
Ãw_key
);

612 
	`SKIP_WHITESPACES
(
¡ršg
);

613 ià(**
¡ršg
 != ',')

615 
	`SKIP_CHAR
(
¡ršg
);

616 
	`SKIP_WHITESPACES
(
¡ršg
);

618 
	`SKIP_WHITESPACES
(
¡ršg
);

619 ià(**
¡ršg
 != '}' ||

620 
	`jsÚ_objeù_»size
(
ouut_objeù
, 
	`jsÚ_objeù_g‘_couÁ
(ouut_objeù)è=ğ
JSONFau»
) {

621 
	`jsÚ_v®ue_ä“
(
ouut_v®ue
);

622  
NULL
;

624 
	`SKIP_CHAR
(
¡ršg
);

625  
ouut_v®ue
;

626 
	}
}

628 
JSON_V®ue
 * 
	$·r£_¬¿y_v®ue
(cÚ¡ **
¡ršg
, 
size_t
 
Ã¡šg
) {

629 
JSON_V®ue
 *
ouut_v®ue
 = 
	`jsÚ_v®ue_š™_¬¿y
(), *
Ãw_¬¿y_v®ue
 = 
NULL
;

630 
JSON_A¼ay
 *
ouut_¬¿y
 = 
	`jsÚ_v®ue_g‘_¬¿y
(
ouut_v®ue
);

631 ià(!
ouut_v®ue
)

632  
NULL
;

633 
	`SKIP_CHAR
(
¡ršg
);

634 
	`SKIP_WHITESPACES
(
¡ršg
);

635 ià(**
¡ršg
 == ']') {

636 
	`SKIP_CHAR
(
¡ršg
);

637  
ouut_v®ue
;

639 **
¡ršg
 != '\0') {

640 
Ãw_¬¿y_v®ue
 = 
	`·r£_v®ue
(
¡ršg
, 
Ã¡šg
);

641 ià(!
Ãw_¬¿y_v®ue
) {

642 
	`jsÚ_v®ue_ä“
(
ouut_v®ue
);

643  
NULL
;

645 if(
	`jsÚ_¬¿y_add
(
ouut_¬¿y
, 
Ãw_¬¿y_v®ue
è=ğ
JSONFau»
) {

646 
	`·rsÚ_ä“
(
Ãw_¬¿y_v®ue
);

647 
	`jsÚ_v®ue_ä“
(
ouut_v®ue
);

648  
NULL
;

650 
	`SKIP_WHITESPACES
(
¡ršg
);

651 ià(**
¡ršg
 != ',')

653 
	`SKIP_CHAR
(
¡ršg
);

654 
	`SKIP_WHITESPACES
(
¡ršg
);

656 
	`SKIP_WHITESPACES
(
¡ršg
);

657 ià(**
¡ršg
 != ']' ||

658 
	`jsÚ_¬¿y_»size
(
ouut_¬¿y
, 
	`jsÚ_¬¿y_g‘_couÁ
(ouut_¬¿y)è=ğ
JSONFau»
) {

659 
	`jsÚ_v®ue_ä“
(
ouut_v®ue
);

660  
NULL
;

662 
	`SKIP_CHAR
(
¡ršg
);

663  
ouut_v®ue
;

664 
	}
}

666 
JSON_V®ue
 * 
	$·r£_¡ršg_v®ue
(cÚ¡ **
¡ršg
) {

667 
JSON_V®ue
 *
v®ue
 = 
NULL
;

668 *
Ãw_¡ršg
 = 
	`g‘_quÙed_¡ršg
(
¡ršg
);

669 ià(
Ãw_¡ršg
 =ğ
NULL
)

670  
NULL
;

671 
v®ue
 = 
	`jsÚ_v®ue_š™_¡ršg_no_cİy
(
Ãw_¡ršg
);

672 ià(
v®ue
 =ğ
NULL
) {

673 
	`·rsÚ_ä“
(
Ãw_¡ršg
);

674  
NULL
;

676  
v®ue
;

677 
	}
}

679 
JSON_V®ue
 * 
	$·r£_boŞ—n_v®ue
(cÚ¡ **
¡ršg
) {

680 
size_t
 
Œue_tok’_size
 = 
	`SIZEOF_TOKEN
("true");

681 
size_t
 
çl£_tok’_size
 = 
	`SIZEOF_TOKEN
("false");

682 ià(
	`¡ºcmp
("Œue", *
¡ršg
, 
Œue_tok’_size
) == 0) {

683 *
¡ršg
 +ğ
Œue_tok’_size
;

684  
	`jsÚ_v®ue_š™_boŞ—n
(1);

685 } ià(
	`¡ºcmp
("çl£", *
¡ršg
, 
çl£_tok’_size
) == 0) {

686 *
¡ršg
 +ğ
çl£_tok’_size
;

687  
	`jsÚ_v®ue_š™_boŞ—n
(0);

689  
NULL
;

690 
	}
}

692 
JSON_V®ue
 * 
	$·r£_numb”_v®ue
(cÚ¡ **
¡ršg
) {

693 *
’d
;

694 
numb”
 = 
	`¡¹od
(*
¡ršg
, &
’d
);

695 
JSON_V®ue
 *
ouut_v®ue
;

696 ià(
	`is_decim®
(*
¡ršg
, 
’d
 - *string)) {

697 *
¡ršg
 = 
’d
;

698 
ouut_v®ue
 = 
	`jsÚ_v®ue_š™_numb”
(
numb”
);

700 
ouut_v®ue
 = 
NULL
;

702  
ouut_v®ue
;

703 
	}
}

705 
JSON_V®ue
 * 
	$·r£_nuÎ_v®ue
(cÚ¡ **
¡ršg
) {

706 
size_t
 
tok’_size
 = 
	`SIZEOF_TOKEN
("null");

707 ià(
	`¡ºcmp
("nuÎ", *
¡ršg
, 
tok’_size
) == 0) {

708 *
¡ršg
 +ğ
tok’_size
;

709  
	`jsÚ_v®ue_š™_nuÎ
();

711  
NULL
;

712 
	}
}

715 
	#APPEND_STRING
(
¡r
èdØ{ 
wr™‹n
 = 
	`­³nd_¡ršg
(
buf
, (str)); \

716 ià(
wr™‹n
 < 0) {  -1; } \

717 ià(
buf
 !ğ
NULL
è{ buà+ğ
wr™‹n
; } \

718 
wr™‹n_tÙ®
 +ğ
wr™‹n
; } 0)

	)

720 
	#APPEND_INDENT
(
Ëv–
èdØ{ 
wr™‹n
 = 
	`­³nd_šd’t
(
buf
, (level)); \

721 ià(
wr™‹n
 < 0) {  -1; } \

722 ià(
buf
 !ğ
NULL
è{ buà+ğ
wr™‹n
; } \

723 
wr™‹n_tÙ®
 +ğ
wr™‹n
; } 0)

	)

725 
	$jsÚ_£rŸlize_to_bufãr_r
(cÚ¡ 
JSON_V®ue
 *
v®ue
, *
buf
, 
Ëv–
, 
is_´‘ty
, *
num_buf
)

727 cÚ¡ *
key
 = 
NULL
, *
¡ršg
 = NULL;

728 
JSON_V®ue
 *
‹mp_v®ue
 = 
NULL
;

729 
JSON_A¼ay
 *
¬¿y
 = 
NULL
;

730 
JSON_Objeù
 *
objeù
 = 
NULL
;

731 
size_t
 
i
 = 0, 
couÁ
 = 0;

732 
num
 = 0.0;

733 
wr™‹n
 = -1, 
wr™‹n_tÙ®
 = 0;

735 
	`jsÚ_v®ue_g‘_ty³
(
v®ue
)) {

736 
JSONA¼ay
:

737 
¬¿y
 = 
	`jsÚ_v®ue_g‘_¬¿y
(
v®ue
);

738 
couÁ
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
¬¿y
);

739 
	`APPEND_STRING
("[");

740 ià(
couÁ
 > 0 && 
is_´‘ty
)

741 
	`APPEND_STRING
("\n");

742 
i
 = 0; i < 
couÁ
; i++) {

743 ià(
is_´‘ty
)

744 
	`APPEND_INDENT
(
Ëv–
+1);

745 
‹mp_v®ue
 = 
	`jsÚ_¬¿y_g‘_v®ue
(
¬¿y
, 
i
);

746 
wr™‹n
 = 
	`jsÚ_£rŸlize_to_bufãr_r
(
‹mp_v®ue
, 
buf
, 
Ëv–
+1, 
is_´‘ty
, 
num_buf
);

747 ià(
wr™‹n
 < 0)

749 ià(
buf
 !ğ
NULL
)

750 
buf
 +ğ
wr™‹n
;

751 
wr™‹n_tÙ®
 +ğ
wr™‹n
;

752 ià(
i
 < (
couÁ
 - 1))

753 
	`APPEND_STRING
(",");

754 ià(
is_´‘ty
)

755 
	`APPEND_STRING
("\n");

757 ià(
couÁ
 > 0 && 
is_´‘ty
)

758 
	`APPEND_INDENT
(
Ëv–
);

759 
	`APPEND_STRING
("]");

760  
wr™‹n_tÙ®
;

761 
JSONObjeù
:

762 
objeù
 = 
	`jsÚ_v®ue_g‘_objeù
(
v®ue
);

763 
couÁ
 = 
	`jsÚ_objeù_g‘_couÁ
(
objeù
);

764 
	`APPEND_STRING
("{");

765 ià(
couÁ
 > 0 && 
is_´‘ty
)

766 
	`APPEND_STRING
("\n");

767 
i
 = 0; i < 
couÁ
; i++) {

768 
key
 = 
	`jsÚ_objeù_g‘_Çme
(
objeù
, 
i
);

769 ià(
is_´‘ty
)

770 
	`APPEND_INDENT
(
Ëv–
+1);

771 
wr™‹n
 = 
	`jsÚ_£rŸlize_¡ršg
(
key
, 
buf
);

772 ià(
wr™‹n
 < 0)

774 ià(
buf
 !ğ
NULL
)

775 
buf
 +ğ
wr™‹n
;

776 
wr™‹n_tÙ®
 +ğ
wr™‹n
;

777 
	`APPEND_STRING
(":");

778 ià(
is_´‘ty
)

779 
	`APPEND_STRING
(" ");

780 
‹mp_v®ue
 = 
	`jsÚ_objeù_g‘_v®ue
(
objeù
, 
key
);

781 
wr™‹n
 = 
	`jsÚ_£rŸlize_to_bufãr_r
(
‹mp_v®ue
, 
buf
, 
Ëv–
+1, 
is_´‘ty
, 
num_buf
);

782 ià(
wr™‹n
 < 0)

784 ià(
buf
 !ğ
NULL
)

785 
buf
 +ğ
wr™‹n
;

786 
wr™‹n_tÙ®
 +ğ
wr™‹n
;

787 ià(
i
 < (
couÁ
 - 1))

788 
	`APPEND_STRING
(",");

789 ià(
is_´‘ty
)

790 
	`APPEND_STRING
("\n");

792 ià(
couÁ
 > 0 && 
is_´‘ty
)

793 
	`APPEND_INDENT
(
Ëv–
);

794 
	`APPEND_STRING
("}");

795  
wr™‹n_tÙ®
;

796 
JSONSŒšg
:

797 
¡ršg
 = 
	`jsÚ_v®ue_g‘_¡ršg
(
v®ue
);

798 
wr™‹n
 = 
	`jsÚ_£rŸlize_¡ršg
(
¡ršg
, 
buf
);

799 ià(
wr™‹n
 < 0)

801 ià(
buf
 !ğ
NULL
)

802 
buf
 +ğ
wr™‹n
;

803 
wr™‹n_tÙ®
 +ğ
wr™‹n
;

804  
wr™‹n_tÙ®
;

805 
JSONBoŞ—n
:

806 ià(
	`jsÚ_v®ue_g‘_boŞ—n
(
v®ue
))

807 
	`APPEND_STRING
("true");

809 
	`APPEND_STRING
("false");

810  
wr™‹n_tÙ®
;

811 
JSONNumb”
:

812 
num
 = 
	`jsÚ_v®ue_g‘_numb”
(
v®ue
);

813 ià(
buf
 !ğ
NULL
)

814 
num_buf
 = 
buf
;

815 ià(
num
 == (()()num))

816 
wr™‹n
 = 
	`¥rštf
(
num_buf
, "%d", ()
num
);

818 
wr™‹n
 = 
	`¥rštf
(
num_buf
, 
DOUBLE_SERIALIZATION_FORMAT
, 
num
);

819 ià(
wr™‹n
 < 0)

821 ià(
buf
 !ğ
NULL
)

822 
buf
 +ğ
wr™‹n
;

823 
wr™‹n_tÙ®
 +ğ
wr™‹n
;

824  
wr™‹n_tÙ®
;

825 
JSONNuÎ
:

826 
	`APPEND_STRING
("null");

827  
wr™‹n_tÙ®
;

828 
JSONE¼Ü
:

833 
	}
}

835 
	$jsÚ_£rŸlize_¡ršg
(cÚ¡ *
¡ršg
, *
buf
) {

836 
size_t
 
i
 = 0, 
Ën
 = 
	`¡¾’
(
¡ršg
);

837 
c
 = '\0';

838 
wr™‹n
 = -1, 
wr™‹n_tÙ®
 = 0;

839 
	`APPEND_STRING
("\"");

840 
i
 = 0; i < 
Ën
; i++) {

841 
c
 = 
¡ršg
[
i
];

842 
c
) {

843 '\"': 
	`APPEND_STRING
("\\\""); ;

844 '\\': 
	`APPEND_STRING
("\\\\"); ;

845 '/': 
	`APPEND_STRING
("\\/"); ;

846 '\b': 
	`APPEND_STRING
("\\b"); ;

847 '\f': 
	`APPEND_STRING
("\\f"); ;

848 '\n': 
	`APPEND_STRING
("\\n"); ;

849 '\r': 
	`APPEND_STRING
("\\r"); ;

850 '\t': 
	`APPEND_STRING
("\\t"); ;

852 ià(
buf
 !ğ
NULL
) {

853 
buf
[0] = 
c
;

854 
buf
 += 1;

856 
wr™‹n_tÙ®
 += 1;

860 
	`APPEND_STRING
("\"");

861  
wr™‹n_tÙ®
;

862 
	}
}

864 
	$­³nd_šd’t
(*
buf
, 
Ëv–
) {

865 
i
;

866 
wr™‹n
 = -1, 
wr™‹n_tÙ®
 = 0;

867 
i
 = 0; i < 
Ëv–
; i++) {

868 
	`APPEND_STRING
(" ");

870  
wr™‹n_tÙ®
;

871 
	}
}

873 
	$­³nd_¡ršg
(*
buf
, cÚ¡ *
¡ršg
) {

874 ià(
buf
 =ğ
NULL
) {

875  ()
	`¡¾’
(
¡ršg
);

877  
	`¥rštf
(
buf
, "%s", 
¡ršg
);

878 
	}
}

880 #undeà
APPEND_STRING


881 #undeà
APPEND_INDENT


884 
JSON_V®ue
 * 
	$jsÚ_·r£_fe
(cÚ¡ *
f’ame
) {

885 *
fe_cÚ‹Ás
 = 
	`»ad_fe
(
f’ame
);

886 
JSON_V®ue
 *
ouut_v®ue
 = 
NULL
;

887 ià(
fe_cÚ‹Ás
 =ğ
NULL
)

888  
NULL
;

889 
ouut_v®ue
 = 
	`jsÚ_·r£_¡ršg
(
fe_cÚ‹Ás
);

890 
	`·rsÚ_ä“
(
fe_cÚ‹Ás
);

891  
ouut_v®ue
;

892 
	}
}

894 
JSON_V®ue
 * 
	$jsÚ_·r£_fe_w™h_comm’ts
(cÚ¡ *
f’ame
) {

895 *
fe_cÚ‹Ás
 = 
	`»ad_fe
(
f’ame
);

896 
JSON_V®ue
 *
ouut_v®ue
 = 
NULL
;

897 ià(
fe_cÚ‹Ás
 =ğ
NULL
)

898  
NULL
;

899 
ouut_v®ue
 = 
	`jsÚ_·r£_¡ršg_w™h_comm’ts
(
fe_cÚ‹Ás
);

900 
	`·rsÚ_ä“
(
fe_cÚ‹Ás
);

901  
ouut_v®ue
;

902 
	}
}

904 
JSON_V®ue
 * 
	$jsÚ_·r£_¡ršg
(cÚ¡ *
¡ršg
) {

905 ià(
¡ršg
 =ğ
NULL
)

906  
NULL
;

907 
	`SKIP_WHITESPACES
(&
¡ršg
);

908 ià(*
¡ršg
 != '{' && *string != '[')

909  
NULL
;

910  
	`·r£_v®ue
((cÚ¡ **)&
¡ršg
, 0);

911 
	}
}

913 
JSON_V®ue
 * 
	$jsÚ_·r£_¡ršg_w™h_comm’ts
(cÚ¡ *
¡ršg
) {

914 
JSON_V®ue
 *
»suÉ
 = 
NULL
;

915 *
¡ršg_mubË_cİy
 = 
NULL
, *
¡ršg_mubË_cİy_±r
 = NULL;

916 
¡ršg_mubË_cİy
 = 
	`·rsÚ_¡rdup
(
¡ršg
);

917 ià(
¡ršg_mubË_cİy
 =ğ
NULL
)

918  
NULL
;

919 
	`»move_comm’ts
(
¡ršg_mubË_cİy
, "/*", "*/");

920 
	`»move_comm’ts
(
¡ršg_mubË_cİy
, "//", "\n");

921 
¡ršg_mubË_cİy_±r
 = 
¡ršg_mubË_cİy
;

922 
	`SKIP_WHITESPACES
(&
¡ršg_mubË_cİy_±r
);

923 ià(*
¡ršg_mubË_cİy_±r
 != '{' && *string_mutable_copy_ptr != '[') {

924 
	`·rsÚ_ä“
(
¡ršg_mubË_cİy
);

925  
NULL
;

927 
»suÉ
 = 
	`·r£_v®ue
((cÚ¡ **)&
¡ršg_mubË_cİy_±r
, 0);

928 
	`·rsÚ_ä“
(
¡ršg_mubË_cİy
);

929  
»suÉ
;

930 
	}
}

935 
JSON_V®ue
 * 
	$jsÚ_objeù_g‘_v®ue
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

936 ià(
objeù
 =ğ
NULL
 || 
Çme
 == NULL)

937  
NULL
;

938  
	`jsÚ_objeù_ng‘_v®ue
(
objeù
, 
Çme
, 
	`¡¾’
(name));

939 
	}
}

941 cÚ¡ * 
	$jsÚ_objeù_g‘_¡ršg
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

942  
	`jsÚ_v®ue_g‘_¡ršg
(
	`jsÚ_objeù_g‘_v®ue
(
objeù
, 
Çme
));

943 
	}
}

945 
	$jsÚ_objeù_g‘_numb”
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

946  
	`jsÚ_v®ue_g‘_numb”
(
	`jsÚ_objeù_g‘_v®ue
(
objeù
, 
Çme
));

947 
	}
}

949 
JSON_Objeù
 * 
	$jsÚ_objeù_g‘_objeù
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

950  
	`jsÚ_v®ue_g‘_objeù
(
	`jsÚ_objeù_g‘_v®ue
(
objeù
, 
Çme
));

951 
	}
}

953 
JSON_A¼ay
 * 
	$jsÚ_objeù_g‘_¬¿y
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

954  
	`jsÚ_v®ue_g‘_¬¿y
(
	`jsÚ_objeù_g‘_v®ue
(
objeù
, 
Çme
));

955 
	}
}

957 
	$jsÚ_objeù_g‘_boŞ—n
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

958  
	`jsÚ_v®ue_g‘_boŞ—n
(
	`jsÚ_objeù_g‘_v®ue
(
objeù
, 
Çme
));

959 
	}
}

961 
JSON_V®ue
 * 
	$jsÚ_objeù_dÙg‘_v®ue
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

962 cÚ¡ *
dÙ_pos™iÚ
 = 
	`¡rchr
(
Çme
, '.');

963 ià(!
dÙ_pos™iÚ
)

964  
	`jsÚ_objeù_g‘_v®ue
(
objeù
, 
Çme
);

965 
objeù
 = 
	`jsÚ_v®ue_g‘_objeù
(
	`jsÚ_objeù_ng‘_v®ue
(objeù, 
Çme
, 
dÙ_pos™iÚ
 -‚ame));

966  
	`jsÚ_objeù_dÙg‘_v®ue
(
objeù
, 
dÙ_pos™iÚ
 + 1);

967 
	}
}

969 cÚ¡ * 
	$jsÚ_objeù_dÙg‘_¡ršg
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

970  
	`jsÚ_v®ue_g‘_¡ršg
(
	`jsÚ_objeù_dÙg‘_v®ue
(
objeù
, 
Çme
));

971 
	}
}

973 
	$jsÚ_objeù_dÙg‘_numb”
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

974  
	`jsÚ_v®ue_g‘_numb”
(
	`jsÚ_objeù_dÙg‘_v®ue
(
objeù
, 
Çme
));

975 
	}
}

977 
JSON_Objeù
 * 
	$jsÚ_objeù_dÙg‘_objeù
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

978  
	`jsÚ_v®ue_g‘_objeù
(
	`jsÚ_objeù_dÙg‘_v®ue
(
objeù
, 
Çme
));

979 
	}
}

981 
JSON_A¼ay
 * 
	$jsÚ_objeù_dÙg‘_¬¿y
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

982  
	`jsÚ_v®ue_g‘_¬¿y
(
	`jsÚ_objeù_dÙg‘_v®ue
(
objeù
, 
Çme
));

983 
	}
}

985 
	$jsÚ_objeù_dÙg‘_boŞ—n
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

986  
	`jsÚ_v®ue_g‘_boŞ—n
(
	`jsÚ_objeù_dÙg‘_v®ue
(
objeù
, 
Çme
));

987 
	}
}

989 
size_t
 
	$jsÚ_objeù_g‘_couÁ
(cÚ¡ 
JSON_Objeù
 *
objeù
) {

990  
objeù
 ? objeù->
couÁ
 : 0;

991 
	}
}

993 cÚ¡ * 
	$jsÚ_objeù_g‘_Çme
(cÚ¡ 
JSON_Objeù
 *
objeù
, 
size_t
 
šdex
) {

994 ià(
šdex
 >ğ
	`jsÚ_objeù_g‘_couÁ
(
objeù
))

995  
NULL
;

996  
objeù
->
Çmes
[
šdex
];

997 
	}
}

1000 
JSON_V®ue
 * 
	$jsÚ_¬¿y_g‘_v®ue
(cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
) {

1001 ià(
šdex
 >ğ
	`jsÚ_¬¿y_g‘_couÁ
(
¬¿y
))

1002  
NULL
;

1003  
¬¿y
->
™ems
[
šdex
];

1004 
	}
}

1006 cÚ¡ * 
	$jsÚ_¬¿y_g‘_¡ršg
(cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
) {

1007  
	`jsÚ_v®ue_g‘_¡ršg
(
	`jsÚ_¬¿y_g‘_v®ue
(
¬¿y
, 
šdex
));

1008 
	}
}

1010 
	$jsÚ_¬¿y_g‘_numb”
(cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
) {

1011  
	`jsÚ_v®ue_g‘_numb”
(
	`jsÚ_¬¿y_g‘_v®ue
(
¬¿y
, 
šdex
));

1012 
	}
}

1014 
JSON_Objeù
 * 
	$jsÚ_¬¿y_g‘_objeù
(cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
) {

1015  
	`jsÚ_v®ue_g‘_objeù
(
	`jsÚ_¬¿y_g‘_v®ue
(
¬¿y
, 
šdex
));

1016 
	}
}

1018 
JSON_A¼ay
 * 
	$jsÚ_¬¿y_g‘_¬¿y
(cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
) {

1019  
	`jsÚ_v®ue_g‘_¬¿y
(
	`jsÚ_¬¿y_g‘_v®ue
(
¬¿y
, 
šdex
));

1020 
	}
}

1022 
	$jsÚ_¬¿y_g‘_boŞ—n
(cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
) {

1023  
	`jsÚ_v®ue_g‘_boŞ—n
(
	`jsÚ_¬¿y_g‘_v®ue
(
¬¿y
, 
šdex
));

1024 
	}
}

1026 
size_t
 
	$jsÚ_¬¿y_g‘_couÁ
(cÚ¡ 
JSON_A¼ay
 *
¬¿y
) {

1027  
¬¿y
 ?‡¼ay->
couÁ
 : 0;

1028 
	}
}

1031 
JSON_V®ue_Ty³
 
	$jsÚ_v®ue_g‘_ty³
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1032  
v®ue
 ? v®ue->
ty³
 : 
JSONE¼Ü
;

1033 
	}
}

1035 
JSON_Objeù
 * 
	$jsÚ_v®ue_g‘_objeù
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1036  
	`jsÚ_v®ue_g‘_ty³
(
v®ue
è=ğ
JSONObjeù
 ? v®ue->v®ue.
objeù
 : 
NULL
;

1037 
	}
}

1039 
JSON_A¼ay
 * 
	$jsÚ_v®ue_g‘_¬¿y
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1040  
	`jsÚ_v®ue_g‘_ty³
(
v®ue
è=ğ
JSONA¼ay
 ? v®ue->v®ue.
¬¿y
 : 
NULL
;

1041 
	}
}

1043 cÚ¡ * 
	$jsÚ_v®ue_g‘_¡ršg
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1044  
	`jsÚ_v®ue_g‘_ty³
(
v®ue
è=ğ
JSONSŒšg
 ? v®ue->v®ue.
¡ršg
 : 
NULL
;

1045 
	}
}

1047 
	$jsÚ_v®ue_g‘_numb”
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1048  
	`jsÚ_v®ue_g‘_ty³
(
v®ue
è=ğ
JSONNumb”
 ? v®ue->v®ue.
numb”
 : 0;

1049 
	}
}

1051 
	$jsÚ_v®ue_g‘_boŞ—n
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1052  
	`jsÚ_v®ue_g‘_ty³
(
v®ue
è=ğ
JSONBoŞ—n
 ? v®ue->v®ue.
boŞ—n
 : -1;

1053 
	}
}

1055 
	$jsÚ_v®ue_ä“
(
JSON_V®ue
 *
v®ue
) {

1056 
	`jsÚ_v®ue_g‘_ty³
(
v®ue
)) {

1057 
JSONObjeù
:

1058 
	`jsÚ_objeù_ä“
(
v®ue
->v®ue.
objeù
);

1060 
JSONSŒšg
:

1061 ià(
v®ue
->v®ue.
¡ršg
è{ 
	`·rsÚ_ä“
(value->value.string); }

1063 
JSONA¼ay
:

1064 
	`jsÚ_¬¿y_ä“
(
v®ue
->v®ue.
¬¿y
);

1069 
	`·rsÚ_ä“
(
v®ue
);

1070 
	}
}

1072 
JSON_V®ue
 * 
	$jsÚ_v®ue_š™_objeù
() {

1073 
JSON_V®ue
 *
Ãw_v®ue
 = (JSON_V®ue*)
	`·rsÚ_m®loc
((JSON_Value));

1074 ià(!
Ãw_v®ue
)

1075  
NULL
;

1076 
Ãw_v®ue
->
ty³
 = 
JSONObjeù
;

1077 
Ãw_v®ue
->
v®ue
.
objeù
 = 
	`jsÚ_objeù_š™
();

1078 ià(!
Ãw_v®ue
->
v®ue
.
objeù
) {

1079 
	`·rsÚ_ä“
(
Ãw_v®ue
);

1080  
NULL
;

1082  
Ãw_v®ue
;

1083 
	}
}

1085 
JSON_V®ue
 * 
	$jsÚ_v®ue_š™_¬¿y
() {

1086 
JSON_V®ue
 *
Ãw_v®ue
 = (JSON_V®ue*)
	`·rsÚ_m®loc
((JSON_Value));

1087 ià(!
Ãw_v®ue
)

1088  
NULL
;

1089 
Ãw_v®ue
->
ty³
 = 
JSONA¼ay
;

1090 
Ãw_v®ue
->
v®ue
.
¬¿y
 = 
	`jsÚ_¬¿y_š™
();

1091 ià(!
Ãw_v®ue
->
v®ue
.
¬¿y
) {

1092 
	`·rsÚ_ä“
(
Ãw_v®ue
);

1093  
NULL
;

1095  
Ãw_v®ue
;

1096 
	}
}

1098 
JSON_V®ue
 * 
	$jsÚ_v®ue_š™_¡ršg
(cÚ¡ *
¡ršg
) {

1099 *
cİy
 = 
NULL
;

1100 
JSON_V®ue
 *
v®ue
;

1101 
size_t
 
¡ršg_Ën
 = 0;

1102 ià(
¡ršg
 =ğ
NULL
)

1103  
NULL
;

1104 
¡ršg_Ën
 = 
	`¡¾’
(
¡ršg
);

1105 ià(!
	`is_v®id_utf8
(
¡ršg
, 
¡ršg_Ën
))

1106  
NULL
;

1107 
cİy
 = 
	`·rsÚ_¡ºdup
(
¡ršg
, 
¡ršg_Ën
);

1108 ià(
cİy
 =ğ
NULL
)

1109  
NULL
;

1110 
v®ue
 = 
	`jsÚ_v®ue_š™_¡ršg_no_cİy
(
cİy
);

1111 ià(
v®ue
 =ğ
NULL
)

1112 
	`·rsÚ_ä“
(
cİy
);

1113  
v®ue
;

1114 
	}
}

1116 
JSON_V®ue
 * 
	$jsÚ_v®ue_š™_numb”
(
numb”
) {

1117 
JSON_V®ue
 *
Ãw_v®ue
 = (JSON_V®ue*)
	`·rsÚ_m®loc
((JSON_Value));

1118 ià(!
Ãw_v®ue
)

1119  
NULL
;

1120 
Ãw_v®ue
->
ty³
 = 
JSONNumb”
;

1121 
Ãw_v®ue
->
v®ue
.
numb”
 =‚umber;

1122  
Ãw_v®ue
;

1123 
	}
}

1125 
JSON_V®ue
 * 
	$jsÚ_v®ue_š™_boŞ—n
(
boŞ—n
) {

1126 
JSON_V®ue
 *
Ãw_v®ue
 = (JSON_V®ue*)
	`·rsÚ_m®loc
((JSON_Value));

1127 ià(!
Ãw_v®ue
)

1128  
NULL
;

1129 
Ãw_v®ue
->
ty³
 = 
JSONBoŞ—n
;

1130 
Ãw_v®ue
->
v®ue
.
boŞ—n
 = boolean ? 1 : 0;

1131  
Ãw_v®ue
;

1132 
	}
}

1134 
JSON_V®ue
 * 
	$jsÚ_v®ue_š™_nuÎ
() {

1135 
JSON_V®ue
 *
Ãw_v®ue
 = (JSON_V®ue*)
	`·rsÚ_m®loc
((JSON_Value));

1136 ià(!
Ãw_v®ue
)

1137  
NULL
;

1138 
Ãw_v®ue
->
ty³
 = 
JSONNuÎ
;

1139  
Ãw_v®ue
;

1140 
	}
}

1142 
JSON_V®ue
 * 
	$jsÚ_v®ue_d“p_cİy
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1143 
size_t
 
i
 = 0;

1144 
JSON_V®ue
 *
»tuº_v®ue
 = 
NULL
, *
‹mp_v®ue_cİy
 = NULL, *
‹mp_v®ue
 = NULL;

1145 cÚ¡ *
‹mp_¡ršg
 = 
NULL
, *
‹mp_key
 = NULL;

1146 *
‹mp_¡ršg_cİy
 = 
NULL
;

1147 
JSON_A¼ay
 *
‹mp_¬¿y
 = 
NULL
, *
‹mp_¬¿y_cİy
 = NULL;

1148 
JSON_Objeù
 *
‹mp_objeù
 = 
NULL
, *
‹mp_objeù_cİy
 = NULL;

1150 
	`jsÚ_v®ue_g‘_ty³
(
v®ue
)) {

1151 
JSONA¼ay
:

1152 
‹mp_¬¿y
 = 
	`jsÚ_v®ue_g‘_¬¿y
(
v®ue
);

1153 
»tuº_v®ue
 = 
	`jsÚ_v®ue_š™_¬¿y
();

1154 ià(
»tuº_v®ue
 =ğ
NULL
)

1155  
NULL
;

1156 
‹mp_¬¿y_cİy
 = 
	`jsÚ_v®ue_g‘_¬¿y
(
»tuº_v®ue
);

1157 
i
 = 0; i < 
	`jsÚ_¬¿y_g‘_couÁ
(
‹mp_¬¿y
); i++) {

1158 
‹mp_v®ue
 = 
	`jsÚ_¬¿y_g‘_v®ue
(
‹mp_¬¿y
, 
i
);

1159 
‹mp_v®ue_cİy
 = 
	`jsÚ_v®ue_d“p_cİy
(
‹mp_v®ue
);

1160 ià(
‹mp_v®ue_cİy
 =ğ
NULL
) {

1161 
	`jsÚ_v®ue_ä“
(
»tuº_v®ue
);

1162  
NULL
;

1164 ià(
	`jsÚ_¬¿y_add
(
‹mp_¬¿y_cİy
, 
‹mp_v®ue_cİy
è=ğ
JSONFau»
) {

1165 
	`jsÚ_v®ue_ä“
(
»tuº_v®ue
);

1166 
	`jsÚ_v®ue_ä“
(
‹mp_v®ue_cİy
);

1167  
NULL
;

1170  
»tuº_v®ue
;

1171 
JSONObjeù
:

1172 
‹mp_objeù
 = 
	`jsÚ_v®ue_g‘_objeù
(
v®ue
);

1173 
»tuº_v®ue
 = 
	`jsÚ_v®ue_š™_objeù
();

1174 ià(
»tuº_v®ue
 =ğ
NULL
)

1175  
NULL
;

1176 
‹mp_objeù_cİy
 = 
	`jsÚ_v®ue_g‘_objeù
(
»tuº_v®ue
);

1177 
i
 = 0; i < 
	`jsÚ_objeù_g‘_couÁ
(
‹mp_objeù
); i++) {

1178 
‹mp_key
 = 
	`jsÚ_objeù_g‘_Çme
(
‹mp_objeù
, 
i
);

1179 
‹mp_v®ue
 = 
	`jsÚ_objeù_g‘_v®ue
(
‹mp_objeù
, 
‹mp_key
);

1180 
‹mp_v®ue_cİy
 = 
	`jsÚ_v®ue_d“p_cİy
(
‹mp_v®ue
);

1181 ià(
‹mp_v®ue_cİy
 =ğ
NULL
) {

1182 
	`jsÚ_v®ue_ä“
(
»tuº_v®ue
);

1183  
NULL
;

1185 ià(
	`jsÚ_objeù_add
(
‹mp_objeù_cİy
, 
‹mp_key
, 
‹mp_v®ue_cİy
è=ğ
JSONFau»
) {

1186 
	`jsÚ_v®ue_ä“
(
»tuº_v®ue
);

1187 
	`jsÚ_v®ue_ä“
(
‹mp_v®ue_cİy
);

1188  
NULL
;

1191  
»tuº_v®ue
;

1192 
JSONBoŞ—n
:

1193  
	`jsÚ_v®ue_š™_boŞ—n
(
	`jsÚ_v®ue_g‘_boŞ—n
(
v®ue
));

1194 
JSONNumb”
:

1195  
	`jsÚ_v®ue_š™_numb”
(
	`jsÚ_v®ue_g‘_numb”
(
v®ue
));

1196 
JSONSŒšg
:

1197 
‹mp_¡ršg
 = 
	`jsÚ_v®ue_g‘_¡ršg
(
v®ue
);

1198 
‹mp_¡ršg_cİy
 = 
	`·rsÚ_¡rdup
(
‹mp_¡ršg
);

1199 ià(
‹mp_¡ršg_cİy
 =ğ
NULL
)

1200  
NULL
;

1201 
»tuº_v®ue
 = 
	`jsÚ_v®ue_š™_¡ršg_no_cİy
(
‹mp_¡ršg_cİy
);

1202 ià(
»tuº_v®ue
 =ğ
NULL
)

1203 
	`·rsÚ_ä“
(
‹mp_¡ršg_cİy
);

1204  
»tuº_v®ue
;

1205 
JSONNuÎ
:

1206  
	`jsÚ_v®ue_š™_nuÎ
();

1207 
JSONE¼Ü
:

1208  
NULL
;

1210  
NULL
;

1212 
	}
}

1214 
size_t
 
	$jsÚ_£rŸliz©iÚ_size
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1215 
num_buf
[1100];

1216 
»s
 = 
	`jsÚ_£rŸlize_to_bufãr_r
(
v®ue
, 
NULL
, 0, 0, 
num_buf
);

1217  
»s
 < 0 ? 0 : (
size_t
)(res + 1);

1218 
	}
}

1220 
JSON_Stus
 
	$jsÚ_£rŸlize_to_bufãr
(cÚ¡ 
JSON_V®ue
 *
v®ue
, *
buf
, 
size_t
 
buf_size_š_by‹s
) {

1221 
wr™‹n
 = -1;

1222 
size_t
 
Ãeded_size_š_by‹s
 = 
	`jsÚ_£rŸliz©iÚ_size
(
v®ue
);

1223 ià(
Ãeded_size_š_by‹s
 =ğ0 || 
buf_size_š_by‹s
 <‚eeded_size_in_bytes) {

1224  
JSONFau»
;

1226 
wr™‹n
 = 
	`jsÚ_£rŸlize_to_bufãr_r
(
v®ue
, 
buf
, 0, 0, 
NULL
);

1227 ià(
wr™‹n
 < 0)

1228  
JSONFau»
;

1229  
JSONSucûss
;

1230 
	}
}

1232 
JSON_Stus
 
	$jsÚ_£rŸlize_to_fe
(cÚ¡ 
JSON_V®ue
 *
v®ue
, cÚ¡ *
f’ame
) {

1233 
JSON_Stus
 
»tuº_code
 = 
JSONSucûss
;

1234 
FILE
 *
å
 = 
NULL
;

1235 *
£rŸlized_¡ršg
 = 
	`jsÚ_£rŸlize_to_¡ršg
(
v®ue
);

1236 ià(
£rŸlized_¡ršg
 =ğ
NULL
) {

1237  
JSONFau»
;

1239 
å
 = 
	`fİ’
 (
f’ame
, "w");

1240 ià(
å
 !ğ
NULL
) {

1241 ià(
	`åuts
 (
£rŸlized_¡ršg
, 
å
è=ğ
EOF
) {

1242 
»tuº_code
 = 
JSONFau»
;

1244 ià(
	`fşo£
 (
å
è=ğ
EOF
) {

1245 
»tuº_code
 = 
JSONFau»
;

1248 
	`jsÚ_ä“_£rŸlized_¡ršg
(
£rŸlized_¡ršg
);

1249  
»tuº_code
;

1250 
	}
}

1252 * 
	$jsÚ_£rŸlize_to_¡ršg
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1253 
JSON_Stus
 
£rŸliz©iÚ_»suÉ
 = 
JSONFau»
;

1254 
size_t
 
buf_size_by‹s
 = 
	`jsÚ_£rŸliz©iÚ_size
(
v®ue
);

1255 *
buf
 = 
NULL
;

1256 ià(
buf_size_by‹s
 == 0) {

1257  
NULL
;

1259 
buf
 = (*)
	`·rsÚ_m®loc
(
buf_size_by‹s
);

1260 ià(
buf
 =ğ
NULL
)

1261  
NULL
;

1262 
£rŸliz©iÚ_»suÉ
 = 
	`jsÚ_£rŸlize_to_bufãr
(
v®ue
, 
buf
, 
buf_size_by‹s
);

1263 ià(
£rŸliz©iÚ_»suÉ
 =ğ
JSONFau»
) {

1264 
	`jsÚ_ä“_£rŸlized_¡ršg
(
buf
);

1265  
NULL
;

1267  
buf
;

1268 
	}
}

1270 
size_t
 
	$jsÚ_£rŸliz©iÚ_size_´‘ty
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1271 
num_buf
[1100];

1272 
»s
 = 
	`jsÚ_£rŸlize_to_bufãr_r
(
v®ue
, 
NULL
, 0, 1, 
num_buf
);

1273  
»s
 < 0 ? 0 : (
size_t
)(res + 1);

1274 
	}
}

1276 
JSON_Stus
 
	$jsÚ_£rŸlize_to_bufãr_´‘ty
(cÚ¡ 
JSON_V®ue
 *
v®ue
, *
buf
, 
size_t
 
buf_size_š_by‹s
) {

1277 
wr™‹n
 = -1;

1278 
size_t
 
Ãeded_size_š_by‹s
 = 
	`jsÚ_£rŸliz©iÚ_size_´‘ty
(
v®ue
);

1279 ià(
Ãeded_size_š_by‹s
 =ğ0 || 
buf_size_š_by‹s
 <‚eeded_size_in_bytes)

1280  
JSONFau»
;

1281 
wr™‹n
 = 
	`jsÚ_£rŸlize_to_bufãr_r
(
v®ue
, 
buf
, 0, 1, 
NULL
);

1282 ià(
wr™‹n
 < 0)

1283  
JSONFau»
;

1284  
JSONSucûss
;

1285 
	}
}

1287 
JSON_Stus
 
	$jsÚ_£rŸlize_to_fe_´‘ty
(cÚ¡ 
JSON_V®ue
 *
v®ue
, cÚ¡ *
f’ame
) {

1288 
JSON_Stus
 
»tuº_code
 = 
JSONSucûss
;

1289 
FILE
 *
å
 = 
NULL
;

1290 *
£rŸlized_¡ršg
 = 
	`jsÚ_£rŸlize_to_¡ršg_´‘ty
(
v®ue
);

1291 ià(
£rŸlized_¡ršg
 =ğ
NULL
) {

1292  
JSONFau»
;

1294 
å
 = 
	`fİ’
 (
f’ame
, "w");

1295 ià(
å
 !ğ
NULL
) {

1296 ià(
	`åuts
 (
£rŸlized_¡ršg
, 
å
è=ğ
EOF
) {

1297 
»tuº_code
 = 
JSONFau»
;

1299 ià(
	`fşo£
 (
å
è=ğ
EOF
) {

1300 
»tuº_code
 = 
JSONFau»
;

1303 
	`jsÚ_ä“_£rŸlized_¡ršg
(
£rŸlized_¡ršg
);

1304  
»tuº_code
;

1305 
	}
}

1307 * 
	$jsÚ_£rŸlize_to_¡ršg_´‘ty
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1308 
JSON_Stus
 
£rŸliz©iÚ_»suÉ
 = 
JSONFau»
;

1309 
size_t
 
buf_size_by‹s
 = 
	`jsÚ_£rŸliz©iÚ_size_´‘ty
(
v®ue
);

1310 *
buf
 = 
NULL
;

1311 ià(
buf_size_by‹s
 == 0) {

1312  
NULL
;

1314 
buf
 = (*)
	`·rsÚ_m®loc
(
buf_size_by‹s
);

1315 ià(
buf
 =ğ
NULL
)

1316  
NULL
;

1317 
£rŸliz©iÚ_»suÉ
 = 
	`jsÚ_£rŸlize_to_bufãr_´‘ty
(
v®ue
, 
buf
, 
buf_size_by‹s
);

1318 ià(
£rŸliz©iÚ_»suÉ
 =ğ
JSONFau»
) {

1319 
	`jsÚ_ä“_£rŸlized_¡ršg
(
buf
);

1320  
NULL
;

1322  
buf
;

1323 
	}
}

1326 
	$jsÚ_ä“_£rŸlized_¡ršg
(*
¡ršg
) {

1327 
	`·rsÚ_ä“
(
¡ršg
);

1328 
	}
}

1330 
JSON_Stus
 
	$jsÚ_¬¿y_»move
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
ix
) {

1331 
size_t
 
Ï¡_–em’t_ix
 = 0;

1332 ià(
¬¿y
 =ğ
NULL
 || 
ix
 >ğ
	`jsÚ_¬¿y_g‘_couÁ
(array)) {

1333  
JSONFau»
;

1335 
Ï¡_–em’t_ix
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
¬¿y
) - 1;

1336 
	`jsÚ_v®ue_ä“
(
	`jsÚ_¬¿y_g‘_v®ue
(
¬¿y
, 
ix
));

1337 
¬¿y
->
couÁ
 -= 1;

1338 ià(
ix
 !ğ
Ï¡_–em’t_ix
)

1339 
¬¿y
->
™ems
[
ix
] = 
	`jsÚ_¬¿y_g‘_v®ue
×¼ay, 
Ï¡_–em’t_ix
);

1340  
JSONSucûss
;

1341 
	}
}

1343 
JSON_Stus
 
	$jsÚ_¬¿y_»¶aû_v®ue
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
ix
, 
JSON_V®ue
 *
v®ue
) {

1344 ià(
¬¿y
 =ğ
NULL
 || 
v®ue
 =ğNULL || 
ix
 >ğ
	`jsÚ_¬¿y_g‘_couÁ
(array)) {

1345  
JSONFau»
;

1347 
	`jsÚ_v®ue_ä“
(
	`jsÚ_¬¿y_g‘_v®ue
(
¬¿y
, 
ix
));

1348 
¬¿y
->
™ems
[
ix
] = 
v®ue
;

1349  
JSONSucûss
;

1350 
	}
}

1352 
JSON_Stus
 
	$jsÚ_¬¿y_»¶aû_¡ršg
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
i
, cÚ¡ * 
¡ršg
) {

1353 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_¡ršg
(
¡ršg
);

1354 ià(
v®ue
 =ğ
NULL
)

1355  
JSONFau»
;

1356 ià(
	`jsÚ_¬¿y_»¶aû_v®ue
(
¬¿y
, 
i
, 
v®ue
è=ğ
JSONFau»
) {

1357 
	`jsÚ_v®ue_ä“
(
v®ue
);

1358  
JSONFau»
;

1360  
JSONSucûss
;

1361 
	}
}

1363 
JSON_Stus
 
	$jsÚ_¬¿y_»¶aû_numb”
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
i
, 
numb”
) {

1364 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_numb”
(
numb”
);

1365 ià(
v®ue
 =ğ
NULL
)

1366  
JSONFau»
;

1367 ià(
	`jsÚ_¬¿y_»¶aû_v®ue
(
¬¿y
, 
i
, 
v®ue
è=ğ
JSONFau»
) {

1368 
	`jsÚ_v®ue_ä“
(
v®ue
);

1369  
JSONFau»
;

1371  
JSONSucûss
;

1372 
	}
}

1374 
JSON_Stus
 
	$jsÚ_¬¿y_»¶aû_boŞ—n
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
i
, 
boŞ—n
) {

1375 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_boŞ—n
(
boŞ—n
);

1376 ià(
v®ue
 =ğ
NULL
)

1377  
JSONFau»
;

1378 ià(
	`jsÚ_¬¿y_»¶aû_v®ue
(
¬¿y
, 
i
, 
v®ue
è=ğ
JSONFau»
) {

1379 
	`jsÚ_v®ue_ä“
(
v®ue
);

1380  
JSONFau»
;

1382  
JSONSucûss
;

1383 
	}
}

1385 
JSON_Stus
 
	$jsÚ_¬¿y_»¶aû_nuÎ
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
i
) {

1386 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_nuÎ
();

1387 ià(
v®ue
 =ğ
NULL
)

1388  
JSONFau»
;

1389 ià(
	`jsÚ_¬¿y_»¶aû_v®ue
(
¬¿y
, 
i
, 
v®ue
è=ğ
JSONFau»
) {

1390 
	`jsÚ_v®ue_ä“
(
v®ue
);

1391  
JSONFau»
;

1393  
JSONSucûss
;

1394 
	}
}

1396 
JSON_Stus
 
	$jsÚ_¬¿y_ş—r
(
JSON_A¼ay
 *
¬¿y
) {

1397 
size_t
 
i
 = 0;

1398 ià(
¬¿y
 =ğ
NULL
)

1399  
JSONFau»
;

1400 
i
 = 0; i < 
	`jsÚ_¬¿y_g‘_couÁ
(
¬¿y
); i++) {

1401 
	`jsÚ_v®ue_ä“
(
	`jsÚ_¬¿y_g‘_v®ue
(
¬¿y
, 
i
));

1403 
¬¿y
->
couÁ
 = 0;

1404  
JSONSucûss
;

1405 
	}
}

1407 
JSON_Stus
 
	$jsÚ_¬¿y_­³nd_v®ue
(
JSON_A¼ay
 *
¬¿y
, 
JSON_V®ue
 *
v®ue
) {

1408 ià(
¬¿y
 =ğ
NULL
 || 
v®ue
 == NULL)

1409  
JSONFau»
;

1410  
	`jsÚ_¬¿y_add
(
¬¿y
, 
v®ue
);

1411 
	}
}

1413 
JSON_Stus
 
	$jsÚ_¬¿y_­³nd_¡ršg
(
JSON_A¼ay
 *
¬¿y
, cÚ¡ *
¡ršg
) {

1414 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_¡ršg
(
¡ršg
);

1415 ià(
v®ue
 =ğ
NULL
)

1416  
JSONFau»
;

1417 ià(
	`jsÚ_¬¿y_­³nd_v®ue
(
¬¿y
, 
v®ue
è=ğ
JSONFau»
) {

1418 
	`jsÚ_v®ue_ä“
(
v®ue
);

1419  
JSONFau»
;

1421  
JSONSucûss
;

1422 
	}
}

1424 
JSON_Stus
 
	$jsÚ_¬¿y_­³nd_numb”
(
JSON_A¼ay
 *
¬¿y
, 
numb”
) {

1425 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_numb”
(
numb”
);

1426 ià(
v®ue
 =ğ
NULL
)

1427  
JSONFau»
;

1428 ià(
	`jsÚ_¬¿y_­³nd_v®ue
(
¬¿y
, 
v®ue
è=ğ
JSONFau»
) {

1429 
	`jsÚ_v®ue_ä“
(
v®ue
);

1430  
JSONFau»
;

1432  
JSONSucûss
;

1433 
	}
}

1435 
JSON_Stus
 
	$jsÚ_¬¿y_­³nd_boŞ—n
(
JSON_A¼ay
 *
¬¿y
, 
boŞ—n
) {

1436 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_boŞ—n
(
boŞ—n
);

1437 ià(
v®ue
 =ğ
NULL
)

1438  
JSONFau»
;

1439 ià(
	`jsÚ_¬¿y_­³nd_v®ue
(
¬¿y
, 
v®ue
è=ğ
JSONFau»
) {

1440 
	`jsÚ_v®ue_ä“
(
v®ue
);

1441  
JSONFau»
;

1443  
JSONSucûss
;

1444 
	}
}

1446 
JSON_Stus
 
	$jsÚ_¬¿y_­³nd_nuÎ
(
JSON_A¼ay
 *
¬¿y
) {

1447 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_nuÎ
();

1448 ià(
v®ue
 =ğ
NULL
)

1449  
JSONFau»
;

1450 ià(
	`jsÚ_¬¿y_­³nd_v®ue
(
¬¿y
, 
v®ue
è=ğ
JSONFau»
) {

1451 
	`jsÚ_v®ue_ä“
(
v®ue
);

1452  
JSONFau»
;

1454  
JSONSucûss
;

1455 
	}
}

1457 
JSON_Stus
 
	$jsÚ_objeù_£t_v®ue
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
JSON_V®ue
 *
v®ue
) {

1458 
size_t
 
i
 = 0;

1459 
JSON_V®ue
 *
Şd_v®ue
;

1460 ià(
objeù
 =ğ
NULL
 || 
Çme
 =ğNULL || 
v®ue
 == NULL)

1461  
JSONFau»
;

1462 
Şd_v®ue
 = 
	`jsÚ_objeù_g‘_v®ue
(
objeù
, 
Çme
);

1463 ià(
Şd_v®ue
 !ğ
NULL
) {

1464 
	`jsÚ_v®ue_ä“
(
Şd_v®ue
);

1465 
i
 = 0; i < 
	`jsÚ_objeù_g‘_couÁ
(
objeù
); i++) {

1466 ià(
	`¡rcmp
(
objeù
->
Çmes
[
i
], 
Çme
) == 0) {

1467 
objeù
->
v®ues
[
i
] = 
v®ue
;

1468  
JSONSucûss
;

1473  
	`jsÚ_objeù_add
(
objeù
, 
Çme
, 
v®ue
);

1474 
	}
}

1476 
JSON_Stus
 
	$jsÚ_objeù_£t_¡ršg
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, cÚ¡ *
¡ršg
) {

1477  
	`jsÚ_objeù_£t_v®ue
(
objeù
, 
Çme
, 
	`jsÚ_v®ue_š™_¡ršg
(
¡ršg
));

1478 
	}
}

1480 
JSON_Stus
 
	$jsÚ_objeù_£t_numb”
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
numb”
) {

1481  
	`jsÚ_objeù_£t_v®ue
(
objeù
, 
Çme
, 
	`jsÚ_v®ue_š™_numb”
(
numb”
));

1482 
	}
}

1484 
JSON_Stus
 
	$jsÚ_objeù_£t_boŞ—n
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
boŞ—n
) {

1485  
	`jsÚ_objeù_£t_v®ue
(
objeù
, 
Çme
, 
	`jsÚ_v®ue_š™_boŞ—n
(
boŞ—n
));

1486 
	}
}

1488 
JSON_Stus
 
	$jsÚ_objeù_£t_nuÎ
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

1489  
	`jsÚ_objeù_£t_v®ue
(
objeù
, 
Çme
, 
	`jsÚ_v®ue_š™_nuÎ
());

1490 
	}
}

1492 
JSON_Stus
 
	$jsÚ_objeù_dÙ£t_v®ue
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
JSON_V®ue
 *
v®ue
) {

1493 cÚ¡ *
dÙ_pos
 = 
NULL
;

1494 *
cu¼’t_Çme
 = 
NULL
;

1495 
JSON_Objeù
 *
‹mp_obj
 = 
NULL
;

1496 
JSON_V®ue
 *
Ãw_v®ue
 = 
NULL
;

1497 ià(
v®ue
 =ğ
NULL
 || 
Çme
 == NULL || value == NULL)

1498  
JSONFau»
;

1499 
dÙ_pos
 = 
	`¡rchr
(
Çme
, '.');

1500 ià(
dÙ_pos
 =ğ
NULL
) {

1501  
	`jsÚ_objeù_£t_v®ue
(
objeù
, 
Çme
, 
v®ue
);

1503 
cu¼’t_Çme
 = 
	`·rsÚ_¡ºdup
(
Çme
, 
dÙ_pos
 -‚ame);

1504 
‹mp_obj
 = 
	`jsÚ_objeù_g‘_objeù
(
objeù
, 
cu¼’t_Çme
);

1505 ià(
‹mp_obj
 =ğ
NULL
) {

1506 
Ãw_v®ue
 = 
	`jsÚ_v®ue_š™_objeù
();

1507 ià(
Ãw_v®ue
 =ğ
NULL
) {

1508 
	`·rsÚ_ä“
(
cu¼’t_Çme
);

1509  
JSONFau»
;

1511 ià(
	`jsÚ_objeù_add
(
objeù
, 
cu¼’t_Çme
, 
Ãw_v®ue
è=ğ
JSONFau»
) {

1512 
	`jsÚ_v®ue_ä“
(
Ãw_v®ue
);

1513 
	`·rsÚ_ä“
(
cu¼’t_Çme
);

1514  
JSONFau»
;

1516 
‹mp_obj
 = 
	`jsÚ_objeù_g‘_objeù
(
objeù
, 
cu¼’t_Çme
);

1518 
	`·rsÚ_ä“
(
cu¼’t_Çme
);

1519  
	`jsÚ_objeù_dÙ£t_v®ue
(
‹mp_obj
, 
dÙ_pos
 + 1, 
v®ue
);

1521 
	}
}

1523 
JSON_Stus
 
	$jsÚ_objeù_dÙ£t_¡ršg
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, cÚ¡ *
¡ršg
) {

1524 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_¡ršg
(
¡ršg
);

1525 ià(
v®ue
 =ğ
NULL
)

1526  
JSONFau»
;

1527 ià(
	`jsÚ_objeù_dÙ£t_v®ue
(
objeù
, 
Çme
, 
v®ue
è=ğ
JSONFau»
) {

1528 
	`jsÚ_v®ue_ä“
(
v®ue
);

1529  
JSONFau»
;

1531  
JSONSucûss
;

1532 
	}
}

1534 
JSON_Stus
 
	$jsÚ_objeù_dÙ£t_numb”
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
numb”
) {

1535 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_numb”
(
numb”
);

1536 ià(
v®ue
 =ğ
NULL
)

1537  
JSONFau»
;

1538 ià(
	`jsÚ_objeù_dÙ£t_v®ue
(
objeù
, 
Çme
, 
v®ue
è=ğ
JSONFau»
) {

1539 
	`jsÚ_v®ue_ä“
(
v®ue
);

1540  
JSONFau»
;

1542  
JSONSucûss
;

1543 
	}
}

1545 
JSON_Stus
 
	$jsÚ_objeù_dÙ£t_boŞ—n
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
boŞ—n
) {

1546 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_boŞ—n
(
boŞ—n
);

1547 ià(
v®ue
 =ğ
NULL
)

1548  
JSONFau»
;

1549 ià(
	`jsÚ_objeù_dÙ£t_v®ue
(
objeù
, 
Çme
, 
v®ue
è=ğ
JSONFau»
) {

1550 
	`jsÚ_v®ue_ä“
(
v®ue
);

1551  
JSONFau»
;

1553  
JSONSucûss
;

1554 
	}
}

1556 
JSON_Stus
 
	$jsÚ_objeù_dÙ£t_nuÎ
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

1557 
JSON_V®ue
 *
v®ue
 = 
	`jsÚ_v®ue_š™_nuÎ
();

1558 ià(
v®ue
 =ğ
NULL
)

1559  
JSONFau»
;

1560 ià(
	`jsÚ_objeù_dÙ£t_v®ue
(
objeù
, 
Çme
, 
v®ue
è=ğ
JSONFau»
) {

1561 
	`jsÚ_v®ue_ä“
(
v®ue
);

1562  
JSONFau»
;

1564  
JSONSucûss
;

1565 
	}
}

1567 
JSON_Stus
 
	$jsÚ_objeù_»move
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

1568 
size_t
 
i
 = 0, 
Ï¡_™em_šdex
 = 0;

1569 ià(
objeù
 =ğ
NULL
 || 
	`jsÚ_objeù_g‘_v®ue
(objeù, 
Çme
) == NULL)

1570  
JSONFau»
;

1571 
Ï¡_™em_šdex
 = 
	`jsÚ_objeù_g‘_couÁ
(
objeù
) - 1;

1572 
i
 = 0; i < 
	`jsÚ_objeù_g‘_couÁ
(
objeù
); i++) {

1573 ià(
	`¡rcmp
(
objeù
->
Çmes
[
i
], 
Çme
) == 0) {

1574 
	`·rsÚ_ä“
(
objeù
->
Çmes
[
i
]);

1575 
	`jsÚ_v®ue_ä“
(
objeù
->
v®ues
[
i
]);

1576 ià(
i
 !ğ
Ï¡_™em_šdex
) {

1577 
objeù
->
Çmes
[
i
] = objeù->Çmes[
Ï¡_™em_šdex
];

1578 
objeù
->
v®ues
[
i
] = objeù->v®ues[
Ï¡_™em_šdex
];

1580 
objeù
->
couÁ
 -= 1;

1581  
JSONSucûss
;

1584  
JSONFau»
;

1585 
	}
}

1587 
JSON_Stus
 
	$jsÚ_objeù_dÙ»move
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
) {

1588 cÚ¡ *
dÙ_pos
 = 
	`¡rchr
(
Çme
, '.');

1589 *
cu¼’t_Çme
 = 
NULL
;

1590 
JSON_Objeù
 *
‹mp_obj
 = 
NULL
;

1591 ià(
dÙ_pos
 =ğ
NULL
) {

1592  
	`jsÚ_objeù_»move
(
objeù
, 
Çme
);

1594 
cu¼’t_Çme
 = 
	`·rsÚ_¡ºdup
(
Çme
, 
dÙ_pos
 -‚ame);

1595 
‹mp_obj
 = 
	`jsÚ_objeù_g‘_objeù
(
objeù
, 
cu¼’t_Çme
);

1596 ià(
‹mp_obj
 =ğ
NULL
) {

1597 
	`·rsÚ_ä“
(
cu¼’t_Çme
);

1598  
JSONFau»
;

1600 
	`·rsÚ_ä“
(
cu¼’t_Çme
);

1601  
	`jsÚ_objeù_dÙ»move
(
‹mp_obj
, 
dÙ_pos
 + 1);

1603 
	}
}

1605 
JSON_Stus
 
	$jsÚ_objeù_ş—r
(
JSON_Objeù
 *
objeù
) {

1606 
size_t
 
i
 = 0;

1607 ià(
objeù
 =ğ
NULL
) {

1608  
JSONFau»
;

1610 
i
 = 0; i < 
	`jsÚ_objeù_g‘_couÁ
(
objeù
); i++) {

1611 
	`·rsÚ_ä“
(
objeù
->
Çmes
[
i
]);

1612 
	`jsÚ_v®ue_ä“
(
objeù
->
v®ues
[
i
]);

1614 
objeù
->
couÁ
 = 0;

1615  
JSONSucûss
;

1616 
	}
}

1618 
JSON_Stus
 
	$jsÚ_v®id©e
(cÚ¡ 
JSON_V®ue
 *
schema
, cÚ¡ JSON_V®u*
v®ue
) {

1619 
JSON_V®ue
 *
‹mp_schema_v®ue
 = 
NULL
, *
‹mp_v®ue
 = NULL;

1620 
JSON_A¼ay
 *
schema_¬¿y
 = 
NULL
, *
v®ue_¬¿y
 = NULL;

1621 
JSON_Objeù
 *
schema_objeù
 = 
NULL
, *
v®ue_objeù
 = NULL;

1622 
JSON_V®ue_Ty³
 
schema_ty³
 = 
JSONE¼Ü
, 
v®ue_ty³
 = JSONError;

1623 cÚ¡ *
key
 = 
NULL
;

1624 
size_t
 
i
 = 0, 
couÁ
 = 0;

1625 ià(
schema
 =ğ
NULL
 || 
v®ue
 == NULL)

1626  
JSONFau»
;

1627 
schema_ty³
 = 
	`jsÚ_v®ue_g‘_ty³
(
schema
);

1628 
v®ue_ty³
 = 
	`jsÚ_v®ue_g‘_ty³
(
v®ue
);

1629 ià(
schema_ty³
 !ğ
v®ue_ty³
 && schema_ty³ !ğ
JSONNuÎ
)

1630  
JSONFau»
;

1631 
schema_ty³
) {

1632 
JSONA¼ay
:

1633 
schema_¬¿y
 = 
	`jsÚ_v®ue_g‘_¬¿y
(
schema
);

1634 
v®ue_¬¿y
 = 
	`jsÚ_v®ue_g‘_¬¿y
(
v®ue
);

1635 
couÁ
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
schema_¬¿y
);

1636 ià(
couÁ
 == 0)

1637  
JSONSucûss
;

1639 
‹mp_schema_v®ue
 = 
	`jsÚ_¬¿y_g‘_v®ue
(
schema_¬¿y
, 0);

1640 
i
 = 0; i < 
	`jsÚ_¬¿y_g‘_couÁ
(
v®ue_¬¿y
); i++) {

1641 
‹mp_v®ue
 = 
	`jsÚ_¬¿y_g‘_v®ue
(
v®ue_¬¿y
, 
i
);

1642 ià(
	`jsÚ_v®id©e
(
‹mp_schema_v®ue
, 
‹mp_v®ue
) == 0) {

1643  
JSONFau»
;

1646  
JSONSucûss
;

1647 
JSONObjeù
:

1648 
schema_objeù
 = 
	`jsÚ_v®ue_g‘_objeù
(
schema
);

1649 
v®ue_objeù
 = 
	`jsÚ_v®ue_g‘_objeù
(
v®ue
);

1650 
couÁ
 = 
	`jsÚ_objeù_g‘_couÁ
(
schema_objeù
);

1651 ià(
couÁ
 == 0)

1652  
JSONSucûss
;

1653 ià(
	`jsÚ_objeù_g‘_couÁ
(
v®ue_objeù
è< 
couÁ
)

1654  
JSONFau»
;

1655 
i
 = 0; i < 
couÁ
; i++) {

1656 
key
 = 
	`jsÚ_objeù_g‘_Çme
(
schema_objeù
, 
i
);

1657 
‹mp_schema_v®ue
 = 
	`jsÚ_objeù_g‘_v®ue
(
schema_objeù
, 
key
);

1658 
‹mp_v®ue
 = 
	`jsÚ_objeù_g‘_v®ue
(
v®ue_objeù
, 
key
);

1659 ià(
‹mp_v®ue
 =ğ
NULL
)

1660  
JSONFau»
;

1661 ià(
	`jsÚ_v®id©e
(
‹mp_schema_v®ue
, 
‹mp_v®ue
è=ğ
JSONFau»
)

1662  
JSONFau»
;

1664  
JSONSucûss
;

1665 
JSONSŒšg
: 
JSONNumb”
: 
JSONBoŞ—n
: 
JSONNuÎ
:

1666  
JSONSucûss
;

1667 
JSONE¼Ü
: :

1668  
JSONFau»
;

1670 
	}
}

1672 
JSON_Stus
 
	$jsÚ_v®ue_equ®s
(cÚ¡ 
JSON_V®ue
 *
a
, cÚ¡ JSON_V®u*
b
) {

1673 
JSON_Objeù
 *
a_objeù
 = 
NULL
, *
b_objeù
 = NULL;

1674 
JSON_A¼ay
 *
a_¬¿y
 = 
NULL
, *
b_¬¿y
 = NULL;

1675 cÚ¡ *
a_¡ršg
 = 
NULL
, *
b_¡ršg
 = NULL;

1676 cÚ¡ *
key
 = 
NULL
;

1677 
size_t
 
a_couÁ
 = 0, 
b_couÁ
 = 0, 
i
 = 0;

1678 
JSON_V®ue_Ty³
 
a_ty³
, 
b_ty³
;

1679 
a_ty³
 = 
	`jsÚ_v®ue_g‘_ty³
(
a
);

1680 
b_ty³
 = 
	`jsÚ_v®ue_g‘_ty³
(
b
);

1681 ià(
a_ty³
 !ğ
b_ty³
) {

1684 
a_ty³
) {

1685 
JSONA¼ay
:

1686 
a_¬¿y
 = 
	`jsÚ_v®ue_g‘_¬¿y
(
a
);

1687 
b_¬¿y
 = 
	`jsÚ_v®ue_g‘_¬¿y
(
b
);

1688 
a_couÁ
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
a_¬¿y
);

1689 
b_couÁ
 = 
	`jsÚ_¬¿y_g‘_couÁ
(
b_¬¿y
);

1690 ià(
a_couÁ
 !ğ
b_couÁ
) {

1693 
i
 = 0; i < 
a_couÁ
; i++) {

1694 ià(!
	`jsÚ_v®ue_equ®s
(
	`jsÚ_¬¿y_g‘_v®ue
(
a_¬¿y
, 
i
),

1695 
	`jsÚ_¬¿y_g‘_v®ue
(
b_¬¿y
, 
i
))) {

1700 
JSONObjeù
:

1701 
a_objeù
 = 
	`jsÚ_v®ue_g‘_objeù
(
a
);

1702 
b_objeù
 = 
	`jsÚ_v®ue_g‘_objeù
(
b
);

1703 
a_couÁ
 = 
	`jsÚ_objeù_g‘_couÁ
(
a_objeù
);

1704 
b_couÁ
 = 
	`jsÚ_objeù_g‘_couÁ
(
b_objeù
);

1705 ià(
a_couÁ
 !ğ
b_couÁ
) {

1708 
i
 = 0; i < 
a_couÁ
; i++) {

1709 
key
 = 
	`jsÚ_objeù_g‘_Çme
(
a_objeù
, 
i
);

1710 ià(!
	`jsÚ_v®ue_equ®s
(
	`jsÚ_objeù_g‘_v®ue
(
a_objeù
, 
key
),

1711 
	`jsÚ_objeù_g‘_v®ue
(
b_objeù
, 
key
))) {

1716 
JSONSŒšg
:

1717 
a_¡ršg
 = 
	`jsÚ_v®ue_g‘_¡ršg
(
a
);

1718 
b_¡ršg
 = 
	`jsÚ_v®ue_g‘_¡ršg
(
b
);

1719  
	`¡rcmp
(
a_¡ršg
, 
b_¡ršg
) == 0;

1720 
JSONBoŞ—n
:

1721  
	`jsÚ_v®ue_g‘_boŞ—n
(
a
è=ğjsÚ_v®ue_g‘_boŞ—n(
b
);

1722 
JSONNumb”
:

1723  
	`çbs
(
	`jsÚ_v®ue_g‘_numb”
(
a
è- jsÚ_v®ue_g‘_numb”(
b
)) < 0.000001;

1724 
JSONE¼Ü
:

1726 
JSONNuÎ
:

1731 
	}
}

1733 
JSON_V®ue_Ty³
 
	$jsÚ_ty³
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1734  
	`jsÚ_v®ue_g‘_ty³
(
v®ue
);

1735 
	}
}

1737 
JSON_Objeù
 * 
	$jsÚ_objeù
 (cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1738  
	`jsÚ_v®ue_g‘_objeù
(
v®ue
);

1739 
	}
}

1741 
JSON_A¼ay
 * 
	$jsÚ_¬¿y
 (cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1742  
	`jsÚ_v®ue_g‘_¬¿y
(
v®ue
);

1743 
	}
}

1745 cÚ¡ * 
	$jsÚ_¡ršg
 (cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1746  
	`jsÚ_v®ue_g‘_¡ršg
(
v®ue
);

1747 
	}
}

1749 
	$jsÚ_numb”
 (cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1750  
	`jsÚ_v®ue_g‘_numb”
(
v®ue
);

1751 
	}
}

1753 
	$jsÚ_boŞ—n
(cÚ¡ 
JSON_V®ue
 *
v®ue
) {

1754  
	`jsÚ_v®ue_g‘_boŞ—n
(
v®ue
);

1755 
	}
}

1757 
	$jsÚ_£t_®loÿtiÚ_funùiÚs
(
JSON_M®loc_FunùiÚ
 
m®loc_fun
, 
JSON_F»e_FunùiÚ
 
ä“_fun
) {

1758 
·rsÚ_m®loc
 = 
m®loc_fun
;

1759 
·rsÚ_ä“
 = 
ä“_fun
;

1760 
	}
}

	@parson/parson.h

24 #iâdeà
·rsÚ_·rsÚ_h


25 
	#·rsÚ_·rsÚ_h


	)

27 #ifdeà
__ılu¥lus


32 
	~<¡ddef.h
>

35 
jsÚ_objeù_t
 
	tJSON_Objeù
;

36 
jsÚ_¬¿y_t
 
	tJSON_A¼ay
;

37 
jsÚ_v®ue_t
 
	tJSON_V®ue
;

39 
	ejsÚ_v®ue_ty³
 {

40 
JSONE¼Ü
 = -1,

41 
JSONNuÎ
 = 1,

42 
JSONSŒšg
 = 2,

43 
JSONNumb”
 = 3,

44 
JSONObjeù
 = 4,

45 
JSONA¼ay
 = 5,

46 
JSONBoŞ—n
 = 6

48 
	tJSON_V®ue_Ty³
;

50 
	ejsÚ_»suÉ_t
 {

51 
JSONSucûss
 = 0,

52 
JSONFau»
 = -1

54 
	tJSON_Stus
;

56 * (*
	tJSON_M®loc_FunùiÚ
)(
	tsize_t
);

57 (*
JSON_F»e_FunùiÚ
)(*);

61 
jsÚ_£t_®loÿtiÚ_funùiÚs
(
JSON_M®loc_FunùiÚ
 
m®loc_fun
, 
JSON_F»e_FunùiÚ
 
ä“_fun
);

64 
JSON_V®ue
 * 
jsÚ_·r£_fe
(cÚ¡ *
f’ame
);

68 
JSON_V®ue
 * 
jsÚ_·r£_fe_w™h_comm’ts
(cÚ¡ *
f’ame
);

71 
JSON_V®ue
 * 
jsÚ_·r£_¡ršg
(cÚ¡ *
¡ršg
);

75 
JSON_V®ue
 * 
jsÚ_·r£_¡ršg_w™h_comm’ts
(cÚ¡ *
¡ršg
);

78 
size_t
 
jsÚ_£rŸliz©iÚ_size
(cÚ¡ 
JSON_V®ue
 *
v®ue
);

79 
JSON_Stus
 
jsÚ_£rŸlize_to_bufãr
(cÚ¡ 
JSON_V®ue
 *
v®ue
, *
buf
, 
size_t
 
buf_size_š_by‹s
);

80 
JSON_Stus
 
jsÚ_£rŸlize_to_fe
(cÚ¡ 
JSON_V®ue
 *
v®ue
, cÚ¡ *
f’ame
);

81 * 
jsÚ_£rŸlize_to_¡ršg
(cÚ¡ 
JSON_V®ue
 *
v®ue
);

84 
size_t
 
jsÚ_£rŸliz©iÚ_size_´‘ty
(cÚ¡ 
JSON_V®ue
 *
v®ue
);

85 
JSON_Stus
 
jsÚ_£rŸlize_to_bufãr_´‘ty
(cÚ¡ 
JSON_V®ue
 *
v®ue
, *
buf
, 
size_t
 
buf_size_š_by‹s
);

86 
JSON_Stus
 
jsÚ_£rŸlize_to_fe_´‘ty
(cÚ¡ 
JSON_V®ue
 *
v®ue
, cÚ¡ *
f’ame
);

87 * 
jsÚ_£rŸlize_to_¡ršg_´‘ty
(cÚ¡ 
JSON_V®ue
 *
v®ue
);

89 
jsÚ_ä“_£rŸlized_¡ršg
(*
¡ršg
);

92 
jsÚ_v®ue_equ®s
(cÚ¡ 
JSON_V®ue
 *
a
, cÚ¡ JSON_V®u*
b
);

104 
JSON_Stus
 
jsÚ_v®id©e
(cÚ¡ 
JSON_V®ue
 *
schema
, cÚ¡ JSON_V®u*
v®ue
);

109 
JSON_V®ue
 * 
jsÚ_objeù_g‘_v®ue
 (cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

110 cÚ¡ * 
jsÚ_objeù_g‘_¡ršg
 (cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

111 
JSON_Objeù
 * 
jsÚ_objeù_g‘_objeù
 (cÚ¡ JSON_Objeù *
objeù
, cÚ¡ *
Çme
);

112 
JSON_A¼ay
 * 
jsÚ_objeù_g‘_¬¿y
 (cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

113 
jsÚ_objeù_g‘_numb”
 (cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

114 
jsÚ_objeù_g‘_boŞ—n
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

120 
JSON_V®ue
 * 
jsÚ_objeù_dÙg‘_v®ue
 (cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

121 cÚ¡ * 
jsÚ_objeù_dÙg‘_¡ršg
 (cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

122 
JSON_Objeù
 * 
jsÚ_objeù_dÙg‘_objeù
 (cÚ¡ JSON_Objeù *
objeù
, cÚ¡ *
Çme
);

123 
JSON_A¼ay
 * 
jsÚ_objeù_dÙg‘_¬¿y
 (cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

124 
jsÚ_objeù_dÙg‘_numb”
 (cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

125 
jsÚ_objeù_dÙg‘_boŞ—n
(cÚ¡ 
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

128 
size_t
 
jsÚ_objeù_g‘_couÁ
(cÚ¡ 
JSON_Objeù
 *
objeù
);

129 cÚ¡ * 
jsÚ_objeù_g‘_Çme
 (cÚ¡ 
JSON_Objeù
 *
objeù
, 
size_t
 
šdex
);

133 
JSON_Stus
 
jsÚ_objeù_£t_v®ue
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
JSON_V®ue
 *
v®ue
);

134 
JSON_Stus
 
jsÚ_objeù_£t_¡ršg
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, cÚ¡ *
¡ršg
);

135 
JSON_Stus
 
jsÚ_objeù_£t_numb”
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
numb”
);

136 
JSON_Stus
 
jsÚ_objeù_£t_boŞ—n
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
boŞ—n
);

137 
JSON_Stus
 
jsÚ_objeù_£t_nuÎ
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

141 
JSON_Stus
 
jsÚ_objeù_dÙ£t_v®ue
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
JSON_V®ue
 *
v®ue
);

142 
JSON_Stus
 
jsÚ_objeù_dÙ£t_¡ršg
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, cÚ¡ *
¡ršg
);

143 
JSON_Stus
 
jsÚ_objeù_dÙ£t_numb”
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
numb”
);

144 
JSON_Stus
 
jsÚ_objeù_dÙ£t_boŞ—n
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
, 
boŞ—n
);

145 
JSON_Stus
 
jsÚ_objeù_dÙ£t_nuÎ
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

148 
JSON_Stus
 
jsÚ_objeù_»move
(
JSON_Objeù
 *
objeù
, cÚ¡ *
Çme
);

151 
JSON_Stus
 
jsÚ_objeù_dÙ»move
(
JSON_Objeù
 *
objeù
, cÚ¡ *
key
);

154 
JSON_Stus
 
jsÚ_objeù_ş—r
(
JSON_Objeù
 *
objeù
);

159 
JSON_V®ue
 * 
jsÚ_¬¿y_g‘_v®ue
 (cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
);

160 cÚ¡ * 
jsÚ_¬¿y_g‘_¡ršg
 (cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
);

161 
JSON_Objeù
 * 
jsÚ_¬¿y_g‘_objeù
 (cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
);

162 
JSON_A¼ay
 * 
jsÚ_¬¿y_g‘_¬¿y
 (cÚ¡ JSON_A¼ay *
¬¿y
, 
size_t
 
šdex
);

163 
jsÚ_¬¿y_g‘_numb”
 (cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
);

164 
jsÚ_¬¿y_g‘_boŞ—n
(cÚ¡ 
JSON_A¼ay
 *
¬¿y
, 
size_t
 
šdex
);

165 
size_t
 
jsÚ_¬¿y_g‘_couÁ
 (cÚ¡ 
JSON_A¼ay
 *
¬¿y
);

169 
JSON_Stus
 
jsÚ_¬¿y_»move
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
i
);

174 
JSON_Stus
 
jsÚ_¬¿y_»¶aû_v®ue
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
i
, 
JSON_V®ue
 *
v®ue
);

175 
JSON_Stus
 
jsÚ_¬¿y_»¶aû_¡ršg
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
i
, cÚ¡ * 
¡ršg
);

176 
JSON_Stus
 
jsÚ_¬¿y_»¶aû_numb”
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
i
, 
numb”
);

177 
JSON_Stus
 
jsÚ_¬¿y_»¶aû_boŞ—n
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
i
, 
boŞ—n
);

178 
JSON_Stus
 
jsÚ_¬¿y_»¶aû_nuÎ
(
JSON_A¼ay
 *
¬¿y
, 
size_t
 
i
);

181 
JSON_Stus
 
jsÚ_¬¿y_ş—r
(
JSON_A¼ay
 *
¬¿y
);

185 
JSON_Stus
 
jsÚ_¬¿y_­³nd_v®ue
(
JSON_A¼ay
 *
¬¿y
, 
JSON_V®ue
 *
v®ue
);

186 
JSON_Stus
 
jsÚ_¬¿y_­³nd_¡ršg
(
JSON_A¼ay
 *
¬¿y
, cÚ¡ *
¡ršg
);

187 
JSON_Stus
 
jsÚ_¬¿y_­³nd_numb”
(
JSON_A¼ay
 *
¬¿y
, 
numb”
);

188 
JSON_Stus
 
jsÚ_¬¿y_­³nd_boŞ—n
(
JSON_A¼ay
 *
¬¿y
, 
boŞ—n
);

189 
JSON_Stus
 
jsÚ_¬¿y_­³nd_nuÎ
(
JSON_A¼ay
 *
¬¿y
);

194 
JSON_V®ue
 * 
jsÚ_v®ue_š™_objeù
 ();

195 
JSON_V®ue
 * 
jsÚ_v®ue_š™_¬¿y
 ();

196 
JSON_V®ue
 * 
jsÚ_v®ue_š™_¡ršg
 (cÚ¡ *
¡ršg
);

197 
JSON_V®ue
 * 
jsÚ_v®ue_š™_numb”
 (
numb”
);

198 
JSON_V®ue
 * 
jsÚ_v®ue_š™_boŞ—n
(
boŞ—n
);

199 
JSON_V®ue
 * 
jsÚ_v®ue_š™_nuÎ
 ();

200 
JSON_V®ue
 * 
jsÚ_v®ue_d“p_cİy
 (cÚ¡ JSON_V®u*
v®ue
);

201 
jsÚ_v®ue_ä“
 (
JSON_V®ue
 *
v®ue
);

203 
JSON_V®ue_Ty³
 
jsÚ_v®ue_g‘_ty³
 (cÚ¡ 
JSON_V®ue
 *
v®ue
);

204 
JSON_Objeù
 * 
jsÚ_v®ue_g‘_objeù
 (cÚ¡ 
JSON_V®ue
 *
v®ue
);

205 
JSON_A¼ay
 * 
jsÚ_v®ue_g‘_¬¿y
 (cÚ¡ 
JSON_V®ue
 *
v®ue
);

206 cÚ¡ * 
jsÚ_v®ue_g‘_¡ršg
 (cÚ¡ 
JSON_V®ue
 *
v®ue
);

207 
jsÚ_v®ue_g‘_numb”
 (cÚ¡ 
JSON_V®ue
 *
v®ue
);

208 
jsÚ_v®ue_g‘_boŞ—n
(cÚ¡ 
JSON_V®ue
 *
v®ue
);

211 
JSON_V®ue_Ty³
 
jsÚ_ty³
 (cÚ¡ 
JSON_V®ue
 *
v®ue
);

212 
JSON_Objeù
 * 
jsÚ_objeù
 (cÚ¡ 
JSON_V®ue
 *
v®ue
);

213 
JSON_A¼ay
 * 
jsÚ_¬¿y
 (cÚ¡ 
JSON_V®ue
 *
v®ue
);

214 cÚ¡ * 
jsÚ_¡ršg
 (cÚ¡ 
JSON_V®ue
 *
v®ue
);

215 
jsÚ_numb”
 (cÚ¡ 
JSON_V®ue
 *
v®ue
);

216 
jsÚ_boŞ—n
(cÚ¡ 
JSON_V®ue
 *
v®ue
);

218 #ifdeà
__ılu¥lus


	@proto/nc_memcache.c

18 
	~<ùy³.h
>

20 
	~<nc_cÜe.h
>

21 
	~<nc_´Ùo.h
>

33 
	#MEMCACHE_MAX_KEY_LENGTH
 250

	)

39 
boŞ


40 
	$memÿche_¡Üage
(
msg
 *
r
)

42 
r
->
ty³
) {

43 
MSG_REQ_MC_SET
:

44 
MSG_REQ_MC_CAS
:

45 
MSG_REQ_MC_ADD
:

46 
MSG_REQ_MC_REPLACE
:

47 
MSG_REQ_MC_APPEND
:

48 
MSG_REQ_MC_PREPEND
:

49  
Œue
;

55  
çl£
;

56 
	}
}

62 
boŞ


63 
	$memÿche_ÿs
(
msg
 *
r
)

65 ià(
r
->
ty³
 =ğ
MSG_REQ_MC_CAS
) {

66  
Œue
;

69  
çl£
;

70 
	}
}

76 
boŞ


77 
	$memÿche_»Œ›v®
(
msg
 *
r
)

79 
r
->
ty³
) {

80 
MSG_REQ_MC_GET
:

81 
MSG_REQ_MC_GETS
:

82  
Œue
;

88  
çl£
;

89 
	}
}

95 
boŞ


96 
	$memÿche_¬™hm‘ic
(
msg
 *
r
)

98 
r
->
ty³
) {

99 
MSG_REQ_MC_INCR
:

100 
MSG_REQ_MC_DECR
:

101  
Œue
;

107  
çl£
;

108 
	}
}

114 
boŞ


115 
	$memÿche_d–‘e
(
msg
 *
r
)

117 ià(
r
->
ty³
 =ğ
MSG_REQ_MC_DELETE
) {

118  
Œue
;

121  
çl£
;

122 
	}
}

128 
boŞ


129 
	$memÿche_touch
(
msg
 *
r
)

131 ià(
r
->
ty³
 =ğ
MSG_REQ_MC_TOUCH
) {

132  
Œue
;

135  
çl£
;

136 
	}
}

139 
	$memÿche_·r£_»q
(
msg
 *
r
)

141 
mbuf
 *
b
;

142 
ušt8_t
 *
p
, *
m
;

143 
ušt8_t
 
ch
;

145 
SW_START
,

146 
SW_REQ_TYPE
,

147 
SW_SPACES_BEFORE_KEY
,

148 
SW_KEY
,

149 
SW_SPACES_BEFORE_KEYS
,

150 
SW_SPACES_BEFORE_FLAGS
,

151 
SW_FLAGS
,

152 
SW_SPACES_BEFORE_EXPIRY
,

153 
SW_EXPIRY
,

154 
SW_SPACES_BEFORE_VLEN
,

155 
SW_VLEN
,

156 
SW_SPACES_BEFORE_CAS
,

157 
SW_CAS
,

158 
SW_RUNTO_VAL
,

159 
SW_VAL
,

160 
SW_SPACES_BEFORE_NUM
,

161 
SW_NUM
,

162 
SW_RUNTO_CRLF
,

163 
SW_CRLF
,

164 
SW_NOREPLY
,

165 
SW_AFTER_NOREPLY
,

166 
SW_ALMOST_DONE
,

167 
SW_SENTINEL


168 } 
¡©e
;

170 
¡©e
 = 
r
->state;

171 
b
 = 
	`STAILQ_LAST
(&
r
->
mhdr
, 
mbuf
, 
Ãxt
);

173 
	`ASSERT
(
r
->
»que¡
);

174 
	`ASSERT
(!
r
->
»dis
);

175 
	`ASSERT
(
¡©e
 >ğ
SW_START
 && s‹ < 
SW_SENTINEL
);

176 
	`ASSERT
(
b
 !ğ
NULL
);

177 
	`ASSERT
(
b
->
pos
 <ğb->
Ï¡
);

180 
	`ASSERT
(
r
->
pos
 !ğ
NULL
);

181 
	`ASSERT
(
r
->
pos
 >ğ
b
->po &&„->po <ğb->
Ï¡
);

183 
p
 = 
r
->
pos
;… < 
b
->
Ï¡
;…++) {

184 
ch
 = *
p
;

186 
¡©e
) {

188 
SW_START
:

189 ià(
ch
 == ' ') {

193 ià(!
	`i¦ow”
(
ch
)) {

194 
”rÜ
;

198 
r
->
tok’
 = 
p
;

199 
¡©e
 = 
SW_REQ_TYPE
;

203 
SW_REQ_TYPE
:

204 ià(
ch
 =ğ' ' || ch =ğ
CR
) {

206 
m
 = 
r
->
tok’
;

207 
r
->
tok’
 = 
NULL
;

208 
r
->
ty³
 = 
MSG_UNKNOWN
;

209 
r
->
Çrg
++;

211 
p
 - 
m
) {

214 ià(
	`¡r4cmp
(
m
, 'g', 'e', 't', ' ')) {

215 
r
->
ty³
 = 
MSG_REQ_MC_GET
;

219 ià(
	`¡r4cmp
(
m
, 's', 'e', 't', ' ')) {

220 
r
->
ty³
 = 
MSG_REQ_MC_SET
;

224 ià(
	`¡r4cmp
(
m
, 'a', 'd', 'd', ' ')) {

225 
r
->
ty³
 = 
MSG_REQ_MC_ADD
;

229 ià(
	`¡r4cmp
(
m
, 'c', 'a', 's', ' ')) {

230 
r
->
ty³
 = 
MSG_REQ_MC_CAS
;

237 ià(
	`¡r4cmp
(
m
, 'g', 'e', 't', 's')) {

238 
r
->
ty³
 = 
MSG_REQ_MC_GETS
;

242 ià(
	`¡r4cmp
(
m
, 'i', 'n', 'c', 'r')) {

243 
r
->
ty³
 = 
MSG_REQ_MC_INCR
;

247 ià(
	`¡r4cmp
(
m
, 'd', 'e', 'c', 'r')) {

248 
r
->
ty³
 = 
MSG_REQ_MC_DECR
;

252 ià(
	`¡r4cmp
(
m
, 'q', 'u', 'i', 't')) {

253 
r
->
ty³
 = 
MSG_REQ_MC_QUIT
;

254 
r
->
qu™
 = 1;

261 ià(
	`¡r5cmp
(
m
, 't', 'o', 'u', 'c', 'h')) {

262 
r
->
ty³
 = 
MSG_REQ_MC_TOUCH
;

269 ià(
	`¡r6cmp
(
m
, 'a', 'p', 'p', 'e', 'n', 'd')) {

270 
r
->
ty³
 = 
MSG_REQ_MC_APPEND
;

274 ià(
	`¡r6cmp
(
m
, 'd', 'e', 'l', 'e', 't', 'e')) {

275 
r
->
ty³
 = 
MSG_REQ_MC_DELETE
;

282 ià(
	`¡r7cmp
(
m
, 'p', 'r', 'e', 'p', 'e', 'n', 'd')) {

283 
r
->
ty³
 = 
MSG_REQ_MC_PREPEND
;

287 ià(
	`¡r7cmp
(
m
, 'r', 'e', 'p', 'l', 'a', 'c', 'e')) {

288 
r
->
ty³
 = 
MSG_REQ_MC_REPLACE
;

295 
r
->
ty³
) {

296 
MSG_REQ_MC_GET
:

297 
MSG_REQ_MC_GETS
:

298 
MSG_REQ_MC_DELETE
:

299 
MSG_REQ_MC_CAS
:

300 
MSG_REQ_MC_SET
:

301 
MSG_REQ_MC_ADD
:

302 
MSG_REQ_MC_REPLACE
:

303 
MSG_REQ_MC_APPEND
:

304 
MSG_REQ_MC_PREPEND
:

305 
MSG_REQ_MC_INCR
:

306 
MSG_REQ_MC_DECR
:

307 
MSG_REQ_MC_TOUCH
:

308 ià(
ch
 =ğ
CR
) {

309 
”rÜ
;

311 
¡©e
 = 
SW_SPACES_BEFORE_KEY
;

314 
MSG_REQ_MC_QUIT
:

315 
p
 =… - 1;

316 
¡©e
 = 
SW_CRLF
;

319 
MSG_UNKNOWN
:

320 
”rÜ
;

323 
	`NOT_REACHED
();

326 } ià(!
	`i¦ow”
(
ch
)) {

327 
”rÜ
;

332 
SW_SPACES_BEFORE_KEY
:

333 ià(
ch
 != ' ') {

334 
p
 =… - 1;

335 
r
->
tok’
 = 
NULL
;

336 
¡©e
 = 
SW_KEY
;

340 
SW_KEY
:

341 ià(
r
->
tok’
 =ğ
NULL
) {

342 
r
->
tok’
 = 
p
;

344 ià(
ch
 =ğ' ' || ch =ğ
CR
) {

345 
keypos
 *
kpos
;

346 
keyËn
 = 
p
 - 
r
->
tok’
;

347 ià(
keyËn
 > 
MEMCACHE_MAX_KEY_LENGTH
) {

348 
	`log_”rÜ
("·r£d bad„eq %"
PRIu64
" ofype %d with key "

350 "maximum key†’gth", 
r
->
id
,„->
ty³
, 16,

351 
r
->
tok’
, 
p
 -„->token);

352 
”rÜ
;

353 } ià(
keyËn
 == 0) {

354 
	`log_”rÜ
("·r£d bad„eq %"
PRIu64
" ofype %d with‡n "

355 "em±y key", 
r
->
id
,„->
ty³
);

356 
”rÜ
;

359 
kpos
 = 
	`¬¿y_push
(
r
->
keys
);

360 ià(
kpos
 =ğ
NULL
) {

361 
’omem
;

363 
kpos
->
¡¬t
 = 
r
->
tok’
;

364 
kpos
->
’d
 = 
p
;

366 
r
->
Çrg
++;

367 
r
->
tok’
 = 
NULL
;

370 ià(
	`memÿche_¡Üage
(
r
)) {

371 
¡©e
 = 
SW_SPACES_BEFORE_FLAGS
;

372 } ià(
	`memÿche_¬™hm‘ic
(
r
è|| 
	`memÿche_touch
(r) ) {

373 
¡©e
 = 
SW_SPACES_BEFORE_NUM
;

374 } ià(
	`memÿche_d–‘e
(
r
)) {

375 
¡©e
 = 
SW_RUNTO_CRLF
;

376 } ià(
	`memÿche_»Œ›v®
(
r
)) {

377 
¡©e
 = 
SW_SPACES_BEFORE_KEYS
;

379 
¡©e
 = 
SW_RUNTO_CRLF
;

382 ià(
ch
 =ğ
CR
) {

383 ià(
	`memÿche_¡Üage
(
r
è|| 
	`memÿche_¬™hm‘ic
(r)) {

384 
”rÜ
;

386 
p
 =… - 1;

392 
SW_SPACES_BEFORE_KEYS
:

393 
	`ASSERT
(
	`memÿche_»Œ›v®
(
r
));

394 
ch
) {

398 
CR
:

399 
¡©e
 = 
SW_ALMOST_DONE
;

403 
r
->
tok’
 = 
NULL
;

404 
p
 =… - 1;

405 
¡©e
 = 
SW_KEY
;

410 
SW_SPACES_BEFORE_FLAGS
:

411 ià(
ch
 != ' ') {

412 ià(!
	`isdig™
(
ch
)) {

413 
”rÜ
;

416 
r
->
tok’
 = 
p
;

417 
¡©e
 = 
SW_FLAGS
;

422 
SW_FLAGS
:

423 ià(
	`isdig™
(
ch
)) {

426 } ià(
ch
 == ' ') {

428 
r
->
tok’
 = 
NULL
;

429 
¡©e
 = 
SW_SPACES_BEFORE_EXPIRY
;

431 
”rÜ
;

436 
SW_SPACES_BEFORE_EXPIRY
:

437 ià(
ch
 != ' ') {

438 ià(!
	`isdig™
(
ch
)) {

439 
”rÜ
;

442 
r
->
tok’
 = 
p
;

443 
¡©e
 = 
SW_EXPIRY
;

448 
SW_EXPIRY
:

449 ià(
	`isdig™
(
ch
)) {

452 } ià(
ch
 == ' ') {

454 
r
->
tok’
 = 
NULL
;

455 
¡©e
 = 
SW_SPACES_BEFORE_VLEN
;

457 
”rÜ
;

462 
SW_SPACES_BEFORE_VLEN
:

463 ià(
ch
 != ' ') {

464 ià(!
	`isdig™
(
ch
)) {

465 
”rÜ
;

468 
r
->
vËn
 = (
ušt32_t
)(
ch
 - '0');

469 
¡©e
 = 
SW_VLEN
;

474 
SW_VLEN
:

475 ià(
	`isdig™
(
ch
)) {

476 
r
->
vËn
 =„->vËÀ* 10 + (
ušt32_t
)(
ch
 - '0');

477 } ià(
	`memÿche_ÿs
(
r
)) {

478 ià(
ch
 != ' ') {

479 
”rÜ
;

482 
p
 =… - 1;

483 
r
->
tok’
 = 
NULL
;

484 
¡©e
 = 
SW_SPACES_BEFORE_CAS
;

485 } ià(
ch
 =ğ' ' || ch =ğ
CR
) {

487 
p
 =… - 1;

488 
r
->
tok’
 = 
NULL
;

489 
¡©e
 = 
SW_RUNTO_CRLF
;

491 
”rÜ
;

496 
SW_SPACES_BEFORE_CAS
:

497 ià(
ch
 != ' ') {

498 ià(!
	`isdig™
(
ch
)) {

499 
”rÜ
;

502 
r
->
tok’
 = 
p
;

503 
¡©e
 = 
SW_CAS
;

508 
SW_CAS
:

509 ià(
	`isdig™
(
ch
)) {

512 } ià(
ch
 =ğ' ' || ch =ğ
CR
) {

514 
p
 =… - 1;

515 
r
->
tok’
 = 
NULL
;

516 
¡©e
 = 
SW_RUNTO_CRLF
;

518 
”rÜ
;

524 
SW_RUNTO_VAL
:

525 
ch
) {

526 
LF
:

528 
¡©e
 = 
SW_VAL
;

532 
”rÜ
;

537 
SW_VAL
:

538 
m
 = 
p
 + 
r
->
vËn
;

539 ià(
m
 >ğ
b
->
Ï¡
) {

540 
	`ASSERT
(
r
->
vËn
 >ğ(
ušt32_t
)(
b
->
Ï¡
 - 
p
));

541 
r
->
vËn
 -ğ(
ušt32_t
)(
b
->
Ï¡
 - 
p
);

542 
m
 = 
b
->
Ï¡
 - 1;

543 
p
 = 
m
;

546 *
m
) {

547 
CR
:

549 
p
 = 
m
;

550 
¡©e
 = 
SW_ALMOST_DONE
;

554 
”rÜ
;

559 
SW_SPACES_BEFORE_NUM
:

560 ià(
ch
 != ' ') {

561 ià(!(
	`isdig™
(
ch
) || ch == '-')) {

562 
”rÜ
;

565 
r
->
tok’
 = 
p
;

566 
¡©e
 = 
SW_NUM
;

571 
SW_NUM
:

572 ià(
	`isdig™
(
ch
)) {

575 } ià(
ch
 =ğ' ' || ch =ğ
CR
) {

576 
r
->
tok’
 = 
NULL
;

578 
p
 =… - 1;

579 
¡©e
 = 
SW_RUNTO_CRLF
;

581 
”rÜ
;

586 
SW_RUNTO_CRLF
:

587 
ch
) {

592 ià(
	`memÿche_¡Üage
(
r
è|| 
	`memÿche_¬™hm‘ic
Ôè|| 
	`memÿche_d–‘e
Ôè|| 
	`memÿche_touch
(r)) {

594 
r
->
tok’
 = 
p
;

595 
¡©e
 = 
SW_NOREPLY
;

597 
”rÜ
;

602 
CR
:

603 ià(
	`memÿche_¡Üage
(
r
)) {

604 
¡©e
 = 
SW_RUNTO_VAL
;

606 
¡©e
 = 
SW_ALMOST_DONE
;

612 
”rÜ
;

617 
SW_NOREPLY
:

618 
ch
) {

620 
CR
:

621 
m
 = 
r
->
tok’
;

622 ià(((
p
 - 
m
è=ğ7è&& 
	`¡r7cmp
(m, 'n', 'o', 'r', 'e', 'p', 'l', 'y')) {

623 
	`ASSERT
(
	`memÿche_¡Üage
(
r
è|| 
	`memÿche_¬™hm‘ic
Ôè|| 
	`memÿche_d–‘e
Ôè|| 
	`memÿche_touch
(r));

624 
r
->
tok’
 = 
NULL
;

626 
r
->
nÜ•ly
 = 1;

627 
¡©e
 = 
SW_AFTER_NOREPLY
;

628 
p
 =… - 1;

630 
”rÜ
;

636 
SW_AFTER_NOREPLY
:

637 
ch
) {

641 
CR
:

642 ià(
	`memÿche_¡Üage
(
r
)) {

643 
¡©e
 = 
SW_RUNTO_VAL
;

645 
¡©e
 = 
SW_ALMOST_DONE
;

650 
”rÜ
;

655 
SW_CRLF
:

656 
ch
) {

660 
CR
:

661 
¡©e
 = 
SW_ALMOST_DONE
;

665 
”rÜ
;

670 
SW_ALMOST_DONE
:

671 
ch
) {

672 
LF
:

674 
dÚe
;

677 
”rÜ
;

682 
SW_SENTINEL
:

684 
	`NOT_REACHED
();

703 
	`ASSERT
(
p
 =ğ
b
->
Ï¡
);

704 
r
->
pos
 = 
p
;

705 
r
->
¡©e
 = state;

707 ià(
b
->
Ï¡
 =ğb->
’d
 && 
r
->
tok’
 !ğ
NULL
) {

708 
r
->
pos
 =„->
tok’
;

709 
r
->
tok’
 = 
NULL
;

710 
r
->
»suÉ
 = 
MSG_PARSE_REPAIR
;

712 
r
->
»suÉ
 = 
MSG_PARSE_AGAIN
;

715 
	`log_hexdump
(
LOG_VERB
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d„eq %"
PRIu64
"„es %d "

716 "ty³ %d s‹ %d„po %d oà%d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

717 
r
->
¡©e
,„->
pos
 - 
b
->pos, b->
Ï¡
 - b->pos);

720 
dÚe
:

721 
	`ASSERT
(
r
->
ty³
 > 
MSG_UNKNOWN
 &&„->ty³ < 
MSG_SENTINEL
);

722 
r
->
pos
 = 
p
 + 1;

723 
	`ASSERT
(
r
->
pos
 <ğ
b
->
Ï¡
);

724 
r
->
¡©e
 = 
SW_START
;

725 
r
->
»suÉ
 = 
MSG_PARSE_OK
;

727 
	`log_hexdump
(
LOG_VERB
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d„eq %"
PRIu64
"„es %d "

728 "ty³ %d s‹ %d„po %d oà%d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

729 
r
->
¡©e
,„->
pos
 - 
b
->pos, b->
Ï¡
 - b->pos);

732 
’omem
:

733 
r
->
»suÉ
 = 
MSG_PARSE_ERROR
;

734 
r
->
¡©e
 = state;

736 
	`log_hexdump
(
LOG_INFO
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "ouˆoàmemÜy oÀ·r£„eq %"
PRIu64
" "

737 "» %dy³ %d s‹ %d", 
r
->
id
,„->
»suÉ
,„->
ty³
,„->
¡©e
);

741 
”rÜ
:

742 
r
->
»suÉ
 = 
MSG_PARSE_ERROR
;

743 
r
->
¡©e
 = state;

744 
”ºo
 = 
EINVAL
;

746 
	`log_hexdump
(
LOG_INFO
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d bad„eq %"
PRIu64
" "

747 "» %dy³ %d s‹ %d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

748 
r
->
¡©e
);

749 
	}
}

752 
	$memÿche_·r£_r¥
(
msg
 *
r
)

754 
mbuf
 *
b
;

755 
ušt8_t
 *
p
, *
m
;

756 
ušt8_t
 
ch
;

758 
SW_START
,

759 
SW_RSP_NUM
,

760 
SW_RSP_STR
,

761 
SW_SPACES_BEFORE_KEY
,

762 
SW_KEY
,

763 
SW_SPACES_BEFORE_FLAGS
,

764 
SW_FLAGS
,

765 
SW_SPACES_BEFORE_VLEN
,

766 
SW_VLEN
,

767 
SW_RUNTO_VAL
,

768 
SW_VAL
,

769 
SW_VAL_LF
,

770 
SW_END
,

771 
SW_RUNTO_CRLF
,

772 
SW_CRLF
,

773 
SW_ALMOST_DONE
,

774 
SW_SENTINEL


775 } 
¡©e
;

777 
¡©e
 = 
r
->state;

778 
b
 = 
	`STAILQ_LAST
(&
r
->
mhdr
, 
mbuf
, 
Ãxt
);

780 
	`ASSERT
(!
r
->
»que¡
);

781 
	`ASSERT
(!
r
->
»dis
);

782 
	`ASSERT
(
¡©e
 >ğ
SW_START
 && s‹ < 
SW_SENTINEL
);

783 
	`ASSERT
(
b
 !ğ
NULL
);

784 
	`ASSERT
(
b
->
pos
 <ğb->
Ï¡
);

787 
	`ASSERT
(
r
->
pos
 !ğ
NULL
);

788 
	`ASSERT
(
r
->
pos
 >ğ
b
->po &&„->po <ğb->
Ï¡
);

790 
p
 = 
r
->
pos
;… < 
b
->
Ï¡
;…++) {

791 
ch
 = *
p
;

793 
¡©e
) {

794 
SW_START
:

795 ià(
	`isdig™
(
ch
)) {

796 
¡©e
 = 
SW_RSP_NUM
;

798 
¡©e
 = 
SW_RSP_STR
;

800 
p
 =… - 1;

804 
SW_RSP_NUM
:

805 ià(
r
->
tok’
 =ğ
NULL
) {

807 
r
->
tok’
 = 
p
;

810 ià(
	`isdig™
(
ch
)) {

813 } ià(
ch
 =ğ' ' || ch =ğ
CR
) {

815 
r
->
tok’
 = 
NULL
;

816 
r
->
ty³
 = 
MSG_RSP_MC_NUM
;

817 
p
 =… - 1;

818 
¡©e
 = 
SW_CRLF
;

820 
”rÜ
;

825 
SW_RSP_STR
:

826 ià(
r
->
tok’
 =ğ
NULL
) {

828 
r
->
tok’
 = 
p
;

831 ià(
ch
 =ğ' ' || ch =ğ
CR
) {

833 
m
 = 
r
->
tok’
;

835 
r
->
ty³
 = 
MSG_UNKNOWN
;

837 
p
 - 
m
) {

839 ià(
	`¡r4cmp
(
m
, 'E', 'N', 'D', '\r')) {

840 
r
->
ty³
 = 
MSG_RSP_MC_END
;

842 
r
->
’d
 = 
m
;

849 ià(
	`¡r5cmp
(
m
, 'V', 'A', 'L', 'U', 'E')) {

854 
r
->
ty³
 = 
MSG_RSP_MC_VALUE
;

858 ià(
	`¡r5cmp
(
m
, 'E', 'R', 'R', 'O', 'R')) {

859 
r
->
ty³
 = 
MSG_RSP_MC_ERROR
;

866 ià(
	`¡r6cmp
(
m
, 'S', 'T', 'O', 'R', 'E', 'D')) {

867 
r
->
ty³
 = 
MSG_RSP_MC_STORED
;

871 ià(
	`¡r6cmp
(
m
, 'E', 'X', 'I', 'S', 'T', 'S')) {

872 
r
->
ty³
 = 
MSG_RSP_MC_EXISTS
;

879 ià(
	`¡r7cmp
(
m
, 'D', 'E', 'L', 'E', 'T', 'E', 'D')) {

880 
r
->
ty³
 = 
MSG_RSP_MC_DELETED
;

884 ià(
	`¡r7cmp
(
m
, 'T', 'O', 'U', 'C', 'H', 'E', 'D')) {

885 
r
->
ty³
 = 
MSG_RSP_MC_TOUCHED
;

892 ià(
	`¡r9cmp
(
m
, 'N', 'O', 'T', '_', 'F', 'O', 'U', 'N', 'D')) {

893 
r
->
ty³
 = 
MSG_RSP_MC_NOT_FOUND
;

900 ià(
	`¡r10cmp
(
m
, 'N', 'O', 'T', '_', 'S', 'T', 'O', 'R', 'E', 'D')) {

901 
r
->
ty³
 = 
MSG_RSP_MC_NOT_STORED
;

908 ià(
	`¡r12cmp
(
m
, 'C', 'L', 'I', 'E', 'N', 'T', '_', 'E', 'R', 'R', 'O', 'R')) {

909 
r
->
ty³
 = 
MSG_RSP_MC_CLIENT_ERROR
;

913 ià(
	`¡r12cmp
(
m
, 'S', 'E', 'R', 'V', 'E', 'R', '_', 'E', 'R', 'R', 'O', 'R')) {

914 
r
->
ty³
 = 
MSG_RSP_MC_SERVER_ERROR
;

921 
r
->
ty³
) {

922 
MSG_UNKNOWN
:

923 
”rÜ
;

925 
MSG_RSP_MC_STORED
:

926 
MSG_RSP_MC_NOT_STORED
:

927 
MSG_RSP_MC_EXISTS
:

928 
MSG_RSP_MC_NOT_FOUND
:

929 
MSG_RSP_MC_DELETED
:

930 
MSG_RSP_MC_TOUCHED
:

931 
¡©e
 = 
SW_CRLF
;

934 
MSG_RSP_MC_END
:

935 
¡©e
 = 
SW_CRLF
;

938 
MSG_RSP_MC_VALUE
:

939 
¡©e
 = 
SW_SPACES_BEFORE_KEY
;

942 
MSG_RSP_MC_ERROR
:

943 
¡©e
 = 
SW_CRLF
;

946 
MSG_RSP_MC_CLIENT_ERROR
:

947 
MSG_RSP_MC_SERVER_ERROR
:

948 
¡©e
 = 
SW_RUNTO_CRLF
;

952 
	`NOT_REACHED
();

955 
p
 =… - 1;

960 
SW_SPACES_BEFORE_KEY
:

961 ià(
ch
 != ' ') {

962 
¡©e
 = 
SW_KEY
;

963 
p
 =… - 1;

968 
SW_KEY
:

969 ià(
ch
 == ' ') {

971 
¡©e
 = 
SW_SPACES_BEFORE_FLAGS
;

976 
SW_SPACES_BEFORE_FLAGS
:

977 ià(
ch
 != ' ') {

978 ià(!
	`isdig™
(
ch
)) {

979 
”rÜ
;

981 
¡©e
 = 
SW_FLAGS
;

982 
p
 =… - 1;

987 
SW_FLAGS
:

988 ià(
r
->
tok’
 =ğ
NULL
) {

993 ià(
	`isdig™
(
ch
)) {

996 } ià(
ch
 == ' ') {

999 
¡©e
 = 
SW_SPACES_BEFORE_VLEN
;

1001 
”rÜ
;

1006 
SW_SPACES_BEFORE_VLEN
:

1007 ià(
ch
 != ' ') {

1008 ià(!
	`isdig™
(
ch
)) {

1009 
”rÜ
;

1011 
p
 =… - 1;

1012 
¡©e
 = 
SW_VLEN
;

1013 
r
->
vËn
 = 0;

1018 
SW_VLEN
:

1019 ià(
	`isdig™
(
ch
)) {

1020 
r
->
vËn
 =„->vËÀ* 10 + (
ušt32_t
)(
ch
 - '0');

1021 } ià(
ch
 =ğ' ' || ch =ğ
CR
) {

1023 
p
 =… - 1;

1025 
¡©e
 = 
SW_RUNTO_CRLF
;

1027 
”rÜ
;

1032 
SW_RUNTO_VAL
:

1033 
ch
) {

1034 
LF
:

1036 
¡©e
 = 
SW_VAL
;

1037 
r
->
tok’
 = 
NULL
;

1041 
”rÜ
;

1046 
SW_VAL
:

1047 
m
 = 
p
 + 
r
->
vËn
;

1048 ià(
m
 >ğ
b
->
Ï¡
) {

1049 
	`ASSERT
(
r
->
vËn
 >ğ(
ušt32_t
)(
b
->
Ï¡
 - 
p
));

1050 
r
->
vËn
 -ğ(
ušt32_t
)(
b
->
Ï¡
 - 
p
);

1051 
m
 = 
b
->
Ï¡
 - 1;

1052 
p
 = 
m
;

1055 *
m
) {

1056 
CR
:

1058 
p
 = 
m
;

1059 
¡©e
 = 
SW_VAL_LF
;

1063 
”rÜ
;

1068 
SW_VAL_LF
:

1069 
ch
) {

1070 
LF
:

1072 
¡©e
 = 
SW_RSP_STR
;

1076 
”rÜ
;

1081 
SW_END
:

1082 ià(
r
->
tok’
 =ğ
NULL
) {

1083 ià(
ch
 != 'E') {

1084 
”rÜ
;

1087 
r
->
tok’
 = 
p
;

1088 } ià(
ch
 =ğ
CR
) {

1090 
m
 = 
r
->
tok’
;

1091 
r
->
tok’
 = 
NULL
;

1093 
p
 - 
m
) {

1095 ià(
	`¡r4cmp
(
m
, 'E', 'N', 'D', '\r')) {

1096 
r
->
’d
 = 
m
;

1097 
¡©e
 = 
SW_ALMOST_DONE
;

1102 
”rÜ
;

1108 
SW_RUNTO_CRLF
:

1109 
ch
) {

1110 
CR
:

1111 ià(
r
->
ty³
 =ğ
MSG_RSP_MC_VALUE
) {

1112 
¡©e
 = 
SW_RUNTO_VAL
;

1114 
¡©e
 = 
SW_ALMOST_DONE
;

1125 
SW_CRLF
:

1126 
ch
) {

1130 
CR
:

1131 
¡©e
 = 
SW_ALMOST_DONE
;

1135 
”rÜ
;

1140 
SW_ALMOST_DONE
:

1141 
ch
) {

1142 
LF
:

1144 
dÚe
;

1147 
”rÜ
;

1152 
SW_SENTINEL
:

1154 
	`NOT_REACHED
();

1160 
	`ASSERT
(
p
 =ğ
b
->
Ï¡
);

1161 
r
->
pos
 = 
p
;

1162 
r
->
¡©e
 = state;

1164 ià(
b
->
Ï¡
 =ğb->
’d
 && 
r
->
tok’
 !ğ
NULL
) {

1165 ià(
¡©e
 <ğ
SW_RUNTO_VAL
 || s‹ =ğ
SW_CRLF
 || s‹ =ğ
SW_ALMOST_DONE
) {

1166 
r
->
¡©e
 = 
SW_START
;

1168 
r
->
pos
 =„->
tok’
;

1169 
r
->
tok’
 = 
NULL
;

1170 
r
->
»suÉ
 = 
MSG_PARSE_REPAIR
;

1172 
r
->
»suÉ
 = 
MSG_PARSE_AGAIN
;

1175 
	`log_hexdump
(
LOG_VERB
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d„¥ %"
PRIu64
"„es %d "

1176 "ty³ %d s‹ %d„po %d oà%d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

1177 
r
->
¡©e
,„->
pos
 - 
b
->pos, b->
Ï¡
 - b->pos);

1180 
dÚe
:

1181 
	`ASSERT
(
r
->
ty³
 > 
MSG_UNKNOWN
 &&„->ty³ < 
MSG_SENTINEL
);

1182 
r
->
pos
 = 
p
 + 1;

1183 
	`ASSERT
(
r
->
pos
 <ğ
b
->
Ï¡
);

1184 
r
->
¡©e
 = 
SW_START
;

1185 
r
->
tok’
 = 
NULL
;

1186 
r
->
»suÉ
 = 
MSG_PARSE_OK
;

1188 
	`log_hexdump
(
LOG_VERB
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d„¥ %"
PRIu64
"„es %d "

1189 "ty³ %d s‹ %d„po %d oà%d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

1190 
r
->
¡©e
,„->
pos
 - 
b
->pos, b->
Ï¡
 - b->pos);

1193 
”rÜ
:

1194 
r
->
»suÉ
 = 
MSG_PARSE_ERROR
;

1195 
r
->
¡©e
 = state;

1196 
”ºo
 = 
EINVAL
;

1198 
	`log_hexdump
(
LOG_INFO
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d bad„¥ %"
PRIu64
" "

1199 "» %dy³ %d s‹ %d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

1200 
r
->
¡©e
);

1201 
	}
}

1203 
boŞ


1204 
	$memÿche_çu»
(
msg
 *
r
)

1206  
çl£
;

1207 
	}
}

1209 
r¡©us_t


1210 
	$memÿche_­³nd_key
(
msg
 *
r
, 
ušt8_t
 *
key
, 
ušt32_t
 
keyËn
)

1212 
mbuf
 *mbuf;

1213 
keypos
 *
kpos
;

1215 
mbuf
 = 
	`msg_’su»_mbuf
(
r
, 
keyËn
 + 2);

1216 ià(
mbuf
 =ğ
NULL
) {

1217  
NC_ENOMEM
;

1220 
kpos
 = 
	`¬¿y_push
(
r
->
keys
);

1221 ià(
kpos
 =ğ
NULL
) {

1222  
NC_ENOMEM
;

1225 
kpos
->
¡¬t
 = 
mbuf
->
Ï¡
;

1226 
kpos
->
’d
 = 
mbuf
->
Ï¡
 + 
keyËn
;

1227 
	`mbuf_cİy
(
mbuf
, 
key
, 
keyËn
);

1228 
r
->
mËn
 +ğ
keyËn
;

1230 
	`mbuf_cİy
(
mbuf
, (
ušt8_t
 *)" ", 1);

1231 
r
->
mËn
 += 1;

1232  
NC_OK
;

1233 
	}
}

1238 
r¡©us_t


1239 
	$memÿche_äagm’t_»Œ›v®
(
msg
 *
r
, 
ušt32_t
 
ncÚtšuum
,

1240 
msg_tqh
 *
äag_msgq
,

1241 
ušt32_t
 
key_¡•
)

1243 
mbuf
 *mbuf;

1244 
msg
 **
sub_msgs
;

1245 
ušt32_t
 
i
;

1246 
r¡©us_t
 
¡©us
;

1248 
sub_msgs
 = 
	`nc_z®loc
(
ncÚtšuum
 * (*sub_msgs));

1249 ià(
sub_msgs
 =ğ
NULL
) {

1250  
NC_ENOMEM
;

1253 
	`ASSERT
(
r
->
äag_£q
 =ğ
NULL
);

1254 
r
->
äag_£q
 = 
	`nc_®loc
(
	`¬¿y_n
Ô->
keys
) * (*r->frag_seq));

1255 ià(
r
->
äag_£q
 =ğ
NULL
) {

1256 
	`nc_ä“
(
sub_msgs
);

1257  
NC_ENOMEM
;

1260 
mbuf
 = 
	`STAILQ_FIRST
(&
r
->
mhdr
);

1261 
mbuf
->
pos
 = mbuf->
¡¬t
;

1269 ; *(
mbuf
->
pos
) != ' ';) {

1270 
mbuf
->
pos
++;

1272 
mbuf
->
pos
++;

1274 
r
->
äag_id
 = 
	`msg_g’_äag_id
();

1275 
r
->
näag
 = 0;

1276 
r
->
äag_owÃr
 =„;

1278 
i
 = 0; i < 
	`¬¿y_n
(
r
->
keys
); i++) {

1279 
msg
 *
sub_msg
;

1280 
keypos
 *
kpos
 = 
	`¬¿y_g‘
(
r
->
keys
, 
i
);

1281 
ušt32_t
 
idx
 = 
	`msg_back’d_idx
(
r
, 
kpos
->
¡¬t
, kpos->
’d
 - kpos->start);

1283 ià(
sub_msgs
[
idx
] =ğ
NULL
) {

1284 
sub_msgs
[
idx
] = 
	`msg_g‘
(
r
->
owÃr
,„->
»que¡
,„->
»dis
);

1285 ià(
sub_msgs
[
idx
] =ğ
NULL
) {

1286 
	`nc_ä“
(
sub_msgs
);

1287  
NC_ENOMEM
;

1290 
r
->
äag_£q
[
i
] = 
sub_msg
 = 
sub_msgs
[
idx
];

1292 
sub_msg
->
Çrg
++;

1293 
¡©us
 = 
	`memÿche_­³nd_key
(
sub_msg
, 
kpos
->
¡¬t
, kpos->
’d
 - kpos->start);

1294 ià(
¡©us
 !ğ
NC_OK
) {

1295 
	`nc_ä“
(
sub_msgs
);

1296  
¡©us
;

1300 
i
 = 0; i < 
ncÚtšuum
; i++) {

1301 
msg
 *
sub_msg
 = 
sub_msgs
[
i
];

1302 ià(
sub_msg
 =ğ
NULL
) {

1307 ià(
r
->
ty³
 =ğ
MSG_REQ_MC_GET
) {

1308 
¡©us
 = 
	`msg_´•’d
(
sub_msg
, (
ušt8_t
 *)"get ", 4);

1309 } ià(
r
->
ty³
 =ğ
MSG_REQ_MC_GETS
) {

1310 
¡©us
 = 
	`msg_´•’d
(
sub_msg
, (
ušt8_t
 *)"gets ", 5);

1312 ià(
¡©us
 !ğ
NC_OK
) {

1313 
	`nc_ä“
(
sub_msgs
);

1314  
¡©us
;

1318 
¡©us
 = 
	`msg_­³nd
(
sub_msg
, (
ušt8_t
 *)
CRLF
, 
CRLF_LEN
);

1319 ià(
¡©us
 !ğ
NC_OK
) {

1320 
	`nc_ä“
(
sub_msgs
);

1321  
¡©us
;

1324 
sub_msg
->
ty³
 = 
r
->type;

1325 
sub_msg
->
äag_id
 = 
r
->frag_id;

1326 
sub_msg
->
äag_owÃr
 = 
r
->frag_owner;

1328 
	`TAILQ_INSERT_TAIL
(
äag_msgq
, 
sub_msg
, 
m_tqe
);

1329 
r
->
näag
++;

1332 
	`nc_ä“
(
sub_msgs
);

1333  
NC_OK
;

1334 
	}
}

1336 
r¡©us_t


1337 
	$memÿche_äagm’t
(
msg
 *
r
, 
ušt32_t
 
ncÚtšuum
, 
msg_tqh
 *
äag_msgq
)

1339 ià(
	`memÿche_»Œ›v®
(
r
)) {

1340  
	`memÿche_äagm’t_»Œ›v®
(
r
, 
ncÚtšuum
, 
äag_msgq
, 1);

1342  
NC_OK
;

1343 
	}
}

1351 
	$memÿche_´e_cßËsû
(
msg
 *
r
)

1353 
msg
 *
´
 = 
r
->
³”
;

1354 
mbuf
 *mbuf;

1356 
	`ASSERT
(!
r
->
»que¡
);

1357 
	`ASSERT
(
´
->
»que¡
);

1359 ià(
´
->
äag_id
 == 0) {

1364 
´
->
äag_owÃr
->
näag_dÚe
++;

1365 
r
->
ty³
) {

1367 
MSG_RSP_MC_VALUE
:

1368 
MSG_RSP_MC_END
:

1375 
	`ASSERT
(
r
->
’d
 !ğ
NULL
);

1378 
mbuf
 = 
	`STAILQ_LAST
(&
r
->
mhdr
, mbuf, 
Ãxt
);

1379 
	`ASSERT
(
mbuf
 !ğ
NULL
);

1388 ià(
r
->
’d
 >ğ
mbuf
->
pos
 &&„->’d < mbuf->
Ï¡
) {

1390 
r
->
mËn
 -ğ(
ušt32_t
)(
mbuf
->
Ï¡
 -„->
’d
);

1391 
mbuf
->
Ï¡
 = 
r
->
’d
;

1396 
r
->
mËn
 -ğ
	`mbuf_Ëngth
(
mbuf
);

1397 
	`mbuf_»move
(&
r
->
mhdr
, 
mbuf
);

1398 
	`mbuf_put
(
mbuf
);

1409 
mbuf
 = 
	`STAILQ_FIRST
(&
r
->
mhdr
);

1410 
	`log_hexdump
(
LOG_ERR
, 
mbuf
->
pos
, 
	`mbuf_Ëngth
(mbuf), "rsp fragment "

1411 "w™h unknowÀty³ %d", 
r
->
ty³
);

1412 
´
->
”rÜ
 = 1;

1413 
´
->
”r
 = 
EINVAL
;

1416 
	}
}

1421 
r¡©us_t


1422 
	$memÿche_cİy_bulk
(
msg
 *
d¡
, msg *
¤c
)

1424 
mbuf
 *mbuf, *
nbuf
;

1425 
ušt8_t
 *
p
;

1426 
ušt32_t
 
Ën
 = 0;

1427 
ušt32_t
 
by‹s
 = 0;

1428 
ušt32_t
 
i
 = 0;

1430 
mbuf
 = 
	`STAILQ_FIRST
(&
¤c
->
mhdr
);

1431 
mbuf
 && 
	`mbuf_em±y
(mbuf);

1432 
mbuf
 = 
	`STAILQ_FIRST
(&
¤c
->
mhdr
)) {

1434 
	`mbuf_»move
(&
¤c
->
mhdr
, 
mbuf
);

1435 
	`mbuf_put
(
mbuf
);

1438 
mbuf
 = 
	`STAILQ_FIRST
(&
¤c
->
mhdr
);

1439 ià(
mbuf
 =ğ
NULL
) {

1440  
NC_OK
;

1442 
p
 = 
mbuf
->
pos
;

1448 
	`ASSERT
(*
p
 == 'V');

1449 
i
 = 0; i < 3; i++) {

1450 ; *
p
 != ' ';) {

1451 
p
++;

1453 
p
++;

1456 
Ën
 = 0;

1457 ; 
p
 < 
mbuf
->
Ï¡
 && 
	`isdig™
(*p);…++) {

1458 
Ën
 =†’ * 10 + (
ušt32_t
)(*
p
 - '0');

1461 ; 
p
 < 
mbuf
->
Ï¡
 && ('\r' != *p);…++) {

1465 
Ën
 +ğ
CRLF_LEN
 * 2;

1466 
Ën
 +ğ(
p
 - 
mbuf
->
pos
);

1468 
by‹s
 = 
Ën
;

1471 ; 
mbuf
;) {

1472 ià(
	`mbuf_Ëngth
(
mbuf
è<ğ
Ën
) {

1473 
nbuf
 = 
	`STAILQ_NEXT
(
mbuf
, 
Ãxt
);

1474 
	`mbuf_»move
(&
¤c
->
mhdr
, 
mbuf
);

1475 
	`mbuf_š£¹
(&
d¡
->
mhdr
, 
mbuf
);

1476 
Ën
 -ğ
	`mbuf_Ëngth
(
mbuf
);

1477 
mbuf
 = 
nbuf
;

1479 
nbuf
 = 
	`mbuf_g‘
();

1480 ià(
nbuf
 =ğ
NULL
) {

1481  
NC_ENOMEM
;

1483 
	`mbuf_cİy
(
nbuf
, 
mbuf
->
pos
, 
Ën
);

1484 
	`mbuf_š£¹
(&
d¡
->
mhdr
, 
nbuf
);

1485 
mbuf
->
pos
 +ğ
Ën
;

1490 
d¡
->
mËn
 +ğ
by‹s
;

1491 
¤c
->
mËn
 -ğ
by‹s
;

1492 
	`log_debug
(
LOG_VVERB
, "memÿche_cİy_bulk cİy by‹s: %d", 
by‹s
);

1493  
NC_OK
;

1494 
	}
}

1503 
	$memÿche_po¡_cßËsû
(
msg
 *
»que¡
)

1505 
msg
 *
»¥Ú£
 = 
»que¡
->
³”
;

1506 
msg
 *
sub_msg
;

1507 
ušt32_t
 
i
;

1508 
r¡©us_t
 
¡©us
;

1510 
	`ASSERT
(!
»¥Ú£
->
»que¡
);

1511 
	`ASSERT
(
»que¡
->»que¡ && (»que¡->
äag_owÃr
 ==„equest));

1512 ià(
»que¡
->
”rÜ
 ||„eque¡->
ã¼Ü
) {

1513 
»¥Ú£
->
owÃr
->
”r
 = 1;

1517 
i
 = 0; i < 
	`¬¿y_n
(
»que¡
->
keys
); i++) {

1518 
sub_msg
 = 
»que¡
->
äag_£q
[
i
]->
³”
;

1519 ià(
sub_msg
 =ğ
NULL
) {

1520 
»¥Ú£
->
owÃr
->
”r
 = 1;

1523 
¡©us
 = 
	`memÿche_cİy_bulk
(
»¥Ú£
, 
sub_msg
);

1524 ià(
¡©us
 !ğ
NC_OK
) {

1525 
»¥Ú£
->
owÃr
->
”r
 = 1;

1531 
¡©us
 = 
	`msg_­³nd
(
»¥Ú£
, (
ušt8_t
 *)"END\r\n", 5);

1532 ià(
¡©us
 !ğ
NC_OK
) {

1533 
»¥Ú£
->
owÃr
->
”r
 = 1;

1536 
	}
}

1539 
	$memÿche_po¡_cÚÃù
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
£rv”
 *server)

1541 
	}
}

1544 
	$memÿche_sw®low_msg
(
cÚn
 *cÚn, 
msg
 *
pmsg
, msg *msg)

1546 
	}
}

1548 
r¡©us_t


1549 
	$memÿche_add_auth
(
cÚ‹xt
 *
ùx
, 
cÚn
 *
c_cÚn
, cÚÀ*
s_cÚn
)

1551 
	`NOT_REACHED
();

1552  
NC_OK
;

1553 
	}
}

1555 
r¡©us_t


1556 
	$memÿche_»¶y
(
msg
 *
r
)

1558 
	`NOT_REACHED
();

1559  
NC_OK
;

1560 
	}
}

	@proto/nc_proto.h

18 #iâdeà
_NC_PROTO_H_


19 
	#_NC_PROTO_H_


	)

21 
	~<nc_cÜe.h
>

23 #ifdeà
NC_LITTLE_ENDIAN


25 
	#¡r4cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
) \

26 (*(
ušt32_t
 *è
m
 =ğ((
c3
 << 24è| (
c2
 << 16è| (
c1
 << 8è| 
c0
))

	)

28 
	#¡r5cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
) \

29 (
	`¡r4cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
è&& (m[4] =ğ
c4
))

	)

31 
	#¡r6cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
) \

32 (
	`¡r4cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
) && \

33 (((
ušt32_t
 *è
m
)[1] & 0xffffè=ğ((
c5
 << 8è| 
c4
))

	)

35 
	#¡r7cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
) \

36 (
	`¡r6cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
è&& (m[6] =ğ
c6
))

	)

38 
	#¡r8cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
) \

39 (
	`¡r4cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
) && \

40 (((
ušt32_t
 *è
m
)[1] =ğ((
c7
 << 24è| (
c6
 << 16è| (
c5
 << 8è| 
c4
)))

	)

42 
	#¡r9cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
) \

43 (
	`¡r8cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
è&& m[8] =ğ
c8
)

	)

45 
	#¡r10cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
) \

46 (
	`¡r8cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
) && \

47 (((
ušt32_t
 *è
m
)[2] & 0xffffè=ğ((
c9
 << 8è| 
c8
))

	)

49 
	#¡r11cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
) \

50 (
	`¡r10cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
è&& (m[10] =ğ
c10
))

	)

52 
	#¡r12cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
) \

53 (
	`¡r8cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
) && \

54 (((
ušt32_t
 *è
m
)[2] =ğ((
c11
 << 24è| (
c10
 << 16è| (
c9
 << 8è| 
c8
)))

	)

58 
	#¡r4cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
) \

59 (
m
[0] =ğ
c0
 && m[1] =ğ
c1
 && m[2] =ğ
c2
 && m[3] =ğ
c3
)

	)

61 
	#¡r5cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
) \

62 (
	`¡r4cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
è&& (m[4] =ğ
c4
))

	)

64 
	#¡r6cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
) \

65 (
	`¡r5cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
è&& m[5] =ğ
c5
)

	)

67 
	#¡r7cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
) \

68 (
	`¡r6cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
è&& m[6] =ğ
c6
)

	)

70 
	#¡r8cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
) \

71 (
	`¡r7cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
è&& m[7] =ğ
c7
)

	)

73 
	#¡r9cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
) \

74 (
	`¡r8cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
è&& m[8] =ğ
c8
)

	)

76 
	#¡r10cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
) \

77 (
	`¡r9cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
è&& m[9] =ğ
c9
)

	)

79 
	#¡r11cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
) \

80 (
	`¡r10cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
è&& m[10] =ğ
c10
)

	)

82 
	#¡r12cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
) \

83 (
	`¡r11cmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
è&& m[11] =ğ
c11
)

	)

87 
	#¡r3icmp
(
m
, 
c0
, 
c1
, 
c2
) \

88 ((
m
[0] =ğ
c0
 || m[0] == (c0 ^ 0x20)) && \

89 (
m
[1] =ğ
c1
 || m[1] == (c1 ^ 0x20)) && \

90 (
m
[2] =ğ
c2
 || m[2] =ğ(c2 ^ 0x20)))

	)

92 
	#¡r4icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
) \

93 (
	`¡r3icmp
(
m
, 
c0
, 
c1
, 
c2
è&& (m[3] =ğ
c3
 || m[3] =ğ(c3 ^ 0x20)))

	)

95 
	#¡r5icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
) \

96 (
	`¡r4icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
è&& (m[4] =ğ
c4
 || m[4] =ğ(c4 ^ 0x20)))

	)

98 
	#¡r6icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
) \

99 (
	`¡r5icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
è&& (m[5] =ğ
c5
 || m[5] =ğ(c5 ^ 0x20)))

	)

101 
	#¡r7icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
) \

102 (
	`¡r6icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
) && \

103 (
m
[6] =ğ
c6
 || m[6] =ğ(c6 ^ 0x20)))

	)

105 
	#¡r8icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
) \

106 (
	`¡r7icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
) && \

107 (
m
[7] =ğ
c7
 || m[7] =ğ(c7 ^ 0x20)))

	)

109 
	#¡r9icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
) \

110 (
	`¡r8icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
) && \

111 (
m
[8] =ğ
c8
 || m[8] =ğ(c8 ^ 0x20)))

	)

113 
	#¡r10icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
) \

114 (
	`¡r9icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
) && \

115 (
m
[9] =ğ
c9
 || m[9] =ğ(c9 ^ 0x20)))

	)

117 
	#¡r11icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
) \

118 (
	`¡r10icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
) && \

119 (
m
[10] =ğ
c10
 || m[10] =ğ(c10 ^ 0x20)))

	)

121 
	#¡r12icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
) \

122 (
	`¡r11icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
) && \

123 (
m
[11] =ğ
c11
 || m[11] =ğ(c11 ^ 0x20)))

	)

125 
	#¡r13icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
, 
c12
) \

126 (
	`¡r12icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
) && \

127 (
m
[12] =ğ
c12
 || m[12] =ğ(c12 ^ 0x20)))

	)

129 
	#¡r14icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
, 
c12
, 
c13
) \

130 (
	`¡r13icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
, 
c12
) && \

131 (
m
[13] =ğ
c13
 || m[13] =ğ(c13 ^ 0x20)))

	)

133 
	#¡r15icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
, 
c12
, 
c13
, 
c14
) \

134 (
	`¡r14icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
, 
c12
, 
c13
) && \

135 (
m
[14] =ğ
c14
 || m[14] =ğ(c14 ^ 0x20)))

	)

137 
	#¡r16icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
, 
c12
, 
c13
, 
c14
, 
c15
) \

138 (
	`¡r15icmp
(
m
, 
c0
, 
c1
, 
c2
, 
c3
, 
c4
, 
c5
, 
c6
, 
c7
, 
c8
, 
c9
, 
c10
, 
c11
, 
c12
, 
c13
, 
c14
) && \

139 (
m
[15] =ğ
c15
 || m[15] =ğ(c15 ^ 0x20)))

	)

141 
memÿche_·r£_»q
(
msg
 *
r
);

142 
memÿche_·r£_r¥
(
msg
 *
r
);

143 
boŞ
 
memÿche_çu»
(
msg
 *
r
);

144 
memÿche_´e_cßËsû
(
msg
 *
r
);

145 
memÿche_po¡_cßËsû
(
msg
 *
r
);

146 
r¡©us_t
 
memÿche_add_auth
(
cÚ‹xt
 *
ùx
, 
cÚn
 *
c_cÚn
, cÚÀ*
s_cÚn
);

147 
r¡©us_t
 
memÿche_äagm’t
(
msg
 *
r
, 
ušt32_t
 
ncÚtšuum
, 
msg_tqh
 *
äag_msgq
);

148 
r¡©us_t
 
memÿche_»¶y
(
msg
 *
r
);

149 
memÿche_po¡_cÚÃù
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
£rv”
 *server);

150 
memÿche_sw®low_msg
(
cÚn
 *cÚn, 
msg
 *
pmsg
, msg *msg);

152 
»dis_·r£_»q
(
msg
 *
r
);

153 
»dis_·r£_r¥
(
msg
 *
r
);

154 
boŞ
 
»dis_çu»
(
msg
 *
r
);

155 
»dis_´e_cßËsû
(
msg
 *
r
);

156 
»dis_po¡_cßËsû
(
msg
 *
r
);

157 
r¡©us_t
 
»dis_add_auth
(
cÚ‹xt
 *
ùx
, 
cÚn
 *
c_cÚn
, cÚÀ*
s_cÚn
);

158 
r¡©us_t
 
»dis_äagm’t
(
msg
 *
r
, 
ušt32_t
 
ncÚtšuum
, 
msg_tqh
 *
äag_msgq
);

159 
r¡©us_t
 
»dis_»¶y
(
msg
 *
r
);

160 
»dis_po¡_cÚÃù
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
£rv”
 *server);

161 
»dis_sw®low_msg
(
cÚn
 *cÚn, 
msg
 *
pmsg
, msg *msg);

	@proto/nc_redis.c

18 
	~<¡dio.h
>

19 
	~<ùy³.h
>

20 
	~<m©h.h
>

22 
	~<nc_cÜe.h
>

23 
	~<nc_´Ùo.h
>

25 
	#RSP_STRING
(
ACTION
) \

26 
	`ACTION
Ğ
ok
, "+OK\r\n" ) \

27 
	`ACTION
Ğ
pÚg
, "+PONG\r\n" ) \

28 
	`ACTION
Ğ
šv®id_·sswÜd
, "-ERR invalid…assword\r\n" ) \

29 
	`ACTION
Ğ
auth_»quœed
, "-NOAUTH Authentication„equired\r\n" ) \

30 
	`ACTION
Ğ
no_·sswÜd
, "-ERR Client sent AUTH, but‚o…assword is set\r\n" ) \

31 

	)

32 
	#DEFINE_ACTION
(
_v¬
, 
_¡r
è
¡ršg
 
r¥_
##_v¬ = 
	`¡ršg
(_¡r);

	)

33 
	$RSP_STRING
Ğ
DEFINE_ACTION
 )

34 #undeà
DEFINE_ACTION


36 
r¡©us_t
 
	`»dis_hªdË_auth_»q
(
msg
 *
»que¡
, msg *
»¥Ú£
);

42 
boŞ


43 
	$»dis_¬gz
(
msg
 *
r
)

45 
r
->
ty³
) {

46 
MSG_REQ_REDIS_PING
:

47 
MSG_REQ_REDIS_QUIT
:

48  
Œue
;

54  
çl£
;

55 
	}
}

61 
boŞ


62 
	$»dis_¬g0
(
msg
 *
r
)

64 
r
->
ty³
) {

65 
MSG_REQ_REDIS_EXISTS
:

66 
MSG_REQ_REDIS_PERSIST
:

67 
MSG_REQ_REDIS_PTTL
:

68 
MSG_REQ_REDIS_TTL
:

69 
MSG_REQ_REDIS_TYPE
:

70 
MSG_REQ_REDIS_DUMP
:

72 
MSG_REQ_REDIS_DECR
:

73 
MSG_REQ_REDIS_GET
:

74 
MSG_REQ_REDIS_INCR
:

75 
MSG_REQ_REDIS_STRLEN
:

77 
MSG_REQ_REDIS_HGETALL
:

78 
MSG_REQ_REDIS_HKEYS
:

79 
MSG_REQ_REDIS_HLEN
:

80 
MSG_REQ_REDIS_HVALS
:

82 
MSG_REQ_REDIS_LLEN
:

83 
MSG_REQ_REDIS_LPOP
:

84 
MSG_REQ_REDIS_RPOP
:

86 
MSG_REQ_REDIS_SCARD
:

87 
MSG_REQ_REDIS_SMEMBERS
:

88 
MSG_REQ_REDIS_SPOP
:

90 
MSG_REQ_REDIS_ZCARD
:

91 
MSG_REQ_REDIS_PFCOUNT
:

92 
MSG_REQ_REDIS_AUTH
:

93  
Œue
;

99  
çl£
;

100 
	}
}

106 
boŞ


107 
	$»dis_¬g1
(
msg
 *
r
)

109 
r
->
ty³
) {

110 
MSG_REQ_REDIS_EXPIRE
:

111 
MSG_REQ_REDIS_EXPIREAT
:

112 
MSG_REQ_REDIS_PEXPIRE
:

113 
MSG_REQ_REDIS_PEXPIREAT
:

115 
MSG_REQ_REDIS_APPEND
:

116 
MSG_REQ_REDIS_DECRBY
:

117 
MSG_REQ_REDIS_GETBIT
:

118 
MSG_REQ_REDIS_GETSET
:

119 
MSG_REQ_REDIS_INCRBY
:

120 
MSG_REQ_REDIS_INCRBYFLOAT
:

121 
MSG_REQ_REDIS_SETNX
:

123 
MSG_REQ_REDIS_HEXISTS
:

124 
MSG_REQ_REDIS_HGET
:

126 
MSG_REQ_REDIS_LINDEX
:

127 
MSG_REQ_REDIS_LPUSHX
:

128 
MSG_REQ_REDIS_RPOPLPUSH
:

129 
MSG_REQ_REDIS_RPUSHX
:

131 
MSG_REQ_REDIS_SISMEMBER
:

133 
MSG_REQ_REDIS_ZRANK
:

134 
MSG_REQ_REDIS_ZREVRANK
:

135 
MSG_REQ_REDIS_ZSCORE
:

136  
Œue
;

142  
çl£
;

143 
	}
}

149 
boŞ


150 
	$»dis_¬g2
(
msg
 *
r
)

152 
r
->
ty³
) {

153 
MSG_REQ_REDIS_GETRANGE
:

154 
MSG_REQ_REDIS_PSETEX
:

155 
MSG_REQ_REDIS_SETBIT
:

156 
MSG_REQ_REDIS_SETEX
:

157 
MSG_REQ_REDIS_SETRANGE
:

159 
MSG_REQ_REDIS_HINCRBY
:

160 
MSG_REQ_REDIS_HINCRBYFLOAT
:

161 
MSG_REQ_REDIS_HSET
:

162 
MSG_REQ_REDIS_HSETNX
:

164 
MSG_REQ_REDIS_LRANGE
:

165 
MSG_REQ_REDIS_LREM
:

166 
MSG_REQ_REDIS_LSET
:

167 
MSG_REQ_REDIS_LTRIM
:

169 
MSG_REQ_REDIS_SMOVE
:

171 
MSG_REQ_REDIS_ZCOUNT
:

172 
MSG_REQ_REDIS_ZLEXCOUNT
:

173 
MSG_REQ_REDIS_ZINCRBY
:

174 
MSG_REQ_REDIS_ZREMRANGEBYLEX
:

175 
MSG_REQ_REDIS_ZREMRANGEBYRANK
:

176 
MSG_REQ_REDIS_ZREMRANGEBYSCORE
:

178 
MSG_REQ_REDIS_RESTORE
:

179  
Œue
;

185  
çl£
;

186 
	}
}

192 
boŞ


193 
	$»dis_¬g3
(
msg
 *
r
)

195 
r
->
ty³
) {

196 
MSG_REQ_REDIS_LINSERT
:

197  
Œue
;

203  
çl£
;

204 
	}
}

210 
boŞ


211 
	$»dis_¬gn
(
msg
 *
r
)

213 
r
->
ty³
) {

214 
MSG_REQ_REDIS_SORT
:

216 
MSG_REQ_REDIS_BITCOUNT
:

217 
MSG_REQ_REDIS_BITPOS
:

219 
MSG_REQ_REDIS_SET
:

220 
MSG_REQ_REDIS_HDEL
:

221 
MSG_REQ_REDIS_HMGET
:

222 
MSG_REQ_REDIS_HMSET
:

223 
MSG_REQ_REDIS_HSCAN
:

225 
MSG_REQ_REDIS_LPUSH
:

226 
MSG_REQ_REDIS_RPUSH
:

228 
MSG_REQ_REDIS_SADD
:

229 
MSG_REQ_REDIS_SDIFF
:

230 
MSG_REQ_REDIS_SDIFFSTORE
:

231 
MSG_REQ_REDIS_SINTER
:

232 
MSG_REQ_REDIS_SINTERSTORE
:

233 
MSG_REQ_REDIS_SREM
:

234 
MSG_REQ_REDIS_SUNION
:

235 
MSG_REQ_REDIS_SUNIONSTORE
:

236 
MSG_REQ_REDIS_SRANDMEMBER
:

237 
MSG_REQ_REDIS_SSCAN
:

239 
MSG_REQ_REDIS_PFADD
:

240 
MSG_REQ_REDIS_PFMERGE
:

242 
MSG_REQ_REDIS_ZADD
:

243 
MSG_REQ_REDIS_ZINTERSTORE
:

244 
MSG_REQ_REDIS_ZRANGE
:

245 
MSG_REQ_REDIS_ZRANGEBYSCORE
:

246 
MSG_REQ_REDIS_ZREM
:

247 
MSG_REQ_REDIS_ZREVRANGE
:

248 
MSG_REQ_REDIS_ZRANGEBYLEX
:

249 
MSG_REQ_REDIS_ZREVRANGEBYSCORE
:

250 
MSG_REQ_REDIS_ZUNIONSTORE
:

251 
MSG_REQ_REDIS_ZSCAN
:

252  
Œue
;

258  
çl£
;

259 
	}
}

265 
boŞ


266 
	$»dis_¬gx
(
msg
 *
r
)

268 
r
->
ty³
) {

269 
MSG_REQ_REDIS_MGET
:

270 
MSG_REQ_REDIS_DEL
:

271  
Œue
;

277  
çl£
;

278 
	}
}

284 
boŞ


285 
	$»dis_¬gkvx
(
msg
 *
r
)

287 
r
->
ty³
) {

288 
MSG_REQ_REDIS_MSET
:

289  
Œue
;

295  
çl£
;

296 
	}
}

304 
boŞ


305 
	$»dis_¬gev®
(
msg
 *
r
)

307 
r
->
ty³
) {

308 
MSG_REQ_REDIS_EVAL
:

309 
MSG_REQ_REDIS_EVALSHA
:

310  
Œue
;

316  
çl£
;

317 
	}
}

323 
boŞ


324 
	$»dis_”rÜ
(
msg
 *
r
)

326 
r
->
ty³
) {

327 
MSG_RSP_REDIS_ERROR
:

328 
MSG_RSP_REDIS_ERROR_ERR
:

329 
MSG_RSP_REDIS_ERROR_OOM
:

330 
MSG_RSP_REDIS_ERROR_BUSY
:

331 
MSG_RSP_REDIS_ERROR_NOAUTH
:

332 
MSG_RSP_REDIS_ERROR_LOADING
:

333 
MSG_RSP_REDIS_ERROR_BUSYKEY
:

334 
MSG_RSP_REDIS_ERROR_MISCONF
:

335 
MSG_RSP_REDIS_ERROR_NOSCRIPT
:

336 
MSG_RSP_REDIS_ERROR_READONLY
:

337 
MSG_RSP_REDIS_ERROR_WRONGTYPE
:

338 
MSG_RSP_REDIS_ERROR_EXECABORT
:

339 
MSG_RSP_REDIS_ERROR_MASTERDOWN
:

340 
MSG_RSP_REDIS_ERROR_NOREPLICAS
:

341  
Œue
;

347  
çl£
;

348 
	}
}

375 
	$»dis_·r£_»q
(
msg
 *
r
)

377 
mbuf
 *
b
;

378 
ušt8_t
 *
p
, *
m
;

379 
ušt8_t
 
ch
;

381 
SW_START
,

382 
SW_NARG
,

383 
SW_NARG_LF
,

384 
SW_REQ_TYPE_LEN
,

385 
SW_REQ_TYPE_LEN_LF
,

386 
SW_REQ_TYPE
,

387 
SW_REQ_TYPE_LF
,

388 
SW_KEY_LEN
,

389 
SW_KEY_LEN_LF
,

390 
SW_KEY
,

391 
SW_KEY_LF
,

392 
SW_ARG1_LEN
,

393 
SW_ARG1_LEN_LF
,

394 
SW_ARG1
,

395 
SW_ARG1_LF
,

396 
SW_ARG2_LEN
,

397 
SW_ARG2_LEN_LF
,

398 
SW_ARG2
,

399 
SW_ARG2_LF
,

400 
SW_ARG3_LEN
,

401 
SW_ARG3_LEN_LF
,

402 
SW_ARG3
,

403 
SW_ARG3_LF
,

404 
SW_ARGN_LEN
,

405 
SW_ARGN_LEN_LF
,

406 
SW_ARGN
,

407 
SW_ARGN_LF
,

408 
SW_SENTINEL


409 } 
¡©e
;

411 
¡©e
 = 
r
->state;

412 
b
 = 
	`STAILQ_LAST
(&
r
->
mhdr
, 
mbuf
, 
Ãxt
);

414 
	`ASSERT
(
r
->
»que¡
);

415 
	`ASSERT
(
¡©e
 >ğ
SW_START
 && s‹ < 
SW_SENTINEL
);

416 
	`ASSERT
(
b
 !ğ
NULL
);

417 
	`ASSERT
(
b
->
pos
 <ğb->
Ï¡
);

420 
	`ASSERT
(
r
->
pos
 !ğ
NULL
);

421 
	`ASSERT
(
r
->
pos
 >ğ
b
->po &&„->po <ğb->
Ï¡
);

423 
p
 = 
r
->
pos
;… < 
b
->
Ï¡
;…++) {

424 
ch
 = *
p
;

426 
¡©e
) {

428 
SW_START
:

429 
SW_NARG
:

430 ià(
r
->
tok’
 =ğ
NULL
) {

431 ià(
ch
 != '*') {

432 
”rÜ
;

434 
r
->
tok’
 = 
p
;

436 
r
->
Çrg_¡¬t
 = 
p
;

437 
r
->
º¬g
 = 0;

438 
¡©e
 = 
SW_NARG
;

439 } ià(
	`isdig™
(
ch
)) {

440 
r
->
º¬g
 =„->º¬g * 10 + (
ušt32_t
)(
ch
 - '0');

441 } ià(
ch
 =ğ
CR
) {

442 ià(
r
->
º¬g
 == 0) {

443 
”rÜ
;

445 
r
->
Çrg
 =„->
º¬g
;

446 
r
->
Çrg_’d
 = 
p
;

447 
r
->
tok’
 = 
NULL
;

448 
¡©e
 = 
SW_NARG_LF
;

450 
”rÜ
;

455 
SW_NARG_LF
:

456 
ch
) {

457 
LF
:

458 
¡©e
 = 
SW_REQ_TYPE_LEN
;

462 
”rÜ
;

467 
SW_REQ_TYPE_LEN
:

468 ià(
r
->
tok’
 =ğ
NULL
) {

469 ià(
ch
 != '$') {

470 
”rÜ
;

472 
r
->
tok’
 = 
p
;

473 
r
->
¾’
 = 0;

474 } ià(
	`isdig™
(
ch
)) {

475 
r
->
¾’
 =„->¾’ * 10 + (
ušt32_t
)(
ch
 - '0');

476 } ià(
ch
 =ğ
CR
) {

477 ià(
r
->
¾’
 =ğ0 ||„->
º¬g
 == 0) {

478 
”rÜ
;

480 
r
->
º¬g
--;

481 
r
->
tok’
 = 
NULL
;

482 
¡©e
 = 
SW_REQ_TYPE_LEN_LF
;

484 
”rÜ
;

489 
SW_REQ_TYPE_LEN_LF
:

490 
ch
) {

491 
LF
:

492 
¡©e
 = 
SW_REQ_TYPE
;

496 
”rÜ
;

501 
SW_REQ_TYPE
:

502 ià(
r
->
tok’
 =ğ
NULL
) {

503 
r
->
tok’
 = 
p
;

506 
m
 = 
r
->
tok’
 +„->
¾’
;

507 ià(
m
 >ğ
b
->
Ï¡
) {

508 
m
 = 
b
->
Ï¡
 - 1;

509 
p
 = 
m
;

513 ià(*
m
 !ğ
CR
) {

514 
”rÜ
;

517 
p
 = 
m
;

518 
r
->
¾’
 = 0;

519 
m
 = 
r
->
tok’
;

520 
r
->
tok’
 = 
NULL
;

521 
r
->
ty³
 = 
MSG_UNKNOWN
;

523 
p
 - 
m
) {

526 ià(
	`¡r3icmp
(
m
, 'g', 'e', 't')) {

527 
r
->
ty³
 = 
MSG_REQ_REDIS_GET
;

531 ià(
	`¡r3icmp
(
m
, 's', 'e', 't')) {

532 
r
->
ty³
 = 
MSG_REQ_REDIS_SET
;

534 
r
->
is_wr™e
 = 1;

538 ià(
	`¡r3icmp
(
m
, 't', 't', 'l')) {

539 
r
->
ty³
 = 
MSG_REQ_REDIS_TTL
;

543 ià(
	`¡r3icmp
(
m
, 'd', 'e', 'l')) {

544 
r
->
ty³
 = 
MSG_REQ_REDIS_DEL
;

551 ià(
	`¡r4icmp
(
m
, 'p', 't', 't', 'l')) {

552 
r
->
ty³
 = 
MSG_REQ_REDIS_PTTL
;

556 ià(
	`¡r4icmp
(
m
, 'd', 'e', 'c', 'r')) {

557 
r
->
ty³
 = 
MSG_REQ_REDIS_DECR
;

561 ià(
	`¡r4icmp
(
m
, 'd', 'u', 'm', 'p')) {

562 
r
->
ty³
 = 
MSG_REQ_REDIS_DUMP
;

566 ià(
	`¡r4icmp
(
m
, 'h', 'd', 'e', 'l')) {

567 
r
->
ty³
 = 
MSG_REQ_REDIS_HDEL
;

571 ià(
	`¡r4icmp
(
m
, 'h', 'g', 'e', 't')) {

572 
r
->
ty³
 = 
MSG_REQ_REDIS_HGET
;

576 ià(
	`¡r4icmp
(
m
, 'h', 'l', 'e', 'n')) {

577 
r
->
ty³
 = 
MSG_REQ_REDIS_HLEN
;

581 ià(
	`¡r4icmp
(
m
, 'h', 's', 'e', 't')) {

582 
r
->
ty³
 = 
MSG_REQ_REDIS_HSET
;

586 ià(
	`¡r4icmp
(
m
, 'i', 'n', 'c', 'r')) {

587 
r
->
ty³
 = 
MSG_REQ_REDIS_INCR
;

591 ià(
	`¡r4icmp
(
m
, 'l', 'l', 'e', 'n')) {

592 
r
->
ty³
 = 
MSG_REQ_REDIS_LLEN
;

596 ià(
	`¡r4icmp
(
m
, 'l', 'p', 'o', 'p')) {

597 
r
->
ty³
 = 
MSG_REQ_REDIS_LPOP
;

601 ià(
	`¡r4icmp
(
m
, 'l', 'r', 'e', 'm')) {

602 
r
->
ty³
 = 
MSG_REQ_REDIS_LREM
;

606 ià(
	`¡r4icmp
(
m
, 'l', 's', 'e', 't')) {

607 
r
->
ty³
 = 
MSG_REQ_REDIS_LSET
;

611 ià(
	`¡r4icmp
(
m
, 'r', 'p', 'o', 'p')) {

612 
r
->
ty³
 = 
MSG_REQ_REDIS_RPOP
;

616 ià(
	`¡r4icmp
(
m
, 's', 'a', 'd', 'd')) {

617 
r
->
ty³
 = 
MSG_REQ_REDIS_SADD
;

621 ià(
	`¡r4icmp
(
m
, 's', 'p', 'o', 'p')) {

622 
r
->
ty³
 = 
MSG_REQ_REDIS_SPOP
;

626 ià(
	`¡r4icmp
(
m
, 's', 'r', 'e', 'm')) {

627 
r
->
ty³
 = 
MSG_REQ_REDIS_SREM
;

631 ià(
	`¡r4icmp
(
m
, 't', 'y', 'p', 'e')) {

632 
r
->
ty³
 = 
MSG_REQ_REDIS_TYPE
;

636 ià(
	`¡r4icmp
(
m
, 'm', 'g', 'e', 't')) {

637 
r
->
ty³
 = 
MSG_REQ_REDIS_MGET
;

640 ià(
	`¡r4icmp
(
m
, 'm', 's', 'e', 't')) {

641 
r
->
ty³
 = 
MSG_REQ_REDIS_MSET
;

645 ià(
	`¡r4icmp
(
m
, 'z', 'a', 'd', 'd')) {

646 
r
->
ty³
 = 
MSG_REQ_REDIS_ZADD
;

650 ià(
	`¡r4icmp
(
m
, 'z', 'r', 'e', 'm')) {

651 
r
->
ty³
 = 
MSG_REQ_REDIS_ZREM
;

655 ià(
	`¡r4icmp
(
m
, 'e', 'v', 'a', 'l')) {

656 
r
->
ty³
 = 
MSG_REQ_REDIS_EVAL
;

660 ià(
	`¡r4icmp
(
m
, 's', 'o', 'r', 't')) {

661 
r
->
ty³
 = 
MSG_REQ_REDIS_SORT
;

665 ià(
	`¡r4icmp
(
m
, 'p', 'i', 'n', 'g')) {

666 
r
->
ty³
 = 
MSG_REQ_REDIS_PING
;

667 
r
->
nofÜw¬d
 = 1;

671 ià(
	`¡r4icmp
(
m
, 'q', 'u', 'i', 't')) {

672 
r
->
ty³
 = 
MSG_REQ_REDIS_QUIT
;

673 
r
->
qu™
 = 1;

677 ià(
	`¡r4icmp
(
m
, 'a', 'u', 't', 'h')) {

678 
r
->
ty³
 = 
MSG_REQ_REDIS_AUTH
;

679 
r
->
nofÜw¬d
 = 1;

686 ià(
	`¡r5icmp
(
m
, 'h', 'k', 'e', 'y', 's')) {

687 
r
->
ty³
 = 
MSG_REQ_REDIS_HKEYS
;

691 ià(
	`¡r5icmp
(
m
, 'h', 'm', 'g', 'e', 't')) {

692 
r
->
ty³
 = 
MSG_REQ_REDIS_HMGET
;

696 ià(
	`¡r5icmp
(
m
, 'h', 'm', 's', 'e', 't')) {

697 
r
->
ty³
 = 
MSG_REQ_REDIS_HMSET
;

701 ià(
	`¡r5icmp
(
m
, 'h', 'v', 'a', 'l', 's')) {

702 
r
->
ty³
 = 
MSG_REQ_REDIS_HVALS
;

706 ià(
	`¡r5icmp
(
m
, 'h', 's', 'c', 'a', 'n')) {

707 
r
->
ty³
 = 
MSG_REQ_REDIS_HSCAN
;

711 ià(
	`¡r5icmp
(
m
, 'l', 'p', 'u', 's', 'h')) {

712 
r
->
ty³
 = 
MSG_REQ_REDIS_LPUSH
;

716 ià(
	`¡r5icmp
(
m
, 'l', 't', 'r', 'i', 'm')) {

717 
r
->
ty³
 = 
MSG_REQ_REDIS_LTRIM
;

721 ià(
	`¡r5icmp
(
m
, 'r', 'p', 'u', 's', 'h')) {

722 
r
->
ty³
 = 
MSG_REQ_REDIS_RPUSH
;

726 ià(
	`¡r5icmp
(
m
, 's', 'c', 'a', 'r', 'd')) {

727 
r
->
ty³
 = 
MSG_REQ_REDIS_SCARD
;

731 ià(
	`¡r5icmp
(
m
, 's', 'd', 'i', 'f', 'f')) {

732 
r
->
ty³
 = 
MSG_REQ_REDIS_SDIFF
;

736 ià(
	`¡r5icmp
(
m
, 's', 'e', 't', 'e', 'x')) {

737 
r
->
ty³
 = 
MSG_REQ_REDIS_SETEX
;

741 ià(
	`¡r5icmp
(
m
, 's', 'e', 't', 'n', 'x')) {

742 
r
->
ty³
 = 
MSG_REQ_REDIS_SETNX
;

746 ià(
	`¡r5icmp
(
m
, 's', 'm', 'o', 'v', 'e')) {

747 
r
->
ty³
 = 
MSG_REQ_REDIS_SMOVE
;

751 ià(
	`¡r5icmp
(
m
, 's', 's', 'c', 'a', 'n')) {

752 
r
->
ty³
 = 
MSG_REQ_REDIS_SSCAN
;

756 ià(
	`¡r5icmp
(
m
, 'z', 'c', 'a', 'r', 'd')) {

757 
r
->
ty³
 = 
MSG_REQ_REDIS_ZCARD
;

761 ià(
	`¡r5icmp
(
m
, 'z', 'r', 'a', 'n', 'k')) {

762 
r
->
ty³
 = 
MSG_REQ_REDIS_ZRANK
;

766 ià(
	`¡r5icmp
(
m
, 'z', 's', 'c', 'a', 'n')) {

767 
r
->
ty³
 = 
MSG_REQ_REDIS_ZSCAN
;

771 ià(
	`¡r5icmp
(
m
, 'p', 'f', 'a', 'd', 'd')) {

772 
r
->
ty³
 = 
MSG_REQ_REDIS_PFADD
;

779 ià(
	`¡r6icmp
(
m
, 'a', 'p', 'p', 'e', 'n', 'd')) {

780 
r
->
ty³
 = 
MSG_REQ_REDIS_APPEND
;

784 ià(
	`¡r6icmp
(
m
, 'b', 'i', 't', 'p', 'o', 's')) {

785 
r
->
ty³
 = 
MSG_REQ_REDIS_BITPOS
;

789 ià(
	`¡r6icmp
(
m
, 'd', 'e', 'c', 'r', 'b', 'y')) {

790 
r
->
ty³
 = 
MSG_REQ_REDIS_DECRBY
;

794 ià(
	`¡r6icmp
(
m
, 'e', 'x', 'i', 's', 't', 's')) {

795 
r
->
ty³
 = 
MSG_REQ_REDIS_EXISTS
;

799 ià(
	`¡r6icmp
(
m
, 'e', 'x', 'p', 'i', 'r', 'e')) {

800 
r
->
ty³
 = 
MSG_REQ_REDIS_EXPIRE
;

804 ià(
	`¡r6icmp
(
m
, 'g', 'e', 't', 'b', 'i', 't')) {

805 
r
->
ty³
 = 
MSG_REQ_REDIS_GETBIT
;

809 ià(
	`¡r6icmp
(
m
, 'g', 'e', 't', 's', 'e', 't')) {

810 
r
->
ty³
 = 
MSG_REQ_REDIS_GETSET
;

814 ià(
	`¡r6icmp
(
m
, 'p', 's', 'e', 't', 'e', 'x')) {

815 
r
->
ty³
 = 
MSG_REQ_REDIS_PSETEX
;

819 ià(
	`¡r6icmp
(
m
, 'h', 's', 'e', 't', 'n', 'x')) {

820 
r
->
ty³
 = 
MSG_REQ_REDIS_HSETNX
;

824 ià(
	`¡r6icmp
(
m
, 'i', 'n', 'c', 'r', 'b', 'y')) {

825 
r
->
ty³
 = 
MSG_REQ_REDIS_INCRBY
;

829 ià(
	`¡r6icmp
(
m
, 'l', 'i', 'n', 'd', 'e', 'x')) {

830 
r
->
ty³
 = 
MSG_REQ_REDIS_LINDEX
;

834 ià(
	`¡r6icmp
(
m
, 'l', 'p', 'u', 's', 'h', 'x')) {

835 
r
->
ty³
 = 
MSG_REQ_REDIS_LPUSHX
;

839 ià(
	`¡r6icmp
(
m
, 'l', 'r', 'a', 'n', 'g', 'e')) {

840 
r
->
ty³
 = 
MSG_REQ_REDIS_LRANGE
;

844 ià(
	`¡r6icmp
(
m
, 'r', 'p', 'u', 's', 'h', 'x')) {

845 
r
->
ty³
 = 
MSG_REQ_REDIS_RPUSHX
;

849 ià(
	`¡r6icmp
(
m
, 's', 'e', 't', 'b', 'i', 't')) {

850 
r
->
ty³
 = 
MSG_REQ_REDIS_SETBIT
;

854 ià(
	`¡r6icmp
(
m
, 's', 'i', 'n', 't', 'e', 'r')) {

855 
r
->
ty³
 = 
MSG_REQ_REDIS_SINTER
;

859 ià(
	`¡r6icmp
(
m
, 's', 't', 'r', 'l', 'e', 'n')) {

860 
r
->
ty³
 = 
MSG_REQ_REDIS_STRLEN
;

864 ià(
	`¡r6icmp
(
m
, 's', 'u', 'n', 'i', 'o', 'n')) {

865 
r
->
ty³
 = 
MSG_REQ_REDIS_SUNION
;

869 ià(
	`¡r6icmp
(
m
, 'z', 'c', 'o', 'u', 'n', 't')) {

870 
r
->
ty³
 = 
MSG_REQ_REDIS_ZCOUNT
;

874 ià(
	`¡r6icmp
(
m
, 'z', 'r', 'a', 'n', 'g', 'e')) {

875 
r
->
ty³
 = 
MSG_REQ_REDIS_ZRANGE
;

879 ià(
	`¡r6icmp
(
m
, 'z', 's', 'c', 'o', 'r', 'e')) {

880 
r
->
ty³
 = 
MSG_REQ_REDIS_ZSCORE
;

887 ià(
	`¡r7icmp
(
m
, 'p', 'e', 'r', 's', 'i', 's', 't')) {

888 
r
->
ty³
 = 
MSG_REQ_REDIS_PERSIST
;

892 ià(
	`¡r7icmp
(
m
, 'p', 'e', 'x', 'p', 'i', 'r', 'e')) {

893 
r
->
ty³
 = 
MSG_REQ_REDIS_PEXPIRE
;

897 ià(
	`¡r7icmp
(
m
, 'h', 'e', 'x', 'i', 's', 't', 's')) {

898 
r
->
ty³
 = 
MSG_REQ_REDIS_HEXISTS
;

902 ià(
	`¡r7icmp
(
m
, 'h', 'g', 'e', 't', 'a', 'l', 'l')) {

903 
r
->
ty³
 = 
MSG_REQ_REDIS_HGETALL
;

907 ià(
	`¡r7icmp
(
m
, 'h', 'i', 'n', 'c', 'r', 'b', 'y')) {

908 
r
->
ty³
 = 
MSG_REQ_REDIS_HINCRBY
;

912 ià(
	`¡r7icmp
(
m
, 'l', 'i', 'n', 's', 'e', 'r', 't')) {

913 
r
->
ty³
 = 
MSG_REQ_REDIS_LINSERT
;

917 ià(
	`¡r7icmp
(
m
, 'z', 'i', 'n', 'c', 'r', 'b', 'y')) {

918 
r
->
ty³
 = 
MSG_REQ_REDIS_ZINCRBY
;

922 ià(
	`¡r7icmp
(
m
, 'e', 'v', 'a', 'l', 's', 'h', 'a')) {

923 
r
->
ty³
 = 
MSG_REQ_REDIS_EVALSHA
;

927 ià(
	`¡r7icmp
(
m
, 'r', 'e', 's', 't', 'o', 'r', 'e')) {

928 
r
->
ty³
 = 
MSG_REQ_REDIS_RESTORE
;

932 ià(
	`¡r7icmp
(
m
, 'p', 'f', 'c', 'o', 'u', 'n', 't')) {

933 
r
->
ty³
 = 
MSG_REQ_REDIS_PFCOUNT
;

937 ià(
	`¡r7icmp
(
m
, 'p', 'f', 'm', 'e', 'r', 'g', 'e')) {

938 
r
->
ty³
 = 
MSG_REQ_REDIS_PFMERGE
;

945 ià(
	`¡r8icmp
(
m
, 'e', 'x', 'p', 'i', 'r', 'e', 'a', 't')) {

946 
r
->
ty³
 = 
MSG_REQ_REDIS_EXPIREAT
;

950 ià(
	`¡r8icmp
(
m
, 'b', 'i', 't', 'c', 'o', 'u', 'n', 't')) {

951 
r
->
ty³
 = 
MSG_REQ_REDIS_BITCOUNT
;

955 ià(
	`¡r8icmp
(
m
, 'g', 'e', 't', 'r', 'a', 'n', 'g', 'e')) {

956 
r
->
ty³
 = 
MSG_REQ_REDIS_GETRANGE
;

960 ià(
	`¡r8icmp
(
m
, 's', 'e', 't', 'r', 'a', 'n', 'g', 'e')) {

961 
r
->
ty³
 = 
MSG_REQ_REDIS_SETRANGE
;

965 ià(
	`¡r8icmp
(
m
, 's', 'm', 'e', 'm', 'b', 'e', 'r', 's')) {

966 
r
->
ty³
 = 
MSG_REQ_REDIS_SMEMBERS
;

970 ià(
	`¡r8icmp
(
m
, 'z', 'r', 'e', 'v', 'r', 'a', 'n', 'k')) {

971 
r
->
ty³
 = 
MSG_REQ_REDIS_ZREVRANK
;

978 ià(
	`¡r9icmp
(
m
, 'p', 'e', 'x', 'p', 'i', 'r', 'e', 'a', 't')) {

979 
r
->
ty³
 = 
MSG_REQ_REDIS_PEXPIREAT
;

983 ià(
	`¡r9icmp
(
m
, 'r', 'p', 'o', 'p', 'l', 'p', 'u', 's', 'h')) {

984 
r
->
ty³
 = 
MSG_REQ_REDIS_RPOPLPUSH
;

988 ià(
	`¡r9icmp
(
m
, 's', 'i', 's', 'm', 'e', 'm', 'b', 'e', 'r')) {

989 
r
->
ty³
 = 
MSG_REQ_REDIS_SISMEMBER
;

993 ià(
	`¡r9icmp
(
m
, 'z', 'r', 'e', 'v', 'r', 'a', 'n', 'g', 'e')) {

994 
r
->
ty³
 = 
MSG_REQ_REDIS_ZREVRANGE
;

998 ià(
	`¡r9icmp
(
m
, 'z', 'l', 'e', 'x', 'c', 'o', 'u', 'n', 't')) {

999 
r
->
ty³
 = 
MSG_REQ_REDIS_ZLEXCOUNT
;

1006 ià(
	`¡r10icmp
(
m
, 's', 'd', 'i', 'f', 'f', 's', 't', 'o', 'r', 'e')) {

1007 
r
->
ty³
 = 
MSG_REQ_REDIS_SDIFFSTORE
;

1012 ià(
	`¡r11icmp
(
m
, 'i', 'n', 'c', 'r', 'b', 'y', 'f', 'l', 'o', 'a', 't')) {

1013 
r
->
ty³
 = 
MSG_REQ_REDIS_INCRBYFLOAT
;

1017 ià(
	`¡r11icmp
(
m
, 's', 'i', 'n', 't', 'e', 'r', 's', 't', 'o', 'r', 'e')) {

1018 
r
->
ty³
 = 
MSG_REQ_REDIS_SINTERSTORE
;

1022 ià(
	`¡r11icmp
(
m
, 's', 'r', 'a', 'n', 'd', 'm', 'e', 'm', 'b', 'e', 'r')) {

1023 
r
->
ty³
 = 
MSG_REQ_REDIS_SRANDMEMBER
;

1027 ià(
	`¡r11icmp
(
m
, 's', 'u', 'n', 'i', 'o', 'n', 's', 't', 'o', 'r', 'e')) {

1028 
r
->
ty³
 = 
MSG_REQ_REDIS_SUNIONSTORE
;

1032 ià(
	`¡r11icmp
(
m
, 'z', 'i', 'n', 't', 'e', 'r', 's', 't', 'o', 'r', 'e')) {

1033 
r
->
ty³
 = 
MSG_REQ_REDIS_ZINTERSTORE
;

1037 ià(
	`¡r11icmp
(
m
, 'z', 'u', 'n', 'i', 'o', 'n', 's', 't', 'o', 'r', 'e')) {

1038 
r
->
ty³
 = 
MSG_REQ_REDIS_ZUNIONSTORE
;

1042 ià(
	`¡r11icmp
(
m
, 'z', 'r', 'a', 'n', 'g', 'e', 'b', 'y', 'l', 'e', 'x')) {

1043 
r
->
ty³
 = 
MSG_REQ_REDIS_ZRANGEBYLEX
;

1050 ià(
	`¡r12icmp
(
m
, 'h', 'i', 'n', 'c', 'r', 'b', 'y', 'f', 'l', 'o', 'a', 't')) {

1051 
r
->
ty³
 = 
MSG_REQ_REDIS_HINCRBYFLOAT
;

1059 ià(
	`¡r13icmp
(
m
, 'z', 'r', 'a', 'n', 'g', 'e', 'b', 'y', 's', 'c', 'o', 'r', 'e')) {

1060 
r
->
ty³
 = 
MSG_REQ_REDIS_ZRANGEBYSCORE
;

1067 ià(
	`¡r14icmp
(
m
, 'z', 'r', 'e', 'm', 'r', 'a', 'n', 'g', 'e', 'b', 'y', 'l', 'e', 'x')) {

1068 
r
->
ty³
 = 
MSG_REQ_REDIS_ZREMRANGEBYLEX
;

1075 ià(
	`¡r15icmp
(
m
, 'z', 'r', 'e', 'm', 'r', 'a', 'n', 'g', 'e', 'b', 'y', 'r', 'a', 'n', 'k')) {

1076 
r
->
ty³
 = 
MSG_REQ_REDIS_ZREMRANGEBYRANK
;

1083 ià(
	`¡r16icmp
(
m
, 'z', 'r', 'e', 'm', 'r', 'a', 'n', 'g', 'e', 'b', 'y', 's', 'c', 'o', 'r', 'e')) {

1084 
r
->
ty³
 = 
MSG_REQ_REDIS_ZREMRANGEBYSCORE
;

1088 ià(
	`¡r16icmp
(
m
, 'z', 'r', 'e', 'v', 'r', 'a', 'n', 'g', 'e', 'b', 'y', 's', 'c', 'o', 'r', 'e')) {

1089 
r
->
ty³
 = 
MSG_REQ_REDIS_ZREVRANGEBYSCORE
;

1099 ià(
r
->
ty³
 =ğ
MSG_UNKNOWN
) {

1100 
	`log_”rÜ
("·r£d unsuµÜ‹d commªd '%.*s'", 
p
 - 
m
, m);

1101 
”rÜ
;

1104 
	`log_debug
(
LOG_VERB
, "·r£d commªd '%.*s'", 
p
 - 
m
, m);

1106 
¡©e
 = 
SW_REQ_TYPE_LF
;

1109 
SW_REQ_TYPE_LF
:

1110 
ch
) {

1111 
LF
:

1112 ià(
	`»dis_¬gz
(
r
)) {

1113 
dÚe
;

1114 } ià(
r
->
Çrg
 == 1) {

1115 
”rÜ
;

1116 } ià(
	`»dis_¬gev®
(
r
)) {

1117 
¡©e
 = 
SW_ARG1_LEN
;

1119 
¡©e
 = 
SW_KEY_LEN
;

1124 
”rÜ
;

1129 
SW_KEY_LEN
:

1130 ià(
r
->
tok’
 =ğ
NULL
) {

1131 ià(
ch
 != '$') {

1132 
”rÜ
;

1134 
r
->
tok’
 = 
p
;

1135 
r
->
¾’
 = 0;

1136 } ià(
	`isdig™
(
ch
)) {

1137 
r
->
¾’
 =„->¾’ * 10 + (
ušt32_t
)(
ch
 - '0');

1138 } ià(
ch
 =ğ
CR
) {

1139 ià(
r
->
¾’
 >ğ
	`mbuf_d©a_size
()) {

1140 
	`log_”rÜ
("·r£d bad„eq %"
PRIu64
" ofype %d with key "

1142 "„edi key†’gth oà%d", 
r
->
id
,„->
ty³
,

1143 
r
->
¾’
, 
	`mbuf_d©a_size
());

1144 
”rÜ
;

1146 ià(
r
->
º¬g
 == 0) {

1147 
”rÜ
;

1149 
r
->
º¬g
--;

1150 
r
->
tok’
 = 
NULL
;

1151 
¡©e
 = 
SW_KEY_LEN_LF
;

1153 
”rÜ
;

1158 
SW_KEY_LEN_LF
:

1159 
ch
) {

1160 
LF
:

1161 
¡©e
 = 
SW_KEY
;

1165 
”rÜ
;

1170 
SW_KEY
:

1171 ià(
r
->
tok’
 =ğ
NULL
) {

1172 
r
->
tok’
 = 
p
;

1175 
m
 = 
r
->
tok’
 +„->
¾’
;

1176 ià(
m
 >ğ
b
->
Ï¡
) {

1177 
m
 = 
b
->
Ï¡
 - 1;

1178 
p
 = 
m
;

1182 ià(*
m
 !ğ
CR
) {

1183 
”rÜ
;

1185 
keypos
 *
kpos
;

1187 
p
 = 
m
;

1188 
r
->
¾’
 = 0;

1189 
m
 = 
r
->
tok’
;

1190 
r
->
tok’
 = 
NULL
;

1192 
kpos
 = 
	`¬¿y_push
(
r
->
keys
);

1193 ià(
kpos
 =ğ
NULL
) {

1194 
’omem
;

1196 
kpos
->
¡¬t
 = 
m
;

1197 
kpos
->
’d
 = 
p
;

1199 
¡©e
 = 
SW_KEY_LF
;

1204 
SW_KEY_LF
:

1205 
ch
) {

1206 
LF
:

1207 ià(
	`»dis_¬g0
(
r
)) {

1208 ià(
r
->
º¬g
 != 0) {

1209 
”rÜ
;

1211 
dÚe
;

1212 } ià(
	`»dis_¬g1
(
r
)) {

1213 ià(
r
->
º¬g
 != 1) {

1214 
”rÜ
;

1216 
¡©e
 = 
SW_ARG1_LEN
;

1217 } ià(
	`»dis_¬g2
(
r
)) {

1218 ià(
r
->
º¬g
 != 2) {

1219 
”rÜ
;

1221 
¡©e
 = 
SW_ARG1_LEN
;

1222 } ià(
	`»dis_¬g3
(
r
)) {

1223 ià(
r
->
º¬g
 != 3) {

1224 
”rÜ
;

1226 
¡©e
 = 
SW_ARG1_LEN
;

1227 } ià(
	`»dis_¬gn
(
r
)) {

1228 ià(
r
->
º¬g
 == 0) {

1229 
dÚe
;

1231 
¡©e
 = 
SW_ARG1_LEN
;

1232 } ià(
	`»dis_¬gx
(
r
)) {

1233 ià(
r
->
º¬g
 == 0) {

1234 
dÚe
;

1236 
¡©e
 = 
SW_KEY_LEN
;

1237 } ià(
	`»dis_¬gkvx
(
r
)) {

1238 ià(
r
->
Çrg
 % 2 == 0) {

1239 
”rÜ
;

1241 
¡©e
 = 
SW_ARG1_LEN
;

1242 } ià(
	`»dis_¬gev®
(
r
)) {

1243 ià(
r
->
º¬g
 == 0) {

1244 
dÚe
;

1246 
¡©e
 = 
SW_ARGN_LEN
;

1248 
”rÜ
;

1254 
”rÜ
;

1259 
SW_ARG1_LEN
:

1260 ià(
r
->
tok’
 =ğ
NULL
) {

1261 ià(
ch
 != '$') {

1262 
”rÜ
;

1264 
r
->
¾’
 = 0;

1265 
r
->
tok’
 = 
p
;

1266 } ià(
	`isdig™
(
ch
)) {

1267 
r
->
¾’
 =„->¾’ * 10 + (
ušt32_t
)(
ch
 - '0');

1268 } ià(
ch
 =ğ
CR
) {

1269 ià((
p
 - 
r
->
tok’
è<ğ1 ||„->
º¬g
 == 0) {

1270 
”rÜ
;

1272 
r
->
º¬g
--;

1273 
r
->
tok’
 = 
NULL
;

1274 
¡©e
 = 
SW_ARG1_LEN_LF
;

1276 
”rÜ
;

1281 
SW_ARG1_LEN_LF
:

1282 
ch
) {

1283 
LF
:

1284 
¡©e
 = 
SW_ARG1
;

1288 
”rÜ
;

1293 
SW_ARG1
:

1294 
m
 = 
p
 + 
r
->
¾’
;

1295 ià(
m
 >ğ
b
->
Ï¡
) {

1296 
r
->
¾’
 -ğ(
ušt32_t
)(
b
->
Ï¡
 - 
p
);

1297 
m
 = 
b
->
Ï¡
 - 1;

1298 
p
 = 
m
;

1302 ià(*
m
 !ğ
CR
) {

1303 
”rÜ
;

1306 
p
 = 
m
;

1307 
r
->
¾’
 = 0;

1309 
¡©e
 = 
SW_ARG1_LF
;

1313 
SW_ARG1_LF
:

1314 
ch
) {

1315 
LF
:

1316 ià(
	`»dis_¬g1
(
r
)) {

1317 ià(
r
->
º¬g
 != 0) {

1318 
”rÜ
;

1320 
dÚe
;

1321 } ià(
	`»dis_¬g2
(
r
)) {

1322 ià(
r
->
º¬g
 != 1) {

1323 
”rÜ
;

1325 
¡©e
 = 
SW_ARG2_LEN
;

1326 } ià(
	`»dis_¬g3
(
r
)) {

1327 ià(
r
->
º¬g
 != 2) {

1328 
”rÜ
;

1330 
¡©e
 = 
SW_ARG2_LEN
;

1331 } ià(
	`»dis_¬gn
(
r
)) {

1332 ià(
r
->
º¬g
 == 0) {

1333 
dÚe
;

1335 
¡©e
 = 
SW_ARGN_LEN
;

1336 } ià(
	`»dis_¬gev®
(
r
)) {

1337 ià(
r
->
º¬g
 < 2) {

1338 
”rÜ
;

1340 
¡©e
 = 
SW_ARG2_LEN
;

1341 } ià(
	`»dis_¬gkvx
(
r
)) {

1342 ià(
r
->
º¬g
 == 0) {

1343 
dÚe
;

1345 
¡©e
 = 
SW_KEY_LEN
;

1347 
”rÜ
;

1353 
”rÜ
;

1358 
SW_ARG2_LEN
:

1359 ià(
r
->
tok’
 =ğ
NULL
) {

1360 ià(
ch
 != '$') {

1361 
”rÜ
;

1363 
r
->
¾’
 = 0;

1364 
r
->
tok’
 = 
p
;

1365 } ià(
	`isdig™
(
ch
)) {

1366 
r
->
¾’
 =„->¾’ * 10 + (
ušt32_t
)(
ch
 - '0');

1367 } ià(
ch
 =ğ
CR
) {

1368 ià((
p
 - 
r
->
tok’
è<ğ1 ||„->
º¬g
 == 0) {

1369 
”rÜ
;

1371 
r
->
º¬g
--;

1372 
r
->
tok’
 = 
NULL
;

1373 
¡©e
 = 
SW_ARG2_LEN_LF
;

1375 
”rÜ
;

1380 
SW_ARG2_LEN_LF
:

1381 
ch
) {

1382 
LF
:

1383 
¡©e
 = 
SW_ARG2
;

1387 
”rÜ
;

1392 
SW_ARG2
:

1393 ià(
r
->
tok’
 =ğ
NULL
 && 
	`»dis_¬gev®
(r)) {

1398 
r
->
tok’
 = 
p
;

1401 
m
 = 
p
 + 
r
->
¾’
;

1402 ià(
m
 >ğ
b
->
Ï¡
) {

1403 
r
->
¾’
 -ğ(
ušt32_t
)(
b
->
Ï¡
 - 
p
);

1404 
m
 = 
b
->
Ï¡
 - 1;

1405 
p
 = 
m
;

1409 ià(*
m
 !ğ
CR
) {

1410 
”rÜ
;

1413 
p
 = 
m
;

1414 
r
->
¾’
 = 0;

1416 ià(
	`»dis_¬gev®
(
r
)) {

1417 
ušt32_t
 
nkey
;

1418 
ušt8_t
 *
chp
;

1427 ià(
p
 - 
r
->
tok’
 < 1) {

1428 
”rÜ
;

1431 
nkey
 = 0, 
chp
 = 
r
->
tok’
; ch°< 
p
; chp++) {

1432 ià(
	`isdig™
(*
chp
)) {

1433 
nkey
 =‚key * 10 + (
ušt32_t
)(*
chp
 - '0');

1435 
”rÜ
;

1438 ià(
nkey
 == 0) {

1439 
”rÜ
;

1442 
r
->
tok’
 = 
NULL
;

1445 
¡©e
 = 
SW_ARG2_LF
;

1449 
SW_ARG2_LF
:

1450 
ch
) {

1451 
LF
:

1452 ià(
	`»dis_¬g2
(
r
)) {

1453 ià(
r
->
º¬g
 != 0) {

1454 
”rÜ
;

1456 
dÚe
;

1457 } ià(
	`»dis_¬g3
(
r
)) {

1458 ià(
r
->
º¬g
 != 1) {

1459 
”rÜ
;

1461 
¡©e
 = 
SW_ARG3_LEN
;

1462 } ià(
	`»dis_¬gn
(
r
)) {

1463 ià(
r
->
º¬g
 == 0) {

1464 
dÚe
;

1466 
¡©e
 = 
SW_ARGN_LEN
;

1467 } ià(
	`»dis_¬gev®
(
r
)) {

1468 ià(
r
->
º¬g
 < 1) {

1469 
”rÜ
;

1471 
¡©e
 = 
SW_KEY_LEN
;

1473 
”rÜ
;

1479 
”rÜ
;

1484 
SW_ARG3_LEN
:

1485 ià(
r
->
tok’
 =ğ
NULL
) {

1486 ià(
ch
 != '$') {

1487 
”rÜ
;

1489 
r
->
¾’
 = 0;

1490 
r
->
tok’
 = 
p
;

1491 } ià(
	`isdig™
(
ch
)) {

1492 
r
->
¾’
 =„->¾’ * 10 + (
ušt32_t
)(
ch
 - '0');

1493 } ià(
ch
 =ğ
CR
) {

1494 ià((
p
 - 
r
->
tok’
è<ğ1 ||„->
º¬g
 == 0) {

1495 
”rÜ
;

1497 
r
->
º¬g
--;

1498 
r
->
tok’
 = 
NULL
;

1499 
¡©e
 = 
SW_ARG3_LEN_LF
;

1501 
”rÜ
;

1506 
SW_ARG3_LEN_LF
:

1507 
ch
) {

1508 
LF
:

1509 
¡©e
 = 
SW_ARG3
;

1513 
”rÜ
;

1518 
SW_ARG3
:

1519 
m
 = 
p
 + 
r
->
¾’
;

1520 ià(
m
 >ğ
b
->
Ï¡
) {

1521 
r
->
¾’
 -ğ(
ušt32_t
)(
b
->
Ï¡
 - 
p
);

1522 
m
 = 
b
->
Ï¡
 - 1;

1523 
p
 = 
m
;

1527 ià(*
m
 !ğ
CR
) {

1528 
”rÜ
;

1531 
p
 = 
m
;

1532 
r
->
¾’
 = 0;

1533 
¡©e
 = 
SW_ARG3_LF
;

1537 
SW_ARG3_LF
:

1538 
ch
) {

1539 
LF
:

1540 ià(
	`»dis_¬g3
(
r
)) {

1541 ià(
r
->
º¬g
 != 0) {

1542 
”rÜ
;

1544 
dÚe
;

1545 } ià(
	`»dis_¬gn
(
r
)) {

1546 ià(
r
->
º¬g
 == 0) {

1547 
dÚe
;

1549 
¡©e
 = 
SW_ARGN_LEN
;

1551 
”rÜ
;

1557 
”rÜ
;

1562 
SW_ARGN_LEN
:

1563 ià(
r
->
tok’
 =ğ
NULL
) {

1564 ià(
ch
 != '$') {

1565 
”rÜ
;

1567 
r
->
¾’
 = 0;

1568 
r
->
tok’
 = 
p
;

1569 } ià(
	`isdig™
(
ch
)) {

1570 
r
->
¾’
 =„->¾’ * 10 + (
ušt32_t
)(
ch
 - '0');

1571 } ià(
ch
 =ğ
CR
) {

1572 ià((
p
 - 
r
->
tok’
è<ğ1 ||„->
º¬g
 == 0) {

1573 
”rÜ
;

1575 
r
->
º¬g
--;

1576 
r
->
tok’
 = 
NULL
;

1577 
¡©e
 = 
SW_ARGN_LEN_LF
;

1579 
”rÜ
;

1584 
SW_ARGN_LEN_LF
:

1585 
ch
) {

1586 
LF
:

1587 
¡©e
 = 
SW_ARGN
;

1591 
”rÜ
;

1596 
SW_ARGN
:

1597 
m
 = 
p
 + 
r
->
¾’
;

1598 ià(
m
 >ğ
b
->
Ï¡
) {

1599 
r
->
¾’
 -ğ(
ušt32_t
)(
b
->
Ï¡
 - 
p
);

1600 
m
 = 
b
->
Ï¡
 - 1;

1601 
p
 = 
m
;

1605 ià(*
m
 !ğ
CR
) {

1606 
”rÜ
;

1609 
p
 = 
m
;

1610 
r
->
¾’
 = 0;

1611 
¡©e
 = 
SW_ARGN_LF
;

1615 
SW_ARGN_LF
:

1616 
ch
) {

1617 
LF
:

1618 ià(
	`»dis_¬gn
(
r
è|| 
	`»dis_¬gev®
(r)) {

1619 ià(
r
->
º¬g
 == 0) {

1620 
dÚe
;

1622 
¡©e
 = 
SW_ARGN_LEN
;

1624 
”rÜ
;

1630 
”rÜ
;

1635 
SW_SENTINEL
:

1637 
	`NOT_REACHED
();

1642 
	`ASSERT
(
p
 =ğ
b
->
Ï¡
);

1643 
r
->
pos
 = 
p
;

1644 
r
->
¡©e
 = state;

1646 ià(
b
->
Ï¡
 =ğb->
’d
 && 
r
->
tok’
 !ğ
NULL
) {

1647 
r
->
pos
 =„->
tok’
;

1648 
r
->
tok’
 = 
NULL
;

1649 
r
->
»suÉ
 = 
MSG_PARSE_REPAIR
;

1651 
r
->
»suÉ
 = 
MSG_PARSE_AGAIN
;

1654 
	`log_hexdump
(
LOG_VERB
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d„eq %"
PRIu64
"„es %d "

1655 "ty³ %d s‹ %d„po %d oà%d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

1656 
r
->
¡©e
,„->
pos
 - 
b
->pos, b->
Ï¡
 - b->pos);

1659 
dÚe
:

1660 
	`ASSERT
(
r
->
ty³
 > 
MSG_UNKNOWN
 &&„->ty³ < 
MSG_SENTINEL
);

1661 
r
->
pos
 = 
p
 + 1;

1662 
	`ASSERT
(
r
->
pos
 <ğ
b
->
Ï¡
);

1663 
r
->
¡©e
 = 
SW_START
;

1664 
r
->
tok’
 = 
NULL
;

1665 
r
->
»suÉ
 = 
MSG_PARSE_OK
;

1667 
	`log_hexdump
(
LOG_VERB
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d„eq %"
PRIu64
"„es %d "

1668 "ty³ %d s‹ %d„po %d oà%d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

1669 
r
->
¡©e
,„->
pos
 - 
b
->pos, b->
Ï¡
 - b->pos);

1672 
’omem
:

1673 
r
->
»suÉ
 = 
MSG_PARSE_ERROR
;

1674 
r
->
¡©e
 = state;

1676 
	`log_hexdump
(
LOG_INFO
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "ouˆoàmemÜy oÀ·r£„eq %"
PRIu64
" "

1677 "» %dy³ %d s‹ %d", 
r
->
id
,„->
»suÉ
,„->
ty³
,„->
¡©e
);

1681 
”rÜ
:

1682 
r
->
»suÉ
 = 
MSG_PARSE_ERROR
;

1683 
r
->
¡©e
 = state;

1684 
”ºo
 = 
EINVAL
;

1686 
	`log_hexdump
(
LOG_INFO
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d bad„eq %"
PRIu64
" "

1687 "» %dy³ %d s‹ %d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

1688 
r
->
¡©e
);

1689 
	}
}

1720 
	$»dis_·r£_r¥
(
msg
 *
r
)

1722 
mbuf
 *
b
;

1723 
ušt8_t
 *
p
, *
m
;

1724 
ušt8_t
 
ch
;

1727 
SW_START
,

1728 
SW_STATUS
,

1729 
SW_ERROR
,

1730 
SW_INTEGER
,

1731 
SW_INTEGER_START
,

1732 
SW_SIMPLE
,

1733 
SW_BULK
,

1734 
SW_BULK_LF
,

1735 
SW_BULK_ARG
,

1736 
SW_BULK_ARG_LF
,

1737 
SW_MULTIBULK
,

1738 
SW_MULTIBULK_NARG_LF
,

1739 
SW_MULTIBULK_ARGN_LEN
,

1740 
SW_MULTIBULK_ARGN_LEN_LF
,

1741 
SW_MULTIBULK_ARGN
,

1742 
SW_MULTIBULK_ARGN_LF
,

1743 
SW_RUNTO_CRLF
,

1744 
SW_ALMOST_DONE
,

1745 
SW_SENTINEL


1746 } 
¡©e
;

1748 
¡©e
 = 
r
->state;

1749 
b
 = 
	`STAILQ_LAST
(&
r
->
mhdr
, 
mbuf
, 
Ãxt
);

1751 
	`ASSERT
(!
r
->
»que¡
);

1752 
	`ASSERT
(
¡©e
 >ğ
SW_START
 && s‹ < 
SW_SENTINEL
);

1753 
	`ASSERT
(
b
 !ğ
NULL
);

1754 
	`ASSERT
(
b
->
pos
 <ğb->
Ï¡
);

1757 
	`ASSERT
(
r
->
pos
 !ğ
NULL
);

1758 
	`ASSERT
(
r
->
pos
 >ğ
b
->po &&„->po <ğb->
Ï¡
);

1760 
p
 = 
r
->
pos
;… < 
b
->
Ï¡
;…++) {

1761 
ch
 = *
p
;

1763 
¡©e
) {

1764 
SW_START
:

1765 
r
->
ty³
 = 
MSG_UNKNOWN
;

1766 
ch
) {

1768 
p
 =… - 1;

1769 
r
->
ty³
 = 
MSG_RSP_REDIS_STATUS
;

1770 
¡©e
 = 
SW_STATUS
;

1774 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR
;

1775 
p
 =… - 1;

1776 
¡©e
 = 
SW_ERROR
;

1780 
r
->
ty³
 = 
MSG_RSP_REDIS_INTEGER
;

1781 
p
 =… - 1;

1782 
¡©e
 = 
SW_INTEGER
;

1786 
r
->
ty³
 = 
MSG_RSP_REDIS_BULK
;

1787 
p
 =… - 1;

1788 
¡©e
 = 
SW_BULK
;

1792 
r
->
ty³
 = 
MSG_RSP_REDIS_MULTIBULK
;

1793 
p
 =… - 1;

1794 
¡©e
 = 
SW_MULTIBULK
;

1798 
”rÜ
;

1803 
SW_STATUS
:

1805 
¡©e
 = 
SW_RUNTO_CRLF
;

1808 
SW_ERROR
:

1809 ià(
r
->
tok’
 =ğ
NULL
) {

1810 ià(
ch
 != '-') {

1811 
”rÜ
;

1814 
r
->
tok’
 = 
p
;

1816 ià(
ch
 =ğ' ' || ch =ğ
CR
) {

1817 
m
 = 
r
->
tok’
;

1818 
r
->
tok’
 = 
NULL
;

1819 
p
 - 
m
) {

1828 ià(
	`¡r4cmp
(
m
, '-', 'E', 'R', 'R')) {

1829 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_ERR
;

1834 ià(
	`¡r4cmp
(
m
, '-', 'O', 'O', 'M')) {

1835 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_OOM
;

1843 ià(
	`¡r5cmp
(
m
, '-', 'B', 'U', 'S', 'Y')) {

1844 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_BUSY
;

1852 ià(
	`¡r7cmp
(
m
, '-', 'N', 'O', 'A', 'U', 'T', 'H')) {

1853 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_NOAUTH
;

1861 ià(
	`¡r8cmp
(
m
, '-', 'L', 'O', 'A', 'D', 'I', 'N', 'G')) {

1862 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_LOADING
;

1867 ià(
	`¡r8cmp
(
m
, '-', 'B', 'U', 'S', 'Y', 'K', 'E', 'Y')) {

1868 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_BUSYKEY
;

1873 ià(
	`¡r8cmp
(
m
, '-', 'M', 'I', 'S', 'C', 'O', 'N', 'F')) {

1874 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_MISCONF
;

1882 ià(
	`¡r9cmp
(
m
, '-', 'N', 'O', 'S', 'C', 'R', 'I', 'P', 'T')) {

1883 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_NOSCRIPT
;

1888 ià(
	`¡r9cmp
(
m
, '-', 'R', 'E', 'A', 'D', 'O', 'N', 'L', 'Y')) {

1889 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_READONLY
;

1897 ià(
	`¡r10cmp
(
m
, '-', 'W', 'R', 'O', 'N', 'G', 'T', 'Y', 'P', 'E')) {

1898 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_WRONGTYPE
;

1903 ià(
	`¡r10cmp
(
m
, '-', 'E', 'X', 'E', 'C', 'A', 'B', 'O', 'R', 'T')) {

1904 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_EXECABORT
;

1912 ià(
	`¡r11cmp
(
m
, '-', 'M', 'A', 'S', 'T', 'E', 'R', 'D', 'O', 'W', 'N')) {

1913 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_MASTERDOWN
;

1918 ià(
	`¡r11cmp
(
m
, '-', 'N', 'O', 'R', 'E', 'P', 'L', 'I', 'C', 'A', 'S')) {

1919 
r
->
ty³
 = 
MSG_RSP_REDIS_ERROR_NOREPLICAS
;

1925 
¡©e
 = 
SW_RUNTO_CRLF
;

1930 
SW_INTEGER
:

1932 
¡©e
 = 
SW_INTEGER_START
;

1933 
r
->
š‹g”
 = 0;

1936 
SW_SIMPLE
:

1937 ià(
ch
 =ğ
CR
) {

1938 
¡©e
 = 
SW_MULTIBULK_ARGN_LF
;

1939 
r
->
º¬g
--;

1943 
SW_INTEGER_START
:

1944 ià(
ch
 =ğ
CR
) {

1945 
¡©e
 = 
SW_ALMOST_DONE
;

1946 } ià(
ch
 == '-') {

1948 } ià(
	`isdig™
(
ch
)) {

1949 
r
->
š‹g”
 =„->š‹g” * 10 + (
ušt32_t
)(
ch
 - '0');

1951 
”rÜ
;

1955 
SW_RUNTO_CRLF
:

1956 
ch
) {

1957 
CR
:

1958 
¡©e
 = 
SW_ALMOST_DONE
;

1967 
SW_ALMOST_DONE
:

1968 
ch
) {

1969 
LF
:

1971 
dÚe
;

1974 
”rÜ
;

1979 
SW_BULK
:

1980 ià(
r
->
tok’
 =ğ
NULL
) {

1981 ià(
ch
 != '$') {

1982 
”rÜ
;

1985 
r
->
tok’
 = 
p
;

1986 
r
->
¾’
 = 0;

1987 } ià(
ch
 == '-') {

1989 
¡©e
 = 
SW_RUNTO_CRLF
;

1990 } ià(
	`isdig™
(
ch
)) {

1991 
r
->
¾’
 =„->¾’ * 10 + (
ušt32_t
)(
ch
 - '0');

1992 } ià(
ch
 =ğ
CR
) {

1993 ià((
p
 - 
r
->
tok’
) <= 1) {

1994 
”rÜ
;

1996 
r
->
tok’
 = 
NULL
;

1997 
¡©e
 = 
SW_BULK_LF
;

1999 
”rÜ
;

2004 
SW_BULK_LF
:

2005 
ch
) {

2006 
LF
:

2007 
¡©e
 = 
SW_BULK_ARG
;

2011 
”rÜ
;

2016 
SW_BULK_ARG
:

2017 
m
 = 
p
 + 
r
->
¾’
;

2018 ià(
m
 >ğ
b
->
Ï¡
) {

2019 
r
->
¾’
 -ğ(
ušt32_t
)(
b
->
Ï¡
 - 
p
);

2020 
m
 = 
b
->
Ï¡
 - 1;

2021 
p
 = 
m
;

2025 ià(*
m
 !ğ
CR
) {

2026 
”rÜ
;

2029 
p
 = 
m
;

2030 
r
->
¾’
 = 0;

2032 
¡©e
 = 
SW_BULK_ARG_LF
;

2036 
SW_BULK_ARG_LF
:

2037 
ch
) {

2038 
LF
:

2039 
dÚe
;

2042 
”rÜ
;

2047 
SW_MULTIBULK
:

2048 ià(
r
->
tok’
 =ğ
NULL
) {

2049 ià(
ch
 != '*') {

2050 
”rÜ
;

2052 
r
->
tok’
 = 
p
;

2054 
r
->
Çrg_¡¬t
 = 
p
;

2055 
r
->
º¬g
 = 0;

2056 } ià(
ch
 == '-') {

2057 
¡©e
 = 
SW_RUNTO_CRLF
;

2058 } ià(
	`isdig™
(
ch
)) {

2059 
r
->
º¬g
 =„->º¬g * 10 + (
ušt32_t
)(
ch
 - '0');

2060 } ià(
ch
 =ğ
CR
) {

2061 ià((
p
 - 
r
->
tok’
) <= 1) {

2062 
”rÜ
;

2065 
r
->
Çrg
 =„->
º¬g
;

2066 
r
->
Çrg_’d
 = 
p
;

2067 
r
->
tok’
 = 
NULL
;

2068 
¡©e
 = 
SW_MULTIBULK_NARG_LF
;

2070 
”rÜ
;

2075 
SW_MULTIBULK_NARG_LF
:

2076 
ch
) {

2077 
LF
:

2078 ià(
r
->
º¬g
 == 0) {

2080 
dÚe
;

2083 
¡©e
 = 
SW_MULTIBULK_ARGN_LEN
;

2087 
”rÜ
;

2092 
SW_MULTIBULK_ARGN_LEN
:

2093 ià(
r
->
tok’
 =ğ
NULL
) {

2118 ià(
ch
 == '*') {

2119 
p
 =… - 1;

2120 
¡©e
 = 
SW_MULTIBULK
;

2124 ià(
ch
 == ':' || ch == '+' || ch == '-') {

2127 
¡©e
 = 
SW_SIMPLE
;

2131 ià(
ch
 != '$') {

2132 
”rÜ
;

2135 
r
->
tok’
 = 
p
;

2136 
r
->
¾’
 = 0;

2137 } ià(
	`isdig™
(
ch
)) {

2138 
r
->
¾’
 =„->¾’ * 10 + (
ušt32_t
)(
ch
 - '0');

2139 } ià(
ch
 == '-') {

2141 } ià(
ch
 =ğ
CR
) {

2142 ià((
p
 - 
r
->
tok’
è<ğ1 ||„->
º¬g
 == 0) {

2143 
”rÜ
;

2146 ià((
r
->
¾’
 =ğ1 && (
p
 -„->
tok’
) == 3)) {

2147 
r
->
¾’
 = 0;

2148 
¡©e
 = 
SW_MULTIBULK_ARGN_LF
;

2150 
¡©e
 = 
SW_MULTIBULK_ARGN_LEN_LF
;

2152 
r
->
º¬g
--;

2153 
r
->
tok’
 = 
NULL
;

2155 
”rÜ
;

2160 
SW_MULTIBULK_ARGN_LEN_LF
:

2161 
ch
) {

2162 
LF
:

2163 
¡©e
 = 
SW_MULTIBULK_ARGN
;

2167 
”rÜ
;

2172 
SW_MULTIBULK_ARGN
:

2173 
m
 = 
p
 + 
r
->
¾’
;

2174 ià(
m
 >ğ
b
->
Ï¡
) {

2175 
r
->
¾’
 -ğ(
ušt32_t
)(
b
->
Ï¡
 - 
p
);

2176 
m
 = 
b
->
Ï¡
 - 1;

2177 
p
 = 
m
;

2181 ià(*
m
 !ğ
CR
) {

2182 
”rÜ
;

2185 
p
 +ğ
r
->
¾’
;

2186 
r
->
¾’
 = 0;

2188 
¡©e
 = 
SW_MULTIBULK_ARGN_LF
;

2192 
SW_MULTIBULK_ARGN_LF
:

2193 
ch
) {

2194 
LF
:

2195 ià(
r
->
º¬g
 == 0) {

2196 
dÚe
;

2199 
¡©e
 = 
SW_MULTIBULK_ARGN_LEN
;

2203 
”rÜ
;

2208 
SW_SENTINEL
:

2210 
	`NOT_REACHED
();

2215 
	`ASSERT
(
p
 =ğ
b
->
Ï¡
);

2216 
r
->
pos
 = 
p
;

2217 
r
->
¡©e
 = state;

2219 ià(
b
->
Ï¡
 =ğb->
’d
 && 
r
->
tok’
 !ğ
NULL
) {

2220 
r
->
pos
 =„->
tok’
;

2221 
r
->
tok’
 = 
NULL
;

2222 
r
->
»suÉ
 = 
MSG_PARSE_REPAIR
;

2224 
r
->
»suÉ
 = 
MSG_PARSE_AGAIN
;

2227 
	`log_hexdump
(
LOG_VERB
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d„¥ %"
PRIu64
"„es %d "

2228 "ty³ %d s‹ %d„po %d oà%d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

2229 
r
->
¡©e
,„->
pos
 - 
b
->pos, b->
Ï¡
 - b->pos);

2232 
dÚe
:

2233 
	`ASSERT
(
r
->
ty³
 > 
MSG_UNKNOWN
 &&„->ty³ < 
MSG_SENTINEL
);

2234 
r
->
pos
 = 
p
 + 1;

2235 
	`ASSERT
(
r
->
pos
 <ğ
b
->
Ï¡
);

2236 
r
->
¡©e
 = 
SW_START
;

2237 
r
->
tok’
 = 
NULL
;

2238 
r
->
»suÉ
 = 
MSG_PARSE_OK
;

2240 
	`log_hexdump
(
LOG_VERB
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d„¥ %"
PRIu64
"„es %d "

2241 "ty³ %d s‹ %d„po %d oà%d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

2242 
r
->
¡©e
,„->
pos
 - 
b
->pos, b->
Ï¡
 - b->pos);

2245 
”rÜ
:

2246 
r
->
»suÉ
 = 
MSG_PARSE_ERROR
;

2247 
r
->
¡©e
 = state;

2248 
”ºo
 = 
EINVAL
;

2250 
	`log_hexdump
(
LOG_INFO
, 
b
->
pos
, 
	`mbuf_Ëngth
(b), "·r£d bad„¥ %"
PRIu64
" "

2251 "» %dy³ %d s‹ %d", 
r
->
id
,„->
»suÉ
,„->
ty³
,

2252 
r
->
¡©e
);

2253 
	}
}

2268 
boŞ


2269 
	$»dis_çu»
(
msg
 *
r
)

2271 
	`ASSERT
(!
r
->
»que¡
);

2273 
r
->
ty³
) {

2274 
MSG_RSP_REDIS_ERROR_OOM
:

2275 
MSG_RSP_REDIS_ERROR_BUSY
:

2276 
MSG_RSP_REDIS_ERROR_LOADING
:

2277  
Œue
;

2283  
çl£
;

2284 
	}
}

2292 
r¡©us_t


2293 
	$»dis_cİy_bulk
(
msg
 *
d¡
, msg *
¤c
)

2295 
mbuf
 *mbuf, *
nbuf
;

2296 
ušt8_t
 *
p
;

2297 
ušt32_t
 
Ën
 = 0;

2298 
ušt32_t
 
by‹s
 = 0;

2299 
r¡©us_t
 
¡©us
;

2301 
mbuf
 = 
	`STAILQ_FIRST
(&
¤c
->
mhdr
);

2302 
mbuf
 && 
	`mbuf_em±y
(mbuf);

2303 
mbuf
 = 
	`STAILQ_FIRST
(&
¤c
->
mhdr
)) {

2305 
	`mbuf_»move
(&
¤c
->
mhdr
, 
mbuf
);

2306 
	`mbuf_put
(
mbuf
);

2309 
mbuf
 = 
	`STAILQ_FIRST
(&
¤c
->
mhdr
);

2310 ià(
mbuf
 =ğ
NULL
) {

2311  
NC_ERROR
;

2314 
p
 = 
mbuf
->
pos
;

2315 
	`ASSERT
(*
p
 == '$');

2316 
p
++;

2318 ià(
p
[0] == '-' &&…[1] == '1') {

2319 
Ën
 = 1 + 2 + 
CRLF_LEN
;

2320 
p
 = 
mbuf
->
pos
 + 
Ën
;

2322 
Ën
 = 0;

2323 ; 
p
 < 
mbuf
->
Ï¡
 && 
	`isdig™
(*p);…++) {

2324 
Ën
 =†’ * 10 + (
ušt32_t
)(*
p
 - '0');

2326 
Ën
 +ğ
CRLF_LEN
 * 2;

2327 
Ën
 +ğ(
p
 - 
mbuf
->
pos
);

2329 
by‹s
 = 
Ën
;

2332 ; 
mbuf
;) {

2333 ià(
	`mbuf_Ëngth
(
mbuf
è<ğ
Ën
) {

2334 
nbuf
 = 
	`STAILQ_NEXT
(
mbuf
, 
Ãxt
);

2335 
	`mbuf_»move
(&
¤c
->
mhdr
, 
mbuf
);

2336 ià(
d¡
 !ğ
NULL
) {

2337 
	`mbuf_š£¹
(&
d¡
->
mhdr
, 
mbuf
);

2339 
Ën
 -ğ
	`mbuf_Ëngth
(
mbuf
);

2340 
mbuf
 = 
nbuf
;

2342 ià(
d¡
 !ğ
NULL
) {

2343 
¡©us
 = 
	`msg_­³nd
(
d¡
, 
mbuf
->
pos
, 
Ën
);

2344 ià(
¡©us
 !ğ
NC_OK
) {

2345  
¡©us
;

2348 
mbuf
->
pos
 +ğ
Ën
;

2353 ià(
d¡
 !ğ
NULL
) {

2354 
d¡
->
mËn
 +ğ
by‹s
;

2356 
¤c
->
mËn
 -ğ
by‹s
;

2357 
	`log_debug
(
LOG_VVERB
, "»dis_cİy_bulk cİy by‹s: %d", 
by‹s
);

2358  
NC_OK
;

2359 
	}
}

2367 
	$»dis_´e_cßËsû
(
msg
 *
r
)

2369 
msg
 *
´
 = 
r
->
³”
;

2370 
mbuf
 *mbuf;

2372 
	`ASSERT
(!
r
->
»que¡
);

2373 
	`ASSERT
(
´
->
»que¡
);

2375 ià(
´
->
äag_id
 == 0) {

2379 
´
->
äag_owÃr
->
näag_dÚe
++;

2381 
r
->
ty³
) {

2382 
MSG_RSP_REDIS_INTEGER
:

2384 
	`ASSERT
(
´
->
ty³
 =ğ
MSG_REQ_REDIS_DEL
);

2386 
mbuf
 = 
	`STAILQ_FIRST
(&
r
->
mhdr
);

2393 
	`ASSERT
(
mbuf
 =ğ
	`STAILQ_LAST
(&
r
->
mhdr
, mbuf, 
Ãxt
));

2394 
	`ASSERT
(
r
->
mËn
 =ğ
	`mbuf_Ëngth
(
mbuf
));

2396 
r
->
mËn
 -ğ
	`mbuf_Ëngth
(
mbuf
);

2397 
	`mbuf_»wšd
(
mbuf
);

2400 
´
->
äag_owÃr
->
š‹g”
 +ğ
r
->integer;

2403 
MSG_RSP_REDIS_MULTIBULK
:

2405 
	`ASSERT
(
´
->
ty³
 =ğ
MSG_REQ_REDIS_MGET
);

2407 
mbuf
 = 
	`STAILQ_FIRST
(&
r
->
mhdr
);

2414 
	`ASSERT
(
r
->
Çrg_¡¬t
 =ğ
mbuf
->
pos
);

2415 
	`ASSERT
(
r
->
Çrg_¡¬t
 <„->
Çrg_’d
);

2417 
r
->
Çrg_’d
 +ğ
CRLF_LEN
;

2418 
r
->
mËn
 -ğ(
ušt32_t
)Ô->
Çrg_’d
 -„->
Çrg_¡¬t
);

2419 
mbuf
->
pos
 = 
r
->
Çrg_’d
;

2423 
MSG_RSP_REDIS_STATUS
:

2424 ià(
´
->
ty³
 =ğ
MSG_REQ_REDIS_MSET
) {

2425 
mbuf
 = 
	`STAILQ_FIRST
(&
r
->
mhdr
);

2426 
r
->
mËn
 -ğ
	`mbuf_Ëngth
(
mbuf
);

2427 
	`mbuf_»wšd
(
mbuf
);

2437 
mbuf
 = 
	`STAILQ_FIRST
(&
r
->
mhdr
);

2438 
	`log_hexdump
(
LOG_ERR
, 
mbuf
->
pos
, 
	`mbuf_Ëngth
(mbuf), "rsp fragment "

2439 "w™h unknowÀty³ %d", 
r
->
ty³
);

2440 
´
->
”rÜ
 = 1;

2441 
´
->
”r
 = 
EINVAL
;

2444 
	}
}

2446 
r¡©us_t


2447 
	$»dis_­³nd_key
(
msg
 *
r
, 
ušt8_t
 *
key
, 
ušt32_t
 
keyËn
)

2449 
ušt32_t
 
Ën
;

2450 
mbuf
 *mbuf;

2451 
ušt8_t
 
´štbuf
[32];

2452 
keypos
 *
kpos
;

2455 
Ën
 = (
ušt32_t
)
	`nc_¢´štf
(
´štbuf
, Õrštbuf), "$%d\r\n", 
keyËn
);

2456 
mbuf
 = 
	`msg_’su»_mbuf
(
r
, 
Ën
);

2457 ià(
mbuf
 =ğ
NULL
) {

2458  
NC_ENOMEM
;

2460 
	`mbuf_cİy
(
mbuf
, 
´štbuf
, 
Ën
);

2461 
r
->
mËn
 +ğ
Ën
;

2464 
mbuf
 = 
	`msg_’su»_mbuf
(
r
, 
keyËn
);

2465 ià(
mbuf
 =ğ
NULL
) {

2466  
NC_ENOMEM
;

2469 
kpos
 = 
	`¬¿y_push
(
r
->
keys
);

2470 ià(
kpos
 =ğ
NULL
) {

2471  
NC_ENOMEM
;

2474 
kpos
->
¡¬t
 = 
mbuf
->
Ï¡
;

2475 
kpos
->
’d
 = 
mbuf
->
Ï¡
 + 
keyËn
;

2476 
	`mbuf_cİy
(
mbuf
, 
key
, 
keyËn
);

2477 
r
->
mËn
 +ğ
keyËn
;

2480 
mbuf
 = 
	`msg_’su»_mbuf
(
r
, 
CRLF_LEN
);

2481 ià(
mbuf
 =ğ
NULL
) {

2482  
NC_ENOMEM
;

2484 
	`mbuf_cİy
(
mbuf
, (
ušt8_t
 *)
CRLF
, 
CRLF_LEN
);

2485 
r
->
mËn
 +ğ(
ušt32_t
)
CRLF_LEN
;

2487  
NC_OK
;

2488 
	}
}

2542 
r¡©us_t


2543 
	$»dis_äagm’t_¬gx
(
msg
 *
r
, 
ušt32_t
 
ncÚtšuum
, 
msg_tqh
 *
äag_msgq
,

2544 
ušt32_t
 
key_¡•
)

2546 
mbuf
 *mbuf;

2547 
msg
 **
sub_msgs
;

2548 
ušt32_t
 
i
;

2549 
r¡©us_t
 
¡©us
;

2551 
	`ASSERT
(
	`¬¿y_n
(
r
->
keys
è=ğÔ->
Çrg
 - 1è/ 
key_¡•
);

2555 
cÚn
 *cÚÀğ
r
->
owÃr
;

2556 
£rv”_poŞ
 *
poŞ
 = 
cÚn
->
owÃr
;

2557 
ncÚtšuum
 = 
	`¬¿y_n
(&
poŞ
->
sh¬ds
);

2558 ià(
ncÚtšuum
 == 0) {

2559  
NC_ENOMEM
;

2562 
sub_msgs
 = 
	`nc_z®loc
(
ncÚtšuum
 * (*sub_msgs));

2563 ià(
sub_msgs
 =ğ
NULL
) {

2564  
NC_ENOMEM
;

2567 
	`ASSERT
(
r
->
äag_£q
 =ğ
NULL
);

2568 
r
->
äag_£q
 = 
	`nc_®loc
(
	`¬¿y_n
Ô->
keys
) * (*r->frag_seq));

2569 ià(
r
->
äag_£q
 =ğ
NULL
) {

2570 
	`nc_ä“
(
sub_msgs
);

2571  
NC_ENOMEM
;

2574 
mbuf
 = 
	`STAILQ_FIRST
(&
r
->
mhdr
);

2575 
mbuf
->
pos
 = mbuf->
¡¬t
;

2583 
i
 = 0; i < 3; i++) {

2584 ; *(
mbuf
->
pos
) != '\n';) {

2585 
mbuf
->
pos
++;

2587 
mbuf
->
pos
++;

2590 
r
->
äag_id
 = 
	`msg_g’_äag_id
();

2591 
r
->
näag
 = 0;

2592 
r
->
äag_owÃr
 =„;

2594 
i
 = 0; i < 
	`¬¿y_n
(
r
->
keys
); i++) {

2595 
msg
 *
sub_msg
;

2596 
keypos
 *
kpos
 = 
	`¬¿y_g‘
(
r
->
keys
, 
i
);

2597 
ušt32_t
 
idx
 = 
	`msg_back’d_idx
(
r
, 
kpos
->
¡¬t
, kpos->
’d
 - kpos->start);

2599 ià(
sub_msgs
[
idx
] =ğ
NULL
) {

2600 
sub_msgs
[
idx
] = 
	`msg_g‘
(
r
->
owÃr
,„->
»que¡
,„->
»dis
);

2601 ià(
sub_msgs
[
idx
] =ğ
NULL
) {

2602 
	`nc_ä“
(
sub_msgs
);

2603  
NC_ENOMEM
;

2606 
r
->
äag_£q
[
i
] = 
sub_msg
 = 
sub_msgs
[
idx
];

2608 
sub_msg
->
Çrg
++;

2609 
¡©us
 = 
	`»dis_­³nd_key
(
sub_msg
, 
kpos
->
¡¬t
, kpos->
’d
 - kpos->start);

2610 ià(
¡©us
 !ğ
NC_OK
) {

2611 
	`nc_ä“
(
sub_msgs
);

2612  
¡©us
;

2615 ià(
key_¡•
 == 1) {

2618 
¡©us
 = 
	`»dis_cİy_bulk
(
NULL
, 
r
);

2619 ià(
¡©us
 !ğ
NC_OK
) {

2620 
	`nc_ä“
(
sub_msgs
);

2621  
¡©us
;

2624 
¡©us
 = 
	`»dis_cİy_bulk
(
sub_msg
, 
r
);

2625 ià(
¡©us
 !ğ
NC_OK
) {

2626 
	`nc_ä“
(
sub_msgs
);

2627  
¡©us
;

2630 
sub_msg
->
Çrg
++;

2634 
i
 = 0; i < 
ncÚtšuum
; i++) {

2635 
msg
 *
sub_msg
 = 
sub_msgs
[
i
];

2636 ià(
sub_msg
 =ğ
NULL
) {

2640 ià(
r
->
ty³
 =ğ
MSG_REQ_REDIS_MGET
) {

2641 
¡©us
 = 
	`msg_´•’d_fÜm©
(
sub_msg
, "*%d\r\n$4\r\nmget\r\n",

2642 
sub_msg
->
Çrg
 + 1);

2643 } ià(
r
->
ty³
 =ğ
MSG_REQ_REDIS_DEL
) {

2644 
¡©us
 = 
	`msg_´•’d_fÜm©
(
sub_msg
, "*%d\r\n$3\r\ndel\r\n",

2645 
sub_msg
->
Çrg
 + 1);

2646 } ià(
r
->
ty³
 =ğ
MSG_REQ_REDIS_MSET
) {

2647 
¡©us
 = 
	`msg_´•’d_fÜm©
(
sub_msg
, "*%d\r\n$4\r\nmset\r\n",

2648 
sub_msg
->
Çrg
 + 1);

2650 
	`NOT_REACHED
();

2652 ià(
¡©us
 !ğ
NC_OK
) {

2653 
	`nc_ä“
(
sub_msgs
);

2654  
¡©us
;

2657 
sub_msg
->
ty³
 = 
r
->type;

2658 
sub_msg
->
äag_id
 = 
r
->frag_id;

2659 
sub_msg
->
äag_owÃr
 = 
r
->frag_owner;

2661 
	`TAILQ_INSERT_TAIL
(
äag_msgq
, 
sub_msg
, 
m_tqe
);

2662 
r
->
näag
++;

2665 
	`nc_ä“
(
sub_msgs
);

2666  
NC_OK
;

2667 
	}
}

2669 
r¡©us_t


2670 
	$»dis_äagm’t
(
msg
 *
r
, 
ušt32_t
 
ncÚtšuum
, 
msg_tqh
 *
äag_msgq
)

2672 ià(1 =ğ
	`¬¿y_n
(
r
->
keys
)){

2673  
NC_OK
;

2676 
r
->
ty³
) {

2677 
MSG_REQ_REDIS_MGET
:

2678 
MSG_REQ_REDIS_DEL
:

2679  
	`»dis_äagm’t_¬gx
(
r
, 
ncÚtšuum
, 
äag_msgq
, 1);

2681 
MSG_REQ_REDIS_MSET
:

2682  
	`»dis_äagm’t_¬gx
(
r
, 
ncÚtšuum
, 
äag_msgq
, 2);

2685  
NC_OK
;

2687 
	}
}

2689 
r¡©us_t


2690 
	$»dis_»¶y
(
msg
 *
r
)

2692 
cÚn
 *
c_cÚn
;

2693 
msg
 *
»¥Ú£
 = 
r
->
³”
;

2695 
	`ASSERT
(
»¥Ú£
 !ğ
NULL
 &&„e¥Ú£->
owÃr
 != NULL);

2697 
c_cÚn
 = 
»¥Ú£
->
owÃr
;

2698 ià(
r
->
ty³
 =ğ
MSG_REQ_REDIS_AUTH
) {

2699  
	`»dis_hªdË_auth_»q
(
r
, 
»¥Ú£
);

2702 ià(!
	`cÚn_auth’tiÿ‹d
(
c_cÚn
)) {

2703  
	`msg_­³nd
(
»¥Ú£
, 
r¥_auth_»quœed
.
d©a
,„¥_auth_»quœed.
Ën
);

2706 
r
->
ty³
) {

2707 
MSG_REQ_REDIS_PING
:

2708  
	`msg_­³nd
(
»¥Ú£
, 
r¥_pÚg
.
d©a
,„¥_pÚg.
Ën
);

2711 
	`NOT_REACHED
();

2712  
NC_ERROR
;

2714 
	}
}

2717 
	$»dis_po¡_cßËsû_m£t
(
msg
 *
»que¡
)

2719 
r¡©us_t
 
¡©us
;

2720 
msg
 *
»¥Ú£
 = 
»que¡
->
³”
;

2722 
¡©us
 = 
	`msg_­³nd
(
»¥Ú£
, 
r¥_ok
.
d©a
,„¥_ok.
Ën
);

2723 ià(
¡©us
 !ğ
NC_OK
) {

2724 
»¥Ú£
->
”rÜ
 = 1;

2725 
»¥Ú£
->
”r
 = 
”ºo
;

2727 
	}
}

2730 
	$»dis_po¡_cßËsû_d–
(
msg
 *
»que¡
)

2732 
msg
 *
»¥Ú£
 = 
»que¡
->
³”
;

2733 
r¡©us_t
 
¡©us
;

2735 
¡©us
 = 
	`msg_´•’d_fÜm©
(
»¥Ú£
, ":%d\r\n", 
»que¡
->
š‹g”
);

2736 ià(
¡©us
 !ğ
NC_OK
) {

2737 
»¥Ú£
->
”rÜ
 = 1;

2738 
»¥Ú£
->
”r
 = 
”ºo
;

2740 
	}
}

2743 
	$»dis_po¡_cßËsû_mg‘
(
msg
 *
»que¡
)

2745 
msg
 *
»¥Ú£
 = 
»que¡
->
³”
;

2746 
msg
 *
sub_msg
;

2747 
r¡©us_t
 
¡©us
;

2748 
ušt32_t
 
i
;

2750 
¡©us
 = 
	`msg_´•’d_fÜm©
(
»¥Ú£
, "*%d\r\n", 
»que¡
->
Çrg
 - 1);

2751 ià(
¡©us
 !ğ
NC_OK
) {

2756 
»¥Ú£
->
owÃr
->
”r
 = 1;

2760 
i
 = 0; i < 
	`¬¿y_n
(
»que¡
->
keys
); i++) {

2761 
sub_msg
 = 
»que¡
->
äag_£q
[
i
]->
³”
;

2762 ià(
sub_msg
 =ğ
NULL
) {

2763 
»¥Ú£
->
owÃr
->
”r
 = 1;

2766 
¡©us
 = 
	`»dis_cİy_bulk
(
»¥Ú£
, 
sub_msg
);

2767 ià(
¡©us
 !ğ
NC_OK
) {

2768 
»¥Ú£
->
owÃr
->
”r
 = 1;

2772 
	}
}

2781 
	$»dis_po¡_cßËsû
(
msg
 *
r
)

2783 
msg
 *
´
 = 
r
->
³”
;

2785 
	`ASSERT
(!
´
->
»que¡
);

2786 
	`ASSERT
(
r
->
»que¡
 && (r->
äag_owÃr
 ==„));

2787 ià(
r
->
”rÜ
 ||„->
ã¼Ü
) {

2792 
r
->
ty³
) {

2793 
MSG_REQ_REDIS_MGET
:

2794  
	`»dis_po¡_cßËsû_mg‘
(
r
);

2796 
MSG_REQ_REDIS_DEL
:

2797  
	`»dis_po¡_cßËsû_d–
(
r
);

2799 
MSG_REQ_REDIS_MSET
:

2800  
	`»dis_po¡_cßËsû_m£t
(
r
);

2803 
	`NOT_REACHED
();

2805 
	}
}

2807 
r¡©us_t


2808 
	$»dis_hªdË_auth_»q
(
msg
 *
»q
, msg *
r¥
)

2810 
cÚn
 *cÚÀğ(cÚÀ*)
r¥
->
owÃr
;

2811 
£rv”_poŞ
 *
poŞ
;

2812 
keypos
 *
kpos
;

2813 
ušt8_t
 *
key
;

2814 
ušt32_t
 
keyËn
;

2815 
boŞ
 
v®id
;

2817 
	`ASSERT
(
cÚn
->
ş›Á
 && !cÚn->
´oxy
);

2819 
poŞ
 = (
£rv”_poŞ
 *)
cÚn
->
owÃr
;

2821 ià(!
poŞ
->
»quœe_auth
) {

2826  
	`msg_­³nd
(
r¥
, 
r¥_no_·sswÜd
.
d©a
,„¥_no_·sswÜd.
Ën
);

2829 
kpos
 = 
	`¬¿y_g‘
(
»q
->
keys
, 0);

2830 
key
 = 
kpos
->
¡¬t
;

2831 
keyËn
 = (
ušt32_t
)(
kpos
->
’d
 - kpos->
¡¬t
);

2832 
v®id
 = (
keyËn
 =ğ
poŞ
->
»dis_auth
.
Ën
) &&

2833 (
	`memcmp
(
poŞ
->
»dis_auth
.
d©a
, 
key
, 
keyËn
è=ğ0è? 
Œue
 : 
çl£
;

2834 ià(
v®id
) {

2835 
cÚn
->
auth’tiÿ‹d
 = 1;

2836  
	`msg_­³nd
(
r¥
, 
r¥_ok
.
d©a
,„¥_ok.
Ën
);

2846 
cÚn
->
auth’tiÿ‹d
 = 0;

2847  
	`msg_­³nd
(
r¥
, 
r¥_šv®id_·sswÜd
.
d©a
,„¥_šv®id_·sswÜd.
Ën
);

2848 
	}
}

2850 
r¡©us_t


2851 
	$»dis_add_auth
(
cÚ‹xt
 *
ùx
, 
cÚn
 *
c_cÚn
, cÚÀ*
s_cÚn
)

2853 
r¡©us_t
 
¡©us
;

2854 
msg
 *msg;

2855 
£rv”_poŞ
 *
poŞ
;

2857 
	`ASSERT
(!
s_cÚn
->
ş›Á
 && !s_cÚn->
´oxy
);

2858 
	`ASSERT
(!
	`cÚn_auth’tiÿ‹d
(
s_cÚn
));

2860 
poŞ
 = 
c_cÚn
->
owÃr
;

2862 
msg
 = 
	`msg_g‘
(
c_cÚn
, 
Œue
, c_cÚn->
»dis
);

2863 ià(
msg
 =ğ
NULL
) {

2864 
c_cÚn
->
”r
 = 
”ºo
;

2865  
NC_ENOMEM
;

2868 
¡©us
 = 
	`msg_´•’d_fÜm©
(
msg
, "*2\r\n$4\r\nAUTH\r\n$%d\r\n%s\r\n",

2869 
poŞ
->
»dis_auth
.
Ën
,…oŞ->»dis_auth.
d©a
);

2870 ià(
¡©us
 !ğ
NC_OK
) {

2871 
	`msg_put
(
msg
);

2872  
¡©us
;

2875 
msg
->
sw®low
 = 1;

2876 
s_cÚn
->
	`’queue_šq
(
ùx
, s_cÚn, 
msg
);

2877 
s_cÚn
->
auth’tiÿ‹d
 = 1;

2879  
NC_OK
;

2880 
	}
}

2883 
	$»dis_po¡_cÚÃù
(
cÚ‹xt
 *
ùx
, 
cÚn
 *cÚn, 
£rv”
 *server)

2885 
r¡©us_t
 
¡©us
;

2886 
£rv”_poŞ
 *
poŞ
 = 
£rv”
->
owÃr
;

2887 
msg
 *msg;

2888 
dig™s
;

2890 
	`ASSERT
(!
cÚn
->
ş›Á
 && cÚn->
cÚÃùed
);

2891 
	`ASSERT
(
cÚn
->
»dis
);

2899 ià(
poŞ
->
»dis_db
 <= 0) {

2908 
msg
 = 
	`msg_g‘
(
cÚn
, 
Œue
, cÚn->
»dis
);

2909 ià(
msg
 =ğ
NULL
) {

2913 
dig™s
 = (
poŞ
->
»dis_db
 >ğ10è? ()
	`log10
(pool->redis_db) + 1 : 1;

2914 
¡©us
 = 
	`msg_´•’d_fÜm©
(
msg
, "*2\r\n$6\r\nSELECT\r\n$%d\r\n%d\r\n", 
dig™s
, 
poŞ
->
»dis_db
);

2915 ià(
¡©us
 !ğ
NC_OK
) {

2916 
	`msg_put
(
msg
);

2919 
msg
->
ty³
 = 
MSG_REQ_REDIS_SELECT
;

2920 
msg
->
»suÉ
 = 
MSG_PARSE_OK
;

2921 
msg
->
sw®low
 = 1;

2922 
msg
->
owÃr
 = 
NULL
;

2925 
	`»q_£rv”_’queue_imsgq_h—d
(
ùx
, 
cÚn
, 
msg
);

2926 
	`msg_£nd
(
ùx
, 
cÚn
);

2928 
	`log_debug
(
LOG_NOTICE
, "£Á 'SELECT %d'Ø% | %s", 
poŞ
->
»dis_db
,

2929 
poŞ
->
Çme
.
d©a
, 
£rv”
->name.data);

2930 
	}
}

2933 
	$»dis_sw®low_msg
(
cÚn
 *cÚn, 
msg
 *
pmsg
, msg *msg)

2935 ià(
pmsg
 !ğ
NULL
 &&…msg->
ty³
 =ğ
MSG_REQ_REDIS_SELECT
 &&

2936 
msg
 !ğ
NULL
 && 
	`»dis_”rÜ
(msg)) {

2937 
£rv”
* 
cÚn_£rv”
;

2938 
£rv”_poŞ
* 
cÚn_poŞ
;

2939 
mbuf
* 
r¥_bufãr
;

2940 
ušt8_t
 
mes§ge
[128];

2941 
size_t
 
cİy_Ën
;

2947 
cÚn_£rv”
 = (
£rv”
*)
cÚn
->
owÃr
;

2948 
cÚn_poŞ
 = 
cÚn_£rv”
->
owÃr
;

2949 
r¥_bufãr
 = 
	`STAILQ_LAST
(&
msg
->
mhdr
, 
mbuf
, 
Ãxt
);

2950 
cİy_Ën
 = 
	`MIN
(
	`mbuf_Ëngth
(
r¥_bufãr
è- 3, (
mes§ge
) - 1);

2952 
	`nc_memıy
(
mes§ge
, &
r¥_bufãr
->
¡¬t
[1], 
cİy_Ën
);

2953 
mes§ge
[
cİy_Ën
] = 0;

2955 
	`log_w¬n
("SELECT %d failed on %s | %s: %s",

2956 
cÚn_poŞ
->
»dis_db
, cÚn_poŞ->
Çme
.
d©a
,

2957 
cÚn_£rv”
->
Çme
.
d©a
, 
mes§ge
);

2959 
	}
}

	@zkutil.c

1 
	~<zook“³r.h
>

3 
	~<´Ùo.h
>

4 
	~<±h»ad.h
>

5 
	~<¡dlib.h
>

6 
	~<¡dio.h
>

7 
	~<¡ršg.h
>

10 
	~<sys/time.h
>

11 
	~<uni¡d.h
>

12 
	~<sys/£Ëù.h
>

14 
	~<time.h
>

15 
	~<”ºo.h
>

16 
	~<as£¹.h
>

18 
	~"zkut.h
"

21 
	gcÚÃùed
 = 0;

22 
	gexpœed
 = 0;

25 cÚ¡ * 
	$S‹2SŒšg
(
¡©e
){

26 ià(
¡©e
 == 0)

28 ià(
¡©e
 =ğ
ZOO_CONNECTING_STATE
)

30 ià(
¡©e
 =ğ
ZOO_ASSOCIATING_STATE
)

32 ià(
¡©e
 =ğ
ZOO_CONNECTED_STATE
)

34 ià(
¡©e
 =ğ
ZOO_EXPIRED_SESSION_STATE
)

36 ià(
¡©e
 =ğ
ZOO_AUTH_FAILED_STATE
)

40 
	}
}

43 cÚ¡ * 
	$Ty³2SŒšg
(
ty³
){

44 ià(
ty³
 =ğ
ZOO_CREATED_EVENT
)

46 ià(
ty³
 =ğ
ZOO_DELETED_EVENT
)

48 ià(
ty³
 =ğ
ZOO_CHANGED_EVENT
)

50 ià(
ty³
 =ğ
ZOO_CHILD_EVENT
)

52 ià(
ty³
 =ğ
ZOO_SESSION_EVENT
)

54 ià(
ty³
 =ğ
ZOO_NOTWATCHING_EVENT
)

58 
	}
}

61 
	$Glob®W©ch”
(
zhªdË_t
 *
zh
,

62 
ty³
,

63 
¡©e
,

64 cÚ¡ *
·th
,

65 * 
ùx
) {

66 
	`årštf
(
¡d”r
, "global_watcher:ƒventype %s, state = %s",

67 
	`Ty³2SŒšg
(
ty³
), 
	`S‹2SŒšg
(
¡©e
));

68 ià(
·th
 && 
	`¡¾’
(path) > 0) {

69 
	`årštf
(
¡d”r
, " fÜ…©h %s", 
·th
);

71 
	`årštf
(
¡d”r
, "\n");

72 ià(
ty³
 =ğ
ZOO_SESSION_EVENT
) {

73 ià(
¡©e
 =ğ
ZOO_CONNECTED_STATE
) {

74 
cÚÃùed
 = 1;

75 } ià(
¡©e
 =ğ
ZOO_AUTH_FAILED_STATE
) {

76 
	`zook“³r_şo£
(
zh
);

77 } ià(
¡©e
 =ğ
ZOO_EXPIRED_SESSION_STATE
) {

78 
cÚÃùed
 = 0;

79 
expœed
 = 1;

80 
	`zook“³r_şo£
(
zh
);

82 
	`årštf
(
¡d”r
, "SESSIONƒvent: ignore state: %s\n",

83 
	`S‹2SŒšg
(
¡©e
));

86 
	`årštf
(
¡d”r
, "Ignoreype %s, state %s\n",

87 
	`Ty³2SŒšg
(
ty³
), 
	`S‹2SŒšg
(
¡©e
));

89 
	}
}

91 
	$DeçuÉG‘Com¶‘iÚ
(
rc
,

92 cÚ¡ *
v®ue
,

93 
v®ue_Ën
,

94 cÚ¡ 
St
 *
¡©
,

95 cÚ¡ *
d©a
) {

96 ià(
d©a
 =ğ
NULL
) {

99 
CÚ‹xtG‘
* 
ùx
 = (CÚ‹xtG‘*)
d©a
;

100 
ùx
->
rc
 =„c;

102 
rc
) {

103 
ZOK
:

104 ià(
v®ue_Ën
 > 
ùx
->
buf_Ën
 - 1) {

105 
ùx
->
»t_buf_Ën
 = ctx->
buf_Ën
 - 1;

107 
ùx
->
»t_buf_Ën
 = 
v®ue_Ën
;

109 
	`memıy
(
ùx
->
buf
, 
v®ue
, (
size_t
)ùx->
»t_buf_Ën
);

110 
ùx
->
buf
[ùx->
»t_buf_Ën
] = 0;

113 
ZCONNECTIONLOSS
:

114 
ZOPERATIONTIMEOUT
:

115 
	`årštf
(
¡d”r
, "Get completion:…ath %s:ƒrror = %d\n",

116 
ùx
->
·th
, 
rc
);

123 
	`±h»ad_mu‹x_uÆock
(&
ùx
->
lock
);

124 
	}
}

126 
	$DeçuÉExi¡sW©ch”
(
zhªdË_t
 *
zkh
,

127 
ty³
,

128 
¡©e
,

129 cÚ¡ *
·th
,

130 *
ùx
) {

131 
CÚ‹xtExi¡s
* 
û
 = (CÚ‹xtExi¡s*)
ùx
;

133 
	`årštf
(
¡d”r
, "exists_watcher: gotƒvent %s, state %s‡t…ath %s, ctx=%p\n",

134 
	`Ty³2SŒšg
(
ty³
), 
	`S‹2SŒšg
(
¡©e
), 
·th
, 
û
);

135 ià(
ty³
 =ğ
ZOO_CREATED_EVENT
) {

138 ià(
ty³
 =ğ
ZOO_CHANGED_EVENT
) {

141 ià(
ty³
 =ğ
ZOO_DELETED_EVENT
) {

144 ià(
û
) {

145 
	`ZKS‘Exi¡sW©ch
(
zkh
, (*)
·th
, 
û
->
w©ch”
, ce->
ùx
);

147 
	`ZKS‘Exi¡sW©ch
(
zkh
, (*)
·th
, 
DeçuÉExi¡sW©ch”
, 
ùx
);

149 
	}
}

152 
	$DeçuÉG‘W©ch”
(
zhªdË_t
 *
zkh
,

153 
ty³
,

154 
¡©e
,

155 cÚ¡ *
·th
,

156 *
ùx
) {

157 
CÚ‹xtG‘
 *
cg
 = (CÚ‹xtG‘*)
ùx
;

158 
	`årštf
(
¡d”r
, "get_watcher: gotƒvent %s, state %s‡t…ath %s, ctx=%p\n",

159 
	`Ty³2SŒšg
(
ty³
), 
	`S‹2SŒšg
(
¡©e
), 
·th
, 
cg
);

162 ià(
ty³
 =ğ
ZOO_CHANGED_EVENT
) {

164 
buf
[4000];

165 
w©ch
 = 0;

166 
sync
 = 1;

167 
	`ZKG‘
(
zkh
, 
·th
, 
buf
, (buf), 
w©ch
, 
sync
);

170 ià(
cg
) {

171 
	`ZKS‘G‘W©ch
(
zkh
, (*)
·th
, 
cg
->
w©ch”
, cg->
ùx
);

173 
	`ZKS‘G‘W©ch
(
zkh
, (*)
·th
, 
DeçuÉG‘W©ch”
, 
ùx
);

177 ià(
ty³
 =ğ
ZOO_DELETED_EVENT
) {

182 ià(
ty³
 =ğ
ZOO_SESSION_EVENT
) {

187 ià(
ty³
 =ğ
ZOO_NOTWATCHING_EVENT
) {

193 
	}
}

195 
	$ZKC»©e
(
zhªdË_t
 *
zkh
, * 
·th
, *
v®ue
, 
v®ue_Ën
, 
æags
) {

196 
rc
 = 
	`zoo_ü—‹
(
zkh
,

197 
·th
,

198 
v®ue
,

199 
v®ue_Ën
,

200 &
ZOO_OPEN_ACL_UNSAFE
,

201 
æags
,

202 
NULL
,

204 
	`årštf
(
¡d”r
, "create znode \"%s\",„et %d\n",

205 
·th
, 
rc
);

206  
rc
;

207 
	}
}

209 
	$ZKD–‘e
(
zhªdË_t
 *
zkh
, * 
·th
) {

210 
rc
 = 
	`zoo_d–‘e
(
zkh
, 
·th
, -1);

211 
	`årštf
(
¡d”r
, "delete znode \"%s\",„et %d\n",

212 
·th
, 
rc
);

214  
rc
;

215 
	}
}

217 
	$ZKS‘
(
zhªdË_t
 *
zkh
, * 
·th
, *
v®ue
, 
v®ue_Ën
) {

218 
rc
 = 
	`zoo_£t
(
zkh
, 
·th
, 
v®ue
, 
v®ue_Ën
, -1);

219 
	`årštf
(
¡d”r
, "Set znode \"%s\" value \"%s\",„et %d\n",

220 
·th
, 
v®ue
, 
rc
);

221  
rc
;

222 
	}
}

229 
	$ZKG‘
(
zhªdË_t
 *
zkh
,

230 cÚ¡ *
·th
,

231 *
buf
,

232 
buf_Ën
,

233 
w©ch
,

234 
sync
) {

236 
St
 
¡©
;

237 
CÚ‹xtG‘
 
ùx
;

238 
»t_buf_Ën
;

240 
rc
;

241 ià(
sync
) {

242 
»t_buf_Ën
 = 
buf_Ën
;

243 
rc
 = 
	`zoo_g‘
(
zkh
, 
·th
, 
w©ch
, 
buf
, &
»t_buf_Ën
, &
¡©
);

245 
ùx
.
·th
 = (*)path;

246 
ùx
.
buf
 = buf;

247 
ùx
.
buf_Ën
 = buf_len;

248 
ùx
.
»t_buf_Ën
 = 0;

249 
ùx
.
w©ch”
 = 
DeçuÉG‘W©ch”
;

250 
ùx
.ctx = &ctx;

252 
	`±h»ad_mu‹x_š™
(&
ùx
.
lock
, 
NULL
);

253 
	`±h»ad_mu‹x_lock
(&
ùx
.
lock
);

255 
rc
 = 
	`zoo_awg‘
(
zkh
,

256 
·th
,

257 
w©ch
 ? 
DeçuÉG‘W©ch”
 : 
NULL
,

258 
w©ch
 ? &
ùx
: 
NULL
,

259 
DeçuÉG‘Com¶‘iÚ
,

260 &
ùx
);

262 
»t_buf_Ën
 = 
ùx
.ret_buf_len;

264 ià(
rc
 !ğ
ZOK
) {

268 ià(
sync
) {

269 
	`årštf
(
¡d”r
, "ZKGet() sync:…ath %s:„et value \"%s\"(%d)\n",

270 
·th
, 
buf
, 
»t_buf_Ën
);

272 
	`±h»ad_mu‹x_lock
(&
ùx
.
lock
);

273 
	`årštf
(
¡d”r
, "ZKGet()‡sync:…ath %s:„et value \"%s\"(%d)\n",

274 
·th
, 
buf
, 
ùx
.
»t_buf_Ën
);

277  
»t_buf_Ën
;

278 
	}
}

286 
	$ZKS‘G‘W©ch
(
zhªdË_t
 *
zkh
, *
·th
, 
w©ch”_â
 
w©ch”
, * 
ùx
) {

287 
rc
 = 
	`zoo_awg‘
(
zkh
,

288 
·th
,

289 
w©ch”
,

290 
ùx
,

291 
DeçuÉG‘Com¶‘iÚ
,

292 
NULL
);

293  
rc
;

294 
	}
}

303 
	$ZKS‘Exi¡sW©ch
(
zhªdË_t
 *
zkh
, *
·th
, 
w©ch”_â
 
w©ch”
, * 
ùx
) {

304 
St
 
¡©
;

305 
rc
 = 
	`zoo_wexi¡s
(
zkh
,

306 
·th
,

307 
w©ch”
,

308 
ùx
,

309 &
¡©
);

310  
rc
;

311 
	}
}

316 
zhªdË_t
* 
	$ZKCÚÃù
(* 
zk_ho¡s
) {

317 ià(
cÚÃùed
) {

318 
	`årštf
(
¡d”r
, "zk % ®»ady cÚÃùed\n", 
zk_ho¡s
);

319  
NULL
;

322 
zhªdË_t
* 
zkh
 = 
NULL
;

323 
zkh
 = 
	`zook“³r_š™
(
zk_ho¡s
,

324 
Glob®W©ch”
,

326 
NULL
,

330 !
cÚÃùed
) {

331 
	`¦“p
(1);

334  
zkh
;

335 
	}
}

339 
	$ZKClo£
(
zhªdË_t
* 
zkh
) {

340 
	`zook“³r_şo£
(
zkh
);

341 
cÚÃùed
 = 0;

342 
	`årštf
(
¡d”r
, "have closed zk...\n");

343 
	}
}

349 
	$ZKExi¡s
(
zhªdË_t
 *
zkh
, * 
·th
) {

350 
St
 
¡©
;

351 
w©ch
 = 0;

352 
rc
 = 
	`zoo_exi¡s
(
zkh
, 
·th
, 
w©ch
, &
¡©
);

353 ià(
rc
 =ğ
ZOK
) {

358 
	}
}

	@zkutil.h

1 #iâdeà
_ZK_UTIL_H_


2 
	#_ZK_UTIL_H_


	)

4 
	~<zook“³r.h
>

6 
	~<´Ùo.h
>

7 
	~<±h»ad.h
>

8 
	~<¡dlib.h
>

9 
	~<¡dio.h
>

10 
	~<¡ršg.h
>

13 
	~<sys/time.h
>

14 
	~<uni¡d.h
>

15 
	~<sys/£Ëù.h
>

17 
	~<time.h
>

18 
	~<”ºo.h
>

19 
	~<as£¹.h
>

23 
	sCÚ‹xtG‘_s
 {

26 *
	m·th
;

28 *
	mbuf
;

30 
	mbuf_Ën
;

33 
	mrc
;

35 
	m»t_buf_Ën
;

38 
±h»ad_mu‹x_t
 
	mlock
;

42 
w©ch”_â
 
	mw©ch”
;

44 *
	mùx
;

46 } 
	tCÚ‹xtG‘
;

50 
	sCÚ‹xtExi¡s_s
 {

52 *
	m·th
;

55 
w©ch”_â
 
	mw©ch”
;

57 *
	mùx
;

59 } 
	tCÚ‹xtExi¡s
;

63 
zhªdË_t
* 
ZKCÚÃù
(* 
zk_ho¡s
);

66 
ZKClo£
(
zhªdË_t
* 
zkh
);

69 
ZKC»©e
(
zhªdË_t
 *
zkh
, * 
·th
, *
v®ue
, 
v®ue_Ën
, 
æags
);

72 
ZKG‘
(
zhªdË_t
 *
zkh
, cÚ¡ *
·th
, *
buf
, 
buf_Ën
, 
w©ch
, 
sync
);

75 
ZKS‘
(
zhªdË_t
 *
zkh
, * 
·th
, *
v®ue
, 
v®ue_Ën
);

78 
ZKD–‘e
(
zhªdË_t
 *
zkh
, * 
·th
);

81 
ZKExi¡s
(
zhªdË_t
 *
zkh
, * 
·th
);

84 
ZKS‘G‘W©ch
(
zhªdË_t
 *
zkh
, *
·th
, 
w©ch”_â
 
w©ch”
, * 
ùx
);

87 
ZKS‘Exi¡sW©ch
(
zhªdË_t
 *
zkh
, *
·th
, 
w©ch”_â
 
w©ch”
, * 
ùx
);

89 
DeçuÉG‘Com¶‘iÚ
(
rc
,

90 cÚ¡ *
v®ue
,

91 
v®ue_Ën
,

92 cÚ¡ 
St
 *
¡©
,

93 cÚ¡ *
d©a
);

95 
DeçuÉG‘W©ch”
(
zhªdË_t
 *
zkh
,

96 
ty³
,

97 
¡©e
,

98 cÚ¡ *
·th
,

99 *
ùx
);

101 
DeçuÉExi¡sW©ch”
(
zhªdË_t
 *
zkh
,

102 
ty³
,

103 
¡©e
,

104 cÚ¡ *
·th
,

105 *
ùx
);

108 
Glob®W©ch”
(
zhªdË_t
 *
zh
,

109 
ty³
,

110 
¡©e
,

111 cÚ¡ *
·th
,

112 * 
ùx
);

114 cÚ¡ * 
S‹2SŒšg
(
¡©e
);

116 cÚ¡ * 
Ty³2SŒšg
(
ty³
);

	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #undeà
_ASSERT_H


25 #undeà
as£¹


26 #undeà
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #undeà
as£¹_³¼Ü


34 
	#_ASSERT_H
 1

	)

35 
	~<ã©u»s.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
¡©ic_ÿ¡
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£¹
(
ex´
è(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£¹_³¼Ü
(
”ºum
è(
	`__ASSERT_VOID_CAST
 (0))

	)

64 #iâdeà
_ASSERT_H_DECLS


65 
	#_ASSERT_H_DECLS


	)

66 
__BEGIN_DECLS


69 
	$__as£¹_ç
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
,

70 
__lše
, cÚ¡ *
__funùiÚ
)

71 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

74 
	$__as£¹_³¼Ü_ç
 (
__”ºum
, cÚ¡ *
__fe
,

75 
__lše
, cÚ¡ *
__funùiÚ
)

76 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

81 
	$__as£¹
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
, 
__lše
)

82 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

85 
__END_DECLS


88 
	#as£¹
(
ex´
) \

89 ((
ex´
) \

90 ? 
	`__ASSERT_VOID_CAST
 (0) \

91 : 
	`__as£¹_ç
 (
	`__STRING
(
ex´
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

93 #ifdef 
__USE_GNU


94 
	#as£¹_³¼Ü
(
”ºum
) \

95 (!(
”ºum
) \

96 ? 
	`__ASSERT_VOID_CAST
 (0) \

97 : 
	`__as£¹_³¼Ü_ç
 ((
”ºum
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

105 #ià
defšed
 
__ılu¥lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

106 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

108 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

109 
	#__ASSERT_FUNCTION
 
__func__


	)

111 
	#__ASSERT_FUNCTION
 ((cÚ¡ *è0)

	)

118 #ià
defšed
 
__USE_ISOC11
 && !defšed 
__ılu¥lus


120 #undeà
¡©ic_as£¹


121 
	#¡©ic_as£¹
 
_Stic_as£¹


	)

	@/usr/include/ctype.h

22 #iâdef 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 
	g__BEGIN_DECLS


30 #iâdeà
_ISb™


39 
	~<’dŸn.h
>

40 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


41 
	#_ISb™
(
b™
è(1 << (b™))

	)

43 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

48 
	m_ISuµ”
 = 
_ISb™
 (0),

49 
	m_ISlow”
 = 
_ISb™
 (1),

50 
	m_IS®pha
 = 
_ISb™
 (2),

51 
	m_ISdig™
 = 
_ISb™
 (3),

52 
	m_ISxdig™
 = 
_ISb™
 (4),

53 
	m_IS¥aû
 = 
_ISb™
 (5),

54 
	m_IS´št
 = 
_ISb™
 (6),

55 
	m_ISg¿ph
 = 
_ISb™
 (7),

56 
	m_ISbÏnk
 = 
_ISb™
 (8),

57 
	m_ISúŒl
 = 
_ISb™
 (9),

58 
	m_ISpunù
 = 
_ISb™
 (10),

59 
	m_IS®num
 = 
_ISb™
 (11)

79 cÚ¡ **
	$__ùy³_b_loc
 ()

80 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

81 cÚ¡ 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

83 cÚ¡ 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

87 #iâdeà
__ılu¥lus


88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

90 #–ià
defšed
 
__USE_EXTERN_INLINES


91 
	#__isùy³_f
(
ty³
) \

92 
__ex‹º_šlše
 \

93 
is
##
	`ty³
 (
__c
è
__THROW
 \

95  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

96 
	}

	)
}

99 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

100 
	#__tßscii
(
c
è((cè& 0x7fè

	)

102 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__exùy³
 (
i§Êum
);

111 
__exùy³
 (
i§Íha
);

112 
__exùy³
 (
isúŒl
);

113 
__exùy³
 (
isdig™
);

114 
__exùy³
 (
i¦ow”
);

115 
__exùy³
 (
isg¿ph
);

116 
__exùy³
 (
i¥ršt
);

117 
__exùy³
 (
i¥unù
);

118 
__exùy³
 (
is¥aû
);

119 
__exùy³
 (
isuµ”
);

120 
__exùy³
 (
isxdig™
);

124 
	$tŞow”
 (
__c
è
__THROW
;

127 
	$touµ”
 (
__c
è
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__exùy³
 (
isbÏnk
);

138 
__END_NAMESPACE_C99


141 #ifdeà
__USE_GNU


143 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

146 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


150 
	$i§scii
 (
__c
è
__THROW
;

154 
	$tßscii
 (
__c
è
__THROW
;

158 
	`__exùy³
 (
_touµ”
);

159 
	`__exùy³
 (
_tŞow”
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

164 (
__ex‹nsiÚ__
 \

165 ({ 
__»s
; \

166 ià( (
c
) > 1) \

168 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

174 
__»s
 = 
f
 
¬gs
; \

177 
__»s
 = (
a
)[(è(
c
)]; \

178 
__»s
; 
	}
}))

	)

180 #ià!
defšed
 
__NO_CTYPE


181 #ifdeà
__isùy³_f


182 
	$__isùy³_f
 (
®num
)

183 
	$__isùy³_f
 (
®pha
)

184 
	$__isùy³_f
 (
úŒl
)

185 
	$__isùy³_f
 (
dig™
)

186 
	$__isùy³_f
 (
low”
)

187 
	$__isùy³_f
 (
g¿ph
)

188 
	$__isùy³_f
 (
´št
)

189 
	$__isùy³_f
 (
punù
)

190 
	$__isùy³_f
 (
¥aû
)

191 
	$__isùy³_f
 (
uµ”
)

192 
	$__isùy³_f
 (
xdig™
)

193 #ifdeà
__USE_ISOC99


194 
	$__isùy³_f
 (
bÏnk
)

196 #–ià
defšed
 
__isùy³


197 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

198 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

199 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

200 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

201 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

202 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

203 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

204 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

205 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

206 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

207 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

208 #ifdeà
__USE_ISOC99


209 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

213 #ifdeà
__USE_EXTERN_INLINES


214 
__ex‹º_šlše
 

215 
	`__NTH
 (
	$tŞow”
 (
__c
))

217  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

218 
	}
}

220 
__ex‹º_šlše
 

221 
__NTH
 (
	$touµ”
 (
__c
))

223  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

224 
	}
}

227 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


228 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

229 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

232 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


233 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

234 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

236 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

237 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

243 #ifdeà
__USE_XOPEN2K8


257 
	~<xloÿË.h
>

261 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

262 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

264 
	#__exùy³_l
(
Çme
) \

265 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

271 
__exùy³_l
 (
i§Êum_l
);

272 
__exùy³_l
 (
i§Íha_l
);

273 
__exùy³_l
 (
isúŒl_l
);

274 
__exùy³_l
 (
isdig™_l
);

275 
__exùy³_l
 (
i¦ow”_l
);

276 
__exùy³_l
 (
isg¿ph_l
);

277 
__exùy³_l
 (
i¥ršt_l
);

278 
__exùy³_l
 (
i¥unù_l
);

279 
__exùy³_l
 (
is¥aû_l
);

280 
__exùy³_l
 (
isuµ”_l
);

281 
__exùy³_l
 (
isxdig™_l
);

283 
__exùy³_l
 (
isbÏnk_l
);

287 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

288 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

291 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

292 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

294 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


295 
	#__tŞow”_l
(
c
, 
loÿË
) \

296 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

297 
	#__touµ”_l
(
c
, 
loÿË
) \

298 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

299 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

300 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

304 #iâdeà
__NO_CTYPE


305 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

306 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

307 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

308 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

309 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

310 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

311 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

312 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

313 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

314 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

315 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

317 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

319 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


320 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

321 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

324 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

325 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

326 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

327 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

328 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

329 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

330 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

331 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

332 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

333 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

334 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

336 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

338 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


339 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

340 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_BSD


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_BSD
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

62 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


63 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

64 
	#htŞe16
(
x
è(x)

	)

65 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

66 
	#Ë16toh
(
x
è(x)

	)

68 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

69 
	#htŞe32
(
x
è(x)

	)

70 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

71 
	#Ë32toh
(
x
è(x)

	)

73 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

74 
	#htŞe64
(
x
è(x)

	)

75 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

76 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/errno.h

22 #iâdef 
_ERRNO_H


26 #iâdef 
__Ãed_Em©h


27 
	#_ERRNO_H
 1

	)

28 
	~<ã©u»s.h
>

31 
	g__BEGIN_DECLS


35 
	~<b™s/”ºo.h
>

36 #undeà
__Ãed_Em©h


38 #ifdef 
_ERRNO_H


45 #iâdef 
”ºo


46 
”ºo
;

49 #ifdeà
__USE_GNU


54 *
´og¿m_švoÿtiÚ_Çme
, *
´og¿m_švoÿtiÚ_shÜt_Çme
;

58 
	g__END_DECLS


66 #ià
defšed
 
__USE_GNU
 || defšed 
__Ãed_”rÜ_t


67 #iâdeà
__”rÜ_t_defšed


68 
	t”rÜ_t
;

69 
	#__”rÜ_t_defšed
 1

	)

71 #undeà
__Ãed_”rÜ_t


	@/usr/include/execinfo.h

18 #iâdeà
_EXECINFO_H


19 
	#_EXECINFO_H
 1

	)

21 
	~<ã©u»s.h
>

23 
__BEGIN_DECLS


27 
	$backŒaû
 (**
__¬¿y
, 
__size
è
	`__nÚnuÎ
 ((1));

32 **
	$backŒaû_symbŞs
 (*cÚ¡ *
__¬¿y
, 
__size
)

33 
__THROW
 
	`__nÚnuÎ
 ((1));

38 
	$backŒaû_symbŞs_fd
 (*cÚ¡ *
__¬¿y
, 
__size
, 
__fd
)

39 
__THROW
 
	`__nÚnuÎ
 ((1));

41 
__END_DECLS


	@/usr/include/fcntl.h

22 #iâdef 
_FCNTL_H


23 
	#_FCNTL_H
 1

	)

25 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


31 
	~<b™s/ty³s.h
>

35 
	~<b™s/fú.h
>

40 #iâdeà
__mode_t_defšed


41 
__mode_t
 
	tmode_t
;

42 
	#__mode_t_defšed


	)

45 #iâdeà
__off_t_defšed


46 #iâdeà
__USE_FILE_OFFSET64


47 
__off_t
 
	toff_t
;

49 
__off64_t
 
	toff_t
;

51 
	#__off_t_defšed


	)

54 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


55 
__off64_t
 
	toff64_t
;

56 
	#__off64_t_defšed


	)

59 #iâdeà
__pid_t_defšed


60 
__pid_t
 
	tpid_t
;

61 
	#__pid_t_defšed


	)

65 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


66 
	#__Ãed_time¥ec


	)

67 
	~<time.h
>

68 
	~<b™s/¡©.h
>

70 
	#S_IFMT
 
__S_IFMT


	)

71 
	#S_IFDIR
 
__S_IFDIR


	)

72 
	#S_IFCHR
 
__S_IFCHR


	)

73 
	#S_IFBLK
 
__S_IFBLK


	)

74 
	#S_IFREG
 
__S_IFREG


	)

75 #ifdeà
__S_IFIFO


76 
	#S_IFIFO
 
__S_IFIFO


	)

78 #ifdeà
__S_IFLNK


79 
	#S_IFLNK
 
__S_IFLNK


	)

81 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
è&& defšed 
__S_IFSOCK


82 
	#S_IFSOCK
 
__S_IFSOCK


	)

87 
	#S_ISUID
 
__S_ISUID


	)

88 
	#S_ISGID
 
__S_ISGID


	)

90 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


92 
	#S_ISVTX
 
__S_ISVTX


	)

95 
	#S_IRUSR
 
__S_IREAD


	)

96 
	#S_IWUSR
 
__S_IWRITE


	)

97 
	#S_IXUSR
 
__S_IEXEC


	)

99 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

101 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

102 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

103 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

105 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

107 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

108 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

109 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

111 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

114 #ifdef 
__USE_MISC


115 #iâdeà
R_OK


118 
	#R_OK
 4

	)

119 
	#W_OK
 2

	)

120 
	#X_OK
 1

	)

121 
	#F_OK
 0

	)

126 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


127 
	#SEEK_SET
 0

	)

128 
	#SEEK_CUR
 1

	)

129 
	#SEEK_END
 2

	)

137 
fú
 (
__fd
, 
__cmd
, ...);

145 #iâdeà
__USE_FILE_OFFSET64


146 
	$İ’
 (cÚ¡ *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

148 #ifdeà
__REDIRECT


149 
	`__REDIRECT
 (
İ’
, (cÚ¡ *
__fe
, 
__oæag
, ...), 
İ’64
)

150 
	`__nÚnuÎ
 ((1));

152 
	#İ’
 
İ’64


	)

155 #ifdeà
__USE_LARGEFILE64


156 
	$İ’64
 (cÚ¡ *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

159 #ifdeà
__USE_ATFILE


169 #iâdeà
__USE_FILE_OFFSET64


170 
	$İ’©
 (
__fd
, cÚ¡ *
__fe
, 
__oæag
, ...)

171 
	`__nÚnuÎ
 ((2));

173 #ifdeà
__REDIRECT


174 
	`__REDIRECT
 (
İ’©
, (
__fd
, cÚ¡ *
__fe
, 
__oæag
,

175 ...), 
İ’©64
è
	`__nÚnuÎ
 ((2));

177 
	#İ’©
 
İ’©64


	)

180 #ifdeà
__USE_LARGEFILE64


181 
	$İ’©64
 (
__fd
, cÚ¡ *
__fe
, 
__oæag
, ...)

182 
	`__nÚnuÎ
 ((2));

191 #iâdeà
__USE_FILE_OFFSET64


192 
	$ü—t
 (cÚ¡ *
__fe
, 
mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

194 #ifdeà
__REDIRECT


195 
	`__REDIRECT
 (
ü—t
, (cÚ¡ *
__fe
, 
mode_t
 
__mode
),

196 
ü—t64
è
	`__nÚnuÎ
 ((1));

198 
	#ü—t
 
ü—t64


	)

201 #ifdeà
__USE_LARGEFILE64


202 
	$ü—t64
 (cÚ¡ *
__fe
, 
mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

205 #ià!
defšed
 
F_LOCK
 && (defšed 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

206 && !
defšed
 
__USE_POSIX
))

215 
	#F_ULOCK
 0

	)

216 
	#F_LOCK
 1

	)

217 
	#F_TLOCK
 2

	)

218 
	#F_TEST
 3

	)

220 #iâdeà
__USE_FILE_OFFSET64


221 
	`lockf
 (
__fd
, 
__cmd
, 
off_t
 
__Ën
);

223 #ifdeà
__REDIRECT


224 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
), 
lockf64
);

226 
	#lockf
 
lockf64


	)

229 #ifdeà
__USE_LARGEFILE64


230 
	`lockf64
 (
__fd
, 
__cmd
, 
off64_t
 
__Ën
);

234 #ifdeà
__USE_XOPEN2K


237 #iâdeà
__USE_FILE_OFFSET64


238 
	$posix_çdvi£
 (
__fd
, 
off_t
 
__off£t
, off_ˆ
__Ën
,

239 
__advi£
è
__THROW
;

241 #ifdeà
__REDIRECT_NTH


242 
	`__REDIRECT_NTH
 (
posix_çdvi£
, (
__fd
, 
__off64_t
 
__off£t
,

243 
__off64_t
 
__Ën
, 
__advi£
),

244 
posix_çdvi£64
);

246 
	#posix_çdvi£
 
posix_çdvi£64


	)

249 #ifdeà
__USE_LARGEFILE64


250 
	$posix_çdvi£64
 (
__fd
, 
off64_t
 
__off£t
, off64_ˆ
__Ën
,

251 
__advi£
è
__THROW
;

259 #iâdeà
__USE_FILE_OFFSET64


260 
	`posix_çÎoÿ‹
 (
__fd
, 
off_t
 
__off£t
, off_ˆ
__Ën
);

262 #ifdeà
__REDIRECT


263 
	`__REDIRECT
 (
posix_çÎoÿ‹
, (
__fd
, 
__off64_t
 
__off£t
,

264 
__off64_t
 
__Ën
),

265 
posix_çÎoÿ‹64
);

267 
	#posix_çÎoÿ‹
 
posix_çÎoÿ‹64


	)

270 #ifdeà
__USE_LARGEFILE64


271 
	`posix_çÎoÿ‹64
 (
__fd
, 
off64_t
 
__off£t
, off64_ˆ
__Ën
);

277 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ
 \

278 && 
defšed
 
__va_¬g_·ck_Ën


279 
	~<b™s/fú2.h
>

282 
__END_DECLS


	@/usr/include/getopt.h

19 #iâdeà
_GETOPT_H


21 #iâdeà
__Ãed_g‘İt


22 
	#_GETOPT_H
 1

	)

32 #ià!
defšed
 
__GNU_LIBRARY__


33 
	~<ùy³.h
>

36 #iâdeà
__THROW


37 #iâdeà
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

40 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__ılu¥lus


57 *
İrg
;

71 
İtšd
;

76 
İ‹¼
;

80 
İtİt
;

82 #iâdeà
__Ãed_g‘İt


104 
	sİtiÚ


106 cÚ¡ *
	gÇme
;

109 
	ghas_¬g
;

110 *
	gæag
;

111 
	gv®
;

116 
	#no_¬gum’t
 0

	)

117 
	#»quœed_¬gum’t
 1

	)

118 
	#İtiÚ®_¬gum’t
 2

	)

146 #ifdeà
__GNU_LIBRARY__


150 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

151 
__THROW
;

153 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

154 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


158 #ifdeà
__REDIRECT


159 
__REDIRECT_NTH
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

160 cÚ¡ *
__shÜtİts
),

161 
__posix_g‘İt
);

163 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

164 cÚ¡ *
__shÜtİts
è
__THROW
;

165 
	#g‘İt
 
__posix_g‘İt


	)

169 
g‘İt
 ();

172 #iâdeà
__Ãed_g‘İt


173 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

174 cÚ¡ *
__shÜtİts
,

175 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

176 
__THROW
;

177 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

178 cÚ¡ *
__shÜtİts
,

179 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

180 
__THROW
;

184 #ifdef 
__ılu¥lus


189 #undeà
__Ãed_g‘İt


	@/usr/include/inttypes.h

22 #iâdeà
_INTTYPES_H


23 
	#_INTTYPES_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	~<¡dšt.h
>

30 #iâdeà
____gwch¬_t_defšed


31 #ifdeà
__ılu¥lus


32 
	#__gwch¬_t
 
wch¬_t


	)

33 #–ià
defšed
 
__WCHAR_TYPE__


34 
__WCHAR_TYPE__
 
	t__gwch¬_t
;

36 
	#__Ãed_wch¬_t


	)

37 
	~<¡ddef.h
>

38 
wch¬_t
 
	t__gwch¬_t
;

40 
	#____gwch¬_t_defšed
 1

	)

43 #ià
__WORDSIZE
 == 64

44 
	#__PRI64_PREFIX
 "l"

	)

45 
	#__PRIPTR_PREFIX
 "l"

	)

47 
	#__PRI64_PREFIX
 "Î"

	)

48 
	#__PRIPTR_PREFIX


	)

54 
	#PRId8
 "d"

	)

55 
	#PRId16
 "d"

	)

56 
	#PRId32
 "d"

	)

57 
	#PRId64
 
__PRI64_PREFIX
 "d"

	)

59 
	#PRIdLEAST8
 "d"

	)

60 
	#PRIdLEAST16
 "d"

	)

61 
	#PRIdLEAST32
 "d"

	)

62 
	#PRIdLEAST64
 
__PRI64_PREFIX
 "d"

	)

64 
	#PRIdFAST8
 "d"

	)

65 
	#PRIdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

66 
	#PRIdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

67 
	#PRIdFAST64
 
__PRI64_PREFIX
 "d"

	)

70 
	#PRIi8
 "i"

	)

71 
	#PRIi16
 "i"

	)

72 
	#PRIi32
 "i"

	)

73 
	#PRIi64
 
__PRI64_PREFIX
 "i"

	)

75 
	#PRIiLEAST8
 "i"

	)

76 
	#PRIiLEAST16
 "i"

	)

77 
	#PRIiLEAST32
 "i"

	)

78 
	#PRIiLEAST64
 
__PRI64_PREFIX
 "i"

	)

80 
	#PRIiFAST8
 "i"

	)

81 
	#PRIiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

82 
	#PRIiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

83 
	#PRIiFAST64
 
__PRI64_PREFIX
 "i"

	)

86 
	#PRIo8
 "o"

	)

87 
	#PRIo16
 "o"

	)

88 
	#PRIo32
 "o"

	)

89 
	#PRIo64
 
__PRI64_PREFIX
 "o"

	)

91 
	#PRIoLEAST8
 "o"

	)

92 
	#PRIoLEAST16
 "o"

	)

93 
	#PRIoLEAST32
 "o"

	)

94 
	#PRIoLEAST64
 
__PRI64_PREFIX
 "o"

	)

96 
	#PRIoFAST8
 "o"

	)

97 
	#PRIoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

98 
	#PRIoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

99 
	#PRIoFAST64
 
__PRI64_PREFIX
 "o"

	)

102 
	#PRIu8
 "u"

	)

103 
	#PRIu16
 "u"

	)

104 
	#PRIu32
 "u"

	)

105 
	#PRIu64
 
__PRI64_PREFIX
 "u"

	)

107 
	#PRIuLEAST8
 "u"

	)

108 
	#PRIuLEAST16
 "u"

	)

109 
	#PRIuLEAST32
 "u"

	)

110 
	#PRIuLEAST64
 
__PRI64_PREFIX
 "u"

	)

112 
	#PRIuFAST8
 "u"

	)

113 
	#PRIuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

114 
	#PRIuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

115 
	#PRIuFAST64
 
__PRI64_PREFIX
 "u"

	)

118 
	#PRIx8
 "x"

	)

119 
	#PRIx16
 "x"

	)

120 
	#PRIx32
 "x"

	)

121 
	#PRIx64
 
__PRI64_PREFIX
 "x"

	)

123 
	#PRIxLEAST8
 "x"

	)

124 
	#PRIxLEAST16
 "x"

	)

125 
	#PRIxLEAST32
 "x"

	)

126 
	#PRIxLEAST64
 
__PRI64_PREFIX
 "x"

	)

128 
	#PRIxFAST8
 "x"

	)

129 
	#PRIxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

130 
	#PRIxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

131 
	#PRIxFAST64
 
__PRI64_PREFIX
 "x"

	)

134 
	#PRIX8
 "X"

	)

135 
	#PRIX16
 "X"

	)

136 
	#PRIX32
 "X"

	)

137 
	#PRIX64
 
__PRI64_PREFIX
 "X"

	)

139 
	#PRIXLEAST8
 "X"

	)

140 
	#PRIXLEAST16
 "X"

	)

141 
	#PRIXLEAST32
 "X"

	)

142 
	#PRIXLEAST64
 
__PRI64_PREFIX
 "X"

	)

144 
	#PRIXFAST8
 "X"

	)

145 
	#PRIXFAST16
 
__PRIPTR_PREFIX
 "X"

	)

146 
	#PRIXFAST32
 
__PRIPTR_PREFIX
 "X"

	)

147 
	#PRIXFAST64
 
__PRI64_PREFIX
 "X"

	)

151 
	#PRIdMAX
 
__PRI64_PREFIX
 "d"

	)

152 
	#PRIiMAX
 
__PRI64_PREFIX
 "i"

	)

153 
	#PRIoMAX
 
__PRI64_PREFIX
 "o"

	)

154 
	#PRIuMAX
 
__PRI64_PREFIX
 "u"

	)

155 
	#PRIxMAX
 
__PRI64_PREFIX
 "x"

	)

156 
	#PRIXMAX
 
__PRI64_PREFIX
 "X"

	)

160 
	#PRIdPTR
 
__PRIPTR_PREFIX
 "d"

	)

161 
	#PRIiPTR
 
__PRIPTR_PREFIX
 "i"

	)

162 
	#PRIoPTR
 
__PRIPTR_PREFIX
 "o"

	)

163 
	#PRIuPTR
 
__PRIPTR_PREFIX
 "u"

	)

164 
	#PRIxPTR
 
__PRIPTR_PREFIX
 "x"

	)

165 
	#PRIXPTR
 
__PRIPTR_PREFIX
 "X"

	)

171 
	#SCNd8
 "hhd"

	)

172 
	#SCNd16
 "hd"

	)

173 
	#SCNd32
 "d"

	)

174 
	#SCNd64
 
__PRI64_PREFIX
 "d"

	)

176 
	#SCNdLEAST8
 "hhd"

	)

177 
	#SCNdLEAST16
 "hd"

	)

178 
	#SCNdLEAST32
 "d"

	)

179 
	#SCNdLEAST64
 
__PRI64_PREFIX
 "d"

	)

181 
	#SCNdFAST8
 "hhd"

	)

182 
	#SCNdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

183 
	#SCNdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

184 
	#SCNdFAST64
 
__PRI64_PREFIX
 "d"

	)

187 
	#SCNi8
 "hhi"

	)

188 
	#SCNi16
 "hi"

	)

189 
	#SCNi32
 "i"

	)

190 
	#SCNi64
 
__PRI64_PREFIX
 "i"

	)

192 
	#SCNiLEAST8
 "hhi"

	)

193 
	#SCNiLEAST16
 "hi"

	)

194 
	#SCNiLEAST32
 "i"

	)

195 
	#SCNiLEAST64
 
__PRI64_PREFIX
 "i"

	)

197 
	#SCNiFAST8
 "hhi"

	)

198 
	#SCNiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

199 
	#SCNiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

200 
	#SCNiFAST64
 
__PRI64_PREFIX
 "i"

	)

203 
	#SCNu8
 "hhu"

	)

204 
	#SCNu16
 "hu"

	)

205 
	#SCNu32
 "u"

	)

206 
	#SCNu64
 
__PRI64_PREFIX
 "u"

	)

208 
	#SCNuLEAST8
 "hhu"

	)

209 
	#SCNuLEAST16
 "hu"

	)

210 
	#SCNuLEAST32
 "u"

	)

211 
	#SCNuLEAST64
 
__PRI64_PREFIX
 "u"

	)

213 
	#SCNuFAST8
 "hhu"

	)

214 
	#SCNuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

215 
	#SCNuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

216 
	#SCNuFAST64
 
__PRI64_PREFIX
 "u"

	)

219 
	#SCNo8
 "hho"

	)

220 
	#SCNo16
 "ho"

	)

221 
	#SCNo32
 "o"

	)

222 
	#SCNo64
 
__PRI64_PREFIX
 "o"

	)

224 
	#SCNoLEAST8
 "hho"

	)

225 
	#SCNoLEAST16
 "ho"

	)

226 
	#SCNoLEAST32
 "o"

	)

227 
	#SCNoLEAST64
 
__PRI64_PREFIX
 "o"

	)

229 
	#SCNoFAST8
 "hho"

	)

230 
	#SCNoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

231 
	#SCNoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

232 
	#SCNoFAST64
 
__PRI64_PREFIX
 "o"

	)

235 
	#SCNx8
 "hhx"

	)

236 
	#SCNx16
 "hx"

	)

237 
	#SCNx32
 "x"

	)

238 
	#SCNx64
 
__PRI64_PREFIX
 "x"

	)

240 
	#SCNxLEAST8
 "hhx"

	)

241 
	#SCNxLEAST16
 "hx"

	)

242 
	#SCNxLEAST32
 "x"

	)

243 
	#SCNxLEAST64
 
__PRI64_PREFIX
 "x"

	)

245 
	#SCNxFAST8
 "hhx"

	)

246 
	#SCNxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

247 
	#SCNxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

248 
	#SCNxFAST64
 
__PRI64_PREFIX
 "x"

	)

252 
	#SCNdMAX
 
__PRI64_PREFIX
 "d"

	)

253 
	#SCNiMAX
 
__PRI64_PREFIX
 "i"

	)

254 
	#SCNoMAX
 
__PRI64_PREFIX
 "o"

	)

255 
	#SCNuMAX
 
__PRI64_PREFIX
 "u"

	)

256 
	#SCNxMAX
 
__PRI64_PREFIX
 "x"

	)

259 
	#SCNdPTR
 
__PRIPTR_PREFIX
 "d"

	)

260 
	#SCNiPTR
 
__PRIPTR_PREFIX
 "i"

	)

261 
	#SCNoPTR
 
__PRIPTR_PREFIX
 "o"

	)

262 
	#SCNuPTR
 
__PRIPTR_PREFIX
 "u"

	)

263 
	#SCNxPTR
 
__PRIPTR_PREFIX
 "x"

	)

266 
	g__BEGIN_DECLS


268 #ià
__WORDSIZE
 == 64

273 
	mquÙ
;

274 
	m»m
;

275 } 
	timaxdiv_t
;

282 
__ex‹nsiÚ__
 
	mquÙ
;

283 
__ex‹nsiÚ__
 
	m»m
;

284 } 
	timaxdiv_t
;

290 
štmax_t
 
	$imaxabs
 (
štmax_t
 
__n
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

293 
imaxdiv_t
 
	$imaxdiv
 (
štmax_t
 
__num”
, iÁmax_ˆ
__d’om
)

294 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

297 
štmax_t
 
	$¡¹oimax
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

298 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

301 
uštmax_t
 
	$¡¹oumax
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

302 ** 
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

305 
štmax_t
 
	$wc¡oimax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

306 
__gwch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

307 
__THROW
;

310 
uštmax_t
 
	$wc¡oumax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

311 
__gwch¬_t
 ** 
__»¡riù
 
__’d±r
, 
__ba£
)

312 
__THROW
;

314 #ifdeà
__USE_EXTERN_INLINES


316 #ià
__WORDSIZE
 == 64

318 
	$__¡¹Ş_š‹º®
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

319 **
__»¡riù
 
__’d±r
,

320 
__ba£
, 
__group
)

321 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

323 
__ex‹º_šlše
 
štmax_t


324 
	`__NTH
 (
	$¡¹oimax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

325 
ba£
))

327  
	`__¡¹Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

328 
	}
}

330 
	$__¡¹oul_š‹º®
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

331 ** 
__»¡riù
 
__’d±r
,

332 
__ba£
, 
__group
)

333 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

335 
__ex‹º_šlše
 
uštmax_t


336 
	`__NTH
 (
	$¡¹oumax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

337 
ba£
))

339  
	`__¡¹oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

340 
	}
}

342 
	$__wc¡Ş_š‹º®
 (cÚ¡ 
__gwch¬_t
 * 
__»¡riù
 
__ÅŒ
,

343 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

344 
__ba£
, 
__group
)

345 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

347 
__ex‹º_šlše
 
štmax_t


348 
	`__NTH
 (
	$wc¡oimax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

349 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

351  
	`__wc¡Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

352 
	}
}

354 
	$__wc¡oul_š‹º®
 (cÚ¡ 
__gwch¬_t
 *

355 
__»¡riù
 
__ÅŒ
,

356 
__gwch¬_t
 **

357 
__»¡riù
 
__’d±r
,

358 
__ba£
, 
__group
)

359 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

361 
__ex‹º_šlše
 
uštmax_t


362 
	`__NTH
 (
	$wc¡oumax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

363 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

365  
	`__wc¡oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

366 
	}
}

370 
__ex‹nsiÚ__


371 
	$__¡¹Şl_š‹º®
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

372 **
__»¡riù
 
__’d±r
,

373 
__ba£
, 
__group
)

374 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

376 
__ex‹º_šlše
 
štmax_t


377 
	`__NTH
 (
	$¡¹oimax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

378 
ba£
))

380  
	`__¡¹Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

381 
	}
}

383 
__ex‹nsiÚ__


384 
	$__¡¹ouÎ_š‹º®
 (const *

385 
__»¡riù
 
__ÅŒ
,

387 
__»¡riù
 
__’d±r
,

388 
__ba£
,

389 
__group
)

390 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

392 
__ex‹º_šlše
 
uštmax_t


393 
	`__NTH
 (
	$¡¹oumax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

394 
ba£
))

396  
	`__¡¹ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

397 
	}
}

399 
__ex‹nsiÚ__


400 
	$__wc¡Şl_š‹º®
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

401 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

402 
__ba£
, 
__group
)

403 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

405 
__ex‹º_šlše
 
štmax_t


406 
	`__NTH
 (
	$wc¡oimax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

407 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

409  
	`__wc¡Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

410 
	}
}

413 
__ex‹nsiÚ__


414 
	$__wc¡ouÎ_š‹º®
 (cÚ¡ 
__gwch¬_t
 *

415 
__»¡riù
 
__ÅŒ
,

416 
__gwch¬_t
 **

417 
__»¡riù
 
__’d±r
,

418 
__ba£
,

419 
__group
)

420 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

422 
__ex‹º_šlše
 
uštmax_t


423 
	`__NTH
 (
	$wc¡oumax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

424 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

426  
	`__wc¡ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

427 
	}
}

432 
	g__END_DECLS


	@/usr/include/limits.h

22 #iâdeà
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<ã©u»s.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

41 #iâdeà
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<b™s/wÜdsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifdeà
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #ià
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #ià
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifdeà
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


123 #šşude_Ãxˆ<
lim™s
.
h
>

129 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


130 #iâdeà
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #iâdeà
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #iâdeà
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<b™s/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<b™s/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<b™s/xİ’_lim.h
>

	@/usr/include/math.h

23 #iâdef 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


32 
	~<b™s/huge_v®.h
>

33 #ifdeà
__USE_ISOC99


34 
	~<b™s/huge_v®f.h
>

35 
	~<b™s/huge_v®l.h
>

38 
	~<b™s/šf.h
>

41 
	~<b™s/Çn.h
>

45 
	~<b™s/m©hdef.h
>

52 
	#__MATHCALL
(
funùiÚ
,
suffix
, 
¬gs
) \

53 
	`__MATHDECL
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
)

	)

54 
	#__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

55 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
); \

56 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
)

	)

57 
	#__MATHCALLX
(
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

58 
	`__MATHDECLX
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
)

	)

59 
	#__MATHDECLX
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

60 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
); \

61 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
)

	)

62 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

63 
ty³
 
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
è
¬gs
 
__THROW


	)

65 
	#_MdoubË_
 

	)

66 
	#__MATH_PRECNAME
(
Çme
,
r
è
	`__CONCAT
Òame,r)

	)

67 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

68 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

69 
	~<b™s/m©hÿÎs.h
>

70 #undeà
_MdoubË_


71 #undeà
_MdoubË_BEGIN_NAMESPACE


72 #undeà
_MdoubË_END_NAMESPACE


73 #undeà
__MATH_PRECNAME


75 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


81 #iâdeà
_Mæßt_


82 
	#_Mæßt_
 

	)

84 
	#_MdoubË_
 
_Mæßt_


	)

85 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f
##
	)
r

86 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

87 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

88 
	~<b™s/m©hÿÎs.h
>

89 #undeà
_MdoubË_


90 #undeà
_MdoubË_BEGIN_NAMESPACE


91 #undeà
_MdoubË_END_NAMESPACE


92 #undeà
__MATH_PRECNAME


94 #ià!(
defšed
 
__NO_LONG_DOUBLE_MATH
 && defšed 
_LIBC
) \

95 || 
defšed
 
__LDBL_COMPAT


96 #ifdeà
__LDBL_COMPAT


98 #ifdeà
__USE_ISOC99


99 
	$__Ædbl_Ãx‰ow¬df
 (
__x
, 
__y
)

100 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

101 #ifdeà
__REDIRECT_NTH


102 
	`__REDIRECT_NTH
 (
Ãx‰ow¬df
, (
__x
, 
__y
),

103 
__Ædbl_Ãx‰ow¬df
)

104 
	`__©Œibu‹__
 ((
__cÚ¡__
));

105 
	`__REDIRECT_NTH
 (
Ãx‰ow¬d
, (
__x
, 
__y
),

106 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

107 
	`__REDIRECT_NTH
 (
Ãx‰ow¬dl
,

108 (
__x
, 
__y
),

109 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

113 #undeà
__MATHDECL_1


114 
	#__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
®Ÿs
) \

115 
ty³
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
), \

116 
¬gs
, 
®Ÿs
)

	)

117 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

118 
	`__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
	`__CONCAT
(funùiÚ,suffix))

	)

124 #iâdeà
_MlÚg_doubË_


125 
	#_MlÚg_doubË_
 

	)

127 
	#_MdoubË_
 
_MlÚg_doubË_


	)

128 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
l
##
	)
r

129 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

130 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

131 
	#__MATH_DECLARE_LDOUBLE
 1

	)

132 
	~<b™s/m©hÿÎs.h
>

133 #undeà
_MdoubË_


134 #undeà
_MdoubË_BEGIN_NAMESPACE


135 #undeà
_MdoubË_END_NAMESPACE


136 #undeà
__MATH_PRECNAME


141 #undeà
__MATHDECL_1


142 #undeà
__MATHDECL


143 #undeà
__MATHCALL


146 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


148 
signgam
;

153 #ifdeà
__USE_ISOC99


191 
FP_NAN
 =

192 
	#FP_NAN
 0

	)

193 
FP_NAN
,

194 
FP_INFINITE
 =

195 
	#FP_INFINITE
 1

	)

196 
FP_INFINITE
,

197 
FP_ZERO
 =

198 
	#FP_ZERO
 2

	)

199 
FP_ZERO
,

200 
FP_SUBNORMAL
 =

201 
	#FP_SUBNORMAL
 3

	)

202 
FP_SUBNORMAL
,

203 
FP_NORMAL
 =

204 
	#FP_NORMAL
 4

	)

205 
FP_NORMAL


209 #ifdeà
__NO_LONG_DOUBLE_MATH


210 
	#åşassify
(
x
) \

211 ( (
x
è=ğ (è? 
	`__åşassifyf
 (xè: 
	`__åşassify
 (x))

	)

213 
	#åşassify
(
x
) \

214 ( (
x
) ==  () \

215 ? 
	`__åşassifyf
 (
x
) \

216 :  (
x
) ==  () \

217 ? 
	`__åşassify
 (
x
è: 
	`__åşassifyl
 (x))

	)

221 #ifdeà
__NO_LONG_DOUBLE_MATH


222 
	#signb™
(
x
) \

223 ( (
x
è=ğ (è? 
	`__signb™f
 (xè: 
	`__signb™
 (x))

	)

225 
	#signb™
(
x
) \

226 ( (
x
) ==  () \

227 ? 
	`__signb™f
 (
x
) \

228 :  (
x
) ==  () \

229 ? 
	`__signb™
 (
x
è: 
	`__signb™l
 (x))

	)

233 #ifdeà
__NO_LONG_DOUBLE_MATH


234 
	#isfš™e
(
x
) \

235 ( (
x
è=ğ (è? 
	`__fš™ef
 (xè: 
	`__fš™e
 (x))

	)

237 
	#isfš™e
(
x
) \

238 ( (
x
) ==  () \

239 ? 
	`__fš™ef
 (
x
) \

240 :  (
x
) ==  () \

241 ? 
	`__fš™e
 (
x
è: 
	`__fš™–
 (x))

	)

245 
	#i¢Üm®
(
x
è(
	`åşassify
 (xè=ğ
FP_NORMAL
)

	)

249 #ifdeà
__NO_LONG_DOUBLE_MATH


250 
	#i¢ª
(
x
) \

251 ( (
x
è=ğ (è? 
	`__i¢ªf
 (xè: 
	`__i¢ª
 (x))

	)

253 
	#i¢ª
(
x
) \

254 ( (
x
) ==  () \

255 ? 
	`__i¢ªf
 (
x
) \

256 :  (
x
) ==  () \

257 ? 
	`__i¢ª
 (
x
è: 
	`__i¢ªl
 (x))

	)

261 #ifdeà
__NO_LONG_DOUBLE_MATH


262 
	#isšf
(
x
) \

263 ( (
x
è=ğ (è? 
	`__isšff
 (xè: 
	`__isšf
 (x))

	)

265 
	#isšf
(
x
) \

266 ( (
x
) ==  () \

267 ? 
	`__isšff
 (
x
) \

268 :  (
x
) ==  () \

269 ? 
	`__isšf
 (
x
è: 
	`__isšæ
 (x))

	)

273 
	#MATH_ERRNO
 1

	)

274 
	#MATH_ERREXCEPT
 2

	)

279 #iâdeà
__FAST_MATH__


280 
	#m©h_”rhªdlšg
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

285 #ifdeà
__USE_GNU


287 #ifdeà
__NO_LONG_DOUBLE_MATH


288 
	#issigÇlšg
(
x
) \

289 ( (
x
è=ğ (è? 
	`__issigÇlšgf
 (xè: 
	`__issigÇlšg
 (x))

	)

291 
	#issigÇlšg
(
x
) \

292 ( (
x
) ==  () \

293 ? 
	`__issigÇlšgf
 (
x
) \

294 :  (
x
) ==  () \

295 ? 
	`__issigÇlšg
 (
x
è: 
	`__issigÇlšgl
 (x))

	)

299 #ifdef 
__USE_MISC


303 
_IEEE_
 = -1,

304 
_SVID_
,

305 
_XOPEN_
,

306 
_POSIX_
,

307 
_ISOC_


308 } 
	t_LIB_VERSION_TYPE
;

313 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

317 #ifdeà
__USE_SVID


323 #ifdeà
__ılu¥lus


324 
__exû±iÚ


326 
exû±iÚ


329 
ty³
;

330 *
Çme
;

331 
¬g1
;

332 
¬g2
;

333 
»tv®
;

334 
	}
};

336 #ifdeà
__ılu¥lus


337 
	$m©h”r
 (
__exû±iÚ
 *
__exc
è
	`throw
 ();

339 
	`m©h”r
 (
exû±iÚ
 *
__exc
);

342 
	#X_TLOSS
 1.41484755040568800000e+16

	)

345 
	#DOMAIN
 1

	)

346 
	#SING
 2

	)

347 
	#OVERFLOW
 3

	)

348 
	#UNDERFLOW
 4

	)

349 
	#TLOSS
 5

	)

350 
	#PLOSS
 6

	)

353 
	#HUGE
 3.40282347e+38F

	)

357 #ifdeà
__USE_XOPEN


359 
	#MAXFLOAT
 3.40282347e+38F

	)

366 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


367 
	#M_E
 2.7182818284590452354

	)

368 
	#M_LOG2E
 1.4426950408889634074

	)

369 
	#M_LOG10E
 0.43429448190325182765

	)

370 
	#M_LN2
 0.69314718055994530942

	)

371 
	#M_LN10
 2.30258509299404568402

	)

372 
	#M_PI
 3.14159265358979323846

	)

373 
	#M_PI_2
 1.57079632679489661923

	)

374 
	#M_PI_4
 0.78539816339744830962

	)

375 
	#M_1_PI
 0.31830988618379067154

	)

376 
	#M_2_PI
 0.63661977236758134308

	)

377 
	#M_2_SQRTPI
 1.12837916709551257390

	)

378 
	#M_SQRT2
 1.41421356237309504880

	)

379 
	#M_SQRT1_2
 0.70710678118654752440

	)

385 #ifdeà
__USE_GNU


386 
	#M_El
 2.718281828459045235360287471352662498L

	)

387 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

388 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

389 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

390 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

391 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

392 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

393 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

394 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

395 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

396 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

397 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

398 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

405 #ià
defšed
 
__STRICT_ANSI__
 && !defšed 
__NO_MATH_INLINES


406 
	#__NO_MATH_INLINES
 1

	)

409 #ià
defšed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

416 
	#isg»©”
(
x
, 
y
è
	`__butš_isg»©”
(x, y)

	)

417 
	#isg»©”equ®
(
x
, 
y
è
	`__butš_isg»©”equ®
(x, y)

	)

418 
	#i¦ess
(
x
, 
y
è
	`__butš_i¦ess
(x, y)

	)

419 
	#i¦es£qu®
(
x
, 
y
è
	`__butš_i¦es£qu®
(x, y)

	)

420 
	#i¦essg»©”
(
x
, 
y
è
	`__butš_i¦essg»©”
(x, y)

	)

421 
	#isunÜd”ed
(
u
, 
v
è
	`__butš_isunÜd”ed
(u, v)

	)

425 #ifdeà
__USE_EXTERN_INLINES


426 
	~<b™s/m©hšlše.h
>

431 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

432 
	~<b™s/m©h-fš™e.h
>

435 #ifdeà
__USE_ISOC99


439 #iâdeà
isg»©”


440 
	#isg»©”
(
x
, 
y
) \

441 (
__ex‹nsiÚ__
 \

442 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

443 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x > __y; 
	}
}))

	)

447 #iâdeà
isg»©”equ®


448 
	#isg»©”equ®
(
x
, 
y
) \

449 (
__ex‹nsiÚ__
 \

450 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

451 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x >ğ__y; }))

	)

455 #iâdeà
i¦ess


456 
	#i¦ess
(
x
, 
y
) \

457 (
__ex‹nsiÚ__
 \

458 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

459 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x < __y; }))

	)

463 #iâdeà
i¦es£qu®


464 
	#i¦es£qu®
(
x
, 
y
) \

465 (
__ex‹nsiÚ__
 \

466 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

467 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x <ğ__y; }))

	)

471 #iâdeà
i¦essg»©”


472 
	#i¦essg»©”
(
x
, 
y
) \

473 (
__ex‹nsiÚ__
 \

474 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

475 !
	`isunÜd”ed
 (
__x
, 
__y
è&& (__x < __y || __y < __x); }))

	)

479 #iâdeà
isunÜd”ed


480 
	#isunÜd”ed
(
u
, 
v
) \

481 (
__ex‹nsiÚ__
 \

482 ({ 
	`__ty³of__
(
u
è
__u
 = (u); __ty³of__(
v
è
__v
 = (v); \

483 
	`åşassify
 (
__u
è=ğ
FP_NAN
 || fpşassify (
__v
è=ğFP_NAN; }))

	)

488 
	g__END_DECLS


	@/usr/include/netdb.h

22 #iâdef 
_NETDB_H


23 
	#_NETDB_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	~<Ãtš‘/š.h
>

28 
	~<¡dšt.h
>

29 #ifdeà
__USE_MISC


32 
	~<½c/Ãtdb.h
>

35 #ifdeà
__USE_GNU


36 
	#__Ãed_sigev’t_t


	)

37 
	~<b™s/sigšfo.h
>

38 
	#__Ãed_time¥ec


	)

39 
	~<time.h
>

42 
	~<b™s/Ãtdb.h
>

45 
	#_PATH_HEQUIV
 "/‘c/ho¡s.equiv"

	)

46 
	#_PATH_HOSTS
 "/‘c/ho¡s"

	)

47 
	#_PATH_NETWORKS
 "/‘c/ÃtwÜks"

	)

48 
	#_PATH_NSSWITCH_CONF
 "/‘c/nssw™ch.cÚf"

	)

49 
	#_PATH_PROTOCOLS
 "/‘c/´ÙocŞs"

	)

50 
	#_PATH_SERVICES
 "/‘c/£rviûs"

	)

53 
	g__BEGIN_DECLS


55 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


58 
	#h_”ºo
 (*
	`__h_”ºo_loÿtiÚ
 ())

	)

61 *
	$__h_”ºo_loÿtiÚ
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

65 
	#HOST_NOT_FOUND
 1

	)

66 
	#TRY_AGAIN
 2

	)

68 
	#NO_RECOVERY
 3

	)

70 
	#NO_DATA
 4

	)

73 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


74 
	#NETDB_INTERNAL
 -1

	)

75 
	#NETDB_SUCCESS
 0

	)

76 
	#NO_ADDRESS
 
NO_DATA


	)

79 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_XOPEN_EXTENDED


81 
	#IPPORT_RESERVED
 1024

	)

84 #ifdeà
__USE_GNU


86 
	#SCOPE_DELIMITER
 '%'

	)

89 #ifdeà
__USE_MISC


92 
	$h”rÜ
 (cÚ¡ *
__¡r
è
__THROW
;

95 cÚ¡ *
	$h¡»¼Ü
 (
__”r_num
è
__THROW
;

100 
	sho¡’t


102 *
h_Çme
;

103 **
h_®Ÿ£s
;

104 
h_add¹y³
;

105 
h_Ëngth
;

106 **
h_addr_li¡
;

107 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


108 
	#h_addr
 
h_addr_li¡
[0]

	)

117 
	`£tho¡’t
 (
__¡ay_İ’
);

123 
	`’dho¡’t
 ();

130 
ho¡’t
 *
	`g‘ho¡’t
 ();

137 
ho¡’t
 *
	`g‘ho¡byaddr
 (cÚ¡ *
__addr
, 
__sockËn_t
 
__Ën
,

138 
__ty³
);

144 
ho¡’t
 *
	`g‘ho¡byÇme
 (cÚ¡ *
__Çme
);

146 #ifdeà
__USE_MISC


155 
ho¡’t
 *
	`g‘ho¡byÇme2
 (cÚ¡ *
__Çme
, 
__af
);

167 
	`g‘ho¡’t_r
 (
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

168 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

169 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

170 *
__»¡riù
 
__h_”ºİ
);

172 
	`g‘ho¡byaddr_r
 (cÚ¡ *
__»¡riù
 
__addr
, 
__sockËn_t
 
__Ën
,

173 
__ty³
,

174 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

175 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

176 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

177 *
__»¡riù
 
__h_”ºİ
);

179 
	`g‘ho¡byÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

180 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

181 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

182 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

183 *
__»¡riù
 
__h_”ºİ
);

185 
	`g‘ho¡byÇme2_r
 (cÚ¡ *
__»¡riù
 
__Çme
, 
__af
,

186 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

187 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

188 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

189 *
__»¡riù
 
__h_”ºİ
);

198 
	`£Š‘’t
 (
__¡ay_İ’
);

204 
	`’dÃ‹Á
 ();

211 
Ã‹Á
 *
	`g‘Ã‹Á
 ();

218 
Ã‹Á
 *
	`g‘Ãtbyaddr
 (
ušt32_t
 
__Ãt
, 
__ty³
);

224 
Ã‹Á
 *
	`g‘ÃtbyÇme
 (cÚ¡ *
__Çme
);

226 #ifdef 
__USE_MISC


237 
	`g‘Ã‹Á_r
 (
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

238 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

239 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

240 *
__»¡riù
 
__h_”ºİ
);

242 
	`g‘Ãtbyaddr_r
 (
ušt32_t
 
__Ãt
, 
__ty³
,

243 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

244 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

245 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

246 *
__»¡riù
 
__h_”ºİ
);

248 
	`g‘ÃtbyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

249 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

250 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

251 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

252 *
__»¡riù
 
__h_”ºİ
);

257 
	s£rv’t


259 *
s_Çme
;

260 **
s_®Ÿ£s
;

261 
s_pÜt
;

262 *
s_´Ùo
;

270 
	`£t£rv’t
 (
__¡ay_İ’
);

276 
	`’d£rv’t
 ();

283 
£rv’t
 *
	`g‘£rv’t
 ();

290 
£rv’t
 *
	`g‘£rvbyÇme
 (cÚ¡ *
__Çme
, cÚ¡ *
__´Ùo
);

297 
£rv’t
 *
	`g‘£rvbypÜt
 (
__pÜt
, cÚ¡ *
__´Ùo
);

300 #ifdef 
__USE_MISC


308 
	`g‘£rv’t_r
 (
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

309 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

310 
£rv’t
 **
__»¡riù
 
__»suÉ
);

312 
	`g‘£rvbyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

313 cÚ¡ *
__»¡riù
 
__´Ùo
,

314 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

315 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

316 
£rv’t
 **
__»¡riù
 
__»suÉ
);

318 
	`g‘£rvbypÜt_r
 (
__pÜt
, cÚ¡ *
__»¡riù
 
__´Ùo
,

319 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

320 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

321 
£rv’t
 **
__»¡riù
 
__»suÉ
);

326 
	s´ÙÛÁ


328 *
p_Çme
;

329 **
p_®Ÿ£s
;

330 
p_´Ùo
;

338 
	`£rÙÛÁ
 (
__¡ay_İ’
);

344 
	`’d´ÙÛÁ
 ();

351 
´ÙÛÁ
 *
	`g‘´ÙÛÁ
 ();

357 
´ÙÛÁ
 *
	`g‘´ÙobyÇme
 (cÚ¡ *
__Çme
);

363 
´ÙÛÁ
 *
	`g‘´Ùobynumb”
 (
__´Ùo
);

366 #ifdef 
__USE_MISC


374 
	`g‘´ÙÛÁ_r
 (
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

375 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

376 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

378 
	`g‘´ÙobyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

379 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

380 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

381 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

383 
	`g‘´Ùobynumb”_r
 (
__´Ùo
,

384 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

385 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

386 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

395 
	`£Š‘g»Á
 (cÚ¡ *
__Ãtgroup
);

403 
	`’dÃtg»Á
 ();

412 
	`g‘Ãtg»Á
 (**
__»¡riù
 
__ho¡p
,

413 **
__»¡riù
 
__u£½
,

414 **
__»¡riù
 
__domašp
);

423 
	`šÃtgr
 (cÚ¡ *
__Ãtgroup
, cÚ¡ *
__ho¡
,

424 cÚ¡ *
__u£r
, cÚ¡ *
__domaš
);

432 
	`g‘Ãtg»Á_r
 (**
__»¡riù
 
__ho¡p
,

433 **
__»¡riù
 
__u£½
,

434 **
__»¡riù
 
__domašp
,

435 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
);

439 #ifdeà
__USE_BSD


451 
	`rcmd
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

452 cÚ¡ *
__»¡riù
 
__locu£r
,

453 cÚ¡ *
__»¡riù
 
__»mu£r
,

454 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

463 
	`rcmd_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

464 cÚ¡ *
__»¡riù
 
__locu£r
,

465 cÚ¡ *
__»¡riù
 
__»mu£r
,

466 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

467 
§_çmy_t
 
__af
);

479 
	`»xec
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

480 cÚ¡ *
__»¡riù
 
__Çme
,

481 cÚ¡ *
__»¡riù
 
__·ss
,

482 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

491 
	`»xec_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

492 cÚ¡ *
__»¡riù
 
__Çme
,

493 cÚ¡ *
__»¡riù
 
__·ss
,

494 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

495 
§_çmy_t
 
__af
);

505 
	`ru£rok
 (cÚ¡ *
__rho¡
, 
__su£r
,

506 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
);

515 
	`ru£rok_af
 (cÚ¡ *
__rho¡
, 
__su£r
,

516 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
,

517 
§_çmy_t
 
__af
);

528 
	`œu£rok
 (
ušt32_t
 
__¿ddr
, 
__su£r
,

529 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
);

539 
	`œu£rok_af
 (cÚ¡ *
__¿ddr
, 
__su£r
,

540 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
,

541 
§_çmy_t
 
__af
);

551 
	`¼esvpÜt
 (*
__®pÜt
);

560 
	`¼esvpÜt_af
 (*
__®pÜt
, 
§_çmy_t
 
__af
);

565 #ifdef 
__USE_POSIX


567 
	saddršfo


569 
ai_æags
;

570 
ai_çmy
;

571 
ai_sockty³
;

572 
ai_´ÙocŞ
;

573 
sockËn_t
 
ai_add¾’
;

574 
sockaddr
 *
ai_addr
;

575 *
ai_ÿnÚÇme
;

576 
addršfo
 *
ai_Ãxt
;

579 #ifdeà
__USE_GNU


581 
	sgaicb


583 cÚ¡ *
¬_Çme
;

584 cÚ¡ *
¬_£rviû
;

585 cÚ¡ 
addršfo
 *
¬_»que¡
;

586 
addršfo
 *
¬_»suÉ
;

588 
__»tuº
;

589 
__glibc_»£rved
[5];

593 
	#GAI_WAIT
 0

	)

594 
	#GAI_NOWAIT
 1

	)

598 
	#AI_PASSIVE
 0x0001

	)

599 
	#AI_CANONNAME
 0x0002

	)

600 
	#AI_NUMERICHOST
 0x0004

	)

601 
	#AI_V4MAPPED
 0x0008

	)

602 
	#AI_ALL
 0x0010

	)

603 
	#AI_ADDRCONFIG
 0x0020

	)

605 #ifdeà
__USE_GNU


606 
	#AI_IDN
 0x0040

	)

609 
	#AI_CANONIDN
 0x0080

	)

610 
	#AI_IDN_ALLOW_UNASSIGNED
 0x0100

	)

612 
	#AI_IDN_USE_STD3_ASCII_RULES
 0x0200

	)

615 
	#AI_NUMERICSERV
 0x0400

	)

618 
	#EAI_BADFLAGS
 -1

	)

619 
	#EAI_NONAME
 -2

	)

620 
	#EAI_AGAIN
 -3

	)

621 
	#EAI_FAIL
 -4

	)

622 
	#EAI_FAMILY
 -6

	)

623 
	#EAI_SOCKTYPE
 -7

	)

624 
	#EAI_SERVICE
 -8

	)

625 
	#EAI_MEMORY
 -10

	)

626 
	#EAI_SYSTEM
 -11

	)

627 
	#EAI_OVERFLOW
 -12

	)

628 #ifdeà
__USE_GNU


629 
	#EAI_NODATA
 -5

	)

630 
	#EAI_ADDRFAMILY
 -9

	)

631 
	#EAI_INPROGRESS
 -100

	)

632 
	#EAI_CANCELED
 -101

	)

633 
	#EAI_NOTCANCELED
 -102

	)

634 
	#EAI_ALLDONE
 -103

	)

635 
	#EAI_INTR
 -104

	)

636 
	#EAI_IDN_ENCODE
 -105

	)

639 #ifdeà
__USE_MISC


640 
	#NI_MAXHOST
 1025

	)

641 
	#NI_MAXSERV
 32

	)

644 
	#NI_NUMERICHOST
 1

	)

645 
	#NI_NUMERICSERV
 2

	)

646 
	#NI_NOFQDN
 4

	)

647 
	#NI_NAMEREQD
 8

	)

648 
	#NI_DGRAM
 16

	)

649 #ifdeà
__USE_GNU


650 
	#NI_IDN
 32

	)

651 
	#NI_IDN_ALLOW_UNASSIGNED
 64

	)

653 
	#NI_IDN_USE_STD3_ASCII_RULES
 128

	)

662 
	`g‘addršfo
 (cÚ¡ *
__»¡riù
 
__Çme
,

663 cÚ¡ *
__»¡riù
 
__£rviû
,

664 cÚ¡ 
addršfo
 *
__»¡riù
 
__»q
,

665 
addršfo
 **
__»¡riù
 
__·i
);

668 
	$ä“addršfo
 (
addršfo
 *
__ai
è
__THROW
;

671 cÚ¡ *
	$gai_¡»¼Ü
 (
__ecode
è
__THROW
;

677 
	`g‘Çmešfo
 (cÚ¡ 
sockaddr
 *
__»¡riù
 
__§
,

678 
sockËn_t
 
__§Ën
, *
__»¡riù
 
__ho¡
,

679 
sockËn_t
 
__ho¡Ën
, *
__»¡riù
 
__£rv
,

680 
sockËn_t
 
__£rvËn
, 
__æags
);

683 #ifdeà
__USE_GNU


692 
	`g‘addršfo_a
 (
__mode
, 
gaicb
 *
__li¡
[
__»¡riù_¬r
],

693 
__’t
, 
sigev’t
 *
__»¡riù
 
__sig
);

703 
	`gai_su¥’d
 (cÚ¡ 
gaicb
 *cÚ¡ 
__li¡
[], 
__’t
,

704 cÚ¡ 
time¥ec
 *
__timeout
);

707 
	$gai_”rÜ
 (
gaicb
 *
__»q
è
__THROW
;

710 
	$gai_ÿnûl
 (
gaicb
 *
__gaicbp
è
__THROW
;

713 
__END_DECLS


	@/usr/include/netinet/in.h

18 #iâdef 
_NETINET_IN_H


19 
	#_NETINET_IN_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<¡dšt.h
>

23 
	~<sys/sock‘.h
>

24 
	~<b™s/ty³s.h
>

27 
__BEGIN_DECLS


30 
ušt32_t
 
	tš_addr_t
;

31 
	sš_addr


33 
š_addr_t
 
	ms_addr
;

37 
	~<b™s/š.h
>

42 
	mIPPROTO_IP
 = 0,

43 
	#IPPROTO_IP
 
IPPROTO_IP


	)

44 
	mIPPROTO_ICMP
 = 1,

45 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

46 
	mIPPROTO_IGMP
 = 2,

47 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

48 
	mIPPROTO_IPIP
 = 4,

49 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

50 
	mIPPROTO_TCP
 = 6,

51 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

52 
	mIPPROTO_EGP
 = 8,

53 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

54 
	mIPPROTO_PUP
 = 12,

55 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

56 
	mIPPROTO_UDP
 = 17,

57 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

58 
	mIPPROTO_IDP
 = 22,

59 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

60 
	mIPPROTO_TP
 = 29,

61 
	#IPPROTO_TP
 
IPPROTO_TP


	)

62 
	mIPPROTO_DCCP
 = 33,

63 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

64 
	mIPPROTO_IPV6
 = 41,

65 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

66 
	mIPPROTO_RSVP
 = 46,

67 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

68 
	mIPPROTO_GRE
 = 47,

69 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

70 
	mIPPROTO_ESP
 = 50,

71 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

72 
	mIPPROTO_AH
 = 51,

73 
	#IPPROTO_AH
 
IPPROTO_AH


	)

74 
	mIPPROTO_MTP
 = 92,

75 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

76 
	mIPPROTO_BEETPH
 = 94,

77 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

78 
	mIPPROTO_ENCAP
 = 98,

79 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

80 
	mIPPROTO_PIM
 = 103,

81 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

82 
	mIPPROTO_COMP
 = 108,

83 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

84 
	mIPPROTO_SCTP
 = 132,

85 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

86 
	mIPPROTO_UDPLITE
 = 136,

87 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

88 
	mIPPROTO_RAW
 = 255,

89 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

90 
	mIPPROTO_MAX


96 #iâdeà
__USE_KERNEL_IPV6_DEFS


99 
	mIPPROTO_HOPOPTS
 = 0,

100 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

101 
	mIPPROTO_ROUTING
 = 43,

102 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

103 
	mIPPROTO_FRAGMENT
 = 44,

104 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

105 
	mIPPROTO_ICMPV6
 = 58,

106 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

107 
	mIPPROTO_NONE
 = 59,

108 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

109 
	mIPPROTO_DSTOPTS
 = 60,

110 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

111 
	mIPPROTO_MH
 = 135

112 
	#IPPROTO_MH
 
IPPROTO_MH


	)

117 
ušt16_t
 
	tš_pÜt_t
;

122 
	mIPPORT_ECHO
 = 7,

123 
	mIPPORT_DISCARD
 = 9,

124 
	mIPPORT_SYSTAT
 = 11,

125 
	mIPPORT_DAYTIME
 = 13,

126 
	mIPPORT_NETSTAT
 = 15,

127 
	mIPPORT_FTP
 = 21,

128 
	mIPPORT_TELNET
 = 23,

129 
	mIPPORT_SMTP
 = 25,

130 
	mIPPORT_TIMESERVER
 = 37,

131 
	mIPPORT_NAMESERVER
 = 42,

132 
	mIPPORT_WHOIS
 = 43,

133 
	mIPPORT_MTP
 = 57,

135 
	mIPPORT_TFTP
 = 69,

136 
	mIPPORT_RJE
 = 77,

137 
	mIPPORT_FINGER
 = 79,

138 
	mIPPORT_TTYLINK
 = 87,

139 
	mIPPORT_SUPDUP
 = 95,

142 
	mIPPORT_EXECSERVER
 = 512,

143 
	mIPPORT_LOGINSERVER
 = 513,

144 
	mIPPORT_CMDSERVER
 = 514,

145 
	mIPPORT_EFSSERVER
 = 520,

148 
	mIPPORT_BIFFUDP
 = 512,

149 
	mIPPORT_WHOSERVER
 = 513,

150 
	mIPPORT_ROUTESERVER
 = 520,

153 
	mIPPORT_RESERVED
 = 1024,

156 
	mIPPORT_USERRESERVED
 = 5000

164 
	#IN_CLASSA
(
a
è((((
š_addr_t
)×)è& 0x80000000è=ğ0)

	)

165 
	#IN_CLASSA_NET
 0xff000000

	)

166 
	#IN_CLASSA_NSHIFT
 24

	)

167 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

168 
	#IN_CLASSA_MAX
 128

	)

170 
	#IN_CLASSB
(
a
è((((
š_addr_t
)×)è& 0xc0000000è=ğ0x80000000)

	)

171 
	#IN_CLASSB_NET
 0xffff0000

	)

172 
	#IN_CLASSB_NSHIFT
 16

	)

173 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

174 
	#IN_CLASSB_MAX
 65536

	)

176 
	#IN_CLASSC
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xc0000000)

	)

177 
	#IN_CLASSC_NET
 0xffffff00

	)

178 
	#IN_CLASSC_NSHIFT
 8

	)

179 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

181 
	#IN_CLASSD
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xe0000000)

	)

182 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

184 
	#IN_EXPERIMENTAL
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xe0000000)

	)

185 
	#IN_BADCLASS
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xf0000000)

	)

188 
	#INADDR_ANY
 ((
š_addr_t
è0x00000000)

	)

190 
	#INADDR_BROADCAST
 ((
š_addr_t
è0xffffffff)

	)

192 
	#INADDR_NONE
 ((
š_addr_t
è0xffffffff)

	)

195 
	#IN_LOOPBACKNET
 127

	)

197 #iâdeà
INADDR_LOOPBACK


198 
	#INADDR_LOOPBACK
 ((
š_addr_t
è0x7f000001è

	)

202 
	#INADDR_UNSPEC_GROUP
 ((
š_addr_t
è0xe0000000è

	)

203 
	#INADDR_ALLHOSTS_GROUP
 ((
š_addr_t
è0xe0000001è

	)

204 
	#INADDR_ALLRTRS_GROUP
 ((
š_addr_t
è0xe0000002è

	)

205 
	#INADDR_MAX_LOCAL_GROUP
 ((
š_addr_t
è0xe00000ffè

	)

207 #iâdeà
__USE_KERNEL_IPV6_DEFS


209 
	sš6_addr


213 
ušt8_t
 
	m__u6_addr8
[16];

214 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


215 
ušt16_t
 
	m__u6_addr16
[8];

216 
ušt32_t
 
	m__u6_addr32
[4];

218 } 
	m__š6_u
;

219 
	#s6_addr
 
__š6_u
.
__u6_addr8


	)

220 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


221 
	#s6_addr16
 
__š6_u
.
__u6_addr16


	)

222 
	#s6_addr32
 
__š6_u
.
__u6_addr32


	)

227 cÚ¡ 
š6_addr
 
š6addr_ªy
;

228 cÚ¡ 
š6_addr
 
š6addr_loİback
;

229 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

230 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

232 
	#INET_ADDRSTRLEN
 16

	)

233 
	#INET6_ADDRSTRLEN
 46

	)

237 
	ssockaddr_š


239 
__SOCKADDR_COMMON
 (
sš_
);

240 
š_pÜt_t
 
	msš_pÜt
;

241 
š_addr
 
	msš_addr
;

244 
	msš_z”o
[ (
sockaddr
) -

245 
__SOCKADDR_COMMON_SIZE
 -

246  (
š_pÜt_t
) -

247  (
š_addr
)];

250 #iâdeà
__USE_KERNEL_IPV6_DEFS


252 
	ssockaddr_š6


254 
__SOCKADDR_COMMON
 (
sš6_
);

255 
š_pÜt_t
 
	msš6_pÜt
;

256 
ušt32_t
 
	msš6_æowšfo
;

257 
š6_addr
 
	msš6_addr
;

258 
ušt32_t
 
	msš6_scİe_id
;

262 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


264 
	s_m»q


267 
š_addr
 
	mimr_muÉŸddr
;

270 
š_addr
 
	mimr_š‹rçû
;

273 
	s_m»q_sourû


276 
š_addr
 
	mimr_muÉŸddr
;

279 
š_addr
 
	mimr_š‹rçû
;

282 
š_addr
 
	mimr_sourûaddr
;

286 #iâdeà
__USE_KERNEL_IPV6_DEFS


288 
	sv6_m»q


291 
š6_addr
 
	mv6mr_muÉŸddr
;

294 
	mv6mr_š‹rçû
;

298 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


300 
	sgroup_»q


303 
ušt32_t
 
	mgr_š‹rçû
;

306 
sockaddr_¡Üage
 
	mgr_group
;

309 
	sgroup_sourû_»q


312 
ušt32_t
 
	mg¤_š‹rçû
;

315 
sockaddr_¡Üage
 
	mg¤_group
;

318 
sockaddr_¡Üage
 
	mg¤_sourû
;

323 
	s_msf‹r


326 
š_addr
 
	mimsf_muÉŸddr
;

329 
š_addr
 
	mimsf_š‹rçû
;

332 
ušt32_t
 
	mimsf_fmode
;

335 
ušt32_t
 
	mimsf_num¤c
;

337 
š_addr
 
	mimsf_¦i¡
[1];

340 
	#IP_MSFILTER_SIZE
(
num¤c
è( (
_msf‹r
) \

341 -  (
š_addr
) \

342 + (
num¤c
è*  (
š_addr
))

	)

344 
	sgroup_f‹r


347 
ušt32_t
 
	mgf_š‹rçû
;

350 
sockaddr_¡Üage
 
	mgf_group
;

353 
ušt32_t
 
	mgf_fmode
;

356 
ušt32_t
 
	mgf_num¤c
;

358 
sockaddr_¡Üage
 
	mgf_¦i¡
[1];

361 
	#GROUP_FILTER_SIZE
(
num¤c
è( (
group_f‹r
) \

362 -  (
sockaddr_¡Üage
) \

363 + ((
num¤c
) \

364 *  (
sockaddr_¡Üage
)))

	)

374 
ušt32_t
 
	$Áohl
 (
ušt32_t
 
__ÃÚg
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

375 
ušt16_t
 
	$Áohs
 (
ušt16_t
 
__ÃtshÜt
)

376 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

377 
ušt32_t
 
	$htÚl
 (
ušt32_t
 
__ho¡lÚg
)

378 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

379 
ušt16_t
 
	$htÚs
 (
ušt16_t
 
__ho¡shÜt
)

380 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

382 
	~<’dŸn.h
>

385 
	~<b™s/by‹sw­.h
>

387 #ifdeà
__OPTIMIZE__


391 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


394 
	#Áohl
(
x
è(x)

	)

395 
	#Áohs
(
x
è(x)

	)

396 
	#htÚl
(
x
è(x)

	)

397 
	#htÚs
(
x
è(x)

	)

399 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


400 
	#Áohl
(
x
è
	`__bsw­_32
 (x)

	)

401 
	#Áohs
(
x
è
	`__bsw­_16
 (x)

	)

402 
	#htÚl
(
x
è
	`__bsw­_32
 (x)

	)

403 
	#htÚs
(
x
è
	`__bsw­_16
 (x)

	)

408 #ifdeà
__GNUC__


409 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

410 (
__ex‹nsiÚ__
 \

411 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

412 
__a
->
s6_addr32
[0] == 0 \

413 && 
__a
->
s6_addr32
[1] == 0 \

414 && 
__a
->
s6_addr32
[2] == 0 \

415 && 
__a
->
s6_addr32
[3] =ğ0; 
	}
}))

	)

417 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

418 (
__ex‹nsiÚ__
 \

419 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

420 
__a
->
s6_addr32
[0] == 0 \

421 && 
__a
->
s6_addr32
[1] == 0 \

422 && 
__a
->
s6_addr32
[2] == 0 \

423 && 
__a
->
s6_addr32
[3] =ğ
	`htÚl
 (1); }))

	)

425 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

426 (
__ex‹nsiÚ__
 \

427 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

428 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xã800000); }))

	)

430 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

431 (
__ex‹nsiÚ__
 \

432 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

433 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xãc00000); }))

	)

435 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

436 (
__ex‹nsiÚ__
 \

437 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

438 
__a
->
s6_addr32
[0] == 0 \

439 && 
__a
->
s6_addr32
[1] == 0 \

440 && 
__a
->
s6_addr32
[2] =ğ
	`htÚl
 (0xffff); }))

	)

442 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

443 (
__ex‹nsiÚ__
 \

444 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

445 
__a
->
s6_addr32
[0] == 0 \

446 && 
__a
->
s6_addr32
[1] == 0 \

447 && 
__a
->
s6_addr32
[2] == 0 \

448 && 
	`Áohl
 (
__a
->
s6_addr32
[3]è> 1; }))

	)

450 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

451 (
__ex‹nsiÚ__
 \

452 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

453 cÚ¡ 
š6_addr
 *
__b
 = (cÚ¡ š6_add¸*è(
b
); \

454 
__a
->
s6_addr32
[0] =ğ
__b
->s6_addr32[0] \

455 && 
__a
->
s6_addr32
[1] =ğ
__b
->s6_addr32[1] \

456 && 
__a
->
s6_addr32
[2] =ğ
__b
->s6_addr32[2] \

457 && 
__a
->
s6_addr32
[3] =ğ
__b
->s6_addr32[3]; }))

	)

459 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

460 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

461 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

462 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

463 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ0)

	)

465 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

466 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

467 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

468 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

469 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ
	`htÚl
 (1))

	)

471 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

472 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

473 =ğ
	`htÚl
 (0xã800000))

	)

475 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

476 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

477 =ğ
	`htÚl
 (0xãc00000))

	)

479 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

480 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

481 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

482 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ
	`htÚl
 (0xffff)))

	)

484 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

485 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

486 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

487 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0) \

488 && (
	`Áohl
 (((cÚ¡ 
ušt32_t
 *è(
a
))[3]è> 1))

	)

490 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

491 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[0]) \

492 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[1]) \

493 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[2]) \

494 && (((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[3]))

	)

497 
	#IN6_IS_ADDR_MULTICAST
(
a
è(((cÚ¡ 
ušt8_t
 *è×))[0] =ğ0xff)

	)

499 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_GNU


501 
	$bšd»svpÜt
 (
__sockfd
, 
sockaddr_š
 *
__sock_š
è
__THROW
;

504 
	$bšd»svpÜt6
 (
__sockfd
, 
sockaddr_š6
 *
__sock_š
)

505 
__THROW
;

509 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

510 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

511 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x1))

	)

513 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

514 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

515 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x2))

	)

517 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

518 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

519 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x5))

	)

521 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

522 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

523 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x8))

	)

525 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

526 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

527 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0xe))

	)

530 #ifdeà
__USE_GNU


531 
cmsghdr
;

534 
	sš6_pktšfo


536 
š6_addr
 
i6_addr
;

537 
i6_ifšdex
;

541 
	s6_mtušfo


543 
sockaddr_š6
 
6m_addr
;

544 
ušt32_t
 
6m_mtu
;

549 
	$š‘6_İtiÚ_¥aû
 (
__nby‹s
)

550 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

551 
	$š‘6_İtiÚ_š™
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

552 
__ty³
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

553 
	$š‘6_İtiÚ_­³nd
 (
cmsghdr
 *
__cmsg
,

554 cÚ¡ 
ušt8_t
 *
__ty³p
, 
__muÉx
,

555 
__¶usy
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

556 
ušt8_t
 *
	$š‘6_İtiÚ_®loc
 (
cmsghdr
 *
__cmsg
, 
__d©®’
,

557 
__muÉx
, 
__¶usy
)

558 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

559 
	$š‘6_İtiÚ_Ãxt
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

560 
ušt8_t
 **
__Œp
)

561 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

562 
	$š‘6_İtiÚ_fšd
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

563 
ušt8_t
 **
__Œp
, 
__ty³
)

564 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

568 
	$š‘6_İt_š™
 (*
__extbuf
, 
sockËn_t
 
__ex’
è
__THROW
;

569 
	$š‘6_İt_­³nd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

570 
ušt8_t
 
__ty³
, 
sockËn_t
 
__Ën
, ušt8_ˆ
__®ign
,

571 **
__d©abuå
è
__THROW
;

572 
	$š‘6_İt_fšish
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
)

573 
__THROW
;

574 
	$š‘6_İt_£t_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

575 
sockËn_t
 
__v®Ën
è
__THROW
;

576 
	$š‘6_İt_Ãxt
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

577 
ušt8_t
 *
__ty³p
, 
sockËn_t
 *
__ËÅ
,

578 **
__d©abuå
è
__THROW
;

579 
	$š‘6_İt_fšd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

580 
ušt8_t
 
__ty³
, 
sockËn_t
 *
__ËÅ
,

581 **
__d©abuå
è
__THROW
;

582 
	$š‘6_İt_g‘_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

583 
sockËn_t
 
__v®Ën
è
__THROW
;

587 
sockËn_t
 
	$š‘6_¹h_¥aû
 (
__ty³
, 
__£gm’ts
è
__THROW
;

588 *
	$š‘6_¹h_š™
 (*
__bp
, 
sockËn_t
 
__bp_Ën
, 
__ty³
,

589 
__£gm’ts
è
__THROW
;

590 
	$š‘6_¹h_add
 (*
__bp
, cÚ¡ 
š6_addr
 *
__addr
è
__THROW
;

591 
	$š‘6_¹h_»v”£
 (cÚ¡ *
__š
, *
__out
è
__THROW
;

592 
	$š‘6_¹h_£gm’ts
 (cÚ¡ *
__bp
è
__THROW
;

593 
š6_addr
 *
	$š‘6_¹h_g‘addr
 (cÚ¡ *
__bp
, 
__šdex
)

594 
__THROW
;

600 
	$g‘v4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

601 
š_addr
 
__group
, 
ušt32_t
 *
__fmode
,

602 
ušt32_t
 *
__num¤c
, 
š_addr
 *
__¦i¡
)

603 
__THROW
;

606 
	$£tv4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

607 
š_addr
 
__group
, 
ušt32_t
 
__fmode
,

608 
ušt32_t
 
__num¤c
,

609 cÚ¡ 
š_addr
 *
__¦i¡
)

610 
__THROW
;

614 
	$g‘sourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

615 cÚ¡ 
sockaddr
 *
__group
,

616 
sockËn_t
 
__grou¶’
, 
ušt32_t
 *
__fmode
,

617 
ušt32_t
 *
__num¤c
,

618 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

621 
	$£tsourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

622 cÚ¡ 
sockaddr
 *
__group
,

623 
sockËn_t
 
__grou¶’
, 
ušt32_t
 
__fmode
,

624 
ušt32_t
 
__num¤c
,

625 cÚ¡ 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

628 
__END_DECLS


	@/usr/include/netinet/tcp.h

32 #iâdeà
_NETINET_TCP_H


33 
	#_NETINET_TCP_H
 1

	)

35 
	~<ã©u»s.h
>

40 
	#TCP_NODELAY
 1

	)

41 
	#TCP_MAXSEG
 2

	)

42 
	#TCP_CORK
 3

	)

43 
	#TCP_KEEPIDLE
 4

	)

44 
	#TCP_KEEPINTVL
 5

	)

45 
	#TCP_KEEPCNT
 6

	)

46 
	#TCP_SYNCNT
 7

	)

47 
	#TCP_LINGER2
 8

	)

48 
	#TCP_DEFER_ACCEPT
 9

	)

49 
	#TCP_WINDOW_CLAMP
 10

	)

50 
	#TCP_INFO
 11

	)

51 
	#TCP_QUICKACK
 12

	)

52 
	#TCP_CONGESTION
 13

	)

53 
	#TCP_MD5SIG
 14

	)

54 
	#TCP_COOKIE_TRANSACTIONS
 15

	)

55 
	#TCP_THIN_LINEAR_TIMEOUTS
 16

	)

56 
	#TCP_THIN_DUPACK
 17

	)

57 
	#TCP_USER_TIMEOUT
 18

	)

58 
	#TCP_REPAIR
 19

	)

59 
	#TCP_REPAIR_QUEUE
 20

	)

60 
	#TCP_QUEUE_SEQ
 21

	)

61 
	#TCP_REPAIR_OPTIONS
 22

	)

62 
	#TCP_FASTOPEN
 23

	)

63 
	#TCP_TIMESTAMP
 24

	)

65 #ifdeà
__USE_MISC


66 
	~<sys/ty³s.h
>

67 
	~<sys/sock‘.h
>

69 
u_št32_t
 
	ttı_£q
;

74 
	stıhdr


76 
__ex‹nsiÚ__
 union

80 
u_št16_t
 
	mth_¥Üt
;

81 
u_št16_t
 
	mth_dpÜt
;

82 
tı_£q
 
	mth_£q
;

83 
tı_£q
 
	mth_ack
;

84 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


85 
u_št8_t
 
	mth_x2
:4;

86 
u_št8_t
 
	mth_off
:4;

88 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


89 
u_št8_t
 
	mth_off
:4;

90 
u_št8_t
 
	mth_x2
:4;

92 
u_št8_t
 
	mth_æags
;

93 
	#TH_FIN
 0x01

	)

94 
	#TH_SYN
 0x02

	)

95 
	#TH_RST
 0x04

	)

96 
	#TH_PUSH
 0x08

	)

97 
	#TH_ACK
 0x10

	)

98 
	#TH_URG
 0x20

	)

99 
u_št16_t
 
	mth_wš
;

100 
u_št16_t
 
	mth_sum
;

101 
u_št16_t
 
	mth_u½
;

105 
u_št16_t
 
	msourû
;

106 
u_št16_t
 
	mde¡
;

107 
u_št32_t
 
	m£q
;

108 
u_št32_t
 
	mack_£q
;

109 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


110 
u_št16_t
 
	m»s1
:4;

111 
u_št16_t
 
	mdoff
:4;

112 
u_št16_t
 
	mfš
:1;

113 
u_št16_t
 
	msyn
:1;

114 
u_št16_t
 
	mr¡
:1;

115 
u_št16_t
 
	mpsh
:1;

116 
u_št16_t
 
	mack
:1;

117 
u_št16_t
 
	murg
:1;

118 
u_št16_t
 
	m»s2
:2;

119 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


120 
u_št16_t
 
	mdoff
:4;

121 
u_št16_t
 
	m»s1
:4;

122 
u_št16_t
 
	m»s2
:2;

123 
u_št16_t
 
	murg
:1;

124 
u_št16_t
 
	mack
:1;

125 
u_št16_t
 
	mpsh
:1;

126 
u_št16_t
 
	mr¡
:1;

127 
u_št16_t
 
	msyn
:1;

128 
u_št16_t
 
	mfš
:1;

132 
u_št16_t
 
	mwšdow
;

133 
u_št16_t
 
	mcheck
;

134 
u_št16_t
 
	murg_±r
;

141 
	mTCP_ESTABLISHED
 = 1,

142 
	mTCP_SYN_SENT
,

143 
	mTCP_SYN_RECV
,

144 
	mTCP_FIN_WAIT1
,

145 
	mTCP_FIN_WAIT2
,

146 
	mTCP_TIME_WAIT
,

147 
	mTCP_CLOSE
,

148 
	mTCP_CLOSE_WAIT
,

149 
	mTCP_LAST_ACK
,

150 
	mTCP_LISTEN
,

151 
	mTCP_CLOSING


154 
	#TCPOPT_EOL
 0

	)

155 
	#TCPOPT_NOP
 1

	)

156 
	#TCPOPT_MAXSEG
 2

	)

157 
	#TCPOLEN_MAXSEG
 4

	)

158 
	#TCPOPT_WINDOW
 3

	)

159 
	#TCPOLEN_WINDOW
 3

	)

160 
	#TCPOPT_SACK_PERMITTED
 4

	)

161 
	#TCPOLEN_SACK_PERMITTED
 2

	)

162 
	#TCPOPT_SACK
 5

	)

163 
	#TCPOPT_TIMESTAMP
 8

	)

164 
	#TCPOLEN_TIMESTAMP
 10

	)

165 
	#TCPOLEN_TSTAMP_APPA
 (
TCPOLEN_TIMESTAMP
+2è

	)

167 
	#TCPOPT_TSTAMP_HDR
 \

168 (
TCPOPT_NOP
<<24|TCPOPT_NOP<<16|
TCPOPT_TIMESTAMP
<<8|
TCPOLEN_TIMESTAMP
)

	)

176 
	#TCP_MSS
 512

	)

178 
	#TCP_MAXWIN
 65535

	)

180 
	#TCP_MAX_WINSHIFT
 14

	)

182 
	#SOL_TCP
 6

	)

185 
	#TCPI_OPT_TIMESTAMPS
 1

	)

186 
	#TCPI_OPT_SACK
 2

	)

187 
	#TCPI_OPT_WSCALE
 4

	)

188 
	#TCPI_OPT_ECN
 8

	)

189 
	#TCPI_OPT_ECN_SEEN
 16

	)

190 
	#TCPI_OPT_SYN_DATA
 32

	)

193 
	etı_ÿ_¡©e


195 
	mTCP_CA_O³n
 = 0,

196 
	mTCP_CA_DisÜd”
 = 1,

197 
	mTCP_CA_CWR
 = 2,

198 
	mTCP_CA_Recov”y
 = 3,

199 
	mTCP_CA_Loss
 = 4

202 
	stı_šfo


204 
u_št8_t
 
	mtıi_¡©e
;

205 
u_št8_t
 
	mtıi_ÿ_¡©e
;

206 
u_št8_t
 
	mtıi_»Œªsm™s
;

207 
u_št8_t
 
	mtıi_´obes
;

208 
u_št8_t
 
	mtıi_backoff
;

209 
u_št8_t
 
	mtıi_İtiÚs
;

210 
u_št8_t
 
	mtıi_¢d_wsÿË
 : 4, 
	mtıi_rcv_wsÿË
 : 4;

212 
u_št32_t
 
	mtıi_¹o
;

213 
u_št32_t
 
	mtıi_©o
;

214 
u_št32_t
 
	mtıi_¢d_mss
;

215 
u_št32_t
 
	mtıi_rcv_mss
;

217 
u_št32_t
 
	mtıi_uÇcked
;

218 
u_št32_t
 
	mtıi_§cked
;

219 
u_št32_t
 
	mtıi_lo¡
;

220 
u_št32_t
 
	mtıi_»Œªs
;

221 
u_št32_t
 
	mtıi_çck‘s
;

224 
u_št32_t
 
	mtıi_Ï¡_d©a_£Á
;

225 
u_št32_t
 
	mtıi_Ï¡_ack_£Á
;

226 
u_št32_t
 
	mtıi_Ï¡_d©a_»cv
;

227 
u_št32_t
 
	mtıi_Ï¡_ack_»cv
;

230 
u_št32_t
 
	mtıi_pmtu
;

231 
u_št32_t
 
	mtıi_rcv_s¡h»sh
;

232 
u_št32_t
 
	mtıi_¹t
;

233 
u_št32_t
 
	mtıi_¹tv¬
;

234 
u_št32_t
 
	mtıi_¢d_s¡h»sh
;

235 
u_št32_t
 
	mtıi_¢d_cwnd
;

236 
u_št32_t
 
	mtıi_advmss
;

237 
u_št32_t
 
	mtıi_»Üd”šg
;

239 
u_št32_t
 
	mtıi_rcv_¹t
;

240 
u_št32_t
 
	mtıi_rcv_¥aû
;

242 
u_št32_t
 
	mtıi_tÙ®_»Œªs
;

247 
	#TCP_MD5SIG_MAXKEYLEN
 80

	)

249 
	stı_md5sig


251 
sockaddr_¡Üage
 
	mtım_addr
;

252 
u_št16_t
 
	m__tım_·d1
;

253 
u_št16_t
 
	mtım_keyËn
;

254 
u_št32_t
 
	m__tım_·d2
;

255 
u_št8_t
 
	mtım_key
[
TCP_MD5SIG_MAXKEYLEN
];

259 
	stı_»·œ_İt


261 
u_št32_t
 
	mİt_code
;

262 
u_št32_t
 
	mİt_v®
;

268 
	mTCP_NO_QUEUE
,

269 
	mTCP_RECV_QUEUE
,

270 
	mTCP_SEND_QUEUE
,

271 
	mTCP_QUEUES_NR
,

275 
	#TCP_COOKIE_MIN
 8

	)

276 
	#TCP_COOKIE_MAX
 16

	)

277 
	#TCP_COOKIE_PAIR_SIZE
 (2*
TCP_COOKIE_MAX
)

	)

280 
	#TCP_COOKIE_IN_ALWAYS
 (1 << 0è

	)

281 
	#TCP_COOKIE_OUT_NEVER
 (1 << 1è

	)

285 
	#TCP_S_DATA_IN
 (1 << 2è

	)

286 
	#TCP_S_DATA_OUT
 (1 << 3è

	)

288 
	#TCP_MSS_DEFAULT
 536U

	)

289 
	#TCP_MSS_DESIRED
 1220U

	)

291 
	stı_cook›_Œª§ùiÚs


293 
u_št16_t
 
	mtıù_æags
;

294 
u_št8_t
 
	m__tıù_·d1
;

295 
u_št8_t
 
	mtıù_cook›_desœed
;

296 
u_št16_t
 
	mtıù_s_d©a_desœed
;

297 
u_št16_t
 
	mtıù_u£d
;

298 
u_št8_t
 
	mtıù_v®ue
[
TCP_MSS_DEFAULT
];

	@/usr/include/poll.h

1 
	~<sys/pŞl.h
>

	@/usr/include/pthread.h

18 #iâdeà
_PTHREAD_H


19 
	#_PTHREAD_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<’dŸn.h
>

23 
	~<sched.h
>

24 
	~<time.h
>

26 
	~<b™s/±h»adty³s.h
>

27 
	~<b™s/£tjmp.h
>

28 
	~<b™s/wÜdsize.h
>

34 
	mPTHREAD_CREATE_JOINABLE
,

35 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

36 
	mPTHREAD_CREATE_DETACHED


37 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

44 
	mPTHREAD_MUTEX_TIMED_NP
,

45 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

46 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

47 
	mPTHREAD_MUTEX_ADAPTIVE_NP


48 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


50 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

51 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

52 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

53 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


55 #ifdeà
__USE_GNU


57 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


62 #ifdeà
__USE_XOPEN2K


66 
	mPTHREAD_MUTEX_STALLED
,

67 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

68 
	mPTHREAD_MUTEX_ROBUST
,

69 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


74 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


78 
	mPTHREAD_PRIO_NONE
,

79 
	mPTHREAD_PRIO_INHERIT
,

80 
	mPTHREAD_PRIO_PROTECT


86 #ià
__PTHREAD_MUTEX_HAVE_ELISION
 == 1

87 
	#__PTHREAD_SPINS
 0, 0

	)

88 #–ià
__PTHREAD_MUTEX_HAVE_ELISION
 == 2

89 
	#__PTHREAD_SPINS
 { 0, 0 }

	)

91 
	#__PTHREAD_SPINS
 0

	)

94 #ifdeà
__PTHREAD_MUTEX_HAVE_PREV


95 
	#PTHREAD_MUTEX_INITIALIZER
 \

96 { { 0, 0, 0, 0, 0, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

97 #ifdeà
__USE_GNU


98 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

99 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

100 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

101 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

102 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

103 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

104 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

105 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

109 
	#PTHREAD_MUTEX_INITIALIZER
 \

110 { { 0, 0, 0, 0, 0, { 
__PTHREAD_SPINS
 } } }

	)

111 #ifdeà
__USE_GNU


112 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

113 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

114 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

115 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

116 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

117 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

124 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


127 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

128 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

129 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

130 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


136 #iâdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


137 #ià
__WORDSIZE
 == 64

138 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

143 
	#PTHREAD_RWLOCK_INITIALIZER
 \

144 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 } }

	)

145 #ifdeà
__USE_GNU


146 #ifdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


147 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

149 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

151 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


152 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

153 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

154 0, 0, 0, 0 } }

	)

156 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

157 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

158 0 } }

	)

168 
	mPTHREAD_INHERIT_SCHED
,

169 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

170 
	mPTHREAD_EXPLICIT_SCHED


171 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

178 
	mPTHREAD_SCOPE_SYSTEM
,

179 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

180 
	mPTHREAD_SCOPE_PROCESS


181 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

188 
	mPTHREAD_PROCESS_PRIVATE
,

189 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

190 
	mPTHREAD_PROCESS_SHARED


191 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

197 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*è0, 0, 0 } }

	)

201 
	s_±h»ad_ş—nup_bufãr


203 (*
	m__routše
) (*);

204 *
	m__¬g
;

205 
	m__ÿnûÉy³
;

206 
_±h»ad_ş—nup_bufãr
 *
	m__´ev
;

212 
	mPTHREAD_CANCEL_ENABLE
,

213 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

214 
	mPTHREAD_CANCEL_DISABLE


215 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

219 
	mPTHREAD_CANCEL_DEFERRED
,

220 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

221 
	mPTHREAD_CANCEL_ASYNCHRONOUS


222 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

224 
	#PTHREAD_CANCELED
 ((*è-1)

	)

228 
	#PTHREAD_ONCE_INIT
 0

	)

231 #ifdeà
__USE_XOPEN2K


235 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

239 
__BEGIN_DECLS


244 
±h»ad_ü—‹
 (
±h»ad_t
 *
__»¡riù
 
__Ãwth»ad
,

245 cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

246 *(*
__¡¬t_routše
) (*),

247 *
__»¡riù
 
__¬g
è
__THROWNL
 
__nÚnuÎ
 ((1, 3));

253 
	$±h»ad_ex™
 (*
__»tv®
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

261 
	`±h»ad_još
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
);

263 #ifdeà
__USE_GNU


266 
	$±h»ad_Œyjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
è
__THROW
;

274 
	`±h»ad_timedjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
,

275 cÚ¡ 
time¥ec
 *
__ab¡ime
);

282 
	$±h»ad_d‘ach
 (
±h»ad_t
 
__th
è
__THROW
;

286 
±h»ad_t
 
	$±h»ad_£lf
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

289 
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
)

290 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

298 
	$±h»ad_©Œ_š™
 (
±h»ad_©Œ_t
 *
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

301 
	$±h»ad_©Œ_de¡roy
 (
±h»ad_©Œ_t
 *
__©Œ
)

302 
__THROW
 
	`__nÚnuÎ
 ((1));

305 
	$±h»ad_©Œ_g‘d‘ach¡©e
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

306 *
__d‘ach¡©e
)

307 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

310 
	$±h»ad_©Œ_£td‘ach¡©e
 (
±h»ad_©Œ_t
 *
__©Œ
,

311 
__d‘ach¡©e
)

312 
__THROW
 
	`__nÚnuÎ
 ((1));

316 
	$±h»ad_©Œ_g‘gu¬dsize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

317 
size_t
 *
__gu¬dsize
)

318 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

321 
	$±h»ad_©Œ_£tgu¬dsize
 (
±h»ad_©Œ_t
 *
__©Œ
,

322 
size_t
 
__gu¬dsize
)

323 
__THROW
 
	`__nÚnuÎ
 ((1));

327 
	$±h»ad_©Œ_g‘sched·¿m
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

328 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

329 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

332 
	$±h»ad_©Œ_£tsched·¿m
 (
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

333 cÚ¡ 
sched_·¿m
 *
__»¡riù


334 
__·¿m
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

337 
	$±h»ad_©Œ_g‘schedpŞicy
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


338 
__©Œ
, *
__»¡riù
 
__pŞicy
)

339 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

342 
	$±h»ad_©Œ_£tschedpŞicy
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__pŞicy
)

343 
__THROW
 
	`__nÚnuÎ
 ((1));

346 
	$±h»ad_©Œ_g‘šh”™sched
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


347 
__©Œ
, *
__»¡riù
 
__šh”™
)

348 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

351 
	$±h»ad_©Œ_£tšh”™sched
 (
±h»ad_©Œ_t
 *
__©Œ
,

352 
__šh”™
)

353 
__THROW
 
	`__nÚnuÎ
 ((1));

357 
	$±h»ad_©Œ_g‘scİe
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

358 *
__»¡riù
 
__scİe
)

359 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

362 
	$±h»ad_©Œ_£tscİe
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__scİe
)

363 
__THROW
 
	`__nÚnuÎ
 ((1));

366 
	$±h»ad_©Œ_g‘¡ackaddr
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


367 
__©Œ
, **
__»¡riù
 
__¡ackaddr
)

368 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__©Œibu‹_d•»ÿ‹d__
;

374 
	$±h»ad_©Œ_£t¡ackaddr
 (
±h»ad_©Œ_t
 *
__©Œ
,

375 *
__¡ackaddr
)

376 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
;

379 
	$±h»ad_©Œ_g‘¡acksize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


380 
__©Œ
, 
size_t
 *
__»¡riù
 
__¡acksize
)

381 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

386 
	$±h»ad_©Œ_£t¡acksize
 (
±h»ad_©Œ_t
 *
__©Œ
,

387 
size_t
 
__¡acksize
)

388 
__THROW
 
	`__nÚnuÎ
 ((1));

390 #ifdeà
__USE_XOPEN2K


392 
	$±h»ad_©Œ_g‘¡ack
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

393 **
__»¡riù
 
__¡ackaddr
,

394 
size_t
 *
__»¡riù
 
__¡acksize
)

395 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

400 
	$±h»ad_©Œ_£t¡ack
 (
±h»ad_©Œ_t
 *
__©Œ
, *
__¡ackaddr
,

401 
size_t
 
__¡acksize
è
__THROW
 
	`__nÚnuÎ
 ((1));

404 #ifdeà
__USE_GNU


407 
	$±h»ad_©Œ_£ffš™y_Å
 (
±h»ad_©Œ_t
 *
__©Œ
,

408 
size_t
 
__ıu£tsize
,

409 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

410 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

414 
	$±h»ad_©Œ_g‘affš™y_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

415 
size_t
 
__ıu£tsize
,

416 
ıu_£t_t
 *
__ıu£t
)

417 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

420 
	$±h»ad_g‘©Œ_deçuÉ_Å
 (
±h»ad_©Œ_t
 *
__©Œ
)

421 
__THROW
 
	`__nÚnuÎ
 ((1));

425 
	$±h»ad_£‰r_deçuÉ_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
)

426 
__THROW
 
	`__nÚnuÎ
 ((1));

431 
	$±h»ad_g‘©Œ_Å
 (
±h»ad_t
 
__th
, 
±h»ad_©Œ_t
 *
__©Œ
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

440 
	$±h»ad_£tsched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
, 
__pŞicy
,

441 cÚ¡ 
sched_·¿m
 *
__·¿m
)

442 
__THROW
 
	`__nÚnuÎ
 ((3));

445 
	$±h»ad_g‘sched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
,

446 *
__»¡riù
 
__pŞicy
,

447 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

448 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

451 
	$±h»ad_£tsched´io
 (
±h»ad_t
 
__rg‘_th»ad
, 
__´io
)

452 
__THROW
;

455 #ifdeà
__USE_GNU


457 
	$±h»ad_g‘Çme_Å
 (
±h»ad_t
 
__rg‘_th»ad
, *
__buf
,

458 
size_t
 
__buæ’
)

459 
__THROW
 
	`__nÚnuÎ
 ((2));

462 
	$±h»ad_£Šame_Å
 (
±h»ad_t
 
__rg‘_th»ad
, cÚ¡ *
__Çme
)

463 
__THROW
 
	`__nÚnuÎ
 ((2));

467 #ifdeà
__USE_UNIX98


469 
	$±h»ad_g‘cÚcu¼’cy
 (è
__THROW
;

472 
	$±h»ad_£tcÚcu¼’cy
 (
__Ëv–
è
__THROW
;

475 #ifdeà
__USE_GNU


480 
	$±h»ad_y›ld
 (è
__THROW
;

485 
	$±h»ad_£ffš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

486 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

487 
__THROW
 
	`__nÚnuÎ
 ((3));

490 
	$±h»ad_g‘affš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

491 
ıu_£t_t
 *
__ıu£t
)

492 
__THROW
 
	`__nÚnuÎ
 ((3));

505 
	`±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

506 (*
__š™_routše
è()è
	`__nÚnuÎ
 ((1, 2));

517 
	`±h»ad_£tÿnûl¡©e
 (
__¡©e
, *
__Şd¡©e
);

521 
	`±h»ad_£tÿnûÉy³
 (
__ty³
, *
__Şdty³
);

524 
	`±h»ad_ÿnûl
 (
±h»ad_t
 
__th
);

529 
	`±h»ad_‹¡ÿnûl
 ();

538 
__jmp_buf
 
__ÿnûl_jmp_buf
;

539 
__mask_was_§ved
;

540 } 
__ÿnûl_jmp_buf
[1];

541 *
__·d
[4];

542 } 
	t__±h»ad_unwšd_buf_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
));

545 #iâdeà
__ş—nup_fù_©Œibu‹


546 
	#__ş—nup_fù_©Œibu‹


	)

551 
	s__±h»ad_ş—nup_äame


553 (*
__ÿnûl_routše
) (*);

554 *
__ÿnûl_¬g
;

555 
__do_™
;

556 
__ÿnûl_ty³
;

559 #ià
defšed
 
__GNUC__
 && defšed 
__EXCEPTIONS


560 #ifdeà
__ılu¥lus


562 şas 
	c__±h»ad_ş—nup_şass


564 (*
__ÿnûl_routše
) (*);

565 *
__ÿnûl_¬g
;

566 
__do_™
;

567 
__ÿnûl_ty³
;

569 
public
:

570 
	`__±h»ad_ş—nup_şass
 ((*
__fù
è(*), *
__¬g
)

571 : 
	`__ÿnûl_routše
 (
__fù
), 
	`__ÿnûl_¬g
 (
__¬g
), 
	$__do_™
 (1) { }

572 ~
	$__±h»ad_ş—nup_şass
 (è{ ià(
__do_™
è
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); 
	}
}

573 
	$__£tdo™
 (
__Ãwv®
è{ 
__do_™
 = __Ãwv®; 
	}
}

574 
	$__deãr
 (è{ 
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
,

575 &
__ÿnûl_ty³
); 
	}
}

576 
	$__»¡Üe
 (ècÚ¡ { 
	`±h»ad_£tÿnûÉy³
 (
__ÿnûl_ty³
, 0); 
	}
}

586 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

588 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
)

	)

592 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

593 
__şäame
.
	`__£tdo™
 (
execu‹
); \

594 } 0)

	)

596 #ifdeà
__USE_GNU


600 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

602 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
); \

603 
__şäame
.
	`__deãr
 ()

	)

608 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

609 
__şäame
.
	`__»¡Üe
 (); \

610 
__şäame
.
	`__£tdo™
 (
execu‹
); \

611 } 0)

	)

618 
__ex‹º_šlše
 

619 
	$__±h»ad_ş—nup_routše
 (
__±h»ad_ş—nup_äame
 *
__äame
)

621 ià(
__äame
->
__do_™
)

622 
__äame
->
	`__ÿnûl_routše
 (__äame->
__ÿnûl_¬g
);

623 
	}
}

632 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

634 
__±h»ad_ş—nup_äame
 
__şäame
 \

635 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

636 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

637 .
__do_™
 = 1 };

	)

641 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

642 
__şäame
.
__do_™
 = (
execu‹
); \

643 } 0)

	)

645 #ifdeà
__USE_GNU


649 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

651 
__±h»ad_ş—nup_äame
 
__şäame
 \

652 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

653 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

654 .
__do_™
 = 1 }; \

655 (è
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
, \

656 &
__şäame
.
__ÿnûl_ty³
)

	)

661 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

662 (è
	`±h»ad_£tÿnûÉy³
 (
__şäame
.
__ÿnûl_ty³
, 
NULL
); \

663 
__şäame
.
__do_™
 = (
execu‹
); \

664 } 0)

	)

675 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

677 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

678 (*
__ÿnûl_routše
è(*èğ(
routše
); \

679 *
__ÿnûl_¬g
 = (
¬g
); \

680 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

681 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

682 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

684 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

685 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

689 
	`__±h»ad_»gi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

690 dØ{

	)

691 
__±h»ad_»gi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

692 
__ş—nup_fù_©Œibu‹
;

696 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

699 
	`__±h»ad_uÄegi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

700 ià(
execu‹
) \

701 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

702 } 0)

	)

703 
	$__±h»ad_uÄegi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

704 
__ş—nup_fù_©Œibu‹
;

706 #ifdeà
__USE_GNU


710 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

712 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

713 (*
__ÿnûl_routše
è(*èğ(
routše
); \

714 *
__ÿnûl_¬g
 = (
¬g
); \

715 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

716 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

717 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

719 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

720 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

724 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (&
__ÿnûl_buf
); \

725 dØ{

	)

726 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

727 
__ş—nup_fù_©Œibu‹
;

732 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

735 
	`__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (&
__ÿnûl_buf
); \

736 ià(
execu‹
) \

737 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

738 
	}
} 0)

	)

739 
	$__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

740 
__ş—nup_fù_©Œibu‹
;

744 
	$__±h»ad_unwšd_Ãxt
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

745 
__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

746 #iâdeà
SHARED


747 
	`__©Œibu‹__
 ((
__w—k__
))

753 
__jmp_buf_g
;

754 
	$__sig£tjmp
 (
__jmp_buf_g
 *
__’v
, 
__§vemask
è
__THROWNL
;

760 
	$±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

761 cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__mu‹x©Œ
)

762 
__THROW
 
	`__nÚnuÎ
 ((1));

765 
	$±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

766 
__THROW
 
	`__nÚnuÎ
 ((1));

769 
	$±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

770 
__THROWNL
 
	`__nÚnuÎ
 ((1));

773 
	$±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

774 
__THROWNL
 
	`__nÚnuÎ
 ((1));

776 #ifdeà
__USE_XOPEN2K


778 
	$±h»ad_mu‹x_timedlock
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

779 cÚ¡ 
time¥ec
 *
__»¡riù


780 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

784 
	$±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

785 
__THROWNL
 
	`__nÚnuÎ
 ((1));

789 
	$±h»ad_mu‹x_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x_t
 *

790 
__»¡riù
 
__mu‹x
,

791 *
__»¡riù
 
__´ioûšg
)

792 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

796 
	$±h»ad_mu‹x_£rioûšg
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

797 
__´ioûšg
,

798 *
__»¡riù
 
__Şd_ûšg
)

799 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

802 #ifdeà
__USE_XOPEN2K8


804 
	$±h»ad_mu‹x_cÚsi¡’t
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

805 
__THROW
 
	`__nÚnuÎ
 ((1));

806 #ifdeà
__USE_GNU


807 
	$±h»ad_mu‹x_cÚsi¡’t_Å
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

808 
__THROW
 
	`__nÚnuÎ
 ((1));

817 
	$±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

818 
__THROW
 
	`__nÚnuÎ
 ((1));

821 
	$±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

822 
__THROW
 
	`__nÚnuÎ
 ((1));

825 
	$±h»ad_mu‹x©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

826 
__»¡riù
 
__©Œ
,

827 *
__»¡riù
 
__psh¬ed
)

828 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

831 
	$±h»ad_mu‹x©Œ_£sh¬ed
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

832 
__psh¬ed
)

833 
__THROW
 
	`__nÚnuÎ
 ((1));

835 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


837 
	$±h»ad_mu‹x©Œ_g‘ty³
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__»¡riù


838 
__©Œ
, *
__»¡riù
 
__kšd
)

839 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

844 
	$±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
, 
__kšd
)

845 
__THROW
 
	`__nÚnuÎ
 ((1));

849 
	$±h»ad_mu‹x©Œ_g‘´ÙocŞ
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

850 
__»¡riù
 
__©Œ
,

851 *
__»¡riù
 
__´ÙocŞ
)

852 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

856 
	$±h»ad_mu‹x©Œ_£rÙocŞ
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

857 
__´ÙocŞ
)

858 
__THROW
 
	`__nÚnuÎ
 ((1));

861 
	$±h»ad_mu‹x©Œ_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

862 
__»¡riù
 
__©Œ
,

863 *
__»¡riù
 
__´ioûšg
)

864 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

867 
	$±h»ad_mu‹x©Œ_£rioûšg
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

868 
__´ioûšg
)

869 
__THROW
 
	`__nÚnuÎ
 ((1));

871 #ifdeà
__USE_XOPEN2K


873 
	$±h»ad_mu‹x©Œ_g‘robu¡
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

874 *
__robu¡Ãss
)

875 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

876 #ifdeà
__USE_GNU


877 
	$±h»ad_mu‹x©Œ_g‘robu¡_Å
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

878 *
__robu¡Ãss
)

879 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

883 
	$±h»ad_mu‹x©Œ_£Œobu¡
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

884 
__robu¡Ãss
)

885 
__THROW
 
	`__nÚnuÎ
 ((1));

886 #ifdeà
__USE_GNU


887 
	$±h»ad_mu‹x©Œ_£Œobu¡_Å
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

888 
__robu¡Ãss
)

889 
__THROW
 
	`__nÚnuÎ
 ((1));

894 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


899 
	$±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

900 cÚ¡ 
±h»ad_rwlock©Œ_t
 *
__»¡riù


901 
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

904 
	$±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
)

905 
__THROW
 
	`__nÚnuÎ
 ((1));

908 
	$±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

909 
__THROWNL
 
	`__nÚnuÎ
 ((1));

912 
	$±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

913 
__THROWNL
 
	`__nÚnuÎ
 ((1));

915 #ifdeà
__USE_XOPEN2K


917 
	$±h»ad_rwlock_timedrdlock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

918 cÚ¡ 
time¥ec
 *
__»¡riù


919 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

923 
	$±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

924 
__THROWNL
 
	`__nÚnuÎ
 ((1));

927 
	$±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

928 
__THROWNL
 
	`__nÚnuÎ
 ((1));

930 #ifdeà
__USE_XOPEN2K


932 
	$±h»ad_rwlock_timedw¾ock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

933 cÚ¡ 
time¥ec
 *
__»¡riù


934 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

938 
	$±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
)

939 
__THROWNL
 
	`__nÚnuÎ
 ((1));

945 
	$±h»ad_rwlock©Œ_š™
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

946 
__THROW
 
	`__nÚnuÎ
 ((1));

949 
	$±h»ad_rwlock©Œ_de¡roy
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

950 
__THROW
 
	`__nÚnuÎ
 ((1));

953 
	$±h»ad_rwlock©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

954 
__»¡riù
 
__©Œ
,

955 *
__»¡riù
 
__psh¬ed
)

956 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

959 
	$±h»ad_rwlock©Œ_£sh¬ed
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

960 
__psh¬ed
)

961 
__THROW
 
	`__nÚnuÎ
 ((1));

964 
	$±h»ad_rwlock©Œ_g‘kšd_Å
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

965 
__»¡riù
 
__©Œ
,

966 *
__»¡riù
 
__´ef
)

967 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

970 
	$±h»ad_rwlock©Œ_£tkšd_Å
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

971 
__´ef
è
__THROW
 
	`__nÚnuÎ
 ((1));

979 
	$±h»ad_cÚd_š™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

980 cÚ¡ 
±h»ad_cÚd©Œ_t
 *
__»¡riù
 
__cÚd_©Œ
)

981 
__THROW
 
	`__nÚnuÎ
 ((1));

984 
	$±h»ad_cÚd_de¡roy
 (
±h»ad_cÚd_t
 *
__cÚd
)

985 
__THROW
 
	`__nÚnuÎ
 ((1));

988 
	$±h»ad_cÚd_sigÇl
 (
±h»ad_cÚd_t
 *
__cÚd
)

989 
__THROWNL
 
	`__nÚnuÎ
 ((1));

992 
	$±h»ad_cÚd_brßdÿ¡
 (
±h»ad_cÚd_t
 *
__cÚd
)

993 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1000 
	$±h»ad_cÚd_wa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

1001 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
)

1002 
	`__nÚnuÎ
 ((1, 2));

1011 
	$±h»ad_cÚd_timedwa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

1012 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

1013 cÚ¡ 
time¥ec
 *
__»¡riù
 
__ab¡ime
)

1014 
	`__nÚnuÎ
 ((1, 2, 3));

1019 
	$±h»ad_cÚd©Œ_š™
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1020 
__THROW
 
	`__nÚnuÎ
 ((1));

1023 
	$±h»ad_cÚd©Œ_de¡roy
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1024 
__THROW
 
	`__nÚnuÎ
 ((1));

1027 
	$±h»ad_cÚd©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1028 
__»¡riù
 
__©Œ
,

1029 *
__»¡riù
 
__psh¬ed
)

1030 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1033 
	$±h»ad_cÚd©Œ_£sh¬ed
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1034 
__psh¬ed
è
__THROW
 
	`__nÚnuÎ
 ((1));

1036 #ifdeà
__USE_XOPEN2K


1038 
	$±h»ad_cÚd©Œ_g‘şock
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1039 
__»¡riù
 
__©Œ
,

1040 
__şockid_t
 *
__»¡riù
 
__şock_id
)

1041 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1044 
	$±h»ad_cÚd©Œ_£tşock
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1045 
__şockid_t
 
__şock_id
)

1046 
__THROW
 
	`__nÚnuÎ
 ((1));

1050 #ifdeà
__USE_XOPEN2K


1055 
	$±h»ad_¥š_š™
 (
±h»ad_¥šlock_t
 *
__lock
, 
__psh¬ed
)

1056 
__THROW
 
	`__nÚnuÎ
 ((1));

1059 
	$±h»ad_¥š_de¡roy
 (
±h»ad_¥šlock_t
 *
__lock
)

1060 
__THROW
 
	`__nÚnuÎ
 ((1));

1063 
	$±h»ad_¥š_lock
 (
±h»ad_¥šlock_t
 *
__lock
)

1064 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1067 
	$±h»ad_¥š_Œylock
 (
±h»ad_¥šlock_t
 *
__lock
)

1068 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1071 
	$±h»ad_¥š_uÆock
 (
±h»ad_¥šlock_t
 *
__lock
)

1072 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1079 
	$±h»ad_b¬r›r_š™
 (
±h»ad_b¬r›r_t
 *
__»¡riù
 
__b¬r›r
,

1080 cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *
__»¡riù


1081 
__©Œ
, 
__couÁ
)

1082 
__THROW
 
	`__nÚnuÎ
 ((1));

1085 
	$±h»ad_b¬r›r_de¡roy
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1086 
__THROW
 
	`__nÚnuÎ
 ((1));

1089 
	$±h»ad_b¬r›r_wa™
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1090 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1094 
	$±h»ad_b¬r›¿‰r_š™
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1095 
__THROW
 
	`__nÚnuÎ
 ((1));

1098 
	$±h»ad_b¬r›¿‰r_de¡roy
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1099 
__THROW
 
	`__nÚnuÎ
 ((1));

1102 
	$±h»ad_b¬r›¿‰r_g‘psh¬ed
 (cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *

1103 
__»¡riù
 
__©Œ
,

1104 *
__»¡riù
 
__psh¬ed
)

1105 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1108 
	$±h»ad_b¬r›¿‰r_£sh¬ed
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
,

1109 
__psh¬ed
)

1110 
__THROW
 
	`__nÚnuÎ
 ((1));

1122 
	`±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

1123 (*
__de¡r_funùiÚ
) (*))

1124 
__THROW
 
	`__nÚnuÎ
 ((1));

1127 
	$±h»ad_key_d–‘e
 (
±h»ad_key_t
 
__key
è
__THROW
;

1130 *
	$±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
è
__THROW
;

1133 
	$±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

1134 cÚ¡ *
__poš‹r
è
__THROW
 ;

1137 #ifdeà
__USE_XOPEN2K


1139 
	$±h»ad_g‘ıuşockid
 (
±h»ad_t
 
__th»ad_id
,

1140 
__şockid_t
 *
__şock_id
)

1141 
__THROW
 
	`__nÚnuÎ
 ((2));

1156 
	`±h»ad_©fÜk
 ((*
__´•¬e
) (),

1157 (*
__·»Á
) (),

1158 (*
__chd
è()è
__THROW
;

1161 #ifdeà
__USE_EXTERN_INLINES


1163 
__ex‹º_šlše
 

1164 
	`__NTH
 (
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
))

1166  
__th»ad1
 =ğ
__th»ad2
;

1167 
	}
}

1170 
	g__END_DECLS


	@/usr/include/sched.h

19 #iâdef 
_SCHED_H


20 
	#_SCHED_H
 1

	)

22 
	~<ã©u»s.h
>

25 
	~<b™s/ty³s.h
>

27 
	#__Ãed_size_t


	)

28 
	~<¡ddef.h
>

30 
	#__Ãed_time_t


	)

31 
	#__Ãed_time¥ec


	)

32 
	~<time.h
>

34 #iâdeà
__pid_t_defšed


35 
__pid_t
 
	tpid_t
;

36 
	#__pid_t_defšed


	)

41 
	~<b™s/sched.h
>

43 
	#sched_´iÜ™y
 
__sched_´iÜ™y


	)

46 
__BEGIN_DECLS


49 
	$sched_£¬am
 (
__pid_t
 
__pid
, cÚ¡ 
sched_·¿m
 *
__·¿m
)

50 
__THROW
;

53 
	$sched_g‘·¿m
 (
__pid_t
 
__pid
, 
sched_·¿m
 *
__·¿m
è
__THROW
;

56 
	$sched_£tscheduËr
 (
__pid_t
 
__pid
, 
__pŞicy
,

57 cÚ¡ 
sched_·¿m
 *
__·¿m
è
__THROW
;

60 
	$sched_g‘scheduËr
 (
__pid_t
 
__pid
è
__THROW
;

63 
	$sched_y›ld
 (è
__THROW
;

66 
	$sched_g‘_´iÜ™y_max
 (
__®gÜ™hm
è
__THROW
;

69 
	$sched_g‘_´iÜ™y_mš
 (
__®gÜ™hm
è
__THROW
;

72 
	$sched_¼_g‘_š‹rv®
 (
__pid_t
 
__pid
, 
time¥ec
 *
__t
è
__THROW
;

75 #ifdeà
__USE_GNU


77 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

78 
	#CPU_SET
(
ıu
, 
ıu£
è
	`__CPU_SET_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

79 
	#CPU_CLR
(
ıu
, 
ıu£
è
	`__CPU_CLR_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

80 
	#CPU_ISSET
(
ıu
, 
ıu£
è
	`__CPU_ISSET_S
 (ıu,  (
ıu_£t_t
), \

81 
ıu£
)

	)

82 
	#CPU_ZERO
(
ıu£
è
	`__CPU_ZERO_S
 ( (
ıu_£t_t
), cpu£)

	)

83 
	#CPU_COUNT
(
ıu£
è
	`__CPU_COUNT_S
 ( (
ıu_£t_t
), cpu£)

	)

85 
	#CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_SET_S
 (ıu, s‘size, cpu£)

	)

86 
	#CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_CLR_S
 (ıu, s‘size, cpu£)

	)

87 
	#CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_ISSET_S
 (cpu, setsize, \

88 
ıu£
)

	)

89 
	#CPU_ZERO_S
(
£tsize
, 
ıu£
è
	`__CPU_ZERO_S
 (£tsize, cpu£)

	)

90 
	#CPU_COUNT_S
(
£tsize
, 
ıu£
è
	`__CPU_COUNT_S
 (£tsize, cpu£)

	)

92 
	#CPU_EQUAL
(
ıu£1
, 
ıu£2
) \

93 
	`__CPU_EQUAL_S
 ( (
ıu_£t_t
), 
ıu£1
, 
ıu£2
)

	)

94 
	#CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

95 
	`__CPU_EQUAL_S
 (
£tsize
, 
ıu£1
, 
ıu£2
)

	)

97 
	#CPU_AND
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

98 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

99 
	#CPU_OR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

100 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

101 
	#CPU_XOR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

102 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

103 
	#CPU_AND_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

104 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

105 
	#CPU_OR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

107 
	#CPU_XOR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

110 
	#CPU_ALLOC_SIZE
(
couÁ
è
	`__CPU_ALLOC_SIZE
 (couÁ)

	)

111 
	#CPU_ALLOC
(
couÁ
è
	`__CPU_ALLOC
 (couÁ)

	)

112 
	#CPU_FREE
(
ıu£t
è
	`__CPU_FREE
 (ıu£t)

	)

116 
	$sched_£ffš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

117 cÚ¡ 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

120 
	$sched_g‘affš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

121 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

124 
__END_DECLS


	@/usr/include/signal.h

22 #iâdef 
_SIGNAL_H


24 #ià!
defšed
 
__Ãed_sig_©omic_t
 && !defšed 
__Ãed_sig£t_t


25 
	#_SIGNAL_H


	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


32 
	~<b™s/sig£t.h
>

36 #ià
defšed
 
__Ãed_sig_©omic_t
 || defšed 
_SIGNAL_H


37 #iâdeà
__sig_©omic_t_defšed


38 
	#__sig_©omic_t_defšed


	)

39 
__BEGIN_NAMESPACE_STD


40 
__sig_©omic_t
 
	tsig_©omic_t
;

41 
	g__END_NAMESPACE_STD


43 #undeà
__Ãed_sig_©omic_t


46 #ià
defšed
 
__Ãed_sig£t_t
 || (defšed 
_SIGNAL_H
 && defšed 
__USE_POSIX
)

47 #iâdeà
__sig£t_t_defšed


48 
	#__sig£t_t_defšed


	)

49 
__sig£t_t
 
	tsig£t_t
;

51 #undeà
__Ãed_sig£t_t


54 #ifdeà
_SIGNAL_H


56 
	~<b™s/ty³s.h
>

57 
	~<b™s/signum.h
>

59 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


60 #iâdeà
__pid_t_defšed


61 
__pid_t
 
	tpid_t
;

62 
	#__pid_t_defšed


	)

64 #ifdeà
__USE_XOPEN


66 #iâdeà
__uid_t_defšed


67 
__uid_t
 
	tuid_t
;

68 
	#__uid_t_defšed


	)

72 #ifdeà
__USE_POSIX199309


74 
	#__Ãed_time¥ec


	)

75 
	~<time.h
>

78 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_XOPEN_EXTENDED


80 
	~<b™s/sigšfo.h
>

85 (*
	t__sighªdËr_t
) ();

90 
__sighªdËr_t
 
	$__sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

91 
__THROW
;

92 #ifdeà
__USE_GNU


93 
__sighªdËr_t
 
	$sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

94 
__THROW
;

100 
__BEGIN_NAMESPACE_STD


101 #ifdeà
__USE_BSD


102 
__sighªdËr_t
 
	$sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

103 
__THROW
;

106 #ifdeà
__REDIRECT_NTH


107 
__sighªdËr_t
 
	`__REDIRECT_NTH
 (
sigÇl
,

108 (
__sig
, 
__sighªdËr_t
 
__hªdËr
),

109 
__sysv_sigÇl
);

111 
	#sigÇl
 
__sysv_sigÇl


	)

114 
__END_NAMESPACE_STD


116 #ifdeà
__USE_XOPEN


119 
__sighªdËr_t
 
	$bsd_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

120 
__THROW
;

126 #ifdeà
__USE_POSIX


127 
	$kl
 (
__pid_t
 
__pid
, 
__sig
è
__THROW
;

130 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


134 
	$kÍg
 (
__pid_t
 
__pg½
, 
__sig
è
__THROW
;

137 
__BEGIN_NAMESPACE_STD


139 
	$¿i£
 (
__sig
è
__THROW
;

140 
__END_NAMESPACE_STD


142 #ifdeà
__USE_SVID


144 
__sighªdËr_t
 
	$ssigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

145 
__THROW
;

146 
	$gsigÇl
 (
__sig
è
__THROW
;

149 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN2K


151 
	`psigÇl
 (
__sig
, cÚ¡ *
__s
);

154 #ifdeà
__USE_XOPEN2K


156 
	`psigšfo
 (cÚ¡ 
sigšfo_t
 *
__pšfo
, cÚ¡ *
__s
);

167 
	`__sig·u£
 (
__sig_Ü_mask
, 
__is_sig
);

169 #ifdeà
__USE_XOPEN


170 #ifdeà
__GNUC__


171 
	$sig·u£
 (
__sig
è
	`__asm__
 ("__xpg_sigpause");

174 
	#sig·u£
(
sig
è
	`__sig·u£
 ((sig), 1)

	)

179 #ifdeà
__USE_BSD


186 
	#sigmask
(
sig
è
	`__sigmask
(sig)

	)

189 
	$sigblock
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

192 
	$sig£tmask
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

195 
	$sigg‘mask
 (è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

199 #ifdeà
__USE_MISC


200 
	#NSIG
 
_NSIG


	)

203 #ifdeà
__USE_GNU


204 
__sighªdËr_t
 
	tsighªdËr_t
;

208 #ifdeà
__USE_BSD


209 
__sighªdËr_t
 
	tsig_t
;

212 #ifdeà
__USE_POSIX


215 
	$sigem±y£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

218 
	$sigfl£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

221 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

224 
	$sigd–£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

227 
	$sigismemb”
 (cÚ¡ 
sig£t_t
 *
__£t
, 
__signo
)

228 
__THROW
 
	`__nÚnuÎ
 ((1));

230 #ifdeà
__USE_GNU


232 
	$sigi£m±y£t
 (cÚ¡ 
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

235 
	$sigªd£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

236 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

239 
	$sigÜ£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

240 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

245 
	~<b™s/sigaùiÚ.h
>

248 
	$sig´ocmask
 (
__how
, cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

249 
sig£t_t
 *
__»¡riù
 
__o£t
è
__THROW
;

256 
	$sigsu¥’d
 (cÚ¡ 
sig£t_t
 *
__£t
è
	`__nÚnuÎ
 ((1));

259 
	$sigaùiÚ
 (
__sig
, cÚ¡ 
sigaùiÚ
 *
__»¡riù
 
__aù
,

260 
sigaùiÚ
 *
__»¡riù
 
__ßù
è
__THROW
;

263 
	$sig³ndšg
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

270 
	$sigwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
, *__»¡riù 
__sig
)

271 
	`__nÚnuÎ
 ((1, 2));

273 #ifdeà
__USE_POSIX199309


278 
	$sigwa™šfo
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

279 
sigšfo_t
 *
__»¡riù
 
__šfo
è
	`__nÚnuÎ
 ((1));

286 
	$sigtimedwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

287 
sigšfo_t
 *
__»¡riù
 
__šfo
,

288 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
)

289 
	`__nÚnuÎ
 ((1));

293 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, cÚ¡ 
sigv®
 
__v®
)

294 
__THROW
;

299 #ifdeà
__USE_BSD


303 cÚ¡ *cÚ¡ 
_sys_sigli¡
[
_NSIG
];

304 cÚ¡ *cÚ¡ 
sys_sigli¡
[
_NSIG
];

307 
	ssigvec


309 
__sighªdËr_t
 
sv_hªdËr
;

310 
sv_mask
;

312 
sv_æags
;

313 
	#sv_Ú¡ack
 
sv_æags


	)

317 
	#SV_ONSTACK
 (1 << 0)

	)

318 
	#SV_INTERRUPT
 (1 << 1)

	)

319 
	#SV_RESETHAND
 (1 << 2)

	)

327 
	$sigvec
 (
__sig
, cÚ¡ 
sigvec
 *
__vec
,

328 
sigvec
 *
__ovec
è
__THROW
;

332 
	~<b™s/sigcÚ‹xt.h
>

335 
	$sig»tuº
 (
sigcÚ‹xt
 *
__sı
è
__THROW
;

340 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


341 
	#__Ãed_size_t


	)

342 
	~<¡ddef.h
>

347 
	$sigš‹¼u±
 (
__sig
, 
__š‹¼u±
è
__THROW
;

349 
	~<b™s/sig¡ack.h
>

350 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


352 
	~<sys/ucÚ‹xt.h
>

358 
	$sig¡ack
 (
sig¡ack
 *
__ss
, sig¡ack *
__oss
)

359 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

363 
	$sig®t¡ack
 (cÚ¡ 
sig®t¡ack
 *
__»¡riù
 
__ss
,

364 
sig®t¡ack
 *
__»¡riù
 
__oss
è
__THROW
;

368 #ifdeà
__USE_XOPEN_EXTENDED


372 
	$sighŞd
 (
__sig
è
__THROW
;

375 
	$sig»l£
 (
__sig
è
__THROW
;

378 
	$sigignÜe
 (
__sig
è
__THROW
;

381 
__sighªdËr_t
 
	$sig£t
 (
__sig
, 
__sighªdËr_t
 
__di¥
è
__THROW
;

384 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


387 
	~<b™s/±h»adty³s.h
>

388 
	~<b™s/sigth»ad.h
>

395 
	$__libc_cu¼’t_sig¹mš
 (è
__THROW
;

397 
	$__libc_cu¼’t_sig¹max
 (è
__THROW
;

401 
__END_DECLS


	@/usr/include/stdint.h

22 #iâdeà
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/wch¬.h
>

27 
	~<b™s/wÜdsize.h
>

34 #iâdeà
__št8_t_defšed


35 
	#__št8_t_defšed


	)

36 sigÃd 
	tšt8_t
;

37 
	tšt16_t
;

38 
	tšt32_t
;

39 #ià
__WORDSIZE
 == 64

40 
	tšt64_t
;

42 
__ex‹nsiÚ__


43 
	tšt64_t
;

48 
	tušt8_t
;

49 
	tušt16_t
;

50 #iâdeà
__ušt32_t_defšed


51 
	tušt32_t
;

52 
	#__ušt32_t_defšed


	)

54 #ià
__WORDSIZE
 == 64

55 
	tušt64_t
;

57 
__ex‹nsiÚ__


58 
	tušt64_t
;

65 sigÃd 
	tšt_Ëa¡8_t
;

66 
	tšt_Ëa¡16_t
;

67 
	tšt_Ëa¡32_t
;

68 #ià
__WORDSIZE
 == 64

69 
	tšt_Ëa¡64_t
;

71 
__ex‹nsiÚ__


72 
	tšt_Ëa¡64_t
;

76 
	tušt_Ëa¡8_t
;

77 
	tušt_Ëa¡16_t
;

78 
	tušt_Ëa¡32_t
;

79 #ià
__WORDSIZE
 == 64

80 
	tušt_Ëa¡64_t
;

82 
__ex‹nsiÚ__


83 
	tušt_Ëa¡64_t
;

90 sigÃd 
	tšt_ç¡8_t
;

91 #ià
__WORDSIZE
 == 64

92 
	tšt_ç¡16_t
;

93 
	tšt_ç¡32_t
;

94 
	tšt_ç¡64_t
;

96 
	tšt_ç¡16_t
;

97 
	tšt_ç¡32_t
;

98 
__ex‹nsiÚ__


99 
	tšt_ç¡64_t
;

103 
	tušt_ç¡8_t
;

104 #ià
__WORDSIZE
 == 64

105 
	tušt_ç¡16_t
;

106 
	tušt_ç¡32_t
;

107 
	tušt_ç¡64_t
;

109 
	tušt_ç¡16_t
;

110 
	tušt_ç¡32_t
;

111 
__ex‹nsiÚ__


112 
	tušt_ç¡64_t
;

117 #ià
__WORDSIZE
 == 64

118 #iâdeà
__šŒ_t_defšed


119 
	tšŒ_t
;

120 
	#__šŒ_t_defšed


	)

122 
	tušŒ_t
;

124 #iâdeà
__šŒ_t_defšed


125 
	tšŒ_t
;

126 
	#__šŒ_t_defšed


	)

128 
	tušŒ_t
;

133 #ià
__WORDSIZE
 == 64

134 
	tštmax_t
;

135 
	tuštmax_t
;

137 
__ex‹nsiÚ__


138 
	tštmax_t
;

139 
__ex‹nsiÚ__


140 
	tuštmax_t
;

144 #ià
__WORDSIZE
 == 64

145 
	#__INT64_C
(
c
èø## 
L


	)

146 
	#__UINT64_C
(
c
èø## 
UL


	)

148 
	#__INT64_C
(
c
èø## 
LL


	)

149 
	#__UINT64_C
(
c
èø## 
ULL


	)

155 
	#INT8_MIN
 (-128)

	)

156 
	#INT16_MIN
 (-32767-1)

	)

157 
	#INT32_MIN
 (-2147483647-1)

	)

158 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

160 
	#INT8_MAX
 (127)

	)

161 
	#INT16_MAX
 (32767)

	)

162 
	#INT32_MAX
 (2147483647)

	)

163 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

166 
	#UINT8_MAX
 (255)

	)

167 
	#UINT16_MAX
 (65535)

	)

168 
	#UINT32_MAX
 (4294967295U)

	)

169 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

173 
	#INT_LEAST8_MIN
 (-128)

	)

174 
	#INT_LEAST16_MIN
 (-32767-1)

	)

175 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

176 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

178 
	#INT_LEAST8_MAX
 (127)

	)

179 
	#INT_LEAST16_MAX
 (32767)

	)

180 
	#INT_LEAST32_MAX
 (2147483647)

	)

181 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

184 
	#UINT_LEAST8_MAX
 (255)

	)

185 
	#UINT_LEAST16_MAX
 (65535)

	)

186 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

187 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

191 
	#INT_FAST8_MIN
 (-128)

	)

192 #ià
__WORDSIZE
 == 64

193 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

194 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

196 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

197 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

199 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

201 
	#INT_FAST8_MAX
 (127)

	)

202 #ià
__WORDSIZE
 == 64

203 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

204 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

206 
	#INT_FAST16_MAX
 (2147483647)

	)

207 
	#INT_FAST32_MAX
 (2147483647)

	)

209 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINT_FAST8_MAX
 (255)

	)

213 #ià
__WORDSIZE
 == 64

214 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

215 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

217 
	#UINT_FAST16_MAX
 (4294967295U)

	)

218 
	#UINT_FAST32_MAX
 (4294967295U)

	)

220 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

224 #ià
__WORDSIZE
 == 64

225 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

226 
	#INTPTR_MAX
 (9223372036854775807L)

	)

227 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

229 
	#INTPTR_MIN
 (-2147483647-1)

	)

230 
	#INTPTR_MAX
 (2147483647)

	)

231 
	#UINTPTR_MAX
 (4294967295U)

	)

236 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

238 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

241 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

247 #ià
__WORDSIZE
 == 64

248 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

249 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

251 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

252 
	#PTRDIFF_MAX
 (2147483647)

	)

256 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

257 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

260 #ià
__WORDSIZE
 == 64

261 
	#SIZE_MAX
 (18446744073709551615UL)

	)

263 
	#SIZE_MAX
 (4294967295U)

	)

267 #iâdeà
WCHAR_MIN


269 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

270 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

274 
	#WINT_MIN
 (0u)

	)

275 
	#WINT_MAX
 (4294967295u)

	)

278 
	#INT8_C
(
c
è
	)
c

279 
	#INT16_C
(
c
è
	)
c

280 
	#INT32_C
(
c
è
	)
c

281 #ià
__WORDSIZE
 == 64

282 
	#INT64_C
(
c
èø## 
L


	)

284 
	#INT64_C
(
c
èø## 
LL


	)

288 
	#UINT8_C
(
c
è
	)
c

289 
	#UINT16_C
(
c
è
	)
c

290 
	#UINT32_C
(
c
èø## 
U


	)

291 #ià
__WORDSIZE
 == 64

292 
	#UINT64_C
(
c
èø## 
UL


	)

294 
	#UINT64_C
(
c
èø## 
ULL


	)

298 #ià
__WORDSIZE
 == 64

299 
	#INTMAX_C
(
c
èø## 
L


	)

300 
	#UINTMAX_C
(
c
èø## 
UL


	)

302 
	#INTMAX_C
(
c
èø## 
LL


	)

303 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/stdio.h

23 #iâdeà
_STDIO_H


25 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	~<b™s/ty³s.h
>

36 
	#__Ãed_FILE


	)

37 
	#__Ãed___FILE


	)

41 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_SVID
 || defšed 
__USE_POSIX
 \

51 || 
defšed
 
	g__USE_BSD
 || defšed 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

52 || 
defšed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_defšed
 1

	)

58 #undeà
__Ãed_FILE


61 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_defšed
 1

	)

68 #undeà
__Ãed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


77 #ifdeà
__GNUC__


78 #iâdeà
_VA_LIST_DEFINED


79 
_G_va_li¡
 
	tva_li¡
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<¡d¬g.h
>

87 #ifdeà
__USE_XOPEN2K8


88 #iâdeà
__off_t_defšed


89 #iâdeà
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_defšed


	)

96 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_defšed


	)

101 #iâdeà
__ssize_t_defšed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_defšed


	)

108 
__BEGIN_NAMESPACE_STD


109 #iâdeà
__USE_FILE_OFFSET64


110 
_G_åos_t
 
	tåos_t
;

112 
_G_åos64_t
 
	tåos_t
;

114 
__END_NAMESPACE_STD


115 #ifdeà
__USE_LARGEFILE64


116 
_G_åos64_t
 
	tåos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #iâdeà
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #iâdeà
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifdeà
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


151 
	#P_tmpdœ
 "/tmp"

	)

164 
	~<b™s/¡dio_lim.h
>

168 
_IO_FILE
 *
¡dš
;

169 
_IO_FILE
 *
¡dout
;

170 
_IO_FILE
 *
¡d”r
;

172 
	#¡dš
 
¡dš


	)

173 
	#¡dout
 
¡dout


	)

174 
	#¡d”r
 
¡d”r


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$»move
 (cÚ¡ *
__f’ame
è
__THROW
;

180 
	$»Çme
 (cÚ¡ *
__Şd
, cÚ¡ *
__Ãw
è
__THROW
;

181 
__END_NAMESPACE_STD


183 #ifdeà
__USE_ATFILE


185 
	$»Çm—t
 (
__Şdfd
, cÚ¡ *
__Şd
, 
__Ãwfd
,

186 cÚ¡ *
__Ãw
è
__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #iâdeà
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfe
 (è
__wur
;

197 #ifdeà
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

200 
	#tmpfe
 
tmpfe64


	)

204 #ifdeà
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfe64
 (è
__wur
;

209 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifdeà
__USE_MISC


215 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

219 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


227 *
	$‹m²am
 (cÚ¡ *
__dœ
, cÚ¡ *
__pfx
)

228 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`fşo£
 (
FILE
 *
__¡»am
);

242 
	`fæush
 (
FILE
 *
__¡»am
);

243 
__END_NAMESPACE_STD


245 #ifdeà
__USE_MISC


252 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

255 #ifdeà
__USE_GNU


262 
	`fşo£®l
 ();

266 
__BEGIN_NAMESPACE_STD


267 #iâdeà
__USE_FILE_OFFSET64


272 
FILE
 *
	$fİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

273 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

278 
FILE
 *
	$äeİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

279 cÚ¡ *
__»¡riù
 
__modes
,

280 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

282 #ifdeà
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
fİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

284 cÚ¡ *
__»¡riù
 
__modes
), 
fİ’64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

287 cÚ¡ *
__»¡riù
 
__modes
,

288 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

289 
__wur
;

291 
	#fİ’
 
fİ’64


	)

292 
	#äeİ’
 
äeİ’64


	)

295 
__END_NAMESPACE_STD


296 #ifdeà
__USE_LARGEFILE64


297 
FILE
 *
	$fİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

298 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

299 
FILE
 *
	$äeİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

300 cÚ¡ *
__»¡riù
 
__modes
,

301 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fdİ’
 (
__fd
, cÚ¡ *
__modes
è
__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

313 cÚ¡ *
__»¡riù
 
__modes
,

314 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

317 #ifdeà
__USE_XOPEN2K8


319 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, cÚ¡ *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

336 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

337 
__modes
, 
size_t
 
__n
è
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_BSD


343 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

344 
size_t
 
__size
è
__THROW
;

347 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

357 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

362 
	`´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

364 
	$¥rštf
 (*
__»¡riù
 
__s
,

365 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

371 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

372 
_G_va_li¡
 
__¬g
);

377 
	`v´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

379 
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

380 
_G_va_li¡
 
__¬g
è
__THROWNL
;

381 
__END_NAMESPACE_STD


383 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

387 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

388 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

390 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

391 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

392 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifdeà
__USE_GNU


399 
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__f
,

400 
_G_va_li¡
 
__¬g
)

401 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

402 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

403 cÚ¡ *
__»¡riù
 
__fmt
, ...)

404 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

405 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

406 cÚ¡ *
__»¡riù
 
__fmt
, ...)

407 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

410 #ifdeà
__USE_XOPEN2K8


412 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
,

413 
_G_va_li¡
 
__¬g
)

414 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

415 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

416 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

426 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

431 
	$sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

433 
	$ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

434 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

436 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

437 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

438 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

439 #ifdeà
__REDIRECT


443 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

444 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

445 
__isoc99_fsÿnf
è
__wur
;

446 
	`__REDIRECT
 (
sÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

447 
__isoc99_sÿnf
è
__wur
;

448 
	`__REDIRECT_NTH
 (
ssÿnf
, (cÚ¡ *
__»¡riù
 
__s
,

449 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

450 
__isoc99_ssÿnf
);

452 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

453 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

454 
	$__isoc99_sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

455 
	$__isoc99_ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

456 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

457 
	#fsÿnf
 
__isoc99_fsÿnf


	)

458 
	#sÿnf
 
__isoc99_sÿnf


	)

459 
	#ssÿnf
 
__isoc99_ssÿnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

472 
_G_va_li¡
 
__¬g
)

473 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

479 
	$vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

480 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

483 
	$vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

484 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

485 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

487 #ià!
defšed
 
__USE_GNU
 \

488 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

489 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

490 #ifdeà
__REDIRECT


494 
	`__REDIRECT
 (
vfsÿnf
,

495 (
FILE
 *
__»¡riù
 
__s
,

496 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

497 
__isoc99_vfsÿnf
)

498 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

499 
	`__REDIRECT
 (
vsÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
,

500 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

501 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

502 
	`__REDIRECT_NTH
 (
vssÿnf
,

503 (cÚ¡ *
__»¡riù
 
__s
,

504 cÚ¡ *
__»¡riù
 
__fÜm©
,

505 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

506 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

508 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

509 cÚ¡ *
__»¡riù
 
__fÜm©
,

510 
_G_va_li¡
 
__¬g
è
__wur
;

511 
	$__isoc99_vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
,

512 
_G_va_li¡
 
__¬g
è
__wur
;

513 
	$__isoc99_vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

514 cÚ¡ *
__»¡riù
 
__fÜm©
,

515 
_G_va_li¡
 
__¬g
è
__THROW
;

516 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

517 
	#vsÿnf
 
__isoc99_vsÿnf


	)

518 
	#vssÿnf
 
__isoc99_vssÿnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fg‘c
 (
FILE
 *
__¡»am
);

532 
	`g‘c
 (
FILE
 *
__¡»am
);

538 
	`g‘ch¬
 ();

539 
__END_NAMESPACE_STD


543 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

545 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


550 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

551 
	`g‘ch¬_uÆocked
 ();

554 #ifdeà
__USE_MISC


561 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

565 
__BEGIN_NAMESPACE_STD


573 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

574 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

580 
	`putch¬
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

587 #ifdeà
__USE_MISC


594 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

597 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


602 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

603 
	`putch¬_uÆocked
 (
__c
);

607 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 \

608 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

610 
	`g‘w
 (
FILE
 *
__¡»am
);

613 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

623 
__wur
;

625 #ià!
defšed
 
__USE_ISOC11
 \

626 || (
defšed
 
__ılu¥lus
 && __cplusplus <= 201103L)

638 *
	$g‘s
 (*
__s
è
__wur
 
__©Œibu‹_d•»ÿ‹d__
;

640 
__END_NAMESPACE_STD


642 #ifdeà
__USE_GNU


649 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

650 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

666 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

667 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

668 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

669 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

670 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

678 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

679 
size_t
 *
__»¡riù
 
__n
,

680 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`åuts
 (cÚ¡ *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

695 
	`puts
 (cÚ¡ *
__s
);

702 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

709 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

715 
size_t
 
	`fwr™e
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

716 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifdeà
__USE_GNU


726 
	`åuts_uÆocked
 (cÚ¡ *
__»¡riù
 
__s
,

727 
FILE
 *
__»¡riù
 
__¡»am
);

730 #ifdeà
__USE_MISC


737 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

739 
size_t
 
	`fwr™e_uÆocked
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

740 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

744 
__BEGIN_NAMESPACE_STD


749 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

754 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

759 
	`»wšd
 (
FILE
 *
__¡»am
);

760 
__END_NAMESPACE_STD


767 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


768 #iâdeà
__USE_FILE_OFFSET64


773 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

778 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

780 #ifdeà
__REDIRECT


781 
	`__REDIRECT
 (
f£eko
,

782 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

783 
f£eko64
);

784 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

786 
	#f£eko
 
f£eko64


	)

787 
	#á–lo
 
á–lo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #iâdeà
__USE_FILE_OFFSET64


798 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

803 
	`f£os
 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
);

805 #ifdeà
__REDIRECT


806 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

807 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

808 
	`__REDIRECT
 (
f£os
,

809 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
), 
f£os64
);

811 
	#fg‘pos
 
fg‘pos64


	)

812 
	#f£os
 
f£os64


	)

815 
__END_NAMESPACE_STD


817 #ifdeà
__USE_LARGEFILE64


818 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

819 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

820 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

821 
	`f£os64
 (
FILE
 *
__¡»am
, cÚ¡ 
åos64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

828 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

830 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifdeà
__USE_MISC


835 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

836 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

837 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`³¼Ü
 (cÚ¡ *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<b™s/sys_”¾i¡.h
>

856 #ifdef 
__USE_POSIX


858 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

861 #ifdeà
__USE_MISC


863 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

867 #ià(
defšed
 
__USE_POSIX2
 || defšed 
__USE_SVID
 || defšed 
__USE_BSD
 || \

868 
defšed
 
__USE_MISC
)

873 
FILE
 *
	$pİ’
 (cÚ¡ *
__commªd
, cÚ¡ *
__modes
è
__wur
;

879 
	`pşo£
 (
FILE
 *
__¡»am
);

883 #ifdef 
__USE_POSIX


885 *
	$ù”mid
 (*
__s
è
__THROW
;

889 #ifdeà
__USE_XOPEN


891 *
	`cu£rid
 (*
__s
);

895 #ifdef 
__USE_GNU


896 
ob¡ack
;

899 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

900 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

901 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

902 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

903 cÚ¡ *
__»¡riù
 
__fÜm©
,

904 
_G_va_li¡
 
__¬gs
)

905 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

909 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


913 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

917 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

920 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

923 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


927 
	#__Ãed_g‘İt


	)

928 
	~<g‘İt.h
>

933 #ifdeà
__USE_EXTERN_INLINES


934 
	~<b™s/¡dio.h
>

936 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


937 
	~<b™s/¡dio2.h
>

939 #ifdeà
__LDBL_COMPAT


940 
	~<b™s/¡dio-ldbl.h
>

943 
__END_DECLS


	@/usr/include/stdlib.h

22 #iâdef 
_STDLIB_H


24 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


29 
	#__Ãed_wch¬_t


	)

30 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

34 
	g__BEGIN_DECLS


36 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


37 
	#_STDLIB_H
 1

	)

39 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


41 
	~<b™s/wa™æags.h
>

42 
	~<b™s/wa™¡©us.h
>

44 #ifdeà
__USE_BSD


49 #ià
defšed
 
__GNUC__
 && !defšed 
__ılu¥lus


50 
	#__WAIT_INT
(
¡©us
) \

51 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

52 { .
__š
 = (
¡©us
è}).
__i
))

	)

54 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

62 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ılu¥lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
wa™
 *
	m__u±r
;

70 *
	m__Œ
;

71 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

85 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

90 #ifdeà
__WIFCONTINUED


91 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquÙ
;

100 
	m»m
;

101 } 
	tdiv_t
;

104 #iâdeà
__ldiv_t_defšed


107 
	mquÙ
;

108 
	m»m
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_defšed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


115 
__BEGIN_NAMESPACE_C99


117 
__ex‹nsiÚ__
 struct

119 
	mquÙ
;

120 
	m»m
;

121 } 
	tÎdiv_t
;

122 
	#__Îdiv_t_defšed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

139 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (cÚ¡ *
__ÅŒ
)

145 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

147 
	$©oi
 (cÚ¡ *
__ÅŒ
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

150 
	$©Ş
 (cÚ¡ *
__ÅŒ
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

152 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_MISC


155 
__BEGIN_NAMESPACE_C99


157 
__ex‹nsiÚ__
 
	$©Şl
 (cÚ¡ *
__ÅŒ
)

158 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$¡¹od
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

165 **
__»¡riù
 
__’d±r
)

166 
__THROW
 
	`__nÚnuÎ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$¡¹of
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

173 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1));

175 
	$¡¹Şd
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

176 **
__»¡riù
 
__’d±r
)

177 
__THROW
 
	`__nÚnuÎ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$¡¹Ş
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

184 **
__»¡riù
 
__’d±r
, 
__ba£
)

185 
__THROW
 
	`__nÚnuÎ
 ((1));

187 
	$¡¹oul
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

188 **
__»¡riù
 
__’d±r
, 
__ba£
)

189 
__THROW
 
	`__nÚnuÎ
 ((1));

190 
__END_NAMESPACE_STD


192 #ifdeà
__USE_BSD


194 
__ex‹nsiÚ__


195 
	$¡¹oq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

196 **
__»¡riù
 
__’d±r
, 
__ba£
)

197 
__THROW
 
	`__nÚnuÎ
 ((1));

199 
__ex‹nsiÚ__


200 
	$¡¹ouq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

201 **
__»¡riù
 
__’d±r
, 
__ba£
)

202 
__THROW
 
	`__nÚnuÎ
 ((1));

205 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_MISC


206 
__BEGIN_NAMESPACE_C99


208 
__ex‹nsiÚ__


209 
	$¡¹Şl
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

210 **
__»¡riù
 
__’d±r
, 
__ba£
)

211 
__THROW
 
	`__nÚnuÎ
 ((1));

213 
__ex‹nsiÚ__


214 
	$¡¹ouÎ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

215 **
__»¡riù
 
__’d±r
, 
__ba£
)

216 
__THROW
 
	`__nÚnuÎ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifdeà
__USE_GNU


235 
	~<xloÿË.h
>

239 
	$¡¹Ş_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

240 **
__»¡riù
 
__’d±r
, 
__ba£
,

241 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4));

243 
	$¡¹oul_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

244 **
__»¡riù
 
__’d±r
,

245 
__ba£
, 
__loÿË_t
 
__loc
)

246 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

248 
__ex‹nsiÚ__


249 
	$¡¹Şl_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

250 **
__»¡riù
 
__’d±r
, 
__ba£
,

251 
__loÿË_t
 
__loc
)

252 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

254 
__ex‹nsiÚ__


255 
	$¡¹ouÎ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

256 **
__»¡riù
 
__’d±r
,

257 
__ba£
, 
__loÿË_t
 
__loc
)

258 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

260 
	$¡¹od_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

261 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

262 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

264 
	$¡¹of_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

265 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

266 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

268 
	$¡¹Şd_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

269 **
__»¡riù
 
__’d±r
,

270 
__loÿË_t
 
__loc
)

271 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

275 #ifdeà
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__ex‹º_šlše
 

278 
	`__NTH
 (
	$©oi
 (cÚ¡ *
__ÅŒ
))

280  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

281 
	}
}

282 
__ex‹º_šlše
 

283 
__NTH
 (
	$©Ş
 (cÚ¡ *
__ÅŒ
))

285  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

292 
__NTH
 (
	$©Şl
 (cÚ¡ *
__ÅŒ
))

294  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

308 
	$a64l
 (cÚ¡ *
__s
)

309 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

313 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_BSD


314 
	~<sys/ty³s.h
>

321 
	$¿ndom
 (è
__THROW
;

324 
	$¤ªdom
 (
__£ed
è
__THROW
;

330 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

331 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

335 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

338 #ifdeà
__USE_MISC


343 
	s¿ndom_d©a


345 
št32_t
 *
åŒ
;

346 
št32_t
 *
½Œ
;

347 
št32_t
 *
¡©e
;

348 
¿nd_ty³
;

349 
¿nd_deg
;

350 
¿nd_£p
;

351 
št32_t
 *
’d_±r
;

354 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

355 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

357 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

358 
__THROW
 
	`__nÚnuÎ
 ((2));

360 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

361 
size_t
 
__¡©–’
,

362 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

363 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

365 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

366 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

367 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$¿nd
 (è
__THROW
;

376 
	$¤ªd
 (
__£ed
è
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifdeà
__USE_POSIX


381 
	$¿nd_r
 (*
__£ed
è
__THROW
;

385 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


389 
	$d¿nd48
 (è
__THROW
;

390 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

393 
	$Ìªd48
 (è
__THROW
;

394 
	$Äªd48
 (
__xsubi
[3])

395 
__THROW
 
	`__nÚnuÎ
 ((1));

398 
	$m¿nd48
 (è
__THROW
;

399 
	$j¿nd48
 (
__xsubi
[3])

400 
__THROW
 
	`__nÚnuÎ
 ((1));

403 
	$¤ªd48
 (
__£edv®
è
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__nÚnuÎ
 ((1));

406 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

408 #ifdeà
__USE_MISC


412 
	sd¿nd48_d©a


414 
__x
[3];

415 
__Şd_x
[3];

416 
__c
;

417 
__š™
;

418 
__ex‹nsiÚ__
 
__a
;

423 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

424 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

425 
	$”ªd48_r
 (
__xsubi
[3],

426 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

427 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

430 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

431 *
__»¡riù
 
__»suÉ
)

432 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

433 
	$Äªd48_r
 (
__xsubi
[3],

434 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

435 *
__»¡riù
 
__»suÉ
)

436 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

439 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

440 *
__»¡riù
 
__»suÉ
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

442 
	$j¿nd48_r
 (
__xsubi
[3],

443 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

444 *
__»¡riù
 
__»suÉ
)

445 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

448 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

449 
__THROW
 
	`__nÚnuÎ
 ((2));

451 
	$£ed48_r
 (
__£ed16v
[3],

452 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

454 
	$lcÚg48_r
 (
__·¿m
[7],

455 
d¿nd48_d©a
 *
__bufãr
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

462 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


463 
	#__m®loc_ªd_ÿÎoc_defšed


	)

464 
__BEGIN_NAMESPACE_STD


466 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

468 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

469 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

470 
__END_NAMESPACE_STD


473 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


474 
__BEGIN_NAMESPACE_STD


480 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

481 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

483 
	$ä“
 (*
__±r
è
__THROW
;

484 
__END_NAMESPACE_STD


486 #ifdef 
__USE_MISC


488 
	$cä“
 (*
__±r
è
__THROW
;

491 #ià
defšed
 
__USE_GNU
 || defšed 
__USE_BSD
 || defšed 
__USE_MISC


492 
	~<®loÿ.h
>

495 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

496 || 
defšed
 
__USE_BSD


498 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

501 #ifdeà
__USE_XOPEN2K


503 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

504 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

507 #ifdeà
__USE_ISOC11


509 *
	$®igÃd_®loc
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

510 
__THROW
 
__©Œibu‹_m®loc__
 
	`__©Œibu‹_®loc_size__
 ((2)è
__wur
;

513 
__BEGIN_NAMESPACE_STD


515 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

519 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

521 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


523 #ifdeà
__ılu¥lus


524 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

525 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

527 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

530 
__END_NAMESPACE_STD


532 #ifdef 
__USE_MISC


535 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

536 
__THROW
 
	`__nÚnuÎ
 ((1));

539 
__BEGIN_NAMESPACE_STD


543 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

545 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


549 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

551 
__END_NAMESPACE_STD


553 #ifdeà
__USE_ISOC99


554 
__BEGIN_NAMESPACE_C99


557 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

558 
__END_NAMESPACE_C99


562 
__BEGIN_NAMESPACE_STD


564 *
	$g‘’v
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

565 
__END_NAMESPACE_STD


567 #ifdeà
__USE_GNU


570 *
	$£cu»_g‘’v
 (cÚ¡ *
__Çme
)

571 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

574 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


578 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

581 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


584 
	$£‹nv
 (cÚ¡ *
__Çme
, cÚ¡ *
__v®ue
, 
__»¶aû
)

585 
__THROW
 
	`__nÚnuÎ
 ((2));

588 
	$un£‹nv
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

591 #ifdef 
__USE_MISC


595 
	$ş—»nv
 (è
__THROW
;

599 #ià
defšed
 
__USE_MISC
 \

600 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
)

606 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1));

609 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 \

610 || 
defšed
 
__USE_XOPEN2K8


619 #iâdeà
__USE_FILE_OFFSET64


620 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

622 #ifdeà
__REDIRECT


623 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

624 
	`__nÚnuÎ
 ((1)è
__wur
;

626 
	#mk¡emp
 
mk¡emp64


	)

629 #ifdeà
__USE_LARGEFILE64


630 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

634 #ifdeà
__USE_MISC


641 #iâdeà
__USE_FILE_OFFSET64


642 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

644 #ifdeà
__REDIRECT


645 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

646 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

648 
	#mk¡emps
 
mk¡emps64


	)

651 #ifdeà
__USE_LARGEFILE64


652 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

653 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K8


663 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

666 #ifdeà
__USE_GNU


673 #iâdeà
__USE_FILE_OFFSET64


674 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

676 #ifdeà
__REDIRECT


677 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

678 
	`__nÚnuÎ
 ((1)è
__wur
;

680 
	#mko¡emp
 
mko¡emp64


	)

683 #ifdeà
__USE_LARGEFILE64


684 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

693 #iâdeà
__USE_FILE_OFFSET64


694 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

695 
	`__nÚnuÎ
 ((1)è
__wur
;

697 #ifdeà
__REDIRECT


698 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

699 
__æags
), 
mko¡emps64
)

700 
	`__nÚnuÎ
 ((1)è
__wur
;

702 
	#mko¡emps
 
mko¡emps64


	)

705 #ifdeà
__USE_LARGEFILE64


706 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

707 
	`__nÚnuÎ
 ((1)è
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy¡em
 (cÚ¡ *
__commªd
è
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ÿnÚiÿlize_fe_Çme
 (cÚ¡ *
__Çme
)

725 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

728 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


734 *
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
,

735 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

740 #iâdeà
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com·r_â_t
) (const *, const *);

744 #ifdef 
__USE_GNU


745 
__com·r_â_t
 
	tcom·risÚ_â_t
;

748 #ifdeà
__USE_GNU


749 (*
	t__com·r_d_â_t
) (const *, const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
,

756 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

757 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

759 #ifdeà
__USE_EXTERN_INLINES


760 
	~<b™s/¡dlib-b£¬ch.h
>

765 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

766 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

767 #ifdeà
__USE_GNU


768 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

769 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

770 
	`__nÚnuÎ
 ((1, 4));

775 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

776 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

777 
__END_NAMESPACE_STD


779 #ifdeà
__USE_ISOC99


780 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

781 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

785 
__BEGIN_NAMESPACE_STD


789 
div_t
 
	$div
 (
__num”
, 
__d’om
)

790 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

791 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

792 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

793 
__END_NAMESPACE_STD


795 #ifdeà
__USE_ISOC99


796 
__BEGIN_NAMESPACE_C99


797 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

798 
__d’om
)

799 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

800 
__END_NAMESPACE_C99


804 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

805 || 
defšed
 
__USE_SVID


812 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

813 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

818 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

819 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

824 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

825 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

828 #ifdeà
__USE_MISC


830 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

831 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

832 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

833 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

834 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

835 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

836 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

837 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

842 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

843 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

844 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

845 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

846 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

847 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

849 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

850 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

851 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

852 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

853 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

854 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

855 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

856 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

860 
__BEGIN_NAMESPACE_STD


863 
	$mbËn
 (cÚ¡ *
__s
, 
size_t
 
__n
è
__THROW
;

866 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

867 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

870 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
;

874 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

875 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

877 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

878 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

879 
__THROW
;

880 
__END_NAMESPACE_STD


883 #ifdeà
__USE_SVID


888 
	$½m©ch
 (cÚ¡ *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

892 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


899 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

900 *cÚ¡ *
__»¡riù
 
__tok’s
,

901 **
__»¡riù
 
__v®u•
)

902 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

906 #ifdeà
__USE_XOPEN


908 
	$£tkey
 (cÚ¡ *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

914 #ifdeà
__USE_XOPEN2KXSI


916 
	$posix_İ’±
 (
__oæag
è
__wur
;

919 #ifdeà
__USE_XOPEN


924 
	$g¿Á±
 (
__fd
è
__THROW
;

928 
	$uÆock±
 (
__fd
è
__THROW
;

933 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

936 #ifdeà
__USE_GNU


940 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

941 
__THROW
 
	`__nÚnuÎ
 ((2));

944 
	`g‘±
 ();

947 #ifdeà
__USE_BSD


951 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

952 
__THROW
 
	`__nÚnuÎ
 ((1));

955 
	~<b™s/¡dlib-æßt.h
>

958 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


959 
	~<b™s/¡dlib.h
>

961 #ifdeà
__LDBL_COMPAT


962 
	~<b™s/¡dlib-ldbl.h
>

966 #undeà
__Ãed_m®loc_ªd_ÿÎoc


968 
__END_DECLS


	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


30 
	#__Ãed_size_t


	)

31 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

39 #ià
defšed
 
__ılu¥lus
 && (__ılu¥lu >ğ199711L || 
__GNUC_PREREQ
 (4, 4))

40 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

44 
__BEGIN_NAMESPACE_STD


46 *
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

47 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

50 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

51 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

52 
__END_NAMESPACE_STD


57 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


58 *
	$memcıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

59 
__c
, 
size_t
 
__n
)

60 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

64 
__BEGIN_NAMESPACE_STD


66 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

69 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

70 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

73 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


76 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

77 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

78 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

79 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

81 #ifdeà
__OPTIMIZE__


82 
__ex‹º_®ways_šlše
 *

83 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


85  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

88 
__ex‹º_®ways_šlše
 const *

89 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


91  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

94 
	}
}

96 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

97 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

99 
__END_NAMESPACE_STD


101 #ifdeà
__USE_GNU


104 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


105 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

106 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

107 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

108 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

110 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

111 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

115 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


116 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

117 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

118 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

119 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

121 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

122 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

127 
__BEGIN_NAMESPACE_STD


129 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

130 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

132 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

133 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

134 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

137 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

138 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

140 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

141 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

144 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

145 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

147 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

151 
	$¡rcŞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

152 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

154 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

155 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

156 
__THROW
 
	`__nÚnuÎ
 ((2));

157 
__END_NAMESPACE_STD


159 #ifdeà
__USE_XOPEN2K8


163 
	~<xloÿË.h
>

166 
	$¡rcŞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

167 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

169 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

170 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

173 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

174 || 
defšed
 
__USE_XOPEN2K8


176 *
	$¡rdup
 (cÚ¡ *
__s
)

177 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

183 #ià
defšed
 
__USE_XOPEN2K8


184 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

185 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

188 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


190 
	#¡rdu·
(
s
) \

191 (
__ex‹nsiÚ__
 \

193 cÚ¡ *
__Şd
 = (
s
); \

194 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

195 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

196 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

197 
	}
}))

	)

200 
	#¡ºdu·
(
s
, 
n
) \

201 (
__ex‹nsiÚ__
 \

203 cÚ¡ *
__Şd
 = (
s
); \

204 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

205 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

206 
__Ãw
[
__Ën
] = '\0'; \

207 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

208 }))

	)

211 
	g__BEGIN_NAMESPACE_STD


213 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


216 *
¡rchr
 (*
__s
, 
__c
)

217 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

218 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

219 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

221 #ifdeà
__OPTIMIZE__


222 
__ex‹º_®ways_šlše
 *

223 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


225  
__butš_¡rchr
 (
__s
, 
__c
);

228 
__ex‹º_®ways_šlše
 const *

229 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


231  
__butš_¡rchr
 (
__s
, 
__c
);

236 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

237 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

240 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


243 *
	`¡¼chr
 (*
__s
, 
__c
)

244 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

245 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

246 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

248 #ifdeà
__OPTIMIZE__


249 
__ex‹º_®ways_šlše
 *

250 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


252  
	`__butš_¡¼chr
 (
__s
, 
__c
);

255 
__ex‹º_®ways_šlše
 const *

256 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


258  
	`__butš_¡¼chr
 (
__s
, 
__c
);

261 
	}
}

263 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

264 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

266 
__END_NAMESPACE_STD


268 #ifdeà
__USE_GNU


271 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


272 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

273 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

274 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

275 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

277 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

278 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

282 
__BEGIN_NAMESPACE_STD


285 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

286 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

289 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

290 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

292 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


295 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

296 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

297 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

298 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

300 #ifdeà
__OPTIMIZE__


301 
__ex‹º_®ways_šlše
 *

302 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


304  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

307 
__ex‹º_®ways_šlše
 const *

308 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


310  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

313 
	}
}

315 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

316 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

319 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


322 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

323 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

324 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

325 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__OPTIMIZE__


328 
__ex‹º_®ways_šlše
 *

329 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


331  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

334 
__ex‹º_®ways_šlše
 const *

335 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


337  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

340 
	}
}

342 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

349 
__THROW
 
	`__nÚnuÎ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

355 cÚ¡ *
__»¡riù
 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

358 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


359 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

360 **
__»¡riù
 
__§ve_±r
)

361 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

364 #ifdeà
__USE_GNU


366 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

368 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

370 cÚ¡ *
__ÃedË
)

371 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

374 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

378 #ifdeà
__USE_GNU


382 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

383 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

384 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

388 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

389 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

392 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

400 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

407 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

414 
__END_NAMESPACE_STD


415 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


423 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


426 #ifdeà
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

428 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

429 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

431 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

433 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

438 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

439 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

443 #ifdeà
__USE_XOPEN2K8


445 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

451 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

453 #ifdeà
__USE_BSD


455 
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

462 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

466 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`šdex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

471 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

474 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex‹º_®ways_šlše
 *

476 
	`šdex
 (*
__s
, 
__c
è
__THROW


478  
	`__butš_šdex
 (
__s
, 
__c
);

481 
__ex‹º_®ways_šlše
 const *

482 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


484  
	`__butš_šdex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

490 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`ršdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

499 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

502 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex‹º_®ways_šlše
 *

504 
	`ršdex
 (*
__s
, 
__c
è
__THROW


506  
	`__butš_ršdex
 (
__s
, 
__c
);

509 
__ex‹º_®ways_šlše
 const *

510 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


512  
	`__butš_ršdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

518 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

523 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

527 #ifdef 
__USE_GNU


528 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

530 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

534 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

535 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

538 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

539 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

542 #ifdef 
__USE_GNU


545 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

546 
__loÿË_t
 
__loc
)

547 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

549 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

550 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

551 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

554 #ifdef 
__USE_BSD


557 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

558 cÚ¡ *
__»¡riù
 
__d–im
)

559 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

562 #ifdef 
__USE_XOPEN2K8


564 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

567 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

568 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

569 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

574 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

575 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

576 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

577 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

578 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

579 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

582 #ifdef 
__USE_GNU


584 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

585 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

588 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

591 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

593 #iâdeà
ba£Çme


598 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


599 "C++" *
	$ba£Çme
 (*
__f’ame
)

600 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

601 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__f’ame
)

602 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

604 *
	$ba£Çme
 (cÚ¡ *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

610 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

611 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

612 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


632 
	~<b™s/¡ršg.h
>

635 
	~<b™s/¡ršg2.h
>

638 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


640 
	~<b™s/¡ršg3.h
>

644 
__END_DECLS


	@/usr/include/time.h

22 #iâdef 
_TIME_H


24 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

25 ! 
defšed
 
	g__Ãed_time¥ec
)

26 
	#_TIME_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__Ãed_size_t


	)

36 
	#__Ãed_NULL


	)

37 
	~<¡ddef.h
>

41 
	~<b™s/time.h
>

44 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


45 #iâdeà
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

53 
	#__şock_t_defšed
 1

	)

55 
	~<b™s/ty³s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__şock_t
 
	tşock_t
;

60 
	g__END_NAMESPACE_STD


61 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


62 
	$__USING_NAMESPACE_STD
(
şock_t
)

66 #undeà
__Ãed_şock_t


68 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

69 
	#__time_t_defšed
 1

	)

71 
	~<b™s/ty³s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #undeà
__Ãed_time_t


84 #ià!
defšed
 
__şockid_t_defšed
 && \

85 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

86 
	#__şockid_t_defšed
 1

	)

88 
	~<b™s/ty³s.h
>

91 
__şockid_t
 
	tşockid_t
;

94 #undeà
__şockid_time_t


96 #ià!
defšed
 
__tim”_t_defšed
 && \

97 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

98 
	#__tim”_t_defšed
 1

	)

100 
	~<b™s/ty³s.h
>

103 
__tim”_t
 
	ttim”_t
;

106 #undeà
__Ãed_tim”_t


109 #ià(!
defšed
 
__time¥ec_defšed
 \

110 && ((
defšed
 
_TIME_H
 \

111 && (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
 \

112 || 
defšed
 
__USE_ISOC11
)) \

113 || 
defšed
 
__Ãed_time¥ec
))

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
__sysÿÎ_¦Úg_t
 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 cÚ¡ *
tm_zÚe
;

149 
__tm_gmtoff
;

150 cÚ¡ *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 #ifdeà
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
şock_t
 
	$şock
 (è
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

195 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

196 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

199 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

205 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

206 cÚ¡ *
__»¡riù
 
__fÜm©
,

207 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifdeà
__USE_XOPEN


213 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

214 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

215 
__THROW
;

218 #ifdeà
__USE_XOPEN2K8


221 
	~<xloÿË.h
>

223 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

224 cÚ¡ *
__»¡riù
 
__fÜm©
,

225 cÚ¡ 
tm
 *
__»¡riù
 
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

229 #ifdeà
__USE_GNU


230 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

231 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

232 
__loÿË_t
 
__loc
è
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

243 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

244 
__END_NAMESPACE_STD


246 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


249 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

250 
tm
 *
__»¡riù
 
__
è
__THROW
;

254 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

255 
tm
 *
__»¡riù
 
__
è
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

264 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

265 
__END_NAMESPACE_STD


267 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


272 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

273 *
__»¡riù
 
__buf
è
__THROW
;

276 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

277 *
__»¡riù
 
__buf
è
__THROW
;

282 *
__tzÇme
[2];

283 
__daylight
;

284 
__timezÚe
;

287 #ifdef 
__USE_POSIX


289 *
tzÇme
[2];

293 
	$tz£t
 (è
__THROW
;

296 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


297 
daylight
;

298 
timezÚe
;

301 #ifdeà
__USE_SVID


304 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

310 
	#__i¦—p
(
y—r
) \

311 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

314 #ifdeà
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

322 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

325 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

329 #ifdeà
__USE_POSIX199309


334 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

335 
time¥ec
 *
__»maššg
);

339 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

342 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

345 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, cÚ¡ 
time¥ec
 *
__
)

346 
__THROW
;

348 #ifdeà
__USE_XOPEN2K


353 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

354 cÚ¡ 
time¥ec
 *
__»q
,

355 
time¥ec
 *
__»m
);

358 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

363 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

364 
sigev’t
 *
__»¡riù
 
__evp
,

365 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

368 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

371 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

372 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

373 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

376 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

377 
__THROW
;

380 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

384 #ifdeà
__USE_ISOC11


386 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__nÚnuÎ
 ((1));

391 #ifdeà
__USE_XOPEN_EXTENDED


403 
g‘d©e_”r
;

412 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

415 #ifdeà
__USE_GNU


426 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

427 
tm
 *
__»¡riù
 
__»sbuå
);

430 
__END_DECLS


	@/usr/include/unistd.h

22 #iâdef 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


32 #ifdeà
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #–ià
defšed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #–ià
defšed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #–ià
defšed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifdeà
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #–ià
defšed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #–ià
defšed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

71 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

75 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

79 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

83 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

86 #ifdeà
__USE_XOPEN2K8


87 
	#_XOPEN_VERSION
 700

	)

88 #–ià
defšed
 
__USE_XOPEN2K


89 
	#_XOPEN_VERSION
 600

	)

90 #–ià
defšed
 
__USE_UNIX98


91 
	#_XOPEN_VERSION
 500

	)

93 
	#_XOPEN_VERSION
 4

	)

97 
	#_XOPEN_XCU_VERSION
 4

	)

100 
	#_XOPEN_XPG2
 1

	)

101 
	#_XOPEN_XPG3
 1

	)

102 
	#_XOPEN_XPG4
 1

	)

105 
	#_XOPEN_UNIX
 1

	)

108 
	#_XOPEN_CRYPT
 1

	)

112 
	#_XOPEN_ENH_I18N
 1

	)

115 
	#_XOPEN_LEGACY
 1

	)

202 
	~<b™s/posix_İt.h
>

205 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


206 
	~<b™s/’vœÚm’ts.h
>

210 
	#STDIN_FILENO
 0

	)

211 
	#STDOUT_FILENO
 1

	)

212 
	#STDERR_FILENO
 2

	)

217 
	~<b™s/ty³s.h
>

219 #iâdef 
__ssize_t_defšed


220 
__ssize_t
 
	tssize_t
;

221 
	#__ssize_t_defšed


	)

224 
	#__Ãed_size_t


	)

225 
	#__Ãed_NULL


	)

226 
	~<¡ddef.h
>

228 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


231 #iâdeà
__gid_t_defšed


232 
__gid_t
 
	tgid_t
;

233 
	#__gid_t_defšed


	)

236 #iâdeà
__uid_t_defšed


237 
__uid_t
 
	tuid_t
;

238 
	#__uid_t_defšed


	)

241 #iâdeà
__off_t_defšed


242 #iâdeà
__USE_FILE_OFFSET64


243 
__off_t
 
	toff_t
;

245 
__off64_t
 
	toff_t
;

247 
	#__off_t_defšed


	)

249 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


250 
__off64_t
 
	toff64_t
;

251 
	#__off64_t_defšed


	)

254 #iâdeà
__u£cÚds_t_defšed


255 
__u£cÚds_t
 
	tu£cÚds_t
;

256 
	#__u£cÚds_t_defšed


	)

259 #iâdeà
__pid_t_defšed


260 
__pid_t
 
	tpid_t
;

261 
	#__pid_t_defšed


	)

265 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


266 #iâdeà
__šŒ_t_defšed


267 
__šŒ_t
 
	tšŒ_t
;

268 
	#__šŒ_t_defšed


	)

272 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


273 #iâdeà
__sockËn_t_defšed


274 
__sockËn_t
 
	tsockËn_t
;

275 
	#__sockËn_t_defšed


	)

281 
	#R_OK
 4

	)

282 
	#W_OK
 2

	)

283 
	#X_OK
 1

	)

284 
	#F_OK
 0

	)

287 
	$acûss
 (cÚ¡ *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

289 #ifdeà
__USE_GNU


292 
	$euidacûss
 (cÚ¡ *
__Çme
, 
__ty³
)

293 
__THROW
 
	`__nÚnuÎ
 ((1));

296 
	$—cûss
 (cÚ¡ *
__Çme
, 
__ty³
)

297 
__THROW
 
	`__nÚnuÎ
 ((1));

300 #ifdeà
__USE_ATFILE


304 
	$çcûs§t
 (
__fd
, cÚ¡ *
__fe
, 
__ty³
, 
__æag
)

305 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

310 #iâdef 
_STDIO_H


311 
	#SEEK_SET
 0

	)

312 
	#SEEK_CUR
 1

	)

313 
	#SEEK_END
 2

	)

314 #ifdeà
__USE_GNU


315 
	#SEEK_DATA
 3

	)

316 
	#SEEK_HOLE
 4

	)

320 #ià
defšed
 
__USE_BSD
 && !defšed 
L_SET


322 
	#L_SET
 
SEEK_SET


	)

323 
	#L_INCR
 
SEEK_CUR


	)

324 
	#L_XTND
 
SEEK_END


	)

333 #iâdeà
__USE_FILE_OFFSET64


334 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

336 #ifdeà
__REDIRECT_NTH


337 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

338 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

339 
l£ek64
);

341 
	#l£ek
 
l£ek64


	)

344 #ifdeà
__USE_LARGEFILE64


345 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

346 
__THROW
;

353 
	`şo£
 (
__fd
);

360 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

366 
ssize_t
 
	$wr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
è
__wur
;

368 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


369 #iâdeà
__USE_FILE_OFFSET64


376 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

377 
__off_t
 
__off£t
è
__wur
;

384 
ssize_t
 
	$pwr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

385 
__off_t
 
__off£t
è
__wur
;

387 #ifdeà
__REDIRECT


388 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

389 
__off64_t
 
__off£t
),

390 
´—d64
è
__wur
;

391 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, cÚ¡ *
__buf
,

392 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

393 
pwr™e64
è
__wur
;

395 
	#´—d
 
´—d64


	)

396 
	#pwr™e
 
pwr™e64


	)

400 #ifdeà
__USE_LARGEFILE64


404 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

405 
__off64_t
 
__off£t
è
__wur
;

408 
ssize_t
 
	$pwr™e64
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

409 
__off64_t
 
__off£t
è
__wur
;

417 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

419 #ifdeà
__USE_GNU


422 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

432 
	$®¬m
 (
__£cÚds
è
__THROW
;

444 
	`¦“p
 (
__£cÚds
);

446 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

447 || 
defšed
 
__USE_BSD


452 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

453 
__THROW
;

460 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

469 
	`·u£
 ();

473 
	$chown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

474 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

476 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


478 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

483 
	$lchown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

484 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

488 #ifdeà
__USE_ATFILE


491 
	$fchowÇt
 (
__fd
, cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
,

492 
__gid_t
 
__group
, 
__æag
)

493 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

497 
	$chdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

499 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


501 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

511 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

513 #ifdef 
__USE_GNU


517 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

520 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

521 || 
defšed
 
__USE_BSD


525 *
	$g‘wd
 (*
__buf
)

526 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

531 
	$dup
 (
__fd
è
__THROW
 
__wur
;

534 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

536 #ifdeà
__USE_GNU


539 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

543 **
__’vœÚ
;

544 #ifdeà
__USE_GNU


545 **
’vœÚ
;

551 
	$execve
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[],

552 *cÚ¡ 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

554 #ifdeà
__USE_XOPEN2K8


557 
	$ãxecve
 (
__fd
, *cÚ¡ 
__¬gv
[], *cÚ¡ 
__’vp
[])

558 
__THROW
 
	`__nÚnuÎ
 ((2));

563 
	$execv
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[])

564 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

568 
	$exeşe
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

569 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

573 
	$exeş
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

574 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

578 
	$execvp
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[])

579 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 
	$exeşp
 (cÚ¡ *
__fe
, cÚ¡ *
__¬g
, ...)

585 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

587 #ifdeà
__USE_GNU


590 
	$execv³
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[],

591 *cÚ¡ 
__’vp
[])

592 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

596 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


598 
	$niû
 (
__šc
è
__THROW
 
__wur
;

603 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

609 
	~<b™s/cÚâame.h
>

612 
	$·thcÚf
 (cÚ¡ *
__·th
, 
__Çme
)

613 
__THROW
 
	`__nÚnuÎ
 ((1));

616 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

619 
	$syscÚf
 (
__Çme
è
__THROW
;

621 #ifdef 
__USE_POSIX2


623 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

628 
__pid_t
 
	$g‘pid
 (è
__THROW
;

631 
__pid_t
 
	$g‘µid
 (è
__THROW
;

634 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

637 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

638 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


639 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

646 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

648 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


660 
	$£g½
 (è
__THROW
;

667 
__pid_t
 
	$£tsid
 (è
__THROW
;

669 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


671 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

675 
__uid_t
 
	$g‘uid
 (è
__THROW
;

678 
__uid_t
 
	$g‘euid
 (è
__THROW
;

681 
__gid_t
 
	$g‘gid
 (è
__THROW
;

684 
__gid_t
 
	$g‘egid
 (è
__THROW
;

689 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

691 #ifdef 
__USE_GNU


693 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

700 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

702 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


705 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
 
__wur
;

708 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


710 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

717 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

719 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


722 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
 
__wur
;

725 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


727 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

730 #ifdeà
__USE_GNU


733 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

734 
__THROW
;

738 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

739 
__THROW
;

743 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

744 
__THROW
 
__wur
;

748 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

749 
__THROW
 
__wur
;

756 
__pid_t
 
	$fÜk
 (è
__THROWNL
;

758 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

759 || 
defšed
 
__USE_BSD


764 
__pid_t
 
	$vfÜk
 (è
__THROW
;

770 *
	$‰yÇme
 (
__fd
è
__THROW
;

774 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

775 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

779 
	$i§‰y
 (
__fd
è
__THROW
;

781 #ià
defšed
 
__USE_BSD
 \

782 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_UNIX98
)

785 
	$‰y¦Ù
 (è
__THROW
;

790 
	$lšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

791 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

793 #ifdeà
__USE_ATFILE


796 
	$lšk©
 (
__äomfd
, cÚ¡ *
__äom
, 
__tofd
,

797 cÚ¡ *
__to
, 
__æags
)

798 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

801 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


803 
	$symlšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

804 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

809 
ssize_t
 
	$»adlšk
 (cÚ¡ *
__»¡riù
 
__·th
,

810 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

811 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

814 #ifdeà
__USE_ATFILE


816 
	$symlšk©
 (cÚ¡ *
__äom
, 
__tofd
,

817 cÚ¡ *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

820 
ssize_t
 
	$»adlšk©
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

821 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

822 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

826 
	$uÆšk
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

828 #ifdeà
__USE_ATFILE


830 
	$uÆšk©
 (
__fd
, cÚ¡ *
__Çme
, 
__æag
)

831 
__THROW
 
	`__nÚnuÎ
 ((2));

835 
	$rmdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

839 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

842 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

849 *
	`g‘logš
 ();

850 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


857 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

860 #ifdef 
__USE_BSD


862 
	$£ogš
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

866 #ifdef 
__USE_POSIX2


870 
	#__Ãed_g‘İt


	)

871 
	~<g‘İt.h
>

875 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


879 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

883 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

886 
	$£tho¡Çme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

887 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

891 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

897 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

898 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

899 
	$£tdomašÇme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

900 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

906 
	$vhªgup
 (è
__THROW
;

909 
	$»voke
 (cÚ¡ *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

917 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

918 
size_t
 
__off£t
, 
__sÿË
)

919 
__THROW
 
	`__nÚnuÎ
 ((1));

925 
	$acù
 (cÚ¡ *
__Çme
è
__THROW
;

929 *
	$g‘u£rsh–l
 (è
__THROW
;

930 
	$’du£rsh–l
 (è
__THROW
;

931 
	$£tu£rsh–l
 (è
__THROW
;

937 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

941 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

944 
	$chroÙ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

948 *
	$g‘·ss
 (cÚ¡ *
__´om±
è
	`__nÚnuÎ
 ((1));

956 
	`fsync
 (
__fd
);

959 #ifdeà
__USE_GNU


962 
	$syncfs
 (
__fd
è
__THROW
;

966 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


969 
	`g‘ho¡id
 ();

972 
	$sync
 (è
__THROW
;

975 #ià
defšed
 
__USE_BSD
 || !defšed 
__USE_XOPEN2K


978 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

983 
	$g‘dbËsize
 (è
__THROW
;

989 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


992 #iâdeà
__USE_FILE_OFFSET64


993 
	$Œunÿ‹
 (cÚ¡ *
__fe
, 
__off_t
 
__Ëngth
)

994 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

996 #ifdeà
__REDIRECT_NTH


997 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

998 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
),

999 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1001 
	#Œunÿ‹
 
Œunÿ‹64


	)

1004 #ifdeà
__USE_LARGEFILE64


1005 
	$Œunÿ‹64
 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
)

1006 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1011 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_POSIX199309
 \

1012 || 
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1015 #iâdeà
__USE_FILE_OFFSET64


1016 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1018 #ifdeà
__REDIRECT_NTH


1019 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1020 
árunÿ‹64
è
__wur
;

1022 
	#árunÿ‹
 
árunÿ‹64


	)

1025 #ifdeà
__USE_LARGEFILE64


1026 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1032 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1033 || 
defšed
 
__USE_MISC


1037 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1043 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1047 #ifdeà
__USE_MISC


1058 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1063 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1075 
	#F_ULOCK
 0

	)

1076 
	#F_LOCK
 1

	)

1077 
	#F_TLOCK
 2

	)

1078 
	#F_TEST
 3

	)

1080 #iâdeà
__USE_FILE_OFFSET64


1081 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1083 #ifdeà
__REDIRECT


1084 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1085 
lockf64
è
__wur
;

1087 
	#lockf
 
lockf64


	)

1090 #ifdeà
__USE_LARGEFILE64


1091 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1096 #ifdeà
__USE_GNU


1101 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1102 (
__ex‹nsiÚ__
 \

1103 ({ 
__»suÉ
; \

1104 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1105 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1106 
__»suÉ
; 
	}
}))

	)

1109 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1112 
fd©async
 (
__fdes
);

1118 #ifdef 
__USE_XOPEN


1120 *
	$üy±
 (cÚ¡ *
__key
, cÚ¡ *
__§É
)

1121 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1125 
	$’üy±
 (*
__glibc_block
, 
__edæag
)

1126 
__THROW
 
	`__nÚnuÎ
 ((1));

1133 
	$swab
 (cÚ¡ *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1134 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1140 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K


1142 *
	$ù”mid
 (*
__s
è
__THROW
;

1147 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


1148 
	~<b™s/uni¡d.h
>

1151 
__END_DECLS


	@/usr/include/zlib.h

31 #iâdeà
ZLIB_H


32 
	#ZLIB_H


	)

34 
	~"zcÚf.h
"

36 #ifdeà
__ılu¥lus


40 
	#ZLIB_VERSION
 "1.2.8"

	)

41 
	#ZLIB_VERNUM
 0x1280

	)

42 
	#ZLIB_VER_MAJOR
 1

	)

43 
	#ZLIB_VER_MINOR
 2

	)

44 
	#ZLIB_VER_REVISION
 8

	)

45 
	#ZLIB_VER_SUBREVISION
 0

	)

80 
voidpf
 (*
	t®loc_func
è
	tOF
((
	tvoidpf
 
	tİaque
, 
	tuIÁ
 
	t™ems
, uIÁ 
	tsize
));

81 (*
ä“_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	tadd»ss
));

83 
š‹º®_¡©e
;

85 
	sz_¡»am_s
 {

86 
z_cÚ¡
 
By‹f
 *
Ãxt_š
;

87 
uIÁ
 
ava_š
;

88 
uLÚg
 
tÙ®_š
;

90 
By‹f
 *
Ãxt_out
;

91 
uIÁ
 
ava_out
;

92 
uLÚg
 
tÙ®_out
;

94 
z_cÚ¡
 *
msg
;

95 
š‹º®_¡©e
 
FAR
 *
¡©e
;

97 
®loc_func
 
z®loc
;

98 
ä“_func
 
zä“
;

99 
voidpf
 
İaque
;

101 
d©a_ty³
;

102 
uLÚg
 
adËr
;

103 
uLÚg
 
»£rved
;

104 } 
	tz_¡»am
;

106 
z_¡»am
 
	tFAR
 *
	tz_¡»amp
;

112 
	sgz_h—d”_s
 {

113 
‹xt
;

114 
uLÚg
 
time
;

115 
xæags
;

116 
os
;

117 
By‹f
 *
exŒa
;

118 
uIÁ
 
exŒa_Ën
;

119 
uIÁ
 
exŒa_max
;

120 
By‹f
 *
Çme
;

121 
uIÁ
 
Çme_max
;

122 
By‹f
 *
comm’t
;

123 
uIÁ
 
comm_max
;

124 
hüc
;

125 
dÚe
;

127 } 
	tgz_h—d”
;

129 
gz_h—d”
 
	tFAR
 *
	tgz_h—d”p
;

164 
	#Z_NO_FLUSH
 0

	)

165 
	#Z_PARTIAL_FLUSH
 1

	)

166 
	#Z_SYNC_FLUSH
 2

	)

167 
	#Z_FULL_FLUSH
 3

	)

168 
	#Z_FINISH
 4

	)

169 
	#Z_BLOCK
 5

	)

170 
	#Z_TREES
 6

	)

173 
	#Z_OK
 0

	)

174 
	#Z_STREAM_END
 1

	)

175 
	#Z_NEED_DICT
 2

	)

176 
	#Z_ERRNO
 (-1)

	)

177 
	#Z_STREAM_ERROR
 (-2)

	)

178 
	#Z_DATA_ERROR
 (-3)

	)

179 
	#Z_MEM_ERROR
 (-4)

	)

180 
	#Z_BUF_ERROR
 (-5)

	)

181 
	#Z_VERSION_ERROR
 (-6)

	)

186 
	#Z_NO_COMPRESSION
 0

	)

187 
	#Z_BEST_SPEED
 1

	)

188 
	#Z_BEST_COMPRESSION
 9

	)

189 
	#Z_DEFAULT_COMPRESSION
 (-1)

	)

192 
	#Z_FILTERED
 1

	)

193 
	#Z_HUFFMAN_ONLY
 2

	)

194 
	#Z_RLE
 3

	)

195 
	#Z_FIXED
 4

	)

196 
	#Z_DEFAULT_STRATEGY
 0

	)

199 
	#Z_BINARY
 0

	)

200 
	#Z_TEXT
 1

	)

201 
	#Z_ASCII
 
Z_TEXT


	)

202 
	#Z_UNKNOWN
 2

	)

205 
	#Z_DEFLATED
 8

	)

208 
	#Z_NULL
 0

	)

210 
	#zlib_v”siÚ
 
	`zlibV”siÚ
()

	)

216 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
zlibV”siÚ
 
OF
(());

246 
ZEXTERN
 
ZEXPORT
 
deæ©e
 
OF
((
z_¡»amp
 
¡rm
, 
æush
));

353 
ZEXTERN
 
ZEXPORT
 
deæ©eEnd
 
OF
((
z_¡»amp
 
¡rm
));

392 
ZEXTERN
 
ZEXPORT
 
šæ©e
 
OF
((
z_¡»amp
 
¡rm
, 
æush
));

508 
ZEXTERN
 
ZEXPORT
 
šæ©eEnd
 
OF
((
z_¡»amp
 
¡rm
));

587 
ZEXTERN
 
ZEXPORT
 
deæ©eS‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

588 cÚ¡ 
By‹f
 *
diùiÚ¬y
,

589 
uIÁ
 
diùL’gth
));

631 
ZEXTERN
 
ZEXPORT
 
deæ©eCİy
 
OF
((
z_¡»amp
 
de¡
,

632 
z_¡»amp
 
sourû
));

649 
ZEXTERN
 
ZEXPORT
 
deæ©eRe£t
 
OF
((
z_¡»amp
 
¡rm
));

660 
ZEXTERN
 
ZEXPORT
 
deæ©eP¬ams
 
OF
((
z_¡»amp
 
¡rm
,

661 
Ëv–
,

662 
¡¿‹gy
));

681 
ZEXTERN
 
ZEXPORT
 
deæ©eTuÃ
 
OF
((
z_¡»amp
 
¡rm
,

682 
good_Ëngth
,

683 
max_Ïzy
,

684 
niû_Ëngth
,

685 
max_chaš
));

698 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
deæ©eBound
 
OF
((
z_¡»amp
 
¡rm
,

699 
uLÚg
 
sourûL’
));

713 
ZEXTERN
 
ZEXPORT
 
deæ©eP’dšg
 
OF
((
z_¡»amp
 
¡rm
,

714 *
³ndšg
,

715 *
b™s
));

728 
ZEXTERN
 
ZEXPORT
 
deæ©ePrime
 
OF
((
z_¡»amp
 
¡rm
,

729 
b™s
,

730 
v®ue
));

745 
ZEXTERN
 
ZEXPORT
 
deæ©eS‘H—d”
 
OF
((
z_¡»amp
 
¡rm
,

746 
gz_h—d”p
 
h—d
));

819 
ZEXTERN
 
ZEXPORT
 
šæ©eS‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

820 cÚ¡ 
By‹f
 *
diùiÚ¬y
,

821 
uIÁ
 
diùL’gth
));

842 
ZEXTERN
 
ZEXPORT
 
šæ©eG‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

843 
By‹f
 *
diùiÚ¬y
,

844 
uIÁ
 *
diùL’gth
));

857 
ZEXTERN
 
ZEXPORT
 
šæ©eSync
 
OF
((
z_¡»amp
 
¡rm
));

876 
ZEXTERN
 
ZEXPORT
 
šæ©eCİy
 
OF
((
z_¡»amp
 
de¡
,

877 
z_¡»amp
 
sourû
));

892 
ZEXTERN
 
ZEXPORT
 
šæ©eRe£t
 
OF
((
z_¡»amp
 
¡rm
));

902 
ZEXTERN
 
ZEXPORT
 
šæ©eRe£t2
 
OF
((
z_¡»amp
 
¡rm
,

903 
wšdowB™s
));

914 
ZEXTERN
 
ZEXPORT
 
šæ©ePrime
 
OF
((
z_¡»amp
 
¡rm
,

915 
b™s
,

916 
v®ue
));

935 
ZEXTERN
 
ZEXPORT
 
šæ©eM¬k
 
OF
((
z_¡»amp
 
¡rm
));

963 
ZEXTERN
 
ZEXPORT
 
šæ©eG‘H—d”
 
OF
((
z_¡»amp
 
¡rm
,

964 
gz_h—d”p
 
h—d
));

1025 (*
š_func
è
	tOF
((
	tFAR
 *,

1026 
	tz_cÚ¡
 
	tFAR
 * FAR *));

1027 (*
out_func
è
	tOF
((
	tFAR
 *, FAR *, ));

1029 
ZEXTERN
 
ZEXPORT
 
šæ©eBack
 
OF
((
z_¡»amp
 
¡rm
,

1030 
š_func
 
š
, 
FAR
 *
š_desc
,

1031 
out_func
 
out
, 
FAR
 *
out_desc
));

1099 
ZEXTERN
 
ZEXPORT
 
šæ©eBackEnd
 
OF
((
z_¡»amp
 
¡rm
));

1107 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
zlibCompeFÏgs
 
OF
(());

1148 #iâdeà
Z_SOLO


1160 
ZEXTERN
 
ZEXPORT
 
com´ess
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1161 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
));

1174 
ZEXTERN
 
ZEXPORT
 
com´ess2
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1175 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
,

1176 
Ëv–
));

1190 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
com´essBound
 
OF
((uLÚg 
sourûL’
));

1197 
ZEXTERN
 
ZEXPORT
 
uncom´ess
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1198 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
));

1224 
gzFe_s
 *
	tgzFe
;

1264 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzdİ’
 
OF
((
fd
, cÚ¡ *
mode
));

1287 
ZEXTERN
 
ZEXPORT
 
gzbufãr
 
OF
((
gzFe
 
fe
, 
size
));

1304 
ZEXTERN
 
ZEXPORT
 
gz£¬ams
 
OF
((
gzFe
 
fe
, 
Ëv–
, 
¡¿‹gy
));

1313 
ZEXTERN
 
ZEXPORT
 
gz»ad
 
OF
((
gzFe
 
fe
, 
voidp
 
buf
, 
Ën
));

1341 
ZEXTERN
 
ZEXPORT
 
gzwr™e
 
OF
((
gzFe
 
fe
,

1342 
voidpc
 
buf
, 
Ën
));

1349 
ZEXTERN
 
ZEXPORTVA
 
gz´štf
 
Z_ARG
((
gzFe
 
fe
, cÚ¡ *
fÜm©
, ...));

1364 
ZEXTERN
 
ZEXPORT
 
gzputs
 
OF
((
gzFe
 
fe
, cÚ¡ *
s
));

1372 
ZEXTERN
 * 
ZEXPORT
 
gzg‘s
 
OF
((
gzFe
 
fe
, *
buf
, 
Ën
));

1385 
ZEXTERN
 
ZEXPORT
 
gzputc
 
OF
((
gzFe
 
fe
, 
c
));

1391 
ZEXTERN
 
ZEXPORT
 
gzg‘c
 
OF
((
gzFe
 
fe
));

1400 
ZEXTERN
 
ZEXPORT
 
gzung‘c
 
OF
((
c
, 
gzFe
 
fe
));

1412 
ZEXTERN
 
ZEXPORT
 
gzæush
 
OF
((
gzFe
 
fe
, 
æush
));

1447 
ZEXTERN
 
ZEXPORT
 
gz»wšd
 
OF
((
gzFe
 
fe
));

1475 
ZEXTERN
 
ZEXPORT
 
gzeof
 
OF
((
gzFe
 
fe
));

1490 
ZEXTERN
 
ZEXPORT
 
gzdœeù
 
OF
((
gzFe
 
fe
));

1511 
ZEXTERN
 
ZEXPORT
 
gzşo£
 
OF
((
gzFe
 
fe
));

1524 
ZEXTERN
 
ZEXPORT
 
gzşo£_r
 
OF
((
gzFe
 
fe
));

1525 
ZEXTERN
 
ZEXPORT
 
gzşo£_w
 
OF
((
gzFe
 
fe
));

1536 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
gz”rÜ
 
OF
((
gzFe
 
fe
, *
”ºum
));

1552 
ZEXTERN
 
ZEXPORT
 
gzş—»¼
 
OF
((
gzFe
 
fe
));

1569 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32
 
OF
((uLÚg 
adËr
, cÚ¡ 
By‹f
 *
buf
, 
uIÁ
 
Ën
));

1600 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32
 
OF
((uLÚg 
üc
, cÚ¡ 
By‹f
 *
buf
, 
uIÁ
 
Ën
));

1633 
ZEXTERN
 
ZEXPORT
 
deæ©eIn™_
 
OF
((
z_¡»amp
 
¡rm
, 
Ëv–
,

1634 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1635 
ZEXTERN
 
ZEXPORT
 
šæ©eIn™_
 
OF
((
z_¡»amp
 
¡rm
,

1636 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1637 
ZEXTERN
 
ZEXPORT
 
deæ©eIn™2_
 
OF
((
z_¡»amp
 
¡rm
, 
Ëv–
, 
m‘hod
,

1638 
wšdowB™s
, 
memLev–
,

1639 
¡¿‹gy
, cÚ¡ *
v”siÚ
,

1640 
¡»am_size
));

1641 
ZEXTERN
 
ZEXPORT
 
šæ©eIn™2_
 
OF
((
z_¡»amp
 
¡rm
, 
wšdowB™s
,

1642 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1643 
ZEXTERN
 
ZEXPORT
 
šæ©eBackIn™_
 
OF
((
z_¡»amp
 
¡rm
, 
wšdowB™s
,

1644 
FAR
 *
wšdow
,

1645 cÚ¡ *
v”siÚ
,

1646 
¡»am_size
));

1647 
	#deæ©eIn™
(
¡rm
, 
Ëv–
) \

1648 
	`deæ©eIn™_
((
¡rm
), (
Ëv–
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1649 
	#šæ©eIn™
(
¡rm
) \

1650 
	`šæ©eIn™_
((
¡rm
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1651 
	#deæ©eIn™2
(
¡rm
, 
Ëv–
, 
m‘hod
, 
wšdowB™s
, 
memLev–
, 
¡¿‹gy
) \

1652 
	`deæ©eIn™2_
((
¡rm
),(
Ëv–
),(
m‘hod
),(
wšdowB™s
),(
memLev–
),\

1653 (
¡¿‹gy
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1654 
	#šæ©eIn™2
(
¡rm
, 
wšdowB™s
) \

1655 
	`šæ©eIn™2_
((
¡rm
), (
wšdowB™s
), 
ZLIB_VERSION
, \

1656 ()(
z_¡»am
))

	)

1657 
	#šæ©eBackIn™
(
¡rm
, 
wšdowB™s
, 
wšdow
) \

1658 
	`šæ©eBackIn™_
((
¡rm
), (
wšdowB™s
), (
wšdow
), \

1659 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1661 #iâdeà
Z_SOLO


1670 
	sgzFe_s
 {

1671 
have
;

1672 *
Ãxt
;

1673 
z_off64_t
 
pos
;

1675 
ZEXTERN
 
ZEXPORT
 
gzg‘c_
 
OF
((
gzFe
 
fe
));

1676 #ifdeà
Z_PREFIX_SET


1677 #undeà
z_gzg‘c


1678 
	#z_gzg‘c
(
g
) \

1679 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
Ãxt
)++è: 
	`gzg‘c
(g))

	)

1681 
	#gzg‘c
(
g
) \

1682 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
Ãxt
)++è: 
	`gzg‘c
(g))

	)

1691 #ifdeà
Z_LARGE64


1692 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzİ’64
 
OF
((const *, const *));

1693 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFe
, z_off64_t, ));

1694 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz‹Î64
 
OF
((
gzFe
));

1695 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFe
));

1696 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše64
 
OF
((uLÚg, uLÚg, 
z_off64_t
));

1697 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše64
 
OF
((uLÚg, uLÚg, 
z_off64_t
));

1700 #ià!
defšed
(
ZLIB_INTERNAL
è&& defšed(
Z_WANT64
)

1701 #ifdeà
Z_PREFIX_SET


1702 
	#z_gzİ’
 
z_gzİ’64


	)

1703 
	#z_gz£ek
 
z_gz£ek64


	)

1704 
	#z_gz‹Î
 
z_gz‹Î64


	)

1705 
	#z_gzoff£t
 
z_gzoff£t64


	)

1706 
	#z_adËr32_combše
 
z_adËr32_combše64


	)

1707 
	#z_üc32_combše
 
z_üc32_combše64


	)

1709 
	#gzİ’
 
gzİ’64


	)

1710 
	#gz£ek
 
gz£ek64


	)

1711 
	#gz‹Î
 
gz‹Î64


	)

1712 
	#gzoff£t
 
gzoff£t64


	)

1713 
	#adËr32_combše
 
adËr32_combše64


	)

1714 
	#üc32_combše
 
üc32_combše64


	)

1716 #iâdeà
Z_LARGE64


1717 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzİ’64
 
OF
((const *, const *));

1718 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFe
, z_off_t, ));

1719 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz‹Î64
 
OF
((
gzFe
));

1720 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFe
));

1721 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše64
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1722 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše64
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1725 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzİ’
 
OF
((const *, const *));

1726 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek
 
OF
((
gzFe
, z_off_t, ));

1727 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz‹Î
 
OF
((
gzFe
));

1728 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t
 
OF
((
gzFe
));

1729 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1730 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1735 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1736 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1741 #ià!
defšed
(
ZUTIL_H
è&& !defšed(
NO_DUMMY_DECL
)

1742 
	sš‹º®_¡©e
 {
dummy
;};

1746 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
zE¼Ü
 
OF
(());

1747 
ZEXTERN
 
ZEXPORT
 
šæ©eSyncPošt
 
OF
((
z_¡»amp
));

1748 
ZEXTERN
 cÚ¡ 
z_üc_t
 
FAR
 * 
ZEXPORT
 
g‘_üc_bË
 
OF
(());

1749 
ZEXTERN
 
ZEXPORT
 
šæ©eUnd”mše
 
OF
((
z_¡»amp
, ));

1750 
ZEXTERN
 
ZEXPORT
 
šæ©eRe£tK“p
 
OF
((
z_¡»amp
));

1751 
ZEXTERN
 
ZEXPORT
 
deæ©eRe£tK“p
 
OF
((
z_¡»amp
));

1752 #ià
defšed
(
_WIN32
è&& !defšed(
Z_SOLO
)

1753 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzİ’_w
 
OF
((cÚ¡ 
wch¬_t
 *
·th
,

1754 cÚ¡ *
mode
));

1756 #ià
defšed
(
STDC
è|| defšed(
Z_HAVE_STDARG_H
)

1757 #iâdeà
Z_SOLO


1758 
ZEXTERN
 
ZEXPORTVA
 
gzv´štf
 
Z_ARG
((
gzFe
 
fe
,

1759 cÚ¡ *
fÜm©
,

1760 
va_li¡
 
va
));

1764 #ifdeà
__ılu¥lus


	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

101 #undeà
__USE_ISOC11


102 #undeà
__USE_ISOC99


103 #undeà
__USE_ISOC95


104 #undeà
__USE_ISOCXX11


105 #undeà
__USE_POSIX


106 #undeà
__USE_POSIX2


107 #undeà
__USE_POSIX199309


108 #undeà
__USE_POSIX199506


109 #undeà
__USE_XOPEN


110 #undeà
__USE_XOPEN_EXTENDED


111 #undeà
__USE_UNIX98


112 #undeà
__USE_XOPEN2K


113 #undeà
__USE_XOPEN2KXSI


114 #undeà
__USE_XOPEN2K8


115 #undeà
__USE_XOPEN2K8XSI


116 #undeà
__USE_LARGEFILE


117 #undeà
__USE_LARGEFILE64


118 #undeà
__USE_FILE_OFFSET64


119 #undeà
__USE_BSD


120 #undeà
__USE_SVID


121 #undeà
__USE_MISC


122 #undeà
__USE_ATFILE


123 #undeà
__USE_GNU


124 #undeà
__USE_REENTRANT


125 #undeà
__USE_FORTIFY_LEVEL


126 #undeà
__KERNEL_STRICT_NAMES


130 #iâdeà
_LOOSE_KERNEL_NAMES


131 
	#__KERNEL_STRICT_NAMES


	)

141 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


142 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

143 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

145 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

150 #ifdeà
_GNU_SOURCE


151 #undeà
_ISOC95_SOURCE


152 
	#_ISOC95_SOURCE
 1

	)

153 #undeà
_ISOC99_SOURCE


154 
	#_ISOC99_SOURCE
 1

	)

155 #undeà
_ISOC11_SOURCE


156 
	#_ISOC11_SOURCE
 1

	)

157 #undeà
_POSIX_SOURCE


158 
	#_POSIX_SOURCE
 1

	)

159 #undeà
_POSIX_C_SOURCE


160 
	#_POSIX_C_SOURCE
 200809L

	)

161 #undeà
_XOPEN_SOURCE


162 
	#_XOPEN_SOURCE
 700

	)

163 #undeà
_XOPEN_SOURCE_EXTENDED


164 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

165 #undeà
_LARGEFILE64_SOURCE


166 
	#_LARGEFILE64_SOURCE
 1

	)

167 #undeà
_DEFAULT_SOURCE


168 
	#_DEFAULT_SOURCE
 1

	)

169 #undeà
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #undeà
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(
defšed
 
_DEFAULT_SOURCE
 \

180 || (!
defšed
 
	g__STRICT_ANSI__
 \

181 && !
defšed
 
	g_ISOC99_SOURCE
 \

182 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

183 && !
defšed
 
	g_XOPEN_SOURCE
 \

184 && !
defšed
 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
))

185 #undeà
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

187 #undeà
_BSD_SOURCE


188 
	#_BSD_SOURCE
 1

	)

189 #undeà
_SVID_SOURCE


190 
	#_SVID_SOURCE
 1

	)

194 #ià(
defšed
 
_ISOC11_SOURCE
 \

195 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

196 
	#__USE_ISOC11
 1

	)

200 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

201 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

202 
	#__USE_ISOC99
 1

	)

206 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

207 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

208 
	#__USE_ISOC95
 1

	)

215 #ià((
defšed
 
__ılu¥lus
 && __cplusplus >= 201103L) \

216 || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
)

217 
	#__USE_ISOCXX11
 1

	)

223 #ifdeà
_DEFAULT_SOURCE


224 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


225 
	#__USE_POSIX_IMPLICITLY
 1

	)

227 #undeà
_POSIX_SOURCE


228 
	#_POSIX_SOURCE
 1

	)

229 #undeà
_POSIX_C_SOURCE


230 
	#_POSIX_C_SOURCE
 200809L

	)

232 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

233 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

234 
	#_POSIX_SOURCE
 1

	)

235 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

236 
	#_POSIX_C_SOURCE
 2

	)

237 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

238 
	#_POSIX_C_SOURCE
 199506L

	)

239 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

240 
	#_POSIX_C_SOURCE
 200112L

	)

242 
	#_POSIX_C_SOURCE
 200809L

	)

244 
	#__USE_POSIX_IMPLICITLY
 1

	)

247 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


248 
	#__USE_POSIX
 1

	)

251 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


252 
	#__USE_POSIX2
 1

	)

255 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

256 
	#__USE_POSIX199309
 1

	)

259 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

260 
	#__USE_POSIX199506
 1

	)

263 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

264 
	#__USE_XOPEN2K
 1

	)

265 #undeà
__USE_ISOC95


266 
	#__USE_ISOC95
 1

	)

267 #undeà
__USE_ISOC99


268 
	#__USE_ISOC99
 1

	)

271 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

272 
	#__USE_XOPEN2K8
 1

	)

273 #undeà
_ATFILE_SOURCE


274 
	#_ATFILE_SOURCE
 1

	)

277 #ifdef 
_XOPEN_SOURCE


278 
	#__USE_XOPEN
 1

	)

279 #ià(
_XOPEN_SOURCE
 - 0) >= 500

280 
	#__USE_XOPEN_EXTENDED
 1

	)

281 
	#__USE_UNIX98
 1

	)

282 #undeà
_LARGEFILE_SOURCE


283 
	#_LARGEFILE_SOURCE
 1

	)

284 #ià(
_XOPEN_SOURCE
 - 0) >= 600

285 #ià(
_XOPEN_SOURCE
 - 0) >= 700

286 
	#__USE_XOPEN2K8
 1

	)

287 
	#__USE_XOPEN2K8XSI
 1

	)

289 
	#__USE_XOPEN2K
 1

	)

290 
	#__USE_XOPEN2KXSI
 1

	)

291 #undeà
__USE_ISOC95


292 
	#__USE_ISOC95
 1

	)

293 #undeà
__USE_ISOC99


294 
	#__USE_ISOC99
 1

	)

297 #ifdeà
_XOPEN_SOURCE_EXTENDED


298 
	#__USE_XOPEN_EXTENDED
 1

	)

303 #ifdeà
_LARGEFILE_SOURCE


304 
	#__USE_LARGEFILE
 1

	)

307 #ifdeà
_LARGEFILE64_SOURCE


308 
	#__USE_LARGEFILE64
 1

	)

311 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

312 
	#__USE_FILE_OFFSET64
 1

	)

315 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


316 
	#__USE_MISC
 1

	)

319 #ifdef 
_BSD_SOURCE


320 
	#__USE_BSD
 1

	)

323 #ifdef 
_SVID_SOURCE


324 
	#__USE_SVID
 1

	)

327 #ifdef 
_ATFILE_SOURCE


328 
	#__USE_ATFILE
 1

	)

331 #ifdef 
_GNU_SOURCE


332 
	#__USE_GNU
 1

	)

335 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


336 
	#__USE_REENTRANT
 1

	)

339 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

340 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

341 #ià
_FORTIFY_SOURCE
 > 1

342 
	#__USE_FORTIFY_LEVEL
 2

	)

344 
	#__USE_FORTIFY_LEVEL
 1

	)

347 
	#__USE_FORTIFY_LEVEL
 0

	)

352 
	~<¡dc-´edef.h
>

360 #undeà
__GNU_LIBRARY__


361 
	#__GNU_LIBRARY__
 6

	)

365 
	#__GLIBC__
 2

	)

366 
	#__GLIBC_MINOR__
 19

	)

368 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

369 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

372 #iâdeà
__ASSEMBLER__


373 #iâdeà
_SYS_CDEFS_H


374 
	~<sys/cdefs.h
>

379 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


380 
	#__USE_LARGEFILE
 1

	)

381 
	#__USE_LARGEFILE64
 1

	)

387 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

388 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

389 && 
defšed
 
	g__ex‹º_šlše


390 
	#__USE_EXTERN_INLINES
 1

	)

398 
	~<gnu/¡ubs.h
>

	@/usr/include/libio.h

28 #iâdeà
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_cÚfig.h
>

33 
	#_IO_åos_t
 
_G_åos_t


	)

34 
	#_IO_åos64_t
 
_G_åos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li¡
 
_G_va_li¡


	)

45 
	#_IO_wšt_t
 
wšt_t


	)

48 
	#__Ãed___va_li¡


	)

49 
	~<¡d¬g.h
>

50 #ifdeà
__GNUC_VA_LIST


51 #undeà
_IO_va_li¡


52 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

55 #iâdeà
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #iâdeà
EOF


62 
	#EOF
 (-1)

	)

64 #iâdeà
NULL


65 #ià
defšed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =ğ2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuÎ
)

	)

69 #ià!
defšed
(
__ılu¥lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifdeà
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifdeà
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifdeà
_IO_MTSAFE_IO


148 #ià
defšed
 
__GLIBC__
 && __GLIBC__ >= 2

149 
	~<b™s/¡dio-lock.h
>

154 
	t_IO_lock_t
;

160 
	s_IO_m¬k”
 {

161 
_IO_m¬k”
 *
	m_Ãxt
;

162 
_IO_FILE
 *
	m_sbuf
;

166 
	m_pos
;

168 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

169 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

170 
	mpublic
:

171 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

172 ~
¡»amm¬k”
();

173 
§všg
(è{  
	m_¥os
 == -2; }

174 
d–
(
¡»amm¬k”
&);

175 
d–
();

180 
	e__codecvt_»suÉ


182 
	m__codecvt_ok
,

183 
	m__codecvt_·¹Ÿl
,

184 
	m__codecvt_”rÜ
,

185 
	m__codecvt_nocÚv


188 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


191 
	s_IO_codecvt


193 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

194 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

195 
	m__mb¡©e_t
 *,

196 cÚ¡ 
	mwch¬_t
 *,

197 cÚ¡ 
	mwch¬_t
 *,

198 cÚ¡ 
	mwch¬_t
 **, *,

200 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

201 
	m__mb¡©e_t
 *, *,

203 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

204 
	m__mb¡©e_t
 *,

206 cÚ¡ **, 
	mwch¬_t
 *,

207 
	mwch¬_t
 *, wchar_t **);

208 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

209 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

210 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

211 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

212 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

214 
_IO_icÚv_t
 
	m__cd_š
;

215 
_IO_icÚv_t
 
	m__cd_out
;

219 
	s_IO_wide_d©a


221 
wch¬_t
 *
	m_IO_»ad_±r
;

222 
wch¬_t
 *
	m_IO_»ad_’d
;

223 
wch¬_t
 *
	m_IO_»ad_ba£
;

224 
wch¬_t
 *
	m_IO_wr™e_ba£
;

225 
wch¬_t
 *
	m_IO_wr™e_±r
;

226 
wch¬_t
 *
	m_IO_wr™e_’d
;

227 
wch¬_t
 *
	m_IO_buf_ba£
;

228 
wch¬_t
 *
	m_IO_buf_’d
;

230 
wch¬_t
 *
	m_IO_§ve_ba£
;

231 
wch¬_t
 *
	m_IO_backup_ba£
;

233 
wch¬_t
 *
	m_IO_§ve_’d
;

235 
__mb¡©e_t
 
	m_IO_¡©e
;

236 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

237 
_IO_codecvt
 
	m_codecvt
;

239 
wch¬_t
 
	m_shÜtbuf
[1];

241 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

245 
	s_IO_FILE
 {

246 
	m_æags
;

247 
	#_IO_fe_æags
 
_æags


	)

251 * 
	m_IO_»ad_±r
;

252 * 
	m_IO_»ad_’d
;

253 * 
	m_IO_»ad_ba£
;

254 * 
	m_IO_wr™e_ba£
;

255 * 
	m_IO_wr™e_±r
;

256 * 
	m_IO_wr™e_’d
;

257 * 
	m_IO_buf_ba£
;

258 * 
	m_IO_buf_’d
;

260 *
	m_IO_§ve_ba£
;

261 *
	m_IO_backup_ba£
;

262 *
	m_IO_§ve_’d
;

264 
_IO_m¬k”
 *
	m_m¬k”s
;

266 
_IO_FILE
 *
	m_chaš
;

268 
	m_f’o
;

270 
	m_blksize
;

272 
	m_æags2
;

274 
_IO_off_t
 
	m_Şd_off£t
;

276 
	#__HAVE_COLUMN


	)

278 
	m_cur_cŞumn
;

279 sigÃd 
	m_vbË_off£t
;

280 
	m_shÜtbuf
[1];

284 
_IO_lock_t
 *
	m_lock
;

285 #ifdeà
_IO_USE_OLD_IO_FILE


288 
	s_IO_FILE_com¶‘e


290 
_IO_FILE
 
	m_fe
;

292 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

293 
_IO_off64_t
 
	m_off£t
;

294 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


296 
_IO_codecvt
 *
	m_codecvt
;

297 
_IO_wide_d©a
 *
	m_wide_d©a
;

298 
_IO_FILE
 *
	m_ä“»s_li¡
;

299 *
	m_ä“»s_buf
;

300 
size_t
 
	m_ä“»s_size
;

302 *
	m__·d1
;

303 *
	m__·d2
;

304 *
	m__·d3
;

305 *
	m__·d4
;

306 
size_t
 
	m__·d5
;

308 
	m_mode
;

310 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

314 #iâdeà
__ılu¥lus


315 
_IO_FILE
 
	t_IO_FILE
;

318 
	g_IO_FILE_¶us
;

320 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

321 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

322 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

323 #iâdeà
_LIBC


324 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

325 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

326 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

328 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

329 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

330 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

338 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

346 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, cÚ¡ *
	t__buf
,

347 
	tsize_t
 
	t__n
);

355 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

358 
	t__io_şo£_â
 (*
	t__cook›
);

361 #ifdeà
_GNU_SOURCE


363 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

364 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

365 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

366 
__io_şo£_â
 
	tcook›_şo£_funùiÚ_t
;

371 
__io_»ad_â
 *
	m»ad
;

372 
__io_wr™e_â
 *
	mwr™e
;

373 
__io_£ek_â
 *
	m£ek
;

374 
__io_şo£_â
 *
	mşo£
;

375 } 
	t_IO_cook›_io_funùiÚs_t
;

376 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

378 
	g_IO_cook›_fe
;

381 
_IO_cook›_š™
 (
_IO_cook›_fe
 *
__cfe
, 
__»ad_wr™e
,

382 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

386 #ifdeà
__ılu¥lus


390 
__und”æow
 (
_IO_FILE
 *);

391 
__uæow
 (
_IO_FILE
 *);

392 
__ov”æow
 (
_IO_FILE
 *, );

393 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


394 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

395 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

396 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

399 #ià 
__GNUC__
 >= 3

400 
	#_IO_BE
(
ex´
, 
»s
è
	`__butš_ex³ù
 (Óx´),„es)

	)

402 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

405 
	#_IO_g‘c_uÆocked
(
_å
) \

406 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

407 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

408 
	#_IO_³ekc_uÆocked
(
_å
) \

409 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

410 && 
	`__und”æow
 (
_å
è=ğ
EOF
 ? EOF \

411 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

412 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

413 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ğ(_å)->
_IO_wr™e_’d
, 0) \

414 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

415 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

417 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


418 
	#_IO_g‘wc_uÆocked
(
_å
) \

419 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

420 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

421 >ğ(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

422 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

423 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

424 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

425 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

426 >ğ(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

427 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

428 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

431 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ğ0)

	)

432 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ğ0)

	)

434 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

435 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

436 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

437 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

439 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

442 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

443 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

445 
_IO_æockfe
 (
_IO_FILE
 *è
__THROW
;

446 
_IO_fuÆockfe
 (
_IO_FILE
 *è
__THROW
;

447 
_IO_árylockfe
 (
_IO_FILE
 *è
__THROW
;

449 #ifdeà
_IO_MTSAFE_IO


450 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

451 
	#_IO_æockfe
(
_å
) \

452 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_æockfe
 (_å)

	)

453 
	#_IO_fuÆockfe
(
_å
) \

454 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_fuÆockfe
 (_å)

	)

456 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

457 
	#_IO_æockfe
(
_å
è

	)

458 
	#_IO_fuÆockfe
(
_å
è

	)

459 
	#_IO_árylockfe
(
_å
è

	)

460 
	#_IO_ş—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

461 
	#_IO_ş—nup_»giÚ_’d
(
_Do™
è

	)

464 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

465 
_IO_va_li¡
, *
__»¡riù
);

466 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

467 
_IO_va_li¡
);

468 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

469 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

471 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

472 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

474 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

476 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


477 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

478 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

479 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

480 #ià
__GNUC__
 >= 2

483 #ià
defšed
 
_LIBC
 && defšed 
SHARED


484 
	~<shlib-com·t.h
>

485 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

486 
	#_IO_fwide_maybe_šcom·tibË
 \

487 (
	`__butš_ex³ù
 (&
_IO_¡dš_u£d
 =ğ
NULL
, 0))

	)

488 cÚ¡ 
_IO_¡dš_u£d
;

489 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

492 #iâdeà
_IO_fwide_maybe_šcom·tibË


493 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

497 
	#_IO_fwide
(
__å
, 
__mode
) \

498 ({ 
__»suÉ
 = (
__mode
); \

499 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

501 ià((
__å
)->
_mode
 == 0) \

503 (
__å
)->
_mode
 = -1; \

504 
__»suÉ
 = (
__å
)->
_mode
; \

506 ià(
	`__butš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

507 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

509 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

510 
__»suÉ
; })

	)

513 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

514 
_IO_va_li¡
, *
__»¡riù
);

515 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

516 
_IO_va_li¡
);

517 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

518 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

521 #ifdeà
__LDBL_COMPAT


522 
	~<b™s/libio-ldbl.h
>

525 #ifdeà
__ılu¥lus


	@/usr/include/rpc/netdb.h

36 #iâdeà
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<ã©u»s.h
>

41 
	#__Ãed_size_t


	)

42 
	~<¡ddef.h
>

44 
__BEGIN_DECLS


46 
	s½ûÁ


48 *
	mr_Çme
;

49 **
	mr_®Ÿ£s
;

50 
	mr_numb”
;

53 
	$£ŒpûÁ
 (
__¡ayİ’
è
__THROW
;

54 
	$’d½ûÁ
 (è
__THROW
;

55 
½ûÁ
 *
	$g‘½cbyÇme
 (cÚ¡ *
__Çme
è
__THROW
;

56 
½ûÁ
 *
	$g‘½cbynumb”
 (
__numb”
è
__THROW
;

57 
½ûÁ
 *
	$g‘½ûÁ
 (è
__THROW
;

59 #ifdeà
__USE_MISC


60 
	$g‘½cbyÇme_r
 (cÚ¡ *
__Çme
, 
½ûÁ
 *
__»suÉ_buf
,

61 *
__bufãr
, 
size_t
 
__buæ’
,

62 
½ûÁ
 **
__»suÉ
è
__THROW
;

64 
	$g‘½cbynumb”_r
 (
__numb”
, 
½ûÁ
 *
__»suÉ_buf
,

65 *
__bufãr
, 
size_t
 
__buæ’
,

66 
½ûÁ
 **
__»suÉ
è
__THROW
;

68 
	$g‘½ûÁ_r
 (
½ûÁ
 *
__»suÉ_buf
, *
__bufãr
,

69 
size_t
 
__buæ’
, 
½ûÁ
 **
__»suÉ
è
__THROW
;

72 
__END_DECLS


	@/usr/include/xlocale.h

20 #iâdeà
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loÿË_¡ruù


30 
__loÿË_d©a
 *
	m__loÿËs
[13];

33 cÚ¡ *
	m__ùy³_b
;

34 cÚ¡ *
	m__ùy³_tŞow”
;

35 cÚ¡ *
	m__ùy³_touµ”
;

38 cÚ¡ *
	m__Çmes
[13];

39 } *
	t__loÿË_t
;

42 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

23 
__off_t
 
	m__pos
;

24 
__mb¡©e_t
 
	m__¡©e
;

25 } 
	t_G_åos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb¡©e_t
 
	m__¡©e
;

30 } 
	t_G_åos64_t
;

31 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gcÚv.h
>

35 
__gcÚv_šfo
 
	m__cd
;

38 
__gcÚv_šfo
 
	m__cd
;

39 
__gcÚv_¡•_d©a
 
	m__d©a
;

40 } 
	m__combšed
;

41 } 
	t_G_icÚv_t
;

46 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

54 
	#__STDC_ISO_10646__
 201103L

	)

57 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/gconv.h

22 #iâdeà
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	#__Ãed_mb¡©e_t


	)

27 
	#__Ãed_wšt_t


	)

28 
	~<wch¬.h
>

29 
	#__Ãed_size_t


	)

30 
	#__Ãed_wch¬_t


	)

31 
	~<¡ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004

64 
	g__gcÚv_¡•
;

65 
	g__gcÚv_¡•_d©a
;

66 
	g__gcÚv_lßded_objeù
;

67 
	g__gcÚv_Œªs_d©a
;

71 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

79 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

80 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

84 (*
	t__gcÚv_Œªs_fù
è(
	t__gcÚv_¡•
 *,

85 
	t__gcÚv_¡•_d©a
 *, *,

89 
	tsize_t
 *);

92 (*
	t__gcÚv_Œªs_cÚ‹xt_fù
) (*, const *,

97 (*
	t__gcÚv_Œªs_qu”y_fù
) (const *, const ***,

98 
	tsize_t
 *);

101 (*
	t__gcÚv_Œªs_š™_fù
) (**, const *);

102 (*
	t__gcÚv_Œªs_’d_fù
) (*);

104 
	s__gcÚv_Œªs_d©a


107 
__gcÚv_Œªs_fù
 
__Œªs_fù
;

108 
__gcÚv_Œªs_cÚ‹xt_fù
 
__Œªs_cÚ‹xt_fù
;

109 
__gcÚv_Œªs_’d_fù
 
__Œªs_’d_fù
;

110 *
__d©a
;

111 
__gcÚv_Œªs_d©a
 *
__Ãxt
;

116 
	s__gcÚv_¡•


118 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

119 cÚ¡ *
__modÇme
;

121 
__couÁ”
;

123 *
__äom_Çme
;

124 *
__to_Çme
;

126 
__gcÚv_fù
 
__fù
;

127 
__gcÚv_btowc_fù
 
__btowc_fù
;

128 
__gcÚv_š™_fù
 
__š™_fù
;

129 
__gcÚv_’d_fù
 
__’d_fù
;

133 
__mš_Ãeded_äom
;

134 
__max_Ãeded_äom
;

135 
__mš_Ãeded_to
;

136 
__max_Ãeded_to
;

139 
__¡©eful
;

141 *
__d©a
;

146 
	s__gcÚv_¡•_d©a


148 *
__outbuf
;

149 *
__outbuãnd
;

153 
__æags
;

157 
__švoÿtiÚ_couÁ”
;

161 
__š‹º®_u£
;

163 
__mb¡©e_t
 *
__¡©•
;

164 
__mb¡©e_t
 
__¡©e
;

168 
__gcÚv_Œªs_d©a
 *
__Œªs
;

173 
	s__gcÚv_šfo


175 
size_t
 
__n¡•s
;

176 
__gcÚv_¡•
 *
__¡•s
;

177 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
 
__æex¬r
;

178 } *
	t__gcÚv_t
;

	@/usr/include/wchar.h

23 #iâdeà
_WCHAR_H


25 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<ã©u»s.h
>

30 #ifdeà
_WCHAR_H


32 
	#__Ãed___FILE


	)

33 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


34 
	#__Ãed_FILE


	)

36 
	~<¡dio.h
>

38 
	#__Ãed___va_li¡


	)

39 
	~<¡d¬g.h
>

41 
	~<b™s/wch¬.h
>

44 
	#__Ãed_size_t


	)

45 
	#__Ãed_wch¬_t


	)

46 
	#__Ãed_NULL


	)

48 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


49 #undeà
__Ãed_wšt_t


50 
	#__Ãed_wšt_t


	)

51 
	~<¡ddef.h
>

55 #iâdeà
_WINT_T


60 
	#_WINT_T


	)

61 
	twšt_t
;

65 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
defšed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twšt_t
;

69 
	g__END_NAMESPACE_STD


74 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
____mb¡©e_t_defšed


80 
	#____mb¡©e_t_defšed
 1

	)

84 
	m__couÁ
;

87 #ifdeà
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wšt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__v®ue
;

94 } 
	t__mb¡©e_t
;

96 #undeà
__Ãed_mb¡©e_t


101 #ifdeà
_WCHAR_H


103 #iâdeà
__mb¡©e_t_defšed


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb¡©e_t_defšed
 1

	)

111 #ifdeà
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

115 #iâdeà
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #iâdeà
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


128 
	~<wùy³.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¬_t
 *
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

150 
wch¬_t
 *
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

151 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

152 
__THROW
;

155 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

156 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

158 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

159 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

160 
__THROW
;

163 
	$wcscmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
)

164 
__THROW
 
__©Œibu‹_pu»__
;

166 
	$wc¢cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

167 
__THROW
 
__©Œibu‹_pu»__
;

168 
__END_NAMESPACE_STD


170 #ifdeà
__USE_XOPEN2K8


172 
	$wcsÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

175 
	$wc¢ÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

176 
size_t
 
__n
è
__THROW
;

180 
	~<xloÿË.h
>

182 
	$wcsÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

183 
__loÿË_t
 
__loc
è
__THROW
;

185 
	$wc¢ÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

186 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

189 
__BEGIN_NAMESPACE_STD


192 
	$wcscŞl
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

196 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

197 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

198 
__END_NAMESPACE_STD


200 #ifdeà
__USE_XOPEN2K8


206 
	$wcscŞl_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

207 
__loÿË_t
 
__loc
è
__THROW
;

212 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

213 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

216 
wch¬_t
 *
	$wcsdup
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

219 
__BEGIN_NAMESPACE_STD


221 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


222 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

223 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

224 "C++" cÚ¡ 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

225 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

227 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

228 
__THROW
 
__©Œibu‹_pu»__
;

231 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


232 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

233 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

234 "C++" cÚ¡ 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

235 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

237 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

238 
__THROW
 
__©Œibu‹_pu»__
;

240 
__END_NAMESPACE_STD


242 #ifdeà
__USE_GNU


245 
wch¬_t
 *
	$wcschºul
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

246 
__THROW
 
__©Œibu‹_pu»__
;

249 
__BEGIN_NAMESPACE_STD


252 
size_t
 
	$wcsc¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__»jeù
)

253 
__THROW
 
__©Œibu‹_pu»__
;

256 
size_t
 
	$wcs¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

257 
__THROW
 
__©Œibu‹_pu»__
;

259 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


260 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

261 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

262 "C++" cÚ¡ 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
,

263 cÚ¡ 
wch¬_t
 *
__acû±
)

264 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

266 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

267 
__THROW
 
__©Œibu‹_pu»__
;

270 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


271 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

272 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

273 "C++" cÚ¡ 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

274 cÚ¡ 
wch¬_t
 *
__ÃedË
)

275 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

277 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

278 
__THROW
 
__©Œibu‹_pu»__
;

282 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

283 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__d–im
,

284 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

287 
size_t
 
	$wc¦’
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

288 
__END_NAMESPACE_STD


290 #ifdeà
__USE_XOPEN


292 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


293 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

294 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

295 "C++" cÚ¡ 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

296 cÚ¡ 
wch¬_t
 *
__ÃedË
)

297 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

299 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

300 
__THROW
 
__©Œibu‹_pu»__
;

304 #ifdeà
__USE_XOPEN2K8


306 
size_t
 
	$wc¢Ën
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

307 
__THROW
 
__©Œibu‹_pu»__
;

311 
__BEGIN_NAMESPACE_STD


313 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


314 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

316 "C++" cÚ¡ 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

317 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

320 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

321 
__THROW
 
__©Œibu‹_pu»__
;

325 
	$wmemcmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

326 
__THROW
 
__©Œibu‹_pu»__
;

329 
wch¬_t
 *
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

330 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

334 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

335 
__THROW
;

338 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

339 
__END_NAMESPACE_STD


341 #ifdeà
__USE_GNU


344 
wch¬_t
 *
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

345 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

346 
__THROW
;

350 
__BEGIN_NAMESPACE_STD


353 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

357 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

361 
	$mbsš™
 (cÚ¡ 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

365 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

366 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

367 
mb¡©e_t
 *
__»¡riù
 
__p
è
__THROW
;

370 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

371 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

374 
size_t
 
	$__mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

375 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

376 
size_t
 
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

377 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

378 
__END_NAMESPACE_STD


380 #ifdeà
__USE_EXTERN_INLINES


386 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

387 
__ex‹º_šlše
 
wšt_t


388 
	`__NTH
 (
	$btowc
 (
__c
))

389 {  (
	`__butš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

390 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

392 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

393 
__ex‹º_šlše
 

394 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

395 {  (
	`__butš_cÚ¡ªt_p
 (
__wc
è&& __wø>ğ
L
'\0' && __wc <= L'\x7f'

396 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

398 
__ex‹º_šlše
 
size_t


399 
__NTH
 (
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

400 
mb¡©e_t
 *
__»¡riù
 
__ps
))

401 {  (
__ps
 !ğ
NULL


402 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

405 
__BEGIN_NAMESPACE_STD


408 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

409 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

410 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

414 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

415 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

416 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

417 
__END_NAMESPACE_STD


420 #ifdef 
__USE_XOPEN2K8


423 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

424 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

425 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

429 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

430 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

431 
size_t
 
__nwc
, size_ˆ
__Ën
,

432 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

437 #ifdeà
__USE_XOPEN


439 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

443 
	$wcswidth
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

447 
__BEGIN_NAMESPACE_STD


450 
	$wc¡od
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

451 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

452 
__END_NAMESPACE_STD


454 #ifdeà
__USE_ISOC99


455 
__BEGIN_NAMESPACE_C99


457 
	$wc¡of
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

458 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

459 
	$wc¡Şd
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

460 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

461 
__END_NAMESPACE_C99


465 
__BEGIN_NAMESPACE_STD


468 
	$wc¡Ş
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

469 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

473 
	$wc¡oul
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

474 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

475 
__THROW
;

476 
__END_NAMESPACE_STD


478 #ifdeà
__USE_ISOC99


479 
__BEGIN_NAMESPACE_C99


482 
__ex‹nsiÚ__


483 
	$wc¡Şl
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

484 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

485 
__THROW
;

489 
__ex‹nsiÚ__


490 
	$wc¡ouÎ
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

491 
wch¬_t
 **
__»¡riù
 
__’d±r
,

492 
__ba£
è
__THROW
;

493 
__END_NAMESPACE_C99


496 #ifdeà
__USE_GNU


499 
__ex‹nsiÚ__


500 
	$wc¡oq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

501 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

502 
__THROW
;

506 
__ex‹nsiÚ__


507 
	$wc¡ouq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

508 
wch¬_t
 **
__»¡riù
 
__’d±r
,

509 
__ba£
è
__THROW
;

512 #ifdeà
__USE_GNU


526 
	~<xloÿË.h
>

530 
	$wc¡Ş_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

531 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

532 
__loÿË_t
 
__loc
è
__THROW
;

534 
	$wc¡oul_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

535 
wch¬_t
 **
__»¡riù
 
__’d±r
,

536 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

538 
__ex‹nsiÚ__


539 
	$wc¡Şl_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

540 
wch¬_t
 **
__»¡riù
 
__’d±r
,

541 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

543 
__ex‹nsiÚ__


544 
	$wc¡ouÎ_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

545 
wch¬_t
 **
__»¡riù
 
__’d±r
,

546 
__ba£
, 
__loÿË_t
 
__loc
)

547 
__THROW
;

549 
	$wc¡od_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

550 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

551 
__THROW
;

553 
	$wc¡of_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

554 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

555 
__THROW
;

557 
	$wc¡Şd_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

558 
wch¬_t
 **
__»¡riù
 
__’d±r
,

559 
__loÿË_t
 
__loc
è
__THROW
;

563 #ifdeà
__USE_XOPEN2K8


566 
wch¬_t
 *
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

567 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

571 
wch¬_t
 *
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

572 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

573 
__THROW
;

580 
__FILE
 *
	$İ’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

583 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


584 
__BEGIN_NAMESPACE_STD


587 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

594 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

595 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

601 
	`w´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

604 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

605 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

606 
__THROW
 ;

612 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

613 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

614 
__gnuc_va_li¡
 
__¬g
)

620 
	`vw´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

621 
__gnuc_va_li¡
 
__¬g
)

625 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

626 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

627 
__gnuc_va_li¡
 
__¬g
)

628 
__THROW
 ;

635 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

636 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

642 
	`wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

645 
	$swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

646 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

647 
__THROW
 ;

649 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

650 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

651 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

652 #ifdeà
__REDIRECT


656 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

657 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

658 
__isoc99_fwsÿnf
)

660 
	`__REDIRECT
 (
wsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

661 
__isoc99_wsÿnf
)

663 
	`__REDIRECT_NTH
 (
swsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

664 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

665 ...), 
__isoc99_swsÿnf
)

668 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

669 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

670 
	`__isoc99_wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

671 
	$__isoc99_swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

672 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

673 
__THROW
;

674 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

675 
	#wsÿnf
 
__isoc99_wsÿnf


	)

676 
	#swsÿnf
 
__isoc99_swsÿnf


	)

680 
__END_NAMESPACE_STD


683 #ifdeà
__USE_ISOC99


684 
__BEGIN_NAMESPACE_C99


689 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

690 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

691 
__gnuc_va_li¡
 
__¬g
)

697 
	`vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

698 
__gnuc_va_li¡
 
__¬g
)

701 
	$vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

702 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

703 
__gnuc_va_li¡
 
__¬g
)

704 
__THROW
 ;

706 #ià!
defšed
 
__USE_GNU
 \

707 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

708 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

709 #ifdeà
__REDIRECT


710 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

711 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

712 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

714 
	`__REDIRECT
 (
vwsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

715 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

717 
	`__REDIRECT_NTH
 (
vswsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

718 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

719 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

722 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

723 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

724 
__gnuc_va_li¡
 
__¬g
);

725 
	`__isoc99_vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

726 
__gnuc_va_li¡
 
__¬g
);

727 
	$__isoc99_vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

728 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

729 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

730 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

731 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

732 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

736 
__END_NAMESPACE_C99


740 
__BEGIN_NAMESPACE_STD


745 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

746 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

752 
wšt_t
 
	`g‘wch¬
 ();

759 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

760 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

766 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

774 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

775 
__FILE
 *
__»¡riù
 
__¡»am
);

781 
	`åutws
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

782 
__FILE
 *
__»¡riù
 
__¡»am
);

789 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

790 
__END_NAMESPACE_STD


793 #ifdeà
__USE_GNU


801 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

802 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

810 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

818 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

827 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

828 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

837 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

838 
__FILE
 *
__»¡riù
 
__¡»am
);

846 
	`åutws_uÆocked
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

847 
__FILE
 *
__»¡riù
 
__¡»am
);

851 
__BEGIN_NAMESPACE_C99


855 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

856 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

857 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

858 
__END_NAMESPACE_C99


860 #ifdeà
__USE_GNU


861 
	~<xloÿË.h
>

865 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

866 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

867 cÚ¡ 
tm
 *
__»¡riù
 
__
,

868 
__loÿË_t
 
__loc
è
__THROW
;

877 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


878 
	#__Ãed_iswxxx


	)

879 
	~<wùy³.h
>

883 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


884 
	~<b™s/wch¬2.h
>

887 #ifdeà
__LDBL_COMPAT


888 
	~<b™s/wch¬-ldbl.h
>

891 
__END_DECLS


899 #undeà
__Ãed_mb¡©e_t


900 #undeà
__Ãed_wšt_t


	@/usr/include/wctype.h

23 #iâdeà
_WCTYPE_H


25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 #iâdeà
__Ãed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__Ãed_wšt_t


	)

33 
	~<wch¬.h
>

37 #iâdeà
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #undeà
__Ãed_iswxxx


46 #iâdeà
__iswxxx_defšed


47 
	#__iswxxx_defšed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	twùy³_t
;

53 
	g__END_NAMESPACE_C99


55 #iâdeà
_ISwb™


60 
	~<’dŸn.h
>

61 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


62 
	#_ISwb™
(
b™
è(1 << (b™))

	)

64 
	#_ISwb™
(
b™
) \

65 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (è((1UL << (
b™
)è>> 24))))

	)

73 
	m__ISwuµ”
 = 0,

74 
	m__ISwlow”
 = 1,

75 
	m__ISw®pha
 = 2,

76 
	m__ISwdig™
 = 3,

77 
	m__ISwxdig™
 = 4,

78 
	m__ISw¥aû
 = 5,

79 
	m__ISw´št
 = 6,

80 
	m__ISwg¿ph
 = 7,

81 
	m__ISwbÏnk
 = 8,

82 
	m__ISwúŒl
 = 9,

83 
	m__ISwpunù
 = 10,

84 
	m__ISw®num
 = 11,

86 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

87 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

88 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

89 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

90 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

91 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

92 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

93 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

94 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

95 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

96 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

97 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

117 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

120 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

124 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

128 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

133 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

136 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

141 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

146 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

151 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

156 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

161 #ifdeà
__USE_ISOC99


162 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

171 
wùy³_t
 
	$wùy³
 (cÚ¡ *
__´İ”ty
è
__THROW
;

175 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 cÚ¡ 
	t__št32_t
 *
	twù¿ns_t
;

187 
__END_NAMESPACE_C99


188 #ifdeà
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

197 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifdeà
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
wù¿ns_t
 
	$wù¿ns
 (cÚ¡ *
__´İ”ty
è
__THROW
;

221 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifdeà
__USE_XOPEN2K8


226 
	~<xloÿË.h
>

230 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

236 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

239 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

243 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

247 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

252 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

255 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

260 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

265 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

270 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

275 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

280 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

284 
wùy³_t
 
	$wùy³_l
 (cÚ¡ *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

285 
__THROW
;

289 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

290 
__THROW
;

298 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

301 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

305 
wù¿ns_t
 
	$wù¿ns_l
 (cÚ¡ *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

306 
__THROW
;

309 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

310 
__loÿË_t
 
__loÿË
è
__THROW
;

314 
__END_DECLS


	@
1
.
1
/usr/include
108
2086
event/nc_epoll.c
event/nc_event.h
event/nc_evport.c
event/nc_kqueue.c
hashkit/nc_crc16.c
hashkit/nc_crc32.c
hashkit/nc_fnv.c
hashkit/nc_hashkit.h
hashkit/nc_hsieh.c
hashkit/nc_jenkins.c
hashkit/nc_ketama.c
hashkit/nc_md5.c
hashkit/nc_modula.c
hashkit/nc_murmur.c
hashkit/nc_one_at_a_time.c
hashkit/nc_random.c
hdr_histogram/hdr_atomic.h
hdr_histogram/hdr_encoding.c
hdr_histogram/hdr_encoding.h
hdr_histogram/hdr_endian.h
hdr_histogram/hdr_histogram.c
hdr_histogram/hdr_histogram.h
hdr_histogram/hdr_histogram_log.c
hdr_histogram/hdr_histogram_log.h
hdr_histogram/hdr_interval_recorder.c
hdr_histogram/hdr_interval_recorder.h
hdr_histogram/hdr_tests.h
hdr_histogram/hdr_thread.c
hdr_histogram/hdr_thread.h
hdr_histogram/hdr_time.c
hdr_histogram/hdr_time.h
hdr_histogram/hdr_writer_reader_phaser.c
hdr_histogram/hdr_writer_reader_phaser.h
nc.c
nc_array.c
nc_array.h
nc_client.c
nc_client.h
nc_conf.c
nc_conf.h
nc_connection.c
nc_connection.h
nc_core.c
nc_core.h
nc_log.c
nc_log.h
nc_mbuf.c
nc_mbuf.h
nc_message.c
nc_message.h
nc_proxy.c
nc_proxy.h
nc_queue.h
nc_rbtree.c
nc_rbtree.h
nc_request.c
nc_response.c
nc_server.c
nc_server.h
nc_signal.c
nc_signal.h
nc_stats.c
nc_stats.h
nc_string.c
nc_string.h
nc_util.c
nc_util.h
parson/parson.c
parson/parson.h
proto/nc_memcache.c
proto/nc_proto.h
proto/nc_redis.c
zkutil.c
zkutil.h
/usr/include/assert.h
/usr/include/ctype.h
/usr/include/endian.h
/usr/include/errno.h
/usr/include/execinfo.h
/usr/include/fcntl.h
/usr/include/getopt.h
/usr/include/inttypes.h
/usr/include/limits.h
/usr/include/math.h
/usr/include/netdb.h
/usr/include/netinet/in.h
/usr/include/netinet/tcp.h
/usr/include/poll.h
/usr/include/pthread.h
/usr/include/sched.h
/usr/include/signal.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/zlib.h
/usr/include/alloca.h
/usr/include/features.h
/usr/include/libio.h
/usr/include/rpc/netdb.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/stdc-predef.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
